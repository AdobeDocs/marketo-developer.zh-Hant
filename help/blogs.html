<html>
    <head>
    </head>
    <body>
<h2>January 2014 Release Updates</h2><br/><br/><h3>Forms 2.0:</h3>
Forms 2.0 empowers Marketers to create beautiful, stable, and flexible web forms without programming knowledge. In addition to the greatly improved editor, conditional logic and robust design, it’s now easier than ever to embed Marketo forms any page of your website. Developers are able to use Javascript to extend the core functionality; uses cases include:
<ul>
 	<li>Hiding a form after successful submission so the visitor remains on the page after they have filled out the form</li>
 	<li>Showing a custom error message on submit based on custom business logic</li>
 	<li>Showing the form in a lightbox style dialog box</li>
</ul>
Developer documentation available <a href="/javascript-api/forms/">here</a>.
<h3>SOAP API version 2_3 now available:</h3>
<ul>
 	<li><a href="/soap-api/getleadchanges/">getLeadChanges:</a>  Introduced request field activityNameFilter</li>
 	<li><a href="/soap-api/listoperation/">ListOperation:</a> Removed request field skipActivityLog</li>
</ul>
<b>Note:</b>  SOAP API revisions are backward compatible<br/><br/>TKaufman - 2014-01-26<br/><br/><h2>Zapier Part II: Marketo Integration Announcement</h2><br/><br/>In a <a href="/blog/seamless-integration-with-marketo-and-over-500-apps-using-zapier/">previous post</a>, we discussed how you could use Zapier to integrate external data sources with Marketo.  The post presented a hands on approach to building your own Zapier workflow (or ” Zap”) from scratch to integrate Marketo and other apps.

So you like the idea of using Zapier with Marketo, but need help getting started?

Good news!  Zapier has just released a number of example Zaps for Marketo that allow you to get going quickly:
<h6>Capture New Leads</h6>
<script src="https://zapier.com/zapbook/embed/widget.js?guided_zaps=12097,12098,12099,12100" type="text/javascript"></script>

<h6>Nurture Your Customers</h6>

<script src="https://zapier.com/zapbook/embed/widget.js?guided_zaps=12101,12102,12103,12104,12105" type="text/javascript"></script>
<h6>Distribute Contact Information</h6>
<script src="https://zapier.com/zapbook/embed/widget.js?guided_zaps=12106,12107,12108,12109" type="text/javascript"></script>

<h6>React to New Prospects</h6>

<script src="https://zapier.com/zapbook/embed/widget.js?guided_zaps=12110,12111,12112,12113" type="text/javascript"></script>

In addition to these examples, you can browse the <a href="https://zapier.com/zapbook/marketo/">Marketo integrations</a> page with hundreds of other apps on Zapier, and build your own automated workflows in minutes. No coding required.

Save time and let automation do your manual work. Get creative. The sky is the limit!<br/><br/>deverly - 2016-06-01<br/><br/><h2>Welcome to the Marketo Developer Blog</h2><br/><br/>Welcome Marketo Developers!  We've been quite busy here at Marketo releasing new features to help Marketers be more successful than ever before.  Marketers today are supported by a phenomenal developer community.  This blog is dedicated to those web developers and software engineers who support the rapidly evolving needs of the modern marketer.

As the Marketo Platform evolves we will be announcing new integration options and API version updates as they are unleashed.  We will also be introducing a new series of how-to articles where we'll share code samples and best practices on integration with the Marketo Platform.

The first article in this series will walk you through how to efficiently <a title="Retrieving customer and prospect information from Marketo using the API" href="/blog/retrieving-customer-and-prospect-information-from-marketo-using-the-api/">retrieve information on the people</a> (customers/contacts/leads) that are stored within Marketo using the API.

Please subscribe using the form above to stay up to date.  We'll email you updates as new articles are published.<br/><br/>deverly - 2014-03-06<br/><br/><h2>Retrieving customer and prospect information from Marketo using the API</h2><br/><br/>You can retrieve information about customers and prospects that are stored within Marketo using the getLead and <a href="/soap-api/getmultipleleads/">getMultipleLeads</a> SOAP API.  It is often desired to extract this information on a recurring basis to keep another system updated as customers and prospect information is updated or new records are created in Marketo.

We'll show you the code sample that would be executed on a recurring basis to poll Marketo for updates.

The below diagram depicts the API calls that are made on a set periodic timer.  Depending on the use case, the periodic timer could be set to run the below code every 10 minutes.
<p style="text-align: center;"><a href="https://marketohost.wpengine.com/wp-content/uploads/2014/03/getmultipleleads.png"><img class="aligncenter wp-image-38" src="https://marketohost.wpengine.com/wp-content/uploads/2014/03/getmultipleleads.png" alt="getmultipleleads" width="713" height="316" /></a></p>
<p style="text-align: left;">The first call to <a href="/soap-api/getmultipleleads/">getMultipleLeads</a> will set the time range, batchSize and which fields are to be returned.  All leads within Marketo that were updated in the specified time range will be returned along with a streamPosition when more records are available than the batchSize specified.</p>
<strong>SOAP Request for first call to getMultipleLeads:</strong>
<pre class="lang:default decode:true prettyprint lang-xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;ns2:paramsGetMultipleLeads xmlns:ns2="http://www.marketo.com/mktows/"&gt;
  &lt;leadSelector xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="ns2:LastUpdateAtSelector"&gt;
    &lt;latestUpdatedAt&gt;2014-02-13T11:51:08.710-08:00&lt;/latestUpdatedAt&gt;
    &lt;oldestUpdatedAt&gt;2014-02-12T11:51:08.713-08:00&lt;/oldestUpdatedAt&gt;
  &lt;/leadSelector&gt;
  &lt;batchSize&gt;2&lt;/batchSize&gt;
  &lt;includeAttributes&gt;
    &lt;stringItem&gt;FirstName&lt;/stringItem&gt;
    &lt;stringItem&gt;LastName&lt;/stringItem&gt;
    &lt;stringItem&gt;Email&lt;/stringItem&gt;
  &lt;/includeAttributes&gt;
&lt;/ns2:paramsGetMultipleLeads&gt;</pre>
<strong>SOAP Response from the first call to getMultipleLeads:
</strong>
<pre class="lang:default decode:true prettyprint lang-xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;ns2:successGetMultipleLeads xmlns:ns2="http://www.marketo.com/mktows/"&gt;
  &lt;result&gt;
 &lt;returnCount&gt;2&lt;/returnCount&gt;&lt;remainingCount&gt;24&lt;/remainingCount&gt;&lt;newStreamPosition&gt;id:1089965:to:1392234668:tl:1392321068:os:2:rc:24&lt;/newStreamPosition&gt;&lt;leadRecordList&gt;
      &lt;leadRecord&gt;
        &lt;Id&gt;84105&lt;/Id&gt;
        &lt;Email&gt;eimang@marketo.com&lt;/Email&gt;
        &lt;ForeignSysPersonId xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true" /&gt;
        &lt;ForeignSysType xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true" /&gt;
        &lt;leadAttributeList xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"&gt;
          &lt;attribute&gt;
            &lt;attrName&gt;FirstName&lt;/attrName&gt;
            &lt;attrType&gt;string&lt;/attrType&gt;
            &lt;attrValue&gt;French&lt;/attrValue&gt;
          &lt;/attribute&gt;
          &lt;attribute&gt;
            &lt;attrName&gt;LastName&lt;/attrName&gt;
            &lt;attrType&gt;string&lt;/attrType&gt;
            &lt;attrValue&gt;Lead&lt;/attrValue&gt;
          &lt;/attribute&gt;
        &lt;/leadAttributeList&gt;
      &lt;/leadRecord&gt;
      &lt;leadRecord&gt;
        &lt;Id&gt;1089965&lt;/Id&gt;
        &lt;Email&gt;t@t.com&lt;/Email&gt;
        &lt;ForeignSysPersonId xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true" /&gt;
        &lt;ForeignSysType xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true" /&gt;
        &lt;leadAttributeList xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"&gt;
          &lt;attribute&gt;
            &lt;attrName&gt;FirstName&lt;/attrName&gt;
            &lt;attrType&gt;string&lt;/attrType&gt;
            &lt;attrValue&gt;George&lt;/attrValue&gt;
          &lt;/attribute&gt;
          &lt;attribute&gt;
            &lt;attrName&gt;LastName&lt;/attrName&gt;
            &lt;attrType&gt;string&lt;/attrType&gt;
            &lt;attrValue&gt;of the Jungle&lt;/attrValue&gt;
          &lt;/attribute&gt;
        &lt;/leadAttributeList&gt;
      &lt;/leadRecord&gt;
    &lt;/leadRecordList&gt;
  &lt;/result&gt;
&lt;/ns2:successGetMultipleLeads&gt;</pre>
As long as the &lt;remainingCount/&gt; value is greater than 0, you will make subsequent calls to getMultipleLeads to paginate through the rest by passing the &lt;newStreamPosition/&gt; value  returned in the previous call into the &lt;streamPosition/&gt; parameter.

<strong>SOAP Request for subsequent call to getMultipleLeads:
</strong>
<pre class="lang:default decode:true prettyprint lang-xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;ns2:paramsGetMultipleLeads xmlns:ns2="http://www.marketo.com/mktows/"&gt;
  &lt;leadSelector xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="ns2:LastUpdateAtSelector"&gt;
    &lt;latestUpdatedAt&gt;2014-02-13T11:51:08.710-08:00&lt;/latestUpdatedAt&gt;
    &lt;oldestUpdatedAt&gt;2014-02-12T11:51:08.713-08:00&lt;/oldestUpdatedAt&gt;
  &lt;/leadSelector&gt;&lt;streamPosition&gt;id:1089965:to:1392234668:tl:1392321068:os:2:rc:24&lt;/streamPosition&gt;&lt;batchSize&gt;2&lt;/batchSize&gt;
  &lt;includeAttributes&gt;
    &lt;stringItem&gt;FirstName&lt;/stringItem&gt;
    &lt;stringItem&gt;LastName&lt;/stringItem&gt;
    &lt;stringItem&gt;Email&lt;/stringItem&gt;
  &lt;/includeAttributes&gt;
&lt;/ns2:paramsGetMultipleLeads&gt;</pre>
This logic will continue as long as &lt;remainingCount/&gt; is greater than zero.

<strong>See below a sample Java program that executes the scenario described above.
</strong>
<pre class="lang:default decode:true prettyprint lang-java ">import com.marketo.mktows.*;
import java.net.URL;
import javax.xml.namespace.QName;
import java.text.DateFormat;
import java.text.SimpleDateFormat;
import java.util.Date;
import java.util.GregorianCalendar;
import javax.crypto.Mac;
import javax.crypto.spec.SecretKeySpec;
import org.apache.commons.codec.binary.Hex;
import javax.xml.bind.JAXBContext;
import javax.xml.bind.JAXBElement;
import javax.xml.bind.Marshaller;
import javax.xml.datatype.DatatypeFactory;
import javax.xml.datatype.XMLGregorianCalendar;

public class GetMultipleLeads {
  public static void main(String[] args) {
    System.out.println("Executing GetMultipleLeads");
        try {
        URL marketoSoapEndPoint = new URL("CHANGE ME" + "?WSDL");
        String marketoUserId = "CHANGE ME";
        String marketoSecretKey = "CHANGE ME";
        QName serviceName = new QName("http://www.marketo.com/mktows/",
        "MktMktowsApiService");
        MktMktowsApiService service = new 
        MktMktowsApiService(marketoSoapEndPoint, serviceName);
        MktowsPort port = service.getMktowsApiSoapPort();

        // Create Signature
        DateFormat df = new SimpleDateFormat("yyyy-MM-dd'T'HH:mm:ssZ");
        String text = df.format(new Date());
        String requestTimestamp = text.substring(0, 22) + ":" +         text.substring(22);
        String encryptString = requestTimestamp + marketoUserId ;

        SecretKeySpec secretKey = new         SecretKeySpec(marketoSecretKey.getBytes(), "HmacSHA1");

        Mac mac = Mac.getInstance("HmacSHA1");
        mac.init(secretKey);
        byte[] rawHmac = mac.doFinal(encryptString.getBytes());
        char[] hexChars = Hex.encodeHex(rawHmac);
        String signature = new String(hexChars);

        // Set Authentication Header
        AuthenticationHeader header = new AuthenticationHeader();
        header.setMktowsUserId(marketoUserId);
        header.setRequestTimestamp(requestTimestamp);
        header.setRequestSignature(signature);

        // Create Request
        ParamsGetMultipleLeads request = new ParamsGetMultipleLeads();

        // Build Request Using LastUpdateAtSelector
        LastUpdateAtSelector leadSelector = new LastUpdateAtSelector();
        GregorianCalendar gc = new GregorianCalendar();
        gc.setTimeInMillis(new Date().getTime());
        gc.add( GregorianCalendar.DAY_OF_YEAR, -20);
        DatatypeFactory factory = DatatypeFactory.newInstance();
        ObjectFactory objectFactory = new ObjectFactory();
        JAXBElement&lt;XMLGregorianCalendar&gt; until =         objectFactory.createLastUpdateAtSelectorLatestUpdatedAt(factory.newXMLGregorianCalendar(gc));

        GregorianCalendar since = new GregorianCalendar();
        since.setTimeInMillis(new Date().getTime());
        since.add( GregorianCalendar.DAY_OF_YEAR, -21);
        leadSelector.setOldestUpdatedAt(factory.newXMLGregorianCalendar(since));
        leadSelector.setLatestUpdatedAt(until);
        request.setLeadSelector(leadSelector);

        ArrayOfString attributes = new ArrayOfString();
        attributes.getStringItems().add("FirstName");
        attributes.getStringItems().add("LastName");
        attributes.getStringItems().add("Email");
        request.setIncludeAttributes(attributes);

        JAXBElement&lt;Integer&gt; batchSize = new 
        ObjectFactory().createParamsGetMultipleLeadsBatchSize(2);
        request.setBatchSize(batchSize);

        SuccessGetMultipleLeads result = null;

        int count = 0;

        do {
        if (count &gt; 0) {
        // Set the streamPosition on subsequent calls to paginate 
        through large result sets
        String pos = result.getResult().getNewStreamPosition();
        JAXBElement&lt;String&gt; streamPos = new 
        ObjectFactory().createParamsGetMultipleLeadsStreamPosition(pos);
        request.setStreamPosition(streamPos);
        }

        JAXBContext context = 
        JAXBContext.newInstance(ParamsGetMultipleLeads.class);
        Marshaller m = context.createMarshaller();
        m.setProperty(Marshaller.JAXB_FORMATTED_OUTPUT, true);
        System.out.println("REQUEST:");
        m.marshal(request, System.out);
        result = port.getMultipleLeads(request, header);
        System.out.println("RESPONSE:");
        m.marshal(result, System.out);
        count = result.getResult().getReturnCount();
        } while (result.getResult().getRemainingCount() &gt; 0);
        }

        catch(Exception e) {
        // Update to include appropriate retry/error handling
        e.printStackTrace();
        }

  }

}</pre>
<h3>Tips &amp; Tricks:</h3>
When extracting large volumes of contacts out of Marketo it is recommended to tune the API request along the following parameters:
<ul>
 	<li>&lt;includeAttributes/&gt;: It is recommended that you only request those fields you are interested in keeping in sync with your system.  This reduces the payload of the response and increases query performance.</li>
 	<li>&lt;batchSize/&gt;: The API supports up to 1000 records to be returned in a single call.  Tuning this value down to 500 records also reduces the payload of the response.</li>
 	<li>&lt;LastUpdatedAtSelector/&gt;:  It is recommended to set both the &lt;oldestUpdatedAt/&gt; along with the &lt;latestUpdatedAt/&gt; pararameter to limit the date range.  For example, instead of making a single request for a year's worth of data.  Break up the API calls to request smaller date ranges.</li>
</ul>
&nbsp;

&nbsp;
<p style="font-size: x-small;">* This article contains code used to implement custom integrations. Due to its customized nature, The Marketo Technical Support team is unable to troubleshoot custom work. Please do not attempt to implement the following code sample without appropriate technical experience, or access to an experienced developer.</p><br/><br/>TKaufman - 2014-03-05<br/><br/><h2>February 2014 Release Updates</h2><br/><br/><h3>SOAP API Update:</h3>
<ul>
	<li><a href="/soap-api/marketo-objects/syncmobjects/">syncMObjects</a>: You can now add and update tags and channels for existing programs.</li>
</ul>
Updates are incorporated into the <a href="http://app.marketo.com/soap/mktows/2_3?WSDL" target="_blank">2_3 WSDL</a>.<br/><br/>TKaufman - 2014-02-26<br/><br/><h2>March 2014 Release Updates</h2><br/><br/><h3>SOAP API Update:</h3>
<ul>
 	<li>Performance improvements to <a href="/soap-api/synclead/">syncLead</a> and <a href="/soap-api/syncmultipleleads/">syncMultipleLeads</a></li>
</ul>
Updates are incorporated into the <a href="http://app.marketo.com/soap/mktows/2_3?WSDL" target="_blank">2_3 WSDL</a>.<br/><br/>TKaufman - 2014-03-20<br/><br/><h2>Merge Anonymous Visitor Activity when Visitor Fills Out Form</h2><br/><br/>In the blog post titled, "<a href="/blog/capture-anonymous-visitor-activity-based-on-business-logic/">Capture Anonymous Visitor Activity Based on Business Logic</a>," we discussed how to create anonymous lead records in Marketo based on custom events. In this blog post, we will build on that post, and associate an anonymous lead record with a known user after you receive the user's contact information.

Marketo's <a href="/javascript-api/lead-tracking/">Munchkin tracking code</a> helps you track visits to your website. The first time someone visits a page on your website that has the Munchkin tracking code, Marketo creates an anonymous lead and uses a browser cookie to track them. Once they identify themselves, they become a known lead and the history associated with their browser cookie is merged in their Marketo lead record.

<strong>Anonymous leads are created when someone:</strong>
<ol>
 	<li>Visits your Marketo landing page the first time</li>
 	<li>Visits a page that has Munchkin tracking code</li>
 	<li>Clicks the View as Web Page link in a Marketo email</li>
</ol>
<strong>An anonymous lead is merged into a new or existing known lead when someone:</strong>
<ol>
 	<li>Clicks a link in a Marketo email</li>
 	<li>Fills out a Marketo form</li>
 	<li>Uses one of the techniques below to associate an anonymous lead with a known record.</li>
</ol>
To submit person data, or associate a browser web-tracking cookie to the corresponding person record in Marketo, use one of the following techniques:

<strong>Browser-Side Submission</strong>

If your use case requires submission of person data from the browser, you should use <a href="http://developers.marketo.com/blog/make-a-marketo-form-submission-in-the-background/">background form submission.</a>

<strong>Server-Side Submission</strong>

If you do not need browser-side submission, the REST API offers many methods for <a href="https://developers.marketo.com/rest-api/lead-database/leads/#create_and_update">person data submission</a>, and a<a href="https://developers.marketo.com/rest-api/lead-database/leads/#associate_web_activity"> purpose-built method for associating cookies to person records</a>.<br/><br/>MManzur - 2014-04-22<br/><br/><h2>April 2014 Release Updates</h2><br/><br/><h3>Marketo Forms Security Update:</h3>
We introduced a limit on the number and frequency of form post submissions from a single IP address.  This limit is now enforced at 30 posts per minute to protect our customers from malicious use of programmatic form submissions.

The <a href="/soap-api/synclead/">syncLead API</a> is the recommended integration vehicle for programmatic submission of new contacts in Marketo.

&nbsp;

&nbsp;<br/><br/>TKaufman - 2014-04-29<br/><br/><h2>Replace your form post integration with the Marketo API</h2><br/><br/>It is common practice for Marketers using Marketo to associate success for a given marketing campaign based on the # of contacts/leads who have filled out a specific web form.  The marketer would simply create a new Marketo form, place it on a landing page and then setup a trigger campaign in Marketo to associate all contacts who filled out that specific form as a success for that Marketing program.  (see screenshot below).

&lt;IMAGE&gt;

It is a natural extension to use this same approach when recording program success even when the campaign success resides outside of someone filling out a form.  For example, when a marketer executes a promotional offer and the conversion is to call in and schedule an appointment.  The prospective customers is not filling out a form at any point in the process.

In the below article, we'll show you how to use the Marketo syncLead API to create a new contact if they are new contacts, and then requestCampaign API to record the success for a given marketing program.<br/><br/>TKaufman - 1970-01-01<br/><br/><h2>Delete a Lead with the Marketo API</h2><br/><br/>Let's say you would like to delete a lead via the Marketo API. You can accomplish this by calling the <a href="/soap-api/requestcampaign/">requestCampaign API</a> on a campaign that has a predefined flow action to delete a lead.

We'll show you first how to create a Smart Campaign, second how to set up a trigger to run a campaign via the API, third how to define deleting a lead as part of a flow action, and fourth a code sample that would be used to execute this campaign.

<strong>How to Create a New Smart Campaign in Marketo</strong>

Smart Campaigns in Marketo execute all of your marketing activities. In a Smart Campaign, you can set up a series of automated actions to take on a smart list of contacts. In the case of deleting a lead, you set up a trigger in the campaign as shown below. First let's set up the Smart Campaign.

1. In Marketing Activities, choose a Program and then under the New dropdown, click on New Local Asset

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/05/smart1.png"><img class="alignnone size-full wp-image-190" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2014/05/smart1.png" alt="smart1" width="603" height="243" /></a>

2. Click on Smart Campaign

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/05/smart2.png"><img class="alignnone size-full wp-image-192" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2014/05/smart2.png" alt="smart2" width="573" height="306" /></a>

3. Enter smart campaign name and click Create

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/05/smart3.png"><img class="alignnone size-full wp-image-194" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2014/05/smart3.png" alt="smart3" width="520" height="330" /></a>

<strong>Add Triggers to a Smart Campaign</strong>

Adding Triggers to a Smart Campaign allows you to make a Smart Campaign run on one person at a time based on a live event, which in this case is a request via the <a href="/soap-api/requestcampaign/">requestCampaign API</a>.

1. Search for the "Campaign is Requested" trigger and then drag and drop it to the canvas.
<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/05/campaignrequest.png"><img class="alignnone size-full wp-image-216" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2014/05/campaignrequest.png" alt="campaignrequest" width="602" height="296" /></a>
2. In the trigger, select "is" and "Web Service API."
<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/05/webserviceapi.png"><img class="alignnone size-full wp-image-202" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2014/05/webserviceapi.png" alt="webserviceapi" width="562" height="138" /></a>

<strong>How to Create a Delete a Lead Flow Action on a Campaign</strong>

Click on Flow in the top menu. From the menu on the right-side, search for Delete Lead, and then drag it to the center to add it as a trigger to the campaign.

Note: If you delete a lead from Marketo only and leave it in your CRM, when any of that lead's data is updated, the lead will be recreated in Marketo.

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/05/deletelead.png"><img class="alignnone size-full wp-image-782" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2014/05/deletelead.png" alt="deletelead" width="631" height="134" /></a>

<strong>Code Sample to Call the requestCampaign API</strong>

After setting up the campaign and triggers in the Marketo interface, we will show you how to use the API to run this campaign. The first sample is a XML request, the second is a XML response, and the final one is a Java code sample that can be used to generate the XML request. We also show you how to find the campaign ID that is used when making a call to the requestCampaign API.

The API call also requires you to know the ID of the Marketo campaign beforehand. You can determine the campaign ID using either of the following methods:

1. Use the <a href="/soap-api/getcampaignsforsource/">getCampaignsForSource</a> API

2. Open the Marketo campaign in a browser and look at the URL address bar. The campaign ID (represented as a 4-digit integer) can be found immediately following "SC". For example, https://app-stage.marketo.com/#SC<strong>1025</strong>A1. The bolded portion is the campaign ID - "1025."

SOAP Request for requestCampaign
<pre class="lang:default decode:true prettyprint linenums lang-xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;SOAP-ENV:Envelope xmlns:SOAP-ENV="http://schemas.xmlsoap.org/soap/envelope/" xmlns:ns1="http://www.marketo.com/mktows/"&gt;
  &lt;SOAP-ENV:Header&gt;
    &lt;ns1:AuthenticationHeader&gt;
      &lt;mktowsUserId&gt;demo17_1_809939944BFABAE58E5D27&lt;/mktowsUserId&gt;&lt;requestSignature&gt;48397ad47b71a1439f13a51eea3137df46441979&lt;/requestSignature&gt;&lt;requestTimestamp&gt;2013-08-01T12:31:14-07:00&lt;/requestTimestamp&gt;
    &lt;/ns1:AuthenticationHeader&gt;
  &lt;/SOAP-ENV:Header&gt;
  &lt;SOAP-ENV:Body&gt;
    &lt;ns1:paramsRequestCampaign&gt;
      &lt;source&gt;MKTOWS&lt;/source&gt;
      &lt;campaignId&gt;4496&lt;/campaignId&gt;
      &lt;leadList&gt;
        &lt;leadKey&gt;
          &lt;keyType&gt;EMAIL&lt;/keyType&gt;
          &lt;keyValue&gt;lead@company.com&lt;/keyValue&gt;
        &lt;/leadKey&gt;
        &lt;leadKey&gt;
          &lt;keyType&gt;EMAIL&lt;/keyType&gt;
          &lt;keyValue&gt;anotherlead@company.com&lt;/keyValue&gt;
        &lt;/leadKey&gt;
      &lt;/leadList&gt;
    &lt;/ns1:paramsRequestCampaign&gt;
  &lt;/SOAP-ENV:Body&gt;
&lt;/SOAP-ENV:Envelope&gt;</pre>
SOAP Response for requestCampaign
<pre class="lang:default decode:true prettyprint linenums lang-xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;SOAP-ENV:Envelope xmlns:SOAP-ENV="http://schemas.xmlsoap.org/soap/envelope/" xmlns:ns1="http://www.marketo.com/mktows/"&gt;
  &lt;SOAP-ENV:Body&gt;
    &lt;ns1:successRequestCampaign&gt;
      &lt;result&gt;
        &lt;success&gt;true&lt;/success&gt;
      &lt;/result&gt;
    &lt;/ns1:successRequestCampaign&gt;
  &lt;/SOAP-ENV:Body&gt;
&lt;/SOAP-ENV:Envelope&gt;</pre>
See below a sample Java program that executes the scenario described above.
<pre class="lang:default decode:true prettyprint lang-java">import com.marketo.mktows.*;
import java.net.URL;
import javax.xml.namespace.QName;
import java.text.DateFormat;
import java.text.SimpleDateFormat;
import java.util.Date;
import javax.crypto.Mac;
import javax.crypto.spec.SecretKeySpec;
import org.apache.commons.codec.binary.Hex;
import javax.xml.bind.JAXBContext;
import javax.xml.bind.JAXBElement;
import javax.xml.bind.Marshaller;
 
 
public class RequestCampaign {
 
    public static void main(String[] args) {
        System.out.println("Executing Request Campaign");
        try {
            URL marketoSoapEndPoint = new URL("CHANGE ME" + "?WSDL");
            String marketoUserId = "CHANGE ME";
            String marketoSecretKey = "CHANGE ME";
             
            QName serviceName = new QName("http://www.marketo.com/mktows/", "MktMktowsApiService");
            MktMktowsApiService service = new MktMktowsApiService(marketoSoapEndPoint, serviceName);
            MktowsPort port = service.getMktowsApiSoapPort();
             
            // Create Signature
            DateFormat df = new SimpleDateFormat("yyyy-MM-dd'T'HH:mm:ssZ");
            String text = df.format(new Date());
            String requestTimestamp = text.substring(0, 22) + ":" + text.substring(22);           
            String encryptString = requestTimestamp + marketoUserId ;
             
            SecretKeySpec secretKey = new SecretKeySpec(marketoSecretKey.getBytes(), "HmacSHA1");
            Mac mac = Mac.getInstance("HmacSHA1");
            mac.init(secretKey);
            byte[] rawHmac = mac.doFinal(encryptString.getBytes());
            char[] hexChars = Hex.encodeHex(rawHmac);
            String signature = new String(hexChars); 
             
            // Set Authentication Header
            AuthenticationHeader header = new AuthenticationHeader();
            header.setMktowsUserId(marketoUserId);
            header.setRequestTimestamp(requestTimestamp);
            header.setRequestSignature(signature);
             
            // Create Request
            ParamsRequestCampaign request = new ParamsRequestCampaign();
             
            request.setSource(ReqCampSourceType.MKTOWS);
             
            ObjectFactory objectFactory = new ObjectFactory();
            JAXBElement&lt;Integer&gt; campaignId = objectFactory.createParamsRequestCampaignCampaignId(4496);
            request.setCampaignId(campaignId);
             
            ArrayOfLeadKey leadKeyList = new ArrayOfLeadKey();
            LeadKey key = new LeadKey();
            key.setKeyType(LeadKeyRef.EMAIL);
            key.setKeyValue("lead@company.com");
             
            LeadKey key2 = new LeadKey();
            key2.setKeyType(LeadKeyRef.EMAIL);
            key2.setKeyValue("anotherlead@company.com");
             
            leadKeyList.getLeadKeies().add(key);
            leadKeyList.getLeadKeies().add(key2);
             
            JAXBElement&lt;ArrayOfLeadKey&gt; arrayOfLeadKey = objectFactory.createParamsRequestCampaignLeadList(leadKeyList);
            request.setLeadList(arrayOfLeadKey);
 
            SuccessRequestCampaign result = port.requestCampaign(request, header);
 
            JAXBContext context = JAXBContext.newInstance(SuccessRequestCampaign.class);
            Marshaller m = context.createMarshaller();
            m.setProperty(Marshaller.JAXB_FORMATTED_OUTPUT, true);
            m.marshal(result, System.out);
             
        }
        catch(Exception e) {
            e.printStackTrace();
        }
    }
}</pre>
<p style="font-size: x-small;">* This article contains code used to implement custom integrations. Due to its customized nature, The Marketo Technical Support team is unable to troubleshoot custom work. Please do not attempt to implement the following code sample without appropriate technical experience, or access to an experienced developer.</p><br/><br/>MManzur - 2014-05-16<br/><br/><h2>Custom Activity Tracking with the Munchkin API</h2><br/><br/>Let's you want to track custom activity in Marketo. For example, you have a video on webpage, and want to track visitors who watch more than 50% of a video. You can do this using Munchkin's custom activity tracking feature. This would be implemented by listening for an event on the page, which is the video reaching 50%, and then calling the Munchkin API. 

To do this, we'll have to set up a custom activity in Marketo to call based on this event on the page. We will use YouTube for the video player, and use their <a href="https://developers.google.com/youtube/iframe_api_reference">YouTube Iframe API</a> to call the method on the Munchkin API. 

We’ll show you first how to generate Munchkin tracking code in Marketo, second how to modify your Munchkin sample code to trigger based on page events, third how to set up a campaign with a smart list that is defined by actions on the page with flows steps, and fifth how toverify that a page visit from an anonymous user was recorded in Marketo. 

====
This blog post is live example of the code being explained. Please fill out this form, so you are a known user in Marketo. This way when you watch 50% of video, it will send you rest of video, and if you watch 100% of video it will send you a link to another blog post. 
===

https://developers.google.com/youtube/iframe_api_reference

<strong>How to Generate Munchkin Tracking Code</strong>

The Munchkin tracking code allows you to track visits to your web site. There are three types of Munchkin code described below, but in this example we will use the Asynchronous Munchkin tracking code.

A) Simple: has the fewest lines of code, but does not optimize for webpage loading time. This code loads the jQuery library each time a webpage is loaded.

B) Asynchronous: reduces webpage loading time. This code checks if the jQuery library already exists, loads it if it's missing, and uses it for executing tracking code once the rest of the webpage has loaded.

C) Asynchronous jQuery: reduces webpage loading time and also improves system performance. This code assumes that you already have jQuery, and does not check to load it.

1. Click Admin at the top right of the app.

<a href="http://developers.marketo.com/blog/wp-content/uploads/2014/04/14.png"><img src="http://developers.marketo.com/blog/wp-content/uploads/2014/04/14.png" alt="1" width="650" height="350" class="alignnone size-full wp-image-492" style="border-style: solid; border-width: 1px; border-color: black;" /></a>

2. Click Munchkin in the tree on the left.

<a href="http://developers.marketo.com/blog/wp-content/uploads/2014/04/21.png"><img src="http://developers.marketo.com/blog/wp-content/uploads/2014/04/21.png" alt="2" width="650" height="394" class="alignnone size-full wp-image-490" style="border-style: solid; border-width: 1px; border-color: black;" /></a>

3. Select Asynchronous for Tracking Code Type.

<a href="http://developers.marketo.com/blog/wp-content/uploads/2014/04/31.png"><img src="http://developers.marketo.com/blog/wp-content/uploads/2014/04/31.png" alt="3" width="538" height="392" class="alignnone size-full wp-image-488" style="border-style: solid; border-width: 1px; border-color: black;" /></a>

4. Click and copy the Javascript tracking code to put on your website.

<a href="http://developers.marketo.com/blog/wp-content/uploads/2014/04/41.png"><img src="http://developers.marketo.com/blog/wp-content/uploads/2014/04/41.png" alt="4" width="543" height="530" class="alignnone size-full wp-image-486" style="border-style: solid; border-width: 1px; border-color: black;" /></a>

<strong>YouTube Code</strong>

https://developers.google.com/youtube/js_api_reference#EventHandlers
https://developers.google.com/youtube/iframe_api_reference
player.getCurrentTime():Number
Returns the elapsed time in seconds since the video started playing.

player.getDuration():Number
Returns the duration in seconds of the currently playing video. Note that getDuration() will return 0 until the video's metadata is loaded, which normally happens just after the video starts playing.
When a non-cookied user goes to a page with the Munchkin tracking code, a new cookie will be created and stored on the user's browser, and a new anonymous lead will be created in Marketo. If the user is already cookied and the user is an existing lead in Marketo, the visit to the page will be recorded in the activity log of the user in Marketo. 



<strong>Code Sample to Cookie User and Track Event</strong>

Place the tracking code on your web pages right before the &lt;/body&gt; tag. Landing pages created in Marketo automatically contain tracking code, so you don’t need to put this code on them.

<a href="http://developers.marketo.com/blog/wp-content/uploads/2014/04/61.png"><img src="http://developers.marketo.com/blog/wp-content/uploads/2014/04/61.png" alt="6" width="655" height="369" class="alignnone size-full wp-image-484" style="border-style: solid; border-width: 1px; border-color: black;" /></a>This code sample would call the Munchkin API after the script is loaded:

<script type="text/javascript" src="https://google-code-prettify.googlecode.com/svn/loader/run_prettify.js"></script>
<pre class="prettyprint linenums lang-js">
&lt;script type=&quot;text/javascript&quot;&gt;
(function() {
  var didInit = false;
  function initMunchkin() {
    if(didInit === false) {
      didInit = true;
      Munchkin.init('XXX-XXX-XXX');
    }
  }
  var s = document.createElement('script');
  s.type = 'text/javascript';
  s.async = true;
  s.src = '//munchkin.marketo.net/munchkin.js';
  s.onreadystatechange = function() {
    if (this.readyState == 'complete' || this.readyState == 'loaded') {
      initMunchkin();
    }
  };
  s.onload = initMunchkin;
  document.getElementsByTagName('head')[0].appendChild(s);
})();
&lt;/script&gt;
</pre>

This code sample would call the Munchkin API after the user has been on the page for 5 seconds and has also scrolled 500 pixels down the page:

<pre class="prettyprint linenums lang-js">
&lt;script src="https://code.jquery.com/jquery-2.1.0.min.js"&gt;&lt;/script&gt; 
&lt;script type="text/javascript"&gt;
$(function(){
	setTimeout(function(){
		$(window).scroll(function() {
    		var y_scroll_position = window.pageYOffset;
    		var scroll_position = 500; //Sets number of pixels user must scroll to be tracked        
		
		if(y_scroll_position > scroll_position) {
		//Munchkin tracking code
			(function() {
  			var didInit = false;
  			function initMunchkin() {
    		if(didInit === false) {
      		didInit = true;
      		Munchkin.init('XXX-XXX-XXX');
    		}
  			}
  			
  			var s = document.createElement('script');
  			s.type = 'text/javascript';
  			s.async = true;
 			s.src = '//munchkin.marketo.net/munchkin.js';
  			s.onreadystatechange = function() {
    		if (this.readyState == 'complete' || this.readyState == 'loaded') {
     	    initMunchkin();
    		}
  			};
  			s.onload = initMunchkin;
  			document.getElementsByTagName('head')[0].appendChild(s);
			})();
	 	}			
	},5000); //Sets time delay before tracking user
});
&lt;/script&gt;
</pre>

<strong>How to Verify Page Visit by Anonymous User Was Recorded in Marketo</strong>

1. Click on Analytics in the top menu, and then click on New Report. Choose Web Page Activity as report type, and then name your report. 

<a href="http://developers.marketo.com/blog/wp-content/uploads/2014/04/Screenshot-Web-Page-Activity.png"><img src="http://developers.marketo.com/blog/wp-content/uploads/2014/04/Screenshot-Web-Page-Activity.png" alt="Screenshot - Web Page Activity" width="1424" height="571" class="alignnone size-full wp-image-618" style="border-style: solid; border-width: 1px; border-color: black;" /></a>

2. After you create a report, click on Smart List. Then select the Visited Web Page filter from the box on the right. Enter the web page where you put the Munchkin tracking code.  

<a href="http://developers.marketo.com/blog/wp-content/uploads/2014/04/Screenshot-Smart-List.png"><img src="http://developers.marketo.com/blog/wp-content/uploads/2014/04/Screenshot-Smart-List.png" alt="Screenshot - Smart List" width="1428" height="420" class="alignnone size-full wp-image-614" style="border-style: solid; border-width: 1px; border-color: black;" /></a>

3. Click on Setup. Select Anonymous Visitors from ISPs, and change option to Shown.

<a href="http://developers.marketo.com/blog/wp-content/uploads/2014/04/Screenshot-Show-anonymous.png"><img src="http://developers.marketo.com/blog/wp-content/uploads/2014/04/Screenshot-Show-anonymous.png" alt="Screenshot - Show anonymous" width="1422" height="473" class="alignnone size-full wp-image-616" style="border-style: solid; border-width: 1px; border-color: black;" /></a>

4. Click on Report. You will now see activity tracked on the web page you selected. 

<a href="http://developers.marketo.com/blog/wp-content/uploads/2014/04/Screenshot-Report-1.png"><img src="http://developers.marketo.com/blog/wp-content/uploads/2014/04/Screenshot-Report-1.png" alt="Screenshot - Report 1" width="1417" height="454" class="alignnone size-full wp-image-620" style="border-style: solid; border-width: 1px; border-color: black;" /></a>

5. Double click on the lead record, which will then show the activity log where you can see the specific page the anonymous user visited.  

<a href="http://developers.marketo.com/blog/wp-content/uploads/2014/04/Screenshot-Report-2.png"><img src="http://developers.marketo.com/blog/wp-content/uploads/2014/04/Screenshot-Report-2.png" alt="Screenshot - Report 2" width="1409" height="562" class="alignnone size-full wp-image-622" style="border-style: solid; border-width: 1px; border-color: black;" /></a>




<p style="font-size: x-small;">* This article contains code used to implement custom integrations. Due to its customized nature, The Marketo Technical Support team is unable to troubleshoot custom work. Please do not attempt to implement the following code sample without appropriate technical experience, or access to an experienced developer.</p>




















For pages with multimedia content, for instance, you may wish to do custom tracking. One common example is to add Munchkin tracking code to the page, and also use the Munchkin API to generate events in your Marketo instance for activities such as playing a video or listening to an audio clip.

We recommend that you put Munchkin tracking code on most or all of your Web pages. Munchkin tracking code is automatically included in landing pages that you create using Marketo.

--------
Use this call to record that the user did something, like visit a page in Ajax, Flash, or other RIA environment. The URL must not contain " or any domain, but it can point to any page -- even pages that don't exist. If you want to add URL parameters, use the params argument.

The event shows up as a Visit Web Page event in the user's activity log under the domain of the calling web page.
 

Note
Your first call to mktoMunchkin() always creates a Visit Web Page event for the current page. You do not need to call visitWebPage unless you want to track an additional web page visit.

 

mktoMunchkinFunction('visitWebPage', {
    url: '/MyFlashMovie/Story1', params: 'x=y&2=3'
});
-----------


 

Note
Please ensure that you have access to an experienced JavaScript developer.  Marketo Technical Support is not set up to assist with troubleshooting custom JavaScript. 


The Munchkin Javascript API allows you to integrate a third-party web system with your Marketo Account. With some web development, you can capture new leads or update current leads with existing applications on your web site.

Let's say you have a web application for customer registration that captures new customer information. With just a bit of programming, you can also have lead information for those users captured in Marketo, and a Marketo cookie set for future web tracking. In addition, another feature allows your web developers to capture and track web activity information from rich web environments such as Flash or Ajax.
 

Note
If you have the appropriate development resources, you should consider using our SOAP API for integration instead of this API. The SOAP API is more robust and has more functionality than the Munchkin API.


Marketo SOAP API

Requirements

You must include the Munchkin Javascript code on your web page for any of this to work. You can find the needed script tags in the Munchkin Tutorial. You must also enable the Munchkin API, which is also described in the Tutorial.

Under the Hood

After you make a Munchkin API call, it automatically cookies the user if they don't have a cookie.

In Marketo, it logs the event (click link, visit web page, or new lead) in the person's Activity Log.

If you're using the click link or visit web page call, the event will get added to that lead's Activity Log (known or anonymous). 

If this is a new lead and you use the associate lead call, that lead will become a known lead and their activity history will be preserved.

If this is an existing lead (based on email address match), any changed or new values will get updated in that lead's record.

Calling Munchkin API Functions

Here's the general form of a munchkinFunction call.  Include it between <script> tags in your web page wherever you want to call it.

You can invoke this like any other Javascript function. However, you must call the Munchkin tracking function mktoMunchkin() before making any mktoMunchkinFunction() calls:

<script src="http://munchkin.marketo.net/munchkin.js" type="text/javascript"></script>
<script>
  mktoMunchkin("###-###-###");
  mktoMunchkinFunction('function',
                       { key: 'value', key2: 'value'},
                       'hash');
</script>

where:

###-###-### is the Munchkin account ID for your account
function is the call you want to make
params is an array of parameters needed for the call
hash is only needed for associateLead<br/><br/>MManzur - 1970-01-01<br/><br/><h2>Getting Data into Marketo</h2><br/><br/>The presentation below shows you the different ways of getting data into Marketo. It focuses on forms, custom objects, and integrations.

<iframe src="http://www.slideshare.net/slideshow/embed_code/35662408" width="597" height="486" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" style="border:1px solid #CCC; border-width:1px 1px 0; margin-bottom:5px; max-width: 100%;" allowfullscreen> </iframe> <div style="margin-bottom:5px"> <strong> <a href="https://www.slideshare.net/MurtzaManzur/getting-data-into-marketo-35662408" title="Getting Data into Marketo " target="_blank">Getting Data into Marketo </a> </strong> from <strong><a href="http://www.slideshare.net/MurtzaManzur" target="_blank">Murtza Manzur</a></strong> </div><br/><br/>MManzur - 2014-06-06<br/><br/><h2>Creating Leads in a Workspace</h2><br/><br/>Let's say your company has two divisions: North America and Europe. You would like to segment your leads based on company division  in Marketo. You can accomplish this using workspaces, which is a feature in Marketo that allows you to limit access to leads. To do this, you would create a workspace for North America and another for Europe. You can then create a lead in particular workspace using the <a href="http://developers.marketo.com/documentation/soap/synclead/">syncLead API</a>. 

You should consider using workspaces and lead partitions if your organization has:
<ol>
<li>Separate marketing teams for multiple product lines</li>
<li>Separate marketing teams for different territories or countries</li>
<li>A parent company and subsidiary companies</li>
<li>A parent company and resellers</li></ol>

When you use lead partitions and workspaces, you can:
<ol>
<li>Restrict access to leads in your organization</li>
<li>Restrict access to assets in your organization</li>
<li>Share assets across marketing teams</li>
</ol>

We'll show you first how to create a workspace in Marketo via the UI, and second how to write a lead to that workspace using the <a href="http://developers.marketo.com/documentation/soap/synclead/">syncLead API</a>.

<strong>Creating a Workspace</strong>

A workspace is a set of leads and Marketo assets.  In a workspace, you can only see leads from that workspace and assets (emails, campaigns, lists, etc) in that workspace.  Smart campaigns in that workspace only affect leads in that workspace. To see the workspaces in your account:

1. Go to the Workspaces & Lead Partitions page of the Admin section.  Your workspaces will appear in the Workspaces tab.

<a href="http://developers.marketo.com/blog/wp-content/uploads/2014/06/workspace_tab.png"><img src="http://developers.marketo.com/blog/wp-content/uploads/2014/06/workspace_tab.png" alt="workspace_tab" width="997" height="290" class="alignnone size-full wp-image-863" style="border-style: solid; border-width: 1px; border-color: black;" /></a>

2. To create a new workspace, click the New Workspace button in the menu bar of the Workspaces tab:

<a href="http://developers.marketo.com/blog/wp-content/uploads/2014/06/workspace2.png"><img src="http://developers.marketo.com/blog/wp-content/uploads/2014/06/workspace2.png" alt="workspace2" width="488" height="223" class="alignnone size-full wp-image-857" style="border-style: solid; border-width: 1px; border-color: black;" /></a>

3. In the dialog, you'll need to add some information about the new workspace:

<strong>Workspace Name</strong> - the name of this workspace as it will appear in the interface
<strong>Description</strong> - an optional text description of the workspace
<strong>Lead Partitions</strong> - which leads are visible in this partition.
<strong>All Lead Partitions</strong> - will see leads from all present and future partitions
<strong>Select individual partitions</strong> - only leads from those partitions (and no future partitions) are visible
<strong>Primary Lead Partition</strong> - leads who visit your landing pages are added to this partition by default
<strong>Language</strong> - the business language of this workspace

<a href="http://developers.marketo.com/blog/wp-content/uploads/2014/06/workspace3.png"><img src="http://developers.marketo.com/blog/wp-content/uploads/2014/06/workspace3.png" alt="workspace3" width="600" height="554" class="alignnone size-full wp-image-855" style="border-style: solid; border-width: 1px; border-color: black;" /></a>

<strong>How to Write a Lead in a Workspace via the API</strong>
<script type="text/javascript" src="https://google-code-prettify.googlecode.com/svn/loader/run_prettify.js"></script>

We will show you how to use the API write leads to a particular workspace. The first sample is a XML request, the second is a XML response, and the final one is a Ruby code sample that can be used to generate the XML request. 

1. After creating lead, Lead Partition is a field on Lead Info. 

SOAP Request for requestCampaign

<pre class="prettyprint linenums lang-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;SOAP-ENV:Envelope xmlns:SOAP-ENV=&quot;http://schemas.xmlsoap.org/soap/envelope/&quot; xmlns:ns1=&quot;http://www.marketo.com/mktows/&quot;&gt;
  &lt;SOAP-ENV:Header&gt;
    &lt;ns1:AuthenticationHeader&gt;
      &lt;mktowsUserId&gt;demo17_1_809939944BFABAE58E5D27&lt;/mktowsUserId&gt;&lt;requestSignature&gt;48397ad47b71a1439f13a51eea3137df46441979&lt;/requestSignature&gt;&lt;requestTimestamp&gt;2013-08-01T12:31:14-07:00&lt;/requestTimestamp&gt;
    &lt;/ns1:AuthenticationHeader&gt;
  &lt;/SOAP-ENV:Header&gt;
  &lt;SOAP-ENV:Body&gt;
    &lt;ns1:paramsRequestCampaign&gt;
      &lt;source&gt;MKTOWS&lt;/source&gt;
      &lt;campaignId&gt;4496&lt;/campaignId&gt;
      &lt;leadList&gt;
        &lt;leadKey&gt;
          &lt;keyType&gt;EMAIL&lt;/keyType&gt;
          &lt;keyValue&gt;lead@company.com&lt;/keyValue&gt;
        &lt;/leadKey&gt;
        &lt;leadKey&gt;
          &lt;keyType&gt;EMAIL&lt;/keyType&gt;
          &lt;keyValue&gt;anotherlead@company.com&lt;/keyValue&gt;
        &lt;/leadKey&gt;
      &lt;/leadList&gt;
    &lt;/ns1:paramsRequestCampaign&gt;
  &lt;/SOAP-ENV:Body&gt;
&lt;/SOAP-ENV:Envelope&gt;</pre>

SOAP Response for requestCampaign

<pre class="prettyprint linenums lang-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;SOAP-ENV:Envelope xmlns:SOAP-ENV=&quot;http://schemas.xmlsoap.org/soap/envelope/&quot; xmlns:ns1=&quot;http://www.marketo.com/mktows/&quot;&gt;
  &lt;SOAP-ENV:Body&gt;
    &lt;ns1:successRequestCampaign&gt;
      &lt;result&gt;
        &lt;success&gt;true&lt;/success&gt;
      &lt;/result&gt;
    &lt;/ns1:successRequestCampaign&gt;
  &lt;/SOAP-ENV:Body&gt;
&lt;/SOAP-ENV:Envelope&gt;</pre>

See below a sample Java program that executes the scenario described above.

<pre class="prettyprint lang-java">import com.marketo.mktows.*;
import java.net.URL;
import javax.xml.namespace.QName;
import java.text.DateFormat;
import java.text.SimpleDateFormat;
import java.util.Date;
import javax.crypto.Mac;
import javax.crypto.spec.SecretKeySpec;
import org.apache.commons.codec.binary.Hex;
import javax.xml.bind.JAXBContext;
import javax.xml.bind.JAXBElement;
import javax.xml.bind.Marshaller;
 
 
public class RequestCampaign {
 
    public static void main(String[] args) {
        System.out.println(&quot;Executing Request Campaign&quot;);
        try {
            URL marketoSoapEndPoint = new URL(&quot;CHANGE ME&quot; + &quot;?WSDL&quot;);
            String marketoUserId = &quot;CHANGE ME&quot;;
            String marketoSecretKey = &quot;CHANGE ME&quot;;
             
            QName serviceName = new QName(&quot;http://www.marketo.com/mktows/&quot;, &quot;MktMktowsApiService&quot;);
            MktMktowsApiService service = new MktMktowsApiService(marketoSoapEndPoint, serviceName);
            MktowsPort port = service.getMktowsApiSoapPort();
             
            // Create Signature
            DateFormat df = new SimpleDateFormat(&quot;yyyy-MM-dd&#039;T&#039;HH:mm:ssZ&quot;);
            String text = df.format(new Date());
            String requestTimestamp = text.substring(0, 22) + &quot;:&quot; + text.substring(22);           
            String encryptString = requestTimestamp + marketoUserId ;
             
            SecretKeySpec secretKey = new SecretKeySpec(marketoSecretKey.getBytes(), &quot;HmacSHA1&quot;);
            Mac mac = Mac.getInstance(&quot;HmacSHA1&quot;);
            mac.init(secretKey);
            byte[] rawHmac = mac.doFinal(encryptString.getBytes());
            char[] hexChars = Hex.encodeHex(rawHmac);
            String signature = new String(hexChars); 
             
            // Set Authentication Header
            AuthenticationHeader header = new AuthenticationHeader();
            header.setMktowsUserId(marketoUserId);
            header.setRequestTimestamp(requestTimestamp);
            header.setRequestSignature(signature);
             
            // Create Request
            ParamsRequestCampaign request = new ParamsRequestCampaign();
             
            request.setSource(ReqCampSourceType.MKTOWS);
             
            ObjectFactory objectFactory = new ObjectFactory();
            JAXBElement&lt;Integer&gt; campaignId = objectFactory.createParamsRequestCampaignCampaignId(4496);
            request.setCampaignId(campaignId);
             
            ArrayOfLeadKey leadKeyList = new ArrayOfLeadKey();
            LeadKey key = new LeadKey();
            key.setKeyType(LeadKeyRef.EMAIL);
            key.setKeyValue(&quot;lead@company.com&quot;);
             
            LeadKey key2 = new LeadKey();
            key2.setKeyType(LeadKeyRef.EMAIL);
            key2.setKeyValue(&quot;anotherlead@company.com&quot;);
             
            leadKeyList.getLeadKeies().add(key);
            leadKeyList.getLeadKeies().add(key2);
             
            JAXBElement&lt;ArrayOfLeadKey&gt; arrayOfLeadKey = objectFactory.createParamsRequestCampaignLeadList(leadKeyList);
            request.setLeadList(arrayOfLeadKey);
 
            SuccessRequestCampaign result = port.requestCampaign(request, header);
 
            JAXBContext context = JAXBContext.newInstance(SuccessRequestCampaign.class);
            Marshaller m = context.createMarshaller();
            m.setProperty(Marshaller.JAXB_FORMATTED_OUTPUT, true);
            m.marshal(result, System.out);
             
        }
        catch(Exception e) {
            e.printStackTrace();
        }
    }
}</pre>



<strong>How do I sign up for Workspaces and Lead Partitions?</strong>

For Marketo Enterprise customers, you have free access to workspaces and lead partitions.  Contact your customer enablement manager for details on enabling and implementing them. For other customers, please contact your Marketo sales executive or email our sales team for more information on this product.




<p style="font-size: x-small;">* This article contains code used to implement custom integrations. Due to its customized nature, The Marketo Technical Support team is unable to troubleshoot custom work. Please do not attempt to implement the following code sample without appropriate technical experience, or access to an experienced developer.</p><br/><br/>MManzur - 1970-01-01<br/><br/><h2>June 2014 Release Updates</h2><br/><br/><h3>REST APIs ARE HERE:</h3>
You heard right, the highly anticipated Marketo REST APIs are here and now available in your Marketo subscription. We introduced over 13 new API endpoints spanning operations for Leads, Lists and Campaigns.

<strong>Endpoints for Leads</strong>
<ul>
 	<li><a href="/documentation/rest/get-lead-by-id/">Get Lead by ID</a></li>
 	<li><a href="/documentation/rest/get-multiple-leads-by-filter-type">Get Multiple Leads by Filter Type</a></li>
 	<li><a href="/documentation/rest/get-multiple-leads-by-list-id">Get Multiple Leads by List ID</a></li>
 	<li><a href="/documentation/rest/createupdate-leads/">Create/Update Leads</a></li>
</ul>
<strong>Endpoints for Lists</strong>
<ul>
 	<li><a href="/documentation/rest/get-list-by-id/">Get List by ID</a></li>
 	<li><a href="/documentation/rest/get-multiple-lists/">Get Multiple Lists</a></li>
 	<li><a href="/documentation/rest/add-leads-to-list/">Add Leads to List</a></li>
 	<li><a href="/documentation/rest/remove-leads-from-list/">Remove Leads from List</a></li>
 	<li><a href="/documentation/rest/member-of-list/">Member of List</a></li>
</ul>
<strong>Endpoints for Campaigns</strong>
<ul>
 	<li><a href="/documentation/rest/get-campaign-by-id/">Get Campaign by ID</a></li>
 	<li><a href="/documentation/rest/get-multiple-campaigns/">Get Multiple Campaigns</a></li>
 	<li><a href="/documentation/rest/schedule-campaign/">Schedule Campaign</a></li>
 	<li><a href="/documentation/rest/request-campaign/">Request Campaign</a></li>
</ul>
You can find all REST API documentation <a href="/documentation/rest/">here</a>.
<h3>Marketo Real-Time Personalization API:</h3>
The Marketo Real-Time Personalization (RTP) JavaScript API extends the platform’s automated personalization capability. It allows for event tracking and dynamic customization of a webpage.  See full documentation <a href="/javascript-api/personalization/">here</a>.<br/><br/>TKaufman - 2014-06-20<br/><br/><h2>Storing a Foreign Key in Marketo</h2><br/><br/>When synchronizing contact and lead records between systems like a proprietary CRM or data warehouse, it is a common requirement to associate a lead record with a unique system identifier. In Marketo you can create or update a lead record through a <a href="/soap-api/syncmultipleleads/">syncMultipleLeads API</a> call using your unique system identifier. To accomplish this, you would store your unique system identifier (primary key) as a foreign key in Marketo. The name of this field in Marketo to store a foreign key is foreignSysPersonId.

Here are three important things to note:
<ol>
 	<li>foreignSysPersonId is not visible in Marketo's UI. So it is a best practice to also populate a custom attribute field with this value.</li>
 	<li>foreignSysPersonId is unique to a lead, but a lead can have more than one foreignSysPersonId.</li>
 	<li>foreignSysPersonId cannot be updated or deleted, but can be reassigned to another record.</li>
</ol>
We'll show how to make a call to the <a href="/soap-api/syncmultipleleads/">syncMultipleLeads API</a> to write a foreignSysPersonId value to two existing lead records in Marketo.

<strong>How to Write foreignSysPersonId Using syncMultipleLeads API</strong>

You can insert a new lead record and specify the foreignSysPersonId. You can also add it to an existing lead by specifying both Marketo ID and the foreignSysPersonId. We'll walk you through the latter case.

<script src="https://google-code-prettify.googlecode.com/svn/loader/run_prettify.js" type="text/javascript"></script>
<strong>Request XML for syncMultipleLeads SOAP API Call</strong>
<pre class="lang:default decode:true prettyprint linenums lang-xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;SOAP-ENV:Envelope xmlns:SOAP-ENV="http://schemas.xmlsoap.org/soap/envelope/" xmlns:ns1="http://www.marketo.com/mktows/"&gt;
  &lt;SOAP-ENV:Header&gt;
    &lt;ns1:AuthenticationHeader&gt;
      &lt;mktowsUserId&gt;demo17_1_809934544BFABAE58E5D27&lt;/mktowsUserId&gt;
      &lt;requestSignature&gt;b5e21953ae9f1b263e644da5eccce9ff33802513&lt;/requestSignature&gt;
      &lt;requestTimestamp&gt;2013-08-01T18:22:30-07:00&lt;/requestTimestamp&gt;
    &lt;/ns1:AuthenticationHeader&gt;
  &lt;/SOAP-ENV:Header&gt;
  &lt;SOAP-ENV:Body&gt;
    &lt;ns1:paramsSyncMultipleLeads&gt;
      &lt;leadRecordList&gt;
        &lt;leadRecord&gt;
          &lt;leadId&gt;1090240&lt;/leadId&gt;
          &lt;foreignSysPersonId&gt;1224191&lt;/foreignSysPersonId&gt;
          &lt;leadAttributeList&gt;
            &lt;attribute&gt;
              &lt;attrName&gt;Company&lt;/attrName&gt;
              &lt;attrValue&gt;Marketo1000&lt;/attrValue&gt;
            &lt;/attribute&gt;
            &lt;attribute&gt;
              &lt;attrName&gt;Phone&lt;/attrName&gt;
              &lt;attrValue&gt;650-555-1000&lt;/attrValue&gt;
            &lt;/attribute&gt;
          &lt;/leadAttributeList&gt;
        &lt;/leadRecord&gt;
        &lt;leadRecord&gt;
          &lt;leadId&gt;1090239&lt;/leadId&gt;
          &lt;foreignSysPersonId&gt;1224192&lt;/foreignSysPersonId&gt;
          &lt;leadAttributeList&gt;
            &lt;attribute&gt;
              &lt;attrName&gt;Company&lt;/attrName&gt;
              &lt;attrValue&gt;Marketo1001&lt;/attrValue&gt;
            &lt;/attribute&gt;
            &lt;attribute&gt;
              &lt;attrName&gt;Phone&lt;/attrName&gt;
              &lt;attrValue&gt;650-555-1001&lt;/attrValue&gt;
            &lt;/attribute&gt;
          &lt;/leadAttributeList&gt;
        &lt;/leadRecord&gt;
      &lt;/leadRecordList&gt;
      &lt;dedupEnabled&gt;true&lt;/dedupEnabled&gt;
    &lt;/ns1:paramsSyncMultipleLeads&gt;
  &lt;/SOAP-ENV:Body&gt;
&lt;/SOAP-ENV:Envelope&gt;</pre>
<strong>Response XML for syncMultipleLeads SOAP API Call</strong>
<pre class="lang:default decode:true prettyprint linenums lang-xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;SOAP-ENV:Envelope xmlns:SOAP-ENV="http://schemas.xmlsoap.org/soap/envelope/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:ns1="http://www.marketo.com/mktows/"&gt;
  &lt;SOAP-ENV:Body&gt;
    &lt;ns1:successSyncMultipleLeads&gt;
      &lt;result&gt;
        &lt;syncStatusList&gt;
          &lt;syncStatus&gt;
            &lt;leadId&gt;1090240&lt;/leadId&gt;
            &lt;status&gt;UPDATED&lt;/status&gt;
            &lt;error xsi:nil="true" /&gt;
          &lt;/syncStatus&gt;
          &lt;syncStatus&gt;
            &lt;leadId&gt;1090239&lt;/leadId&gt;
            &lt;status&gt;UPDATED&lt;/status&gt;
            &lt;error xsi:nil="true" /&gt;
          &lt;/syncStatus&gt;
        &lt;/syncStatusList&gt;
      &lt;/result&gt;
    &lt;/ns1:successSyncMultipleLeads&gt;
  &lt;/SOAP-ENV:Body&gt;
&lt;/SOAP-ENV:Envelope&gt;</pre>
<strong>See below a sample Ruby program that will output the Request XML above.
</strong>
<pre class="lang:default decode:true prettyprint lang-ruby ">require 'savon' # Use version 2.0 Savon gem
require 'date'

mktowsUserId = "" # CHANGE ME
marketoSecretKey = "" # CHANGE ME
marketoSoapEndPoint = "" # CHANGE ME
marketoNameSpace = "http://www.marketo.com/mktows/"

#Create Signature
Timestamp = DateTime.now
requestTimestamp = Timestamp.to_s
encryptString = requestTimestamp + mktowsUserId
digest = OpenSSL::Digest.new('sha1')
hashedsignature = OpenSSL::HMAC.hexdigest(digest, marketoSecretKey, encryptString)
requestSignature = hashedsignature.to_s

#Create SOAP Header
headers = {
	'ns1:AuthenticationHeader' =&gt; { "mktowsUserId" =&gt; mktowsUserId, "requestSignature" =&gt; requestSignature, 					
	"requestTimestamp"  =&gt; requestTimestamp 
	}
}

client = Savon.client(wsdl: 'http://app.marketo.com/soap/mktows/2_3?WSDL', soap_header: headers, endpoint: marketoSoapEndPoint, open_timeout: 90, read_timeout: 90, namespace_identifier: :ns1, env_namespace: 'SOAP-ENV')

#Create Request
request = {
        :lead_record_list =&gt; {
                :lead_record =&gt; {
                        :lead_id =&gt; "1090240",
                        :foreign_sys_person_id =&gt; "1224191",
                :lead_attribute_list =&gt; {
                        :attribute =&gt; {
                                :attr_name =&gt; "Company",
                                :attr_value =&gt; "Marketo1000" },
                         :attribute! =&gt; {
                                :attr_name =&gt; "Phone",
                                :attr_value =&gt; "650-555-1000" }
                }
        },
        :lead_record! =&gt; {
                        :lead_id =&gt; "1090239",
                        :foreign_sys_person_id =&gt; "1224192",
                :lead_attribute_list =&gt; {
                        :attribute =&gt; {
                                :attr_name =&gt; "Company",
                                :attr_value =&gt; "Marketo1001" },
                         :attribute! =&gt; {
                                :attr_name =&gt; "Phone",
                                :attr_value =&gt; "650-555-1001" }
                }
        }
        },
    :dedup_enabled =&gt; "True"
}

response = client.call(:sync_multiple_leads, message: request)

puts response</pre>
&nbsp;
<p style="font-size: x-small;">* This article contains code used to implement custom integrations. Due to its customized nature, The Marketo Technical Support team is unable to troubleshoot custom work. Please do not attempt to implement the following code sample without appropriate technical experience, or access to an experienced developer.</p><br/><br/>MManzur - 2014-06-27<br/><br/><h2>Updating a Lead's Email Address</h2><br/><br/>Let's say a user fills out a Marketo form on your site. What happens? Marketo cookies the user, and associates them with the email they provided. What if the next time the user visits your website, and they fill out the same form again with a different email. What will happen? Marketo will create a new lead record, and overwrite the first cookie on the user's browser. The user is now a new/different lead in Marketo. 

We will show you four ways to update a lead's email address in Marketo including the <a href="http://developers.marketo.com/documentation/soap/synclead/">syncLead API method</a>, the custom field in a form method, the Marketo UI, and by importing a list. 

<strong>Via the syncLead API</strong>

You can use the <a href="http://developers.marketo.com/documentation/soap/synclead/">syncLead API</a> to update a lead record using their Marketo ID and new email address. 
<script type="text/javascript" src="https://google-code-prettify.googlecode.com/svn/loader/run_prettify.js"></script>

Request XML for syncMultipleLeads SOAP API Call
		<pre class="prettyprint linenums lang-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;<br />
&lt;SOAP-ENV:Envelope xmlns:SOAP-ENV=&quot;http://schemas.xmlsoap.org/soap/envelope/&quot; xmlns:ns1=&quot;http://www.marketo.com/mktows/&quot;&gt;<br />
  &lt;SOAP-ENV:Header&gt;<br />
    &lt;ns1:AuthenticationHeader&gt;<br />
      &lt;mktowsUserId&gt;bigcorp1_461839624B16E06BA2D663&lt;/mktowsUserId&gt;<br />
      &lt;requestSignature&gt;92f05a7be4838ae1c0e5aafe814891ee72968a08&lt;/requestSignature&gt;<br />
      &lt;requestTimestamp&gt;2013-07-31T12:38:47-07:00&lt;/requestTimestamp&gt;<br />
    &lt;/ns1:AuthenticationHeader&gt;<br />
  &lt;/SOAP-ENV:Header&gt;<br />
  &lt;SOAP-ENV:Body&gt;<br />
    &lt;ns1:paramsSyncLead&gt;<br />
      &lt;leadRecord&gt;<br />
        &lt;leadId&gt;1090240&lt;/leadId&gt;<br />
        &lt;Email&gt;t@t.com&lt;/Email&gt;<br />
      &lt;/leadRecord&gt;<br />
      &lt;returnLead&gt;false&lt;/returnLead&gt;<br />
    &lt;/ns1:paramsSyncLead&gt;<br />
  &lt;/SOAP-ENV:Body&gt;<br />
&lt;/SOAP-ENV:Envelope&gt;</pre>

Response XML for syncMultipleLeads SOAP API Call
<pre class="prettyprint linenums lang-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;<br />
&lt;SOAP-ENV:Envelope xmlns:SOAP-ENV=&quot;http://schemas.xmlsoap.org/soap/envelope/&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xmlns:ns1=&quot;http://www.marketo.com/mktows/&quot;&gt;<br />
  &lt;SOAP-ENV:Body&gt;<br />
    &lt;ns1:successSyncLead&gt;<br />
      &lt;result&gt;<br />
        &lt;leadId&gt;1090240&lt;/leadId&gt;<br />
        &lt;syncStatus&gt;<br />
          &lt;leadId&gt;1090240&lt;/leadId&gt;<br />
          &lt;status&gt;UPDATED&lt;/status&gt;<br />
          &lt;error xsi:nil=&quot;true&quot; /&gt;<br />
        &lt;/syncStatus&gt;<br />
        &lt;leadRecord xsi:nil=&quot;true&quot; /&gt;<br />
      &lt;/result&gt;<br />
    &lt;/ns1:successSyncLead&gt;<br />
  &lt;/SOAP-ENV:Body&gt;<br />
&lt;/SOAP-ENV:Envelope&gt;</pre>

See below a sample Ruby program that will output the Request XML above.
<pre class="prettyprint lang-ruby">require &#039;savon&#039; # Use version 2.0 Savon gem<br />
require &#039;date&#039;<br />
<br />
mktowsUserId = &quot;&quot; # CHANGE ME<br />
marketoSecretKey = &quot;&quot; # CHANGE ME<br />
marketoSoapEndPoint = &quot;&quot; # CHANGE ME<br />
marketoNameSpace = &quot;http://www.marketo.com/mktows/&quot;<br />
<br />
#Create Signature<br />
Timestamp = DateTime.now<br />
requestTimestamp = Timestamp.to_s<br />
encryptString = requestTimestamp + mktowsUserId<br />
digest = OpenSSL::Digest.new(&#039;sha1&#039;)<br />
hashedsignature = OpenSSL::HMAC.hexdigest(digest, marketoSecretKey, encryptString)<br />
requestSignature = hashedsignature.to_s<br />
<br />
#Create SOAP Header<br />
headers = { <br />
	&#039;ns1:AuthenticationHeader&#039; =&gt; { &quot;mktowsUserId&quot; =&gt; mktowsUserId, &quot;requestSignature&quot; =&gt; requestSignature, 					<br />
	&quot;requestTimestamp&quot;  =&gt; requestTimestamp <br />
	}<br />
}<br />
<br />
client = Savon.client(wsdl: &#039;http://app.marketo.com/soap/mktows/2_3?WSDL&#039;, soap_header: headers, endpoint: marketoSoapEndPoint, open_timeout: 90, read_timeout: 90, namespace_identifier: :ns1, env_namespace: &#039;SOAP-ENV&#039;)<br />
<br />
#Create Request<br />
request = {<br />
	:lead_record =&gt; {<br />
		:Email =&gt; &quot;t@t.com&quot;,<br />
		:lead_id =&gt; &quot;1090240&quot;,<br />
	:return_lead =&gt; &quot;false&quot;<br />
}<br />
<br />
response = client.call(:sync_lead, message: request)<br />
<br />
puts response</pre>

<strong>Via a Custom Field in a Form</strong>

You can create a custom field for the "New Email Address" in Marketo. Then ask the user to fill out a form that includes this new field. Then create a program in Marketo that would change the data value of the system email address field with the token {{lead.newEmailAddress}} when there is a change in the new custom field "New Email Address."

<strong>Via the Marketo UI</strong>

You can manually update a lead's email address via the Marketo UI. Here is <a href="https://community.marketo.com/MarketoArticle?id=kA050000000L7cnCAC">help article</a> that describes how to do this (Marketo login required to see article).

<strong>Via Importing a List</strong>

You can update a lead's email addres using the import a list method in Marketo described <a href="https://community.marketo.com/MarketoArticle?id=kA050000000L3lICAS" target="_blank">here</a> (Marketo login required to see article). 





&nbsp;
<p style="font-size: x-small;">* This article contains code used to implement custom integrations. Due to its customized nature, The Marketo Technical Support team is unable to troubleshoot custom work. Please do not attempt to implement the following code sample without appropriate technical experience, or access to an experienced developer.</p><br/><br/>MManzur - 1970-01-01<br/><br/><h2>Store a Second Email Address for a Lead</h2><br/><br/>Let's say you want to change a lead's score in Marketo using the APIs. This is possible to do with the REST API using the <a href="/documentation/rest/createupdate-leads/">Create/Update Lead endpoint</a>.

If you want to store more than one email on a lead record, you would need to create a custom field, and store the second email there. Here is a help article with more information:

Below is a code sample in Ruby that shows how to make this call.
<pre class="lang:default decode:true prettyprint lang-rb ">require 'rest_client'
require 'json'

#Build request URL
#Replace AAA-BBB-CCC with your Marketo instance
marketo_instance = "https://AAA-BBB-CCC.mktorest.com"
endpoint = "/rest/v1/leads.json"
#Replace with your access token
auth_token =  "?access_token=" + "ac756f7a-d54d-41ac-8c3c-f2d2a39ee325:ab"
request_url = marketo_instance + endpoint + auth_token

#Build request body
data = { "action" =&gt; "updateOnly", "input" =&gt; [ { "email" =&gt; "example@email.com", "leadScore" =&gt; "30" } ] }

#Make request
response = RestClient.post request_url, data.to_json, :content_type =&gt; :json, :accept =&gt; :json

#Returns Marketo API response
puts response
</pre><br/><br/>MManzur - 2015-02-20<br/><br/><h2>Create a Custom Field in Marketo, and Update this Field via API</h2><br/><br/>Let's say you have additional data about your leads that does not fit into the standard Marketo fields. For example, this custom field could be a third-party score. You can create a custom field in Marketo for your third-party score, and then update the value of this field via either the Marketo <a href="/documentation/rest/">REST APIs</a> or <a href="/soap-api/">SOAP APIs</a>.

We'll show you first how to create a custom field in Marketo, and second how to <a href="/documentation/rest/createupdate-leads/">update this field using the REST API</a>.
<h4>How to Create a Custom Field in Marketo</h4>
1. Under Admin, click on Field Management.

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/08/11.png"><img class="size-full wp-image-1307 alignnone" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2014/08/11.png" alt="1" width="651" height="498" /></a>

2. Click the New Custom Field button.

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/08/21.png"><img class="size-full wp-image-1309 alignnone" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2014/08/21.png" alt="2" width="475" height="182" /></a>

3. Choose the field Type. This will change how it is rendered in Smart Lists and Forms in Marketo.

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/08/3.png"><img class="size-full wp-image-1311 alignnone" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2014/08/3.png" alt="3" width="538" height="448" /></a>

4. Enter the Name as you want it to appear in Marketo. Pick the Name and API Name carefully as renaming fields can be difficult and in some situations not possible.

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/08/4.png"><img class="size-full wp-image-1313 alignnone" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2014/08/4.png" alt="4" width="542" height="371" /></a>

5. The custom field you created is now accessible via the APIs.
<h4>How to Update Custom Field via REST API</h4>
In the previous section, we created a custom field called "myCustomField" with the data type string. To update the value of that field, we will use the <a href="/documentation/rest/createupdate-leads/">REST API endpoint called Create / Update Leads</a>.

Before you can make a request to the REST API, you will need to authenticate. This is outside of the scope of this article, but in-depth information <a href="/rest-api/authentication/">is available on the Marketo developers site</a>.

Below is a sample request body that could be used to update the value of "myCustomField" custom field using the <a href="http://developers.marketo.com/documentation/rest/createupdate-leads/">Create / Update Leads endpoint</a>.

<script src="https://google-code-prettify.googlecode.com/svn/loader/run_prettify.js" type="text/javascript"></script>

<strong>Endpoint</strong>
<pre class="lang:default decode:true prettyprint lang-js">/rest/v1/leads.json
</pre>
<strong>Request Body</strong>
<pre class="lang:default decode:true prettyprint lang-js ">{
   "action":"createOrUpdate",
   "input":[  
      {  
         "email":"example@example.com",
         "myCustomField":"examplestring"
      }
   ]
}
</pre>
<p style="font-size: x-small;">* This article contains code used to implement custom integrations. Due to its customized nature, The Marketo Technical Support team is unable to troubleshoot custom work. Please do not attempt to implement the following code sample without appropriate technical experience, or access to an experienced developer.</p><br/><br/>MManzur - 2014-08-19<br/><br/><h2>Integrating Unbounce and Marketo</h2><br/><br/><strong>NOTE: This is a guest blog post by Fab Capodicasa. He is a Marketo-certified consultant at <a href="http://hooshmarketing.com.au/">Hoosh Marketing</a>, a Marketo LaunchPoint agency partner specializing in B2C. He has worked in both SaaS and marketing for the last 13 years. His background is a blend of hardcore IT, direct marketing, and enterprise sales. Fab is also a former Marketo employee.</strong>

<strong>Overview</strong>

In this article we demonstrate how to integrate Unbounce, a popular landing page tool, with Marketo. We will show you first how to insert Marketo tracking into Unbounce, and second how to modify Unbounce forms to insert data directly into Marketo.

The challenge integrating Unbounce with Marketo is that Unbounce does not allow default fields to be renamed (E.g. first_name cannot be changed to FirstName). It also does not allow field labels to be different from field names.

This integration involves Javascript which tweaks the existing forms to make them compatible with Marketo. I recommend that you have at least a beginner level of Javascript and a intermediate level of Marketo knowledge to complete the tasks in this article.

<strong>Part 1: Add Marketo Tracking Code to Unbounce</strong>

Adding Marketo's Munchkin tracking script to Unbounce pages is required both for analytics and the form integration to work. Please follow these steps:

Copy your Munchkin code from Marketo: Navigate to Admin -&gt; Munchkin and copy the ‘Simple’ version of the Javascript.

Open the Unbounce landing page and click Javascripts-&gt; Add New Javascript.

<a href="http://developers.marketo.com/blog/wp-content/uploads/2014/08/1.png"><img class="size-medium wp-image-1091 alignleft" alt="1" src="http://developers.marketo.com/blog/wp-content/uploads/2014/08/1-300x137.png" width="300" height="137" /></a>

Click Add, call the script ‘Munchkin’, select ‘Before Body End Tag’ and then paste the Munchkin code.
<a href="http://developers.marketo.com/blog/wp-content/uploads/2014/08/2.png"><img class="alignleft size-medium wp-image-1097" alt="2" src="http://developers.marketo.com/blog/wp-content/uploads/2014/08/2-300x170.png" width="300" height="170" /></a>

Click the Done button.

For future Unbounce pages, you will go to Javascripts and enable the Munchkin script we created. There is no need to recreate it.

<strong>Part 2: Convert the Unbounce Form to a Marketo Form</strong>

Now we need to modify the Unbounce form by adding some new hidden fields and Javascript to allow your Unbounce landing pages to submit lead information directly into Marketo.

We will first create a Marketo placeholder form. In Marketo, create a blank form and approve it. This will be the proxy form in Marketo which represents the Unbounce form.

Add Hidden Fields to the Unbounce Form. These hidden fields are required by Marketo to determine which Marketo instance, which form and user session this form submission will apply to.

In Unbounce, open your form by double clicking. Add a hidden field called <em>_mkt_trk</em>. Add a second hidden field called <em>formid</em>.
<a href="http://developers.marketo.com/blog/wp-content/uploads/2014/08/3a.png"><img class="size-medium wp-image-1165 alignleft" alt="3a" src="http://developers.marketo.com/blog/wp-content/uploads/2014/08/3a-300x154.png" width="300" height="154" /></a>

<img class="size-medium wp-image-1167 alignleft" alt="4a" src="http://developers.marketo.com/blog/wp-content/uploads/2014/08/4a-300x153.png" width="300" height="153" />

<font color="red">233</font> needs to be replaced with the id of your form, which can be found in the Marketo form embed code in Marketo. In Marketo, Open your form, select Form Actions-&gt;Embed Code

<a href="http://developers.marketo.com/blog/wp-content/uploads/2014/08/5a.png"><img class="alignleft size-full wp-image-1169" alt="5a" src="http://developers.marketo.com/blog/wp-content/uploads/2014/08/5a.png" width="243" height="249" /></a>

<a href="http://developers.marketo.com/blog/wp-content/uploads/2014/08/6a.png"><img class="alignleft size-medium wp-image-1171" alt="6a" src="http://developers.marketo.com/blog/wp-content/uploads/2014/08/6a-300x27.png" width="300" height="27" /></a>

Add a hidden field called <em>returnurl</em>. <font color="red">"http://hooshmarketing.com.au/thank-you"</font> needs to be replaced with follow-up URL, this is the URL you want users to be redirected to after submitting the form. For example, this could be your thank you page.

<a href="http://developers.marketo.com/blog/wp-content/uploads/2014/08/8a.png"><img class="alignleft size-medium wp-image-1175" alt="8a" src="http://developers.marketo.com/blog/wp-content/uploads/2014/08/8a-300x153.png" width="300" height="153" /></a>

<strong>Part 3: Direct Unbounce Form to Marketo</strong>

The follow-up URL is the page which your lead will be redirected to after their lead is submitted to Marketo. In Unbounce, please follow these steps:

Click on your form.

Modify the Form Confirmation section.

Change the Confirmation to Post form data to a URL.

Set URL to the follow-up page you want.

<font color="red">fpmarkets</font> needs to be replaced with your Marketo account string, which can be found in Marketo under Admin-&gt;Landing Pages.

<a href="http://developers.marketo.com/blog/wp-content/uploads/2014/08/9a.png"><img class="size-medium wp-image-1179 alignleft" alt="9a" src="http://developers.marketo.com/blog/wp-content/uploads/2014/08/9a-300x184.png" width="300" height="184" /></a>

<strong>Part 4: Add Javascript to the Unbounce Page</strong>

This Javascript will convert the form to be compatible with Marketo and to submit it to Marketo. In Unbounce, please follow these steps:

Open the Unbounce landing page and click Javascripts-&gt; Add New Javascript.

<a href="http://developers.marketo.com/blog/wp-content/uploads/2014/08/10a.png"><img class="size-medium wp-image-1183 alignleft" alt="10a" src="http://developers.marketo.com/blog/wp-content/uploads/2014/08/10a-300x137.png" width="300" height="137" /></a>

Click Add, call the script ‘Marketo Form Convert’, select ‘Before Body End Tag’.
<a href="http://developers.marketo.com/blog/wp-content/uploads/2014/08/11a.png"><img class="size-medium wp-image-1185 alignleft" alt="11a" src="http://developers.marketo.com/blog/wp-content/uploads/2014/08/11a-300x67.png" width="300" height="67" /></a>

Paste the Javascript code below:

<script type="text/javascript" src="https://google-code-prettify.googlecode.com/svn/loader/run_prettify.js"></script>
<pre class="prettyprint linenums lang-js">&lt;script&gt;

var MARKETO_MUNCHKIN_ID='614-CGT-700';
var MARKETO_ACCOUNT_STRING = 'fpmarkets';
  
var UNBOUNCE_MARKETO_FIELD_MAP = new Object(); 
  
//default field mappings
UNBOUNCE_MARKETO_FIELD_MAP['first_name'] = 'FirstName';
UNBOUNCE_MARKETO_FIELD_MAP['email'] = 'Email';
UNBOUNCE_MARKETO_FIELD_MAP['last_name'] = 'LastName';
UNBOUNCE_MARKETO_FIELD_MAP['phone_number'] = 'Phone';

function getMarketoField(k) {
    return UNBOUNCE_MARKETO_FIELD_MAP[k];
}
  
  
var formFields = [];
var hiddenClonedFields = [];
var firstForm = document.forms[0];  
  
//Convert Unbounce form names to Marketo field names  
for(i=0; i&lt;firstForm.elements.length; i++){
 var formField = firstForm.elements[i];
 var newFieldName = getMarketoField(formField.name);
  
  if(newFieldName != undefined) {
        
    
    //save original field as hidden field
    var hiddenField = document.createElement("input");
    hiddenField.setAttribute("type", "hidden");
    hiddenField.setAttribute("name", formField.name);
    hiddenField.setAttribute("id", formField.id);
    hiddenClonedFields.push(hiddenField);
    
    //change original field
    console.log ( 'Changed form field name: ' + formField.name + '=&gt;' + newFieldName );
    formField.name = newFieldName;
    formField.id = newFieldName;
    formFields.push(formField);
    
    
  } else {
    console.log ( 'Couldn't map:' + formField.name );
  }
}
  
//Add hidden cloned Unbounce fields to form
//for Unbounce validation
for(i=0; i&lt;hiddenClonedFields.length; i++){
    firstForm.appendChild(hiddenClonedFields[i]);
    formFields[i].onchange = (function(hf) {
        return function(event) {
            hf.value = event.target.value;
          console.log('Changed hidden cloned field:' + hf.name + '=&gt;' + hf.value);
        };
    }(hiddenClonedFields[i]));
    console.log ( 'Added cloned field: ' + hiddenClonedFields[i].name );
}
  
   
//Add MunchkinId to form
var input = document.createElement("input");
input.setAttribute("type", "hidden");
input.setAttribute("name", "munchkinId");
input.setAttribute("value", MARKETO_MUNCHKIN_ID);
firstForm.appendChild(input);
console.log('Added hidden field:' + input.name + '=' + input.value);
&lt;/script&gt;</pre>
If you have custom fields which are have API names that aren’t compatible with Unbounce , you can add these to the mapping in the Javascript. For example, if one of your custom fields in Marketo was <em>Comments_c</em>, but you wanted the field label to appear as Comments, Unbounce wouldn’t let you change the field name to <em>Comments_c</em>.

<a href="http://developers.marketo.com/blog/wp-content/uploads/2014/08/12a.png"><img class="aligncenter size-full wp-image-1191" alt="12a" src="http://developers.marketo.com/blog/wp-content/uploads/2014/08/12a.png" width="285" height="157" /></a>

<pre class="prettyprint linenums lang-js">//default field mappings
UNBOUNCE_MARKETO_FIELD_MAP['comments'] = 'Comments_c';
UNBOUNCE_MARKETO_FIELD_MAP['first_name'] = 'FirstName';
UNBOUNCE_MARKETO_FIELD_MAP['email'] = 'Email';
</pre>

<em>comments</em> is the name of the field in Unbounce.
<em>Comments_c</em> is the name of the field in Marketo.

For future Unbounce pages, you will simply go to Javascripts and enable the Munchkin script we created. There is no need to recreate it.

<strong>Part 5: Testing</strong>

The last step is to test this form integration is working. Create a trigger in Marketo which activates on the Marketo form fill out and make sure leads are being inserted correctly into Marketo. Once the form is submitted, the page should be redirecting you to the follow up URL.<br/><br/>FCapodicasa - 2014-08-04<br/><br/><h2>July 2014 Release Updates</h2><br/><br/><h3>REST APIs Updates</h3>
There are two new endpoints available for the REST APIs: <a href="/documentation/rest/import-lead/">Import to List</a> and <a href="/documentation/rest/get-import-lead-status/">Get Import to List Status</a>. The Import to List API supports syncing leads in bulk. The Get Import to List Status API will return the status of lead operation from the Import Lead API call.
<h3>Munchkin Updates</h3>
The new version of Munchkin is 147. Version 142 is unsupported and will be removed in early September 2014. In Version 142, there were publicly-accessible functions that were not documented on the developers site. Those undocumented functions are no longer available publicly. Documented functions on the developers site will be continue to be supported long-term.
<h3>RTP Updates</h3>
The RTP API has a new function called <a href="/javascript-api/personalization/">Get Visitor Data</a>. This RTP API call allows you to get real-time visitor data such as organization, industry, location and segment code match.<br/><br/>MManzur - 2014-07-30<br/><br/><h2>Using Multiple Munchkin Tracking Codes on a Single Page</h2><br/><br/>Let's say you have multiple Marketo instances and you would like to send web tracking events like page visits or clicked links to these multiple instances, it is possible to do this with Munchkin.

Marketo tracks visitors to your website by domain (e.g. "marketo.com"). If you're hosting this Munchkin script on a domain that's different than your primary domain (e.g. "company.com"), those visitors will appear as anonymous leads until they fill out a form on that other domain.

To accomplish this, add the <strong>altIds</strong> parameter to your <strong>Munchkin.init</strong> call. The altIds parameter contains an array of the additional Munchkin IDs where web events should be sent.

Using the example below, replace the highlighted Munchkin IDs (XXX-XXX-XXX, YYY-YYY-YYY, and ZZZ-ZZZ-ZZZ) with the Munchkin IDs from each Marketo instance where the tracking information should be sent.
<pre class="lang:default decode:true">&lt;script src="http://munchkin.marketo.net/munchkin.js" type="text/javascript"&gt;&lt;/script&gt;
&lt;script&gt;Munchkin.init('XXX-XXX-XXX', { altIds:['YYY-YYY-YYY', 'ZZZ-ZZZ-ZZZ'] });&lt;/script&gt;


</pre>
For additional information on Munchkin initialization parameters, see <a href="https://developers.marketo.com/javascript-api/lead-tracking/configuration/">this document</a>.<br/><br/>MManzur - 2014-08-08<br/><br/><h2>Integrating Munchkin with Google Tag Manager</h2><br/><br/>Google Tag Manger lets you add tags to your website. Rather than manually add each tracking script like Munchkin to the source code of your website, you can put <a href="http://www.google.com/tagmanager/">Google Tag Manager</a> on your site, and then add tags like <a href="/javascript-api/lead-tracking/">Munchkin</a> through Google Tag Manager's UI.

In this post, we'll first show how to generate Munchkin tracking code in Marketo, and then second how to add this Munchkin tracking code to Google Tag Manager.
<h4>How to Generate Munchkin Tracking Code</h4>
1. Click <strong>Admin</strong> at the top right of the app.

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/08/marketo_admin.png"><img class="size-full wp-image-5601 alignnone" src="https://marketohost.wpengine.com/wp-content/uploads/2014/08/marketo_admin.png" alt="marketo_admin" width="1706" height="385" /></a>

2. Click <strong>Munchkin</strong> in the tree on the left.

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/08/marketo_munchkin.png"><img class="size-full wp-image-5602 alignnone" src="https://marketohost.wpengine.com/wp-content/uploads/2014/08/marketo_munchkin.png" alt="marketo_munchkin" width="776" height="679" /></a>

3. Select <strong>Asynchronous</strong> for Tracking Code Type.

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/08/marketo_munchkin_asynchronous.png"><img class="size-full wp-image-5603 alignnone" src="https://marketohost.wpengine.com/wp-content/uploads/2014/08/marketo_munchkin_asynchronous.png" alt="marketo_munchkin_asynchronous" width="618" height="509" /></a>

4. Click and copy the JavaScript tracking code.

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/08/marketo_tracking_code.png"><img class="size-full wp-image-5604 alignnone" src="https://marketohost.wpengine.com/wp-content/uploads/2014/08/marketo_tracking_code.png" alt="marketo_tracking_code" width="625" height="511" /></a>

<strong>How to Add Munchkin Tracking Code to Google Tag Manager</strong>
<ol>
 	<li>Login to your Google Tag Manager account and <strong>Add new t</strong><strong>ag.</strong></li>
</ol>
<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/08/google_tag_man_add_tag.png"><img class="size-full wp-image-5605 alignnone" src="https://marketohost.wpengine.com/wp-content/uploads/2014/08/google_tag_man_add_tag.png" alt="google_tag_man_add_tag" width="340" height="189" /></a>

2. Create a new <strong>Custom HTML Tag</strong>.

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/08/google_tag_man_custom_html_tag.png"><img class="size-full wp-image-5606 alignnone" src="https://marketohost.wpengine.com/wp-content/uploads/2014/08/google_tag_man_custom_html_tag.png" alt="google_tag_man_custom_html_tag" width="1016" height="714" /></a>

3. Copy and paste your Munchkin code into the <strong>HTML</strong> field and click <strong>Continue</strong>.

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/08/google_tag_man_continue.png"><img class="size-full wp-image-5609 aligncenter" src="https://marketohost.wpengine.com/wp-content/uploads/2014/08/google_tag_man_continue.png" alt="google_tag_man_continue" width="970" height="829" /></a>

4. Select <strong>Fire On All Pages </strong>and click <strong>Create Tag.  </strong>Note: If you have an extremely high traffic web site, you can exclude sections of your site using <strong>Fire On Some Pages</strong>.

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/08/google_tag_man_create_tag.png"><img class="size-full wp-image-5608 alignnone" src="https://marketohost.wpengine.com/wp-content/uploads/2014/08/google_tag_man_create_tag.png" alt="google_tag_man_create_tag" width="971" height="944" /></a>

5. Click save, and then verify that Munchkin tracking code is now loading on your website.
<p style="font-size: x-small;">* This article contains code used to implement custom integrations. Due to its customized nature, The Marketo Technical Support team is unable to troubleshoot custom work. Please do not attempt to implement the following code sample without appropriate technical experience, or access to an experienced developer.</p><br/><br/>MManzur - 2014-08-05<br/><br/><h2>Hide Lightbox After Form Submission</h2><br/><br/><h4>Overview</h4>
The current lightbox embed code generated by Marketo does not disappear when the form is submitted. It will reload the page after form submission, and the form will appear again. If you would like to create a lightbox that hides after form submission, then please follow the steps below.
<h4>How to Guide</h4>
1. After creating your form in Marketo, generate your embed code. To do this, click Form Actions, and then click Lightbox as code type. Copy and paste this code into a text editor, so you can edit it in the next step.

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/08/Screen-Shot-2014-08-20-at-5.32.07-PM.png"><img class="size-full wp-image-1361 alignnone" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2014/08/Screen-Shot-2014-08-20-at-5.32.07-PM.png" alt="Screen Shot 2014-08-20 at 5.32.07 PM" width="189" height="299" /></a>

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/08/Screen-Shot-2014-08-20-at-5.32.23-PM.png"><img class="size-full wp-image-1363 alignnone" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2014/08/Screen-Shot-2014-08-20-at-5.32.23-PM.png" alt="Screen Shot 2014-08-20 at 5.32.23 PM" width="652" height="420" /></a>

2. Replace all the code after "(form)" in your embed code with the code below:

<script src="https://google-code-prettify.googlecode.com/svn/loader/run_prettify.js" type="text/javascript"></script>
<pre class="lang:default decode:true prettyprint lang-js ">{
var lightbox = MktoForms2.lightbox(form).show();
form.onSuccess(function(){
lightbox.hide();
return false;
});
});
&lt;/script&gt;
</pre>
3. After step 2, the completed version should look like the code below. The code is now ready to be used on your website.
<pre class="lang:default decode:true prettyprint lang-js">&lt;script src="http://app-sj04.marketo.com/js/forms2/js/forms2.js"&gt;&lt;/script&gt;
&lt;form id="mktoForm_0000"&gt;&lt;/form&gt;
&lt;script&gt;MktoForms2.loadForm("http://app-sj04.marketo.com", "AAA-BBB-CCC", 0000, function (form){
var lightbox = MktoForms2.lightbox(form).show();
form.onSuccess(function(){
lightbox.hide();
return false;
});
});
&lt;/script&gt;
</pre>
<p style="font-size: x-small;">* This article contains code used to implement custom integrations. Due to its customized nature, The Marketo Technical Support team is unable to troubleshoot custom work. Please do not attempt to implement the following code sample without appropriate technical experience, or access to an experienced developer.</p><br/><br/>MManzur - 2014-08-21<br/><br/><h2>Quick Start Guide for Marketo REST API</h2><br/><br/>This guide will show you how to make your first call to the Marketo REST API in ten minutes.

We'll show you how to retrieve a single lead using the <a href="/documentation/rest/get-lead-by-id/">Get Lead by Id</a> REST API endpoint. To do this, we will walk you through the authentication process to generate an access token, which you will use to make a HTTP GET request to <a href="/documentation/rest/get-lead-by-id/">Get Lead by Id</a>. Then we'll provide you with the code to make the request that returns lead information formatted as JSON.
<h2>How to Generate an Authentication Token</h2>
A Custom Service in Marketo allows you to describe and define what data your application will have access to. You need to be logged in as a Marketo administrator to create a Custom Service and associate that service with a single API-Only user.

1. Navigate to the admin area of the Marketo application.

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/09/navigate_to_admin.png"><img class="alignnone size-full wp-image-4247" src="https://marketohost.wpengine.com/wp-content/uploads/2014/09/navigate_to_admin.png" alt="navigate_to_admin" width="1397" height="768" /></a>

2. Click on the Users &amp; Roles node on the left panel.

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/09/users_and_roles.png"><img class="alignnone size-full wp-image-4249" src="https://marketohost.wpengine.com/wp-content/uploads/2014/09/users_and_roles.png" alt="users_and_roles" width="1357" height="612" /></a>

3. Create a new role.  Reveal the list of role permissions by clicking Access API.

<img class="alignnone wp-image-7409 size-full" src="http://developers.marketo.com/wp-content/uploads/2015/09/create_new_role_1.png" alt="" width="599" height="599" />

Now scroll down and select only the permissions that you need.  In this case, we'll simply select Read-Only Lead permission.

<img class="alignnone wp-image-7410 size-full" src="http://developers.marketo.com/wp-content/uploads/2015/09/create_new_role_2.png" alt="" width="597" height="601" />

4. The next step is to create an API-Only user and associating it with the API role that you created in the previous step. You can do so by checking the API-Only user checkbox at the time of user creation.

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/09/invite_new_user.png"><img class="alignnone size-full wp-image-4253" src="https://marketohost.wpengine.com/wp-content/uploads/2014/09/invite_new_user.png" alt="invite_new_user" width="750" height="704" /></a>

5. A Custom service is required to uniquely identify your client application. To create a custom application, go to the Admin &gt; LaunchPoint screen and create a new service.

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/09/launchpoint_new_service.png"><img class="alignnone size-full wp-image-4259" src="https://marketohost.wpengine.com/wp-content/uploads/2014/09/launchpoint_new_service.png" alt="launchpoint_new_service" width="1920" height="965" /></a>

6. Provide the Display Name, choose "Custom" Service type, provide Description, and the user email address created in step 4. We recommend using a descriptive Display Name that represents either the company or purpose of this Custom REST API Service.

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/09/new_service1.png"><img class="alignnone size-full wp-image-4261" src="https://marketohost.wpengine.com/wp-content/uploads/2014/09/new_service1.png" alt="new_service" width="548" height="511" /></a>

7. Click on "View Details" link on the grid to get the Client Id and Client Secret.

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/09/view_details.png"><img class="alignnone size-full wp-image-4263" src="https://marketohost.wpengine.com/wp-content/uploads/2014/09/view_details.png" alt="view_details" width="1357" height="807" /></a>

Your client application will be able to use the Client Id and Client Secret to generate an access token.

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/09/details.png"><img class="alignnone size-full wp-image-4265" src="https://marketohost.wpengine.com/wp-content/uploads/2014/09/details.png" alt="details" width="602" height="375" /></a>

8. Copy and paste your authentication token into a text editor. Your authentication token will look similar to the example below:
<blockquote>cdf01657-110d-4155-99a7-f986b2ff13a0:int</blockquote>
<h2>How to Determine the Endpoint URL</h2>
In making a request to Marketo API, you will need to specify your Marketo instance in the endpoint URL. All non-bulk API requests to the Marketo REST API will follow the format below:
<blockquote>&lt;REST API Endpoint URL&gt;/rest/</blockquote>
The REST API Endpoint URL can be found within the Marketo Admin &gt; Web Services panel.

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/09/rest_api_endpoint.png"><img class="alignnone size-full wp-image-4267" src="https://marketohost.wpengine.com/wp-content/uploads/2014/09/rest_api_endpoint.png" alt="rest_api_endpoint" width="1175" height="493" /></a>

Your Marketo endpoint URL structure should look similar to the example below:
<blockquote>https://100-AEK-913.mktorest.com/rest/v1/lead/{id}.json</blockquote>
<strong>Note: Bulk API URLs are not prefixed with '/rest/'.  For Bulk API, you should only use the host, and append the appropriate path like so:</strong>
<blockquote>https://100-AEK-913.mktorest.com<span class="crayon-o">/</span><span class="crayon-v">bulk</span><span class="crayon-o">/</span><span class="crayon-v">v1</span><span class="crayon-o">/</span><span class="crayon-v">leads</span><span class="crayon-o">/</span><span class="crayon-v">export</span><span class="crayon-o">/</span><span class="crayon-v">create</span><span class="crayon-sy">.</span><span class="crayon-v">json</span></blockquote>
<h2>How to use Authentication Token to Call Get Lead by Id API</h2>
In the previous sections, we generated an authentication token and found the endpoint URL. We will now make a request to REST API endpoint called <a href="http://developers.marketo.com/documentation/rest/get-lead-by-id/">Get Lead by Id</a>.

The easiest way to make your request to Marketo REST API is to paste the URL into your web browser address bar. Follow the format below:
<blockquote>https://&lt;REST API Endpoint URL for your Marketo instance&gt;/rest/v1/&lt;API that you are calling&gt;?access_token=&lt;access_token&gt;</blockquote>
<h4>Example</h4>
<blockquote>https://100-AEK-913.mktorest.com/rest/v1/lead/318581.json?access_token=cdf01657-110d-4155-99a7-f986b2ff13a0:int</blockquote>
If your call is successful, then it will return JSON with the format below:
<pre class="lang:default decode:true prettyprint lang-js " title="Response">{
    "requestId": "d82a#14e26755a9c",
    "result": [
        {
            "id": 318581,
            "updatedAt": "2015-06-11T23:15:23Z",
            "lastName": "Doe",
            "email": "jdoe@marketo.com",
            "createdAt": "2015-03-17T00:18:40Z",
            "firstName": "John"
        }
    ],
    "success": true
}
</pre>
If you are interested in learning more about the Marketo REST APIs, this is a <a href="http://developers.marketo.com/documentation/rest/">good place to start</a>.<br/><br/>deverly - 2015-09-04<br/><br/><h2>How to Delete Marketo Tracking Cookie</h2><br/><br/>Question: "We have set up a form on our website for the sales team to unsubscribe individuals that have verbally asked to be removed from any email messaging. What we are finding though is when they enter in the email and submit that they are cookied with that email address and start to receive alerts for their activity on our webiste. The form we have is currently an embedded form. Has anyone figured out a way to disable the cook tracking on an embeded form, I understand how to do it with a marketo landing page."

We can do this. To implement this, speed up the cookie expiration. After the cookie is created by the form, you can force it to immediately expire. Because the cookie is expired, the browser will automatically delete it. 

To start this process, we are going to use the native form functionality to call under function called deleteCookie. 
<br/><br/>MManzur - 1970-01-01<br/><br/><h2>August 2014 Release Updates</h2><br/><br/><h3>New REST APIs</h3>
There are three new endpoints available for the REST APIs: <a href="/documentation/rest/describe/">Describe </a>(Lead metadata), <a href="/documentation/rest/get-import-warning-file/">Get Import Warning File</a> and <a href="/documentation/rest/get-import-failure-file/">Get Import Failure File</a>.  The highly anticipated lead metadata API will allow developers to programatically retrieve a list of all lead record attributes.  Get Import Warning File and Failure File return the status for individual records imported using the <a href="/documentation/rest/import-lead/">Import Lead bulk API</a> call.<a href="/documentation/rest/import-lead/">
</a><br/><br/>TKaufman - 2014-08-26<br/><br/><h2>Integrate a Marketo Landing Page with Wordpress</h2><br/><br/>Let's say your website is built using Wordpress, and you would like to embed a Marketo landing page one of the pages. This is possible using an iframe. An iframe allows you to embed a page within another page. In this post, you'll show how to embed a Marketo landing page into a Wordpress page. 

<strong>Choosing a Wordpress Plugin</strong>

Wordpress There are number of 

Here is a Wordpress plugin that lets you :
http://wordpress.org/plugins/iframe/

Here are some pro's and con's on using this approach:
http://www.elixiter.com/marketo-landing-page-and-form-hosting-options/

Great post Murtza! Colby, the iframe would preserve the part where after submitting the form you are redirected to a PDF. We used iframes on our site for a long time.


Great post Murtza! Colby, the iframe would preserve the part where after submitting the form you are redirected to a PDF. We used iframes on our site for a long time.

Of note, if you want to pass through URL parameters from the main URL to the iframe you will need to do some coding. Also, make sure your Google Analytics is set up properly. You don't want to have page views counted twice for every visit to the page with the iframe.<br/><br/>MManzur - 1970-01-01<br/><br/><h2>Integrate Optimizely with a Marketo Landing Page</h2><br/><br/><a href="https://www.optimizely.com/">Optimizely</a> gives you the ability to conduct A/B testing, multipage, and multivariate testing on your site. You can use Optimizely with a Marketo landing page. Here's how to do this:

<strong>Step 1: Find and copy your Optimizely code snippet.</strong>

Go to your Dashboard in Optimizely, and click the Project Code link. Copy the line of code that appears in the pop-up.

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/09/11.png"><img class="size-large wp-image-1756 alignnone" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2014/09/11-1024x393.png" alt="1" width="1024" height="393" /></a>

<strong>Step 2: Log into Marketo, and select your landing page template. Then click "Edit Draft."</strong>

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/09/1-1.png"><img class="size-full wp-image-1593 alignnone" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2014/09/1-1.png" alt="1" width="637" height="308" /></a>

<strong>Step 3: Click Landing Page Actions. Then click Edit Page Meta Tags</strong>

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/09/6-1.png"><img class="size-full wp-image-1784 alignnone" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2014/09/6-1.png" alt="6" width="316" height="237" /></a>

<strong>Step 4: Paste your Optimizely code snippet in Custom HEAD HTML section, and click Save.</strong>

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/09/7.png"><img class="size-full wp-image-1786 alignnone" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2014/09/7.png" alt="7" width="700" height="601" /></a>

<strong>Step 5: Test your landing page to confirm that the Optimizely snippet is working.</strong><br/><br/>MManzur - 2014-09-18<br/><br/><h2>Search by Full Name via Marketo REST API</h2><br/><br/><strong>Question:</strong> Is there a way to query a lead using Marketo APIs with just a lead's full name?

<strong>Answer:</strong> It is not directly possible. However, the workaround described below will allow you to do this.

1. Create a custom field called “Fullname” in Marketo. <a href="/blog/create-a-custom-field-in-marketo-and-update-this-field-via-api/">Here's a blog post that describes how to do this.</a>

2. Use either <a href="/soap-api/getmultipleleads/">getMultipleLeads</a> SOAP API or <a href="/documentation/rest/get-multiple-leads-by-filter-type">Get Multiple Leads by Filter Type</a> to query your lead database. Include first name and last name as attributes in your request to either REST or SOAP APIs.

3. After you query your lead database, concatenate "First Name" and "Last Name” for each lead, and store this data in a "Fullname" column.

4. Use <a href="/soap-api/syncmultipleleads/">syncMultipleLeads</a> SOAP API to push this data to “Fullname” custom field. Alternatively, you can use the <a href="/documentation/rest/import-lead/">Import Lead</a> API, or import a CSV or XLS using the Marketo UI.

5. Now you will be able to query by full name using <a href="/documentation/rest/get-multiple-leads-by-filter-type/">Get Multiple Leads by Filter Type API</a> to search for this custom field. Specify “Fullname” as “filterType” and "filterValue" would be “Joe Johnson"with a Get Multiple Leads by Filter Type REST API call.<br/><br/>MManzur - 2014-09-09<br/><br/><h2>Delete Marketo Tracking Cookie</h2><br/><br/><h4>Additional Note: This method should only be used if the desired effect is to remove the cookie entirely.  In most other cases, <a title="Clearing Marketo Tracking Cookie from Forms 2.0 Submission" href="/blog/clearing-marketo-tracking-cookie-from-forms-2-0-submission/">this method</a> should be used.</h4>
This code sample can be used to delete a Marketo tracking cookie from a user's browser after Marketo form submission. It works by calling deleteMarketoCookie method after a user submits a form. This method expires the cookie by setting the expiration date to a date in the past. The default behavior of the browser is then to delete this cookie because it is expired.

<script src="https://gist.github.com/MurtzaM/9c6d3a0a2aed9ebfde85.js"></script><br/><br/>MManzur - 2014-09-09<br/><br/><h2>Restrict Free Email Domains on Form Fill Out</h2><br/><br/>Let's say you would like to restrict site visitors from submitting a form with a free email domain, such as Gmail or Yahoo. To accomplish this, include the script below in the source code of the page with the Marketo form.

It will check if a user entered a non-business email (Gmail, Hotmail, etc.), and prevent Marketo form submission if a user enters one. You can extend the list of blocked email domains by modifying line 9 to include domains you would like to restrict.

<script src="https://gist.github.com/MurtzaM/3c59bb67ec2f1e052ae1.js"></script><br/><br/>MManzur - 2014-09-09<br/><br/><h2>Debugging a field that is not accesible via the API</h2><br/><br/>If you are coming to this field

https://community.marketo.com/MarketoDiscussionDetail?id=90650000000PvugAAC


When we attempt to update the field AnnualRevenue using the SOAP API, the response says the record is updated, however the AnnualRevenue field does not persist the change.  If we try to update the field manually using the Lead Database, changes to this field are not persisted either.

check if the field is  blocked in Admin.

The other thing can sometimes happen is that it might be an Account Field synced over from SFDC. We block changes to those fields by default because SFDC is the system of record for them in many cases.


1) Created At
2) Marketo SFDC ID
3) Marketo Unique Code
4) SFDC Type
5) Updated At
6) Urgency
7) Priority
8) Sales Created Date<br/><br/>MManzur - 1970-01-01<br/><br/><h2>Add Custom Code to a Marketo Landing Page</h2><br/><br/>Let's say you would like to add a third-party tracking script, such as Google Analytics to your Marketo landing page. This is possible via the Marketo UI. More generally, you can add any custom code (HTML, CSS, JavaScript) to your Marketo landing by following the instructions below.

1. Select your landing page and click on Edit Draft.

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/09/1-2.png"><img class="size-full wp-image-1593 alignnone" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2014/09/1-2.png" alt="1" width="637" height="308" /></a>

2. Drag in the HTML element.

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/09/2.png"><img class="size-full wp-image-1595 alignnone" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2014/09/2.png" alt="2" width="501" height="424" /></a>

3. Enter your custom code, and click Save.

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/09/3.png"><img class="size-full wp-image-1597 alignnone" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2014/09/3.png" alt="3" width="672" height="319" /></a><br/><br/>MManzur - 2014-09-10<br/><br/><h2>Server-Side Form Post</h2><br/><br/>https://community.marketo.com/MarketoResource?id=kA650000000GsXXCA0<br/><br/>MManzur - 2014-09-11<br/><br/><h2>Clearing Marketo Tracking Cookie from Forms 2.0 Submission</h2><br/><br/><h4>Overview</h4>
Forms 1.0 contained the value for the Munchkin tracking cookie as a field in the DOM. This was submitted along with all of the other inputs. <a href="/javascript-api/forms/">Forms 2.0</a> omits this field, and dynamically populates the value upon submission rather than on form load.

While this is generally acceptable, it does creates a class of use cases, which require the tracking cookie be cleared to avoid unintended tracking and prefilling. For example, this can occur at a tradeshow where a Marketo customer is using the same form on the same device, and getting contact information from multiple people.

The snippet below will allow you to clear the cookie value on submission of the form, without having to delete the cookie itself from the user's browser.
<h4>Code Sample</h4>
This snippet expects a single form load on the page. If there are multiple forms, you should use the <a href="/javascript-api/forms/api-reference/">loadForm or getForm methods</a> to implement your callbacks.
<pre class="lang:default decode:true">&lt;script&gt;
//add a callback to the first ready form on the page
MktoForms2.whenReady( function(form){ 
	//add the tracking field to be submitted
        form.addHiddenFields({"_mkt_trk":""});
        //clear the value during the onSubmit event to prevent tracking association
	form.onSubmit( function(form){
		form.vals({"_mkt_trk":""}); 
	})
})
&lt;/script&gt;
</pre><br/><br/>kelkington - 2014-09-11<br/><br/><h2>September 2014 Release Updates</h2><br/><br/><h3>Updates to REST API</h3>
Added a new optional fields value to <a href="http://developers.marketo.com/documentation/rest/get-multiple-leads-by-filter-type/">Get Multiple Leads</a> API which will return the Munchkin cookie values associated with a lead record.  Simply add "?fields=cookies" to the request.
<h3>New Real-Time Personalization API</h3>
Introduced <a href="http://developers.marketo.com/documentation/websites/rtp-js-api/rtp-redirect-api/">Real-Time Personalization Redirect API</a>. This API enables the redirection of segmented audiences to a target URL.

&nbsp;

&nbsp;

&nbsp;<br/><br/>MManzur - 1970-01-01<br/><br/><h2>Marketo Developer Blog RSS Feed</h2><br/><br/>If you want to be notified with updates to the Marketo Developer Blog, you can add the Marketo Developer Blog RSS Feed to your RSS reader of choice.

Marketo Developer Blog RSS Feed: "<a href="/blog/feed/">http://developers.marketo.com/blog/feed/</a>"<br/><br/>MManzur - 2014-09-16<br/><br/><h2>Add Location Data from RTP API to Marketo Form Fill Out</h2><br/><br/><strong>You'll need active RTP and MLM subscriptions to implement the use case described in this blog post.</strong>

Using the <a href="/javascript-api/personalization/">RTP JavaScript APIs</a> and <a href="/javascript-api/forms/">Marketo Forms 2.0</a>, you can pull the inferred location data from RTP and push it into Marketo via a form fill out. This will allow you to see the user's inferred location (based on IP address) during the most recent form activity.

To get started, you will need to create <a href="/blog/create-a-custom-field-in-marketo-and-update-this-field-via-api/">three custom string fields in Marketo</a>. You can do this either via your CRM if it has a native integration with Marketo, <a href="/blog/create-a-custom-field-in-marketo-and-update-this-field-via-api/">or from the Field Management menu in Marketo's admin section</a>. I recommend naming these fields 'Most Recent Country', 'Most Recent State', and 'Most Recent City.' We'll continue this blog using this naming convention. The API names for these fields will be 'mostRecentCountry', 'mostRecentState', and 'mostRecentCity'.

To retrieve the location data, we'll be using the <a href="/javascript-api/personalization/">RTP method to get the visitor's location data</a>, and then pass it into the form using the <a href="/javascript-api/forms/">addHiddenFields and vals methods</a> from the Marketo Forms 2.0.

On your page, add your RTP JS tag and a Marketo form. Then, include the script below. You will need to change the names of the target form fields in the example code if you are using a different naming convention than the one described above.
<pre class="lang:default decode:true">&lt;script&gt;
//modify the form and grab the user
MktoForms2.whenReady( function(form) {	
        //add the hidden fields to the form
	form.addHiddenFields({
		"mostRecentCountry":"",
		"mostRecentState":"",
		"mostRecentCity":""});
	//Grab the visitor data, a JS object with it is passed in the callback function of the third argument
	rtp('get','visitor',function(visitor){
		//add the desired info from the visitor object to the form fields
		form.vals({
			"mostRecentCountry":visitor.results.location.country,
			"mostRecentCity":visitor.results.location.city,
			"mostRecentState":visitor.results.location.state});
		}
		);
	});
&lt;/script&gt;
</pre><br/><br/>kelkington - 2014-09-17<br/><br/><h2>Block Crawling and Search Indexing of a Marketo Landing Page</h2><br/><br/>Let's say you want to block a Marketo landing page from being crawled and shown in results by search engines like Google. Here's how to do this:

<strong>Step 1: Log into Marketo, and select your landing page. Then click "Edit Draft."</strong>

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/09/1.png"><img class="size-full wp-image-1593 alignnone" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2014/09/1.png" alt="1" width="637" height="308" /></a>

<strong>Step 2: Click Landing Page Actions. Then click Edit Page Meta Tags</strong>

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/09/6.png"><img class="size-full wp-image-1784 alignnone" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2014/09/6.png" alt="6" width="316" height="237" /></a>

<strong>Step 3: Change Robots field to No Index, No Follow. Then click Save.</strong>

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/09/8.png"><img class="size-full wp-image-1805 alignnone" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2014/09/8.png" alt="8" width="703" height="601" /></a><br/><br/>MManzur - 2014-09-19<br/><br/><h2>Marketo REST vs SOAP APIs FAQ</h2><br/><br/><strong>Updated: March 2016</strong>

Here are answers to the most frequently asked questions about Marketo <a href="/documentation/rest/">REST</a> and <a href="/soap-api/">SOAP</a> APIs.

<strong>Q: What are the main differences between the Marketo REST and SOAP APIs?</strong>
A: While the ability to push/pull specific data via REST and SOAP APIs mostly overlaps, there is certain functionality that only exists in either REST or SOAP APIs. In terms of performance, the REST API has better <a href="http://en.wikipedia.org/wiki/Throughput">throughput</a> than the SOAP API. In terms of the authentication model, the REST API has an authentication model that uses an expiring token.  Our REST API also provides access to Marketo <a href="/documentation/asset-api/">assets</a>.

&nbsp;

<strong>Q: What features are available in the REST API that are not available in the SOAP API? </strong>
A: <a href="/documentation/rest/get-multiple-lists/">List of lists API</a>, check if <a href="/documentation/rest/member-of-list/">lead is a member of list</a> API, <a href="/documentation/rest/remove-leads-from-list/">remove a lead from a list API</a>, <a href="/documentation/rest/">Usage API</a>, and <a href="/documentation/rest/">Error API</a> are only available with the REST API.

<strong>Q: Does Marketo plan to deprecate the SOAP API?</strong>
A: There is no plan to deprecate the SOAP API.

<strong>Q: Are there plans to increase the number of APIs available for the SOAP API?</strong>
A: No.

<strong>Q: Are there plans to increase the number of APIs available for the REST API?</strong>
A: Yes.  REST is the primary focus of Marketo's API development at this time.<br/><br/>MManzur - 2014-09-20<br/><br/><h2>Import Demo Data</h2><br/><br/>To test out the Marketo APIs, you need to have data in your Marketo lead database. This post will show you how to import demo data into your Marketo account.

<a href="/wp-content/uploads/2014/12/Marketo-demo-data.csv">Here is a link to a CSV file with demo data</a> that you can use as a starting point for creating your own demo data. It has 500 leads with email, first name, last name, and company name columns. To make the data more interesting, add additional columns, such as city and state.

<strong>Step 1 - Login to Marketo, and go to Lead Database. Click New. Then click Import List.</strong>

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/12/Screen-Shot-2014-12-08-at-2.31.09-PM.png"><img class="size-full wp-image-2714 alignnone" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2014/12/Screen-Shot-2014-12-08-at-2.31.09-PM.png" alt="Screen Shot 2014-12-08 at 2.31.09 PM" width="408" height="274" /></a>

<strong>Step 2 - Click Browse and select the file with the demo data. Then click Next. </strong>

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/12/Screen-Shot-2014-12-08-at-2.33.24-PM.png"><img class="size-full wp-image-2718 alignnone" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2014/12/Screen-Shot-2014-12-08-at-2.33.24-PM.png" alt="Screen Shot 2014-12-08 at 2.33.24 PM" width="750" height="466" /></a>

<strong>Step 3 - Verify that the column names from the demo data file match up with the appropriate Marketo fields. Then click Next.</strong>

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/12/Screen-Shot-2014-12-08-at-2.53.30-PM.png"><img class="size-full wp-image-2722 alignnone" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2014/12/Screen-Shot-2014-12-08-at-2.53.30-PM.png" alt="Screen Shot 2014-12-08 at 2.53.30 PM" width="749" height="471" /></a>

<strong>Step 4 - Select a List Name. Select an Acquisition Program. Then click Import.</strong>

Selecting a list name will associate the leads from the demo data file with this list in Marketo. Selecting an acquisition program will put the name of the acquisition program on all leads imported from this file.

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/12/Screen-Shot-2014-12-08-at-2.55.16-PM.png"><img class="size-full wp-image-2724 alignnone" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2014/12/Screen-Shot-2014-12-08-at-2.55.16-PM.png" alt="Screen Shot 2014-12-08 at 2.55.16 PM" width="752" height="468" /></a>

<strong>Step 5 - Wait for the Import Completed notification to verify the import was successful.</strong>

With the demo data now in your Marketo lead database, you can test out the Marketo APIs. <a href="/blog/quick-start-guide-for-marketo-rest-api/">This blog post</a> is a good next step to learn more.

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/12/Screen-Shot-2014-12-08-at-3.01.01-PM.png"><img class="size-full wp-image-2730 alignnone" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2014/12/Screen-Shot-2014-12-08-at-3.01.01-PM.png" alt="Screen Shot 2014-12-08 at 3.01.01 PM" width="899" height="804" /></a><br/><br/>MManzur - 2014-12-08<br/><br/><h2>Server-Side Form Post</h2><br/><br/><strong>Note: This is a non-public and unsupported API, it is not supported and its behavior may change at any time</strong>

If you use your own forms on your website, you can still send this data into Marketo using a server-side post. The benefit of this approach is that you can keep your existing form and application logic, but you can still use an actual form post into Marketo. This gives the Marketo users a “Fills Out Form” event, which can be used to trigger automated processes or for segmentation.

<strong>NOTE: There is a rate limit of 30 server-side form posts per minute from a one single IP address.</strong>

In each scripting or programming language there are different options to do a server-side form submission, and they may have different object/methods that can be used to make the Post Call. For example, in PHP many people use the cURL library. In all cases, you will be posting name-value pairs to a specified URL. The names need to be identical to the API names of the Marketo fields. In addition, there are a couple of system fields that will need to be included to correctly capture the form submission.

<strong>Step One: Create a Form</strong>

The first step is to create a form in Marketo or to use an existing form that you want to submit. The name of the form needs to be descriptive, but it does not actually need any form fields. If you create a new form, simply enter a name, uncheck the “Open form editor” box and you’re done.

<strong>Step Two: Find a Form ID</strong>

In the Marketo UI, select the form and look at the URL: it should be of the format https://app-x.marketo.com/#FO8B2ZN12. Behind the # sign, look at the number immediately following “FO” to find the Form ID. In this case, the Form ID is 8. In some cases, your first form may be numbered 1001 and count up from there. The Form ID is a variable, so that you can trigger the submission of different forms.

<strong>Step Three: Get your Marketo Account ID</strong>

Go to Admin &gt; Munchkin and copy the Munchkin Account ID, which has the format of 000-AAA-000:
<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/11/Screen-Shot-2014-11-06-at-3.55.03-PM.png"><img class="size-full wp-image-2156 alignnone" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2014/11/Screen-Shot-2014-11-06-at-3.55.03-PM.png" alt="Screen Shot 2014-11-06 at 3.55.03 PM" width="873" height="791" /></a>

You’ll need this so that the form is submitted into the correct Marketo instance.

<strong>Step Four: Determine the POST URL</strong>

When in the Marketo user interface, note the domain in the location bar, usually of the format http://app-x.marketo.com/. Discard anything after the slash, then append “index.php/leadCapture/save” to get the full form POST URL.

Note 1: this is case sensitive.

Note 2: Marketo Sandboxes may have a different domain than your Production Marketo system. So an example URL would be:

http://app-x.marketo.com/index.php/leadCapture/save

You can also use HTTPS instead of HTTP (do not use your CNAME as it will give a security exception).

<strong>Step Five: Find the Form Field Names</strong>

Go to Admin &gt; Field Management and click the “Export Field Names” button to download a spreadsheet with the API field names. Use the API name as the name in your name-value pairs.

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/11/Screen-Shot-2014-11-06-at-3.56.00-PM.png"><img class="size-full wp-image-2158 alignnone" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2014/11/Screen-Shot-2014-11-06-at-3.56.00-PM.png" alt="Screen Shot 2014-11-06 at 3.56.00 PM" width="761" height="459" /></a>

<strong>Step Six: Decide Which Fields to POST</strong>

You can include any Marketo Lead field in your form submission. Please note that field names are case sensitive. In addition to the fields you want to submit there are two mandatory fields and two recommended fields:

Mandatory fields on the form:

(1) munchkinId - This field is used for your Munchkin Account ID
(2) formid - This field indicates which form in Marketo has been submitted

Recommended fields on the form:

(1) Email - this field is used as the primary key for deduplication. If Marketo finds a matching email address in the Marketo database, it will update the existing record, otherwise it will create a new record. If there are multiple matches, it will update the most recently updated record
(2) _mkt_trk - this field carries the cookie information, so you’ll be able to track the individual’s web page visits. If you have Munchkin on your form page, Munchkin will automatically enter a value in this hidden form field. If not, read it from the cookie with the same name and pass it to Marketo in this field.

<strong>Note: The body of the POST to a Marketo form must be URL encoded.</strong>

<strong>Step Seven: See the Response</strong>

The response to the form post will be a HTTP 302 redirect code. In some systems this will appear as an error. However, in this case it means that the Lead is was successfully created or updated. If there is an error, you will receive a 4xx or 5xx error code.

<strong>Reference Links</strong>
<ul>
 	<li>Here is a <a href="https://nation.marketo.com/community/product_and_support/blog/2015/12/11/how-to-build-an-external-subscription-center">post</a> about using this technique for unsubscribe scenarios [by Justin Cooperman, Sr. Product Manager]</li>
</ul><br/><br/>MManzur - 2014-11-07<br/><br/><h2>Find Leads Updated on Specific Date Ranges</h2><br/><br/>Let's say you want to find leads that were updated on specific dates via the <a href="/soap-api/">Marketo API</a>. This is possible with the <a href="/soap-api/leads/getmultipleleads/">getMultipleLeads SOAP API</a>. This method will return any leads with a data value change or new activity in Marketo for the date range you request.

For the leadSelector, you would specify LastUpdateAtSelector. Then, you would define the date ranges with oldestUpdatedAt and latestUpdatedAt time bounds. Please see the sample Request XML below, which shows you how to find leads that were updated between 12am PST on June 6, 2014 and 12am PST on June 7, 2014.

Note: the date range must not exceed 30 days.

<strong>Sample Request XML to Find Leads Updated by Date</strong>
<pre class="lang:default decode:true ">&lt;soapenv:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:mkt="http://www.marketo.com/mktows/"&gt;
&lt;soapenv:Header&gt;
&lt;mkt:AuthenticationHeader&gt;
&lt;mktowsUserId&gt;REPLACE&lt;/mktowsUserId&gt;
&lt;requestSignature&gt;REPLACE&lt;/requestSignature&gt;
&lt;requestTimestamp&gt;2014-10-23T12:19:51-07:00&lt;/requestTimestamp&gt;
&lt;/mkt:AuthenticationHeader&gt;
&lt;/soapenv:Header&gt;
&lt;soapenv:Body&gt;
&lt;mkt:paramsGetMultipleLeads&gt;
&lt;leadSelector xsi:type="mkt:LastUpdateAtSelector"&gt;
&lt;oldestUpdatedAt&gt;2014-06-06T00:00:00-08:00&lt;/oldestUpdatedAt&gt;
&lt;latestUpdatedAt&gt;2014-06-07T00:00:00-08:00&lt;/latestUpdatedAt&gt;
&lt;/leadSelector&gt;
&lt;/mkt:paramsGetMultipleLeads&gt;
&lt;/soapenv:Body&gt;
&lt;/soapenv:Envelope&gt;
</pre><br/><br/>MManzur - 2014-09-24<br/><br/><h2>Add Dynamic Content to an Email</h2><br/><br/>Let's say you send out a daily email, and you want to automatically include that day's date in the email template. To do this, you will use tokens and email scripting in Marketo.

<strong>Step One: Create a token.</strong>

Navigate to the program where you want to use the token. Click My Tokens.

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/11/token1.png"><img class="size-full wp-image-2594 alignnone" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2014/11/token1.png" alt="token1" width="119" height="130" /></a>

Double click on Email Script. Then name this token. Then click Edit.

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/11/token2.png"><img class="size-large wp-image-2596 alignnone" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2014/11/token2-1024x204.png" alt="token2" width="1024" height="204" /></a>

Paste the email script below in this window. Then click Save.

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/11/token3.png"><img class="size-full wp-image-2598 alignnone" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2014/11/token3.png" alt="token3" width="903" height="581" /></a>
<pre class="lang:default decode:true ">## Access Velocity's calendar object
#set($x = $date.calendar)

## Format date
#set($current_date = $date.format('dd-MM-yyyy', $x.getTime()))

## Returns today's date
$current_date
</pre>
<strong>Step Two: Reference the token in the email template.</strong>

Note the name of the token.

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/11/token4.png"><img class="size-large wp-image-2602 alignnone" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2014/11/token4-1024x89.png" alt="token4" width="1024" height="89" /></a>

Navigate to your email draft. Include the token.

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/11/token5.png"><img class="size-full wp-image-2600 alignnone" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2014/11/token5.png" alt="token5" width="712" height="265" /></a>

When the email is sent out, the value of the token will be populated. For more information, please see the <a href="/email-scripting/">Email Scripting developer documentation</a>.<br/><br/>MManzur - 2014-11-22<br/><br/><h2>Bash Security Advisory</h2><br/><br/>Marketo has performed a thorough investigation of the Bash vulnerability, also known as <a href="http://web.nvd.nist.gov/view/vuln/detail?vulnId=CVE-2014-6271">Shellshock (CVE-2014-6271)</a>, and have concluded that we are not susceptible to these attacks. In addition, we have taken preventive action by updating the software to the latest version to ensure compliance with <a href="https://www.us-cert.gov/ncas/alerts/TA14-268A">CERT recommendation</a>.<br/><br/>MManzur - 2014-09-26<br/><br/><h2>How to Update SOAP API Credentials</h2><br/><br/>It is a best practice to regularly update your <a href="/soap-api/">SOAP API</a> credentials. Currently, there is no way to programmatically do this via the Marketo API. The instructions below will show you how to update your SOAP API credentials via the Marketo UI.

1. Go to the Admin section and click on Web Services.

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/09/a.png"><img class="size-full wp-image-1932 alignnone" src="https://marketohost.wpengine.com/wp-content/uploads/2014/09/a.png" alt="a" width="581" height="515" /></a>

2. Set an Encryption Key that is at least 10 characters, click Save Changes.

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/09/b.png"><img class="size-full wp-image-1936 alignnone" src="https://marketohost.wpengine.com/wp-content/uploads/2014/09/b.png" alt="b" width="646" height="379" /></a><br/><br/>MManzur - 2014-09-29<br/><br/><h2>How to Clean Up Your Marketo Database</h2><br/><br/><strong>NOTE: This is a guest blog post. Josh Hill is the Marketo Practice Lead at Perkuto, a marketing automation agency. Josh works at the intersection of marketing, sales, and technology to deliver revenue generation systems. He writes about marketing automation and demand generation at <a href="http://www.marketingrockstarguides.com/">MarketingRockstarGuides.com</a>.
</strong>

Keeping your Marketo database clean is an important part of administering this powerful system. If your Marketo data is dirty or your CRM data is dirty, then your job as a marketing manager becomes a whole lot harder as you explain why campaigns went to the wrong people or your reports are “directional.”

<a href="https://www.data.com/export/sites/data/common/assets/pdf/DS_Gartner.pdf">A 2011 Gartner study noted</a> that poor data quality lowered labor productivity by 20%. That’s 20% of your time (8 hours/week or 1 day per week) that is wasted because you had to fix data. But this loss pales in comparison to the revenue lost because your targeting was wrong.

Here are the top five reasons to invest in keeping your data clean:

- Better segmentation of leads and clients can be done, allowing you to focus your message on the right people at the right time. That 20% off coupon should go only to new prospects, not your best clients, right?

- Avoid duplicate sending of emails. In spite of all the precautions, it is possible to send multiple emails to the same lead, usually because duplicate records are not merged.

- Accurate reporting to your boss. Because the CMO has a seat at the revenue table, you must have accurate, consistent, and repeatable reports…or you cannot be a revenue marketer anymore.

- Hurt pending deals if you email the wrong marketing material to key prospects during sales negotiations. If your database is not providing that detail on lifecycle stage, that could sink a deal or two.

- Remove bad or old leads to stay below pricing thresholds. Much has been written about the cost of bad data. Your most immediate concern is that too many bad, duplicate, or old leads are pushing you over your Marketo or Salesforce pricing tier, which can result in thousands of fees per year.

So how do you keep your database clean? You can follow these principles of data cleanliness, but how do you get there inside Marketo?

I will make a few assumptions about your system:

- You have a standard Marketo system.
- You have a typical Lead-Contact-Account Salesforce setup.
- You are syncing all records between systems.
- You are not using purposeful duplicates.

<strong>Step 1: Find the Right Leads to Fix</strong>

Let’s first find the leads that are potential problems. With each client, I will go through a series of smart lists to determine the health of their database. I suggest you do the same on a monthly basis. Once the smart lists are working, this will take you no more than 15 minutes per month. This is a great way to demonstrate the ROI of your work and Marketo.

Create a table to understand the total impact on your database. The example below includes the criteria I look for, so be sure to include other fields important to your business. Breakdown each group by Marketo Only, SFDC Leads, and SFDC Contacts.

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/10/Screen-Shot-2014-10-08-at-3.31.18-PM.png"><img class="size-full wp-image-1983 alignnone" src="https://marketohost.wpengine.com/wp-content/uploads/2014/10/Screen-Shot-2014-10-08-at-3.31.18-PM.png" alt="Screen Shot 2014-10-08 at 3.31.18 PM" width="583" height="520" /></a>

<strong>Step 2: Use Automation to Correct Data Values</strong>

The use of automation rules to correct common misspellings or missing data goes back several decades. In the 1960s, poor data quality when sending direct mail could result in thousands of dollars being wasted. Today, data quality mistakes ruin reputations faster than a misdirected mail piece. Email reputation, choice of language, and customer experience matter and they matter more because mistakes can go publicly viral in minutes. Save your firm’s reputation with automated data cleansing.

These data management flows are one of the first things I setup in Marketo. Most firms setup similar flows:

- Country Corrector (although you should have followed Principle 1 to not need this)
- State Corrector or Mapper – often helpful if you have Country and Inferred State.
- Count of Employees to Employee Range.
- Bad Lead Source to Good Lead Source
- Email Invalid to Email is Good if the Email changed.
- Translate old field values to a new field (Full to Empty).

For example, this flow adjusts Employee Range based on Employee Number.

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/10/1c.png"><img class="size-full wp-image-1987 alignnone" src="https://marketohost.wpengine.com/wp-content/uploads/2014/10/1c.png" alt="1c" width="900" height="751" /></a>

<strong>Step 3: Data Appending Tools</strong>
Filling in empty fields is critical to segmenting your database better. Leads do not always fill in the right Industry or Function or even Title on a form. Sometimes you have legacy data from an older system. This lack of data means you have to either send that email to fewer people, or possibly the wrong people. To fix this, you need data appending tools.

- Option 1: Fill it in yourself.

You may be able to interpolate data to backfill empty fields. Perhaps you have a SIC code instead of Industry name or Annual Revenue vs. Annual Revenue Range. Marketo can easily automate these fixes.

- Option 2: Find a data appending/enrichment vendor via LaunchPoint

There are <a href="http://launchpoint.marketo.com/">several vendors in Launchpoint</a>, such as NetProspex and ReachForce that can help you enrich your lead data. Some ask you for a sheet of your data, which they then clean and send back. The better option is an automated tool in Marketo or Salesforce, which checks the fields you, want, and then pushes back the right data. Most vendors use the <a href="/home/">Marketo API or Webhooks</a> to accomplish this.

- Option 3: Use Marketo APIs to update leads

You can use the Marketo APIs to identify leads that need to be cleansed, and then update them via the API. The <a href="/documentation/rest/get-multiple-leads-by-filter-type/">Get Multiple Leads by Filter Type REST API</a> is good starting place for pulling out data from Marketo that match certain criteria. To update leads, please look at the <a href="/documentation/rest/createupdate-leads/">Create/Update Leads REST API</a>.

Alternatively, you can set up a <a href="/webhooks/">Marketo Webhook</a> to notify an external system that a certain event has happened, such as a form fill out. You can then respond back with values to update the lead with.

<strong>Step 4: What Should You Automate?</strong>

I provided some suggestions in Step 2. But if we want to clean up more of the database, we need to go beyond fixing data values.

- Competitor Blacklisting: make sure you are automating the collection and blacklisting of your competitors. If you have competitor-partners, it is still good to mark them properly and place them in a list to possibly suppress.

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/10/2c.png"><img class="size-full wp-image-1989 alignnone" src="https://marketohost.wpengine.com/wp-content/uploads/2014/10/2c.png" alt="2c" width="694" height="563" /></a>

- Multiple Hard Bounces: definitely automate this flow. If a lead hard bounces more than twice in a 30 day period, set them to Suspended or Invalid. Then go in once a month to review if the issue was a typo or something else.

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/10/3c.png"><img class="size-full wp-image-1991 alignnone" src="https://marketohost.wpengine.com/wp-content/uploads/2014/10/3c.png" alt="3c" width="787" height="187" /></a>

- Multiple Soft Bounces in 30 Days: set these to marketing suspended=TRUE for 30 days.

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/10/4c.png"><img class="size-full wp-image-1993 alignnone" src="https://marketohost.wpengine.com/wp-content/uploads/2014/10/4c.png" alt="4c" width="807" height="662" /></a>

- Spam Trap suspension/deletion: be careful if your product means people use possible spam trap addresses. See a list of spam traps.

The Smart List

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/10/5c.png"><img class="size-full wp-image-1995 alignnone" src="https://marketohost.wpengine.com/wp-content/uploads/2014/10/5c.png" alt="5c" width="772" height="379" /></a>

The Smart Campaign

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/10/6c.png"><img class="size-full wp-image-1997 alignnone" src="https://marketohost.wpengine.com/wp-content/uploads/2014/10/6c.png" alt="6c" width="747" height="357" /></a>

<strong>What Not to Automate</strong>

Never automate the deletion of leads, because there is too much risk in accidentally mass deletion of the wrong records. Instead, review once a month leads marked as Trash. But if you want to delete trashed leads, run a flow like this with a 30-day wait.

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/10/7c.png"><img class="size-full wp-image-2003 alignnone" src="https://marketohost.wpengine.com/wp-content/uploads/2014/10/7c.png" alt="7c" width="900" height="544" /></a>

<strong>Step 5: Caveats</strong>

Using automation is a great way to save time and keep your database clean. Automation is a double-edged sword because if you set it up wrong, it can cause havoc in a few minutes. Be careful as you go through these processes and keep everyone informed.

Generally I advise against deleting any SFDC Contacts because they are more likely to be active Opportunities, Clients, or ex-Clients. You may be required by Finance or Legal to retain certain records and Contacts are attached to those records. Instead, focus on Contacts that Hard Bounce, become Invalid, or become No Longer There.

Now you know a few of the techniques to keep your Marketo database clean. Let us know if you came up with other ways to automate these processes using the API or Webhooks!<br/><br/>JHill - 2014-10-08<br/><br/><h2>October 2014 Release Updates</h2><br/><br/><h3>New REST APIs</h3>
There are four new endpoints available for the REST APIs: <a href="/documentation/rest/get-activity-types/">Get Activity Types</a>, <a href="/documentation/rest/get-lead-activities/">Get Lead Activities</a>, <a href="/documentation/rest/get-lead-changes/">Get Lead Changes</a>, and <a href="/documentation/rest/get-paging-token/">Get Paging Token</a>. This set of APIs lets you pull new activities or changes to leads.<br/><br/>MManzur - 2014-10-10<br/><br/><h2>External Page Prefill</h2><br/><br/>Marketo forms do not provide native prefill functionality when loaded outside of a Marketo landing page. However, we can still implement this using the <a href="/documentation/rest/">Marketo APIs</a> and the <a href="/javascript-api/forms/">Forms 2.0 JavaScript API</a>.

The first step is to retrieve the lead data from Marketo via a REST call from your server. Assuming that we do not have an immediate way to crossreference lead IDs or another unique identifier from the server, we'll need to use the Munchkin cookie, '_mkto_trk', to retrieve data from the Marketo server, using the <a href="/documentation/rest/get-multiple-leads-by-filter-type/">Get Leads By Filter Type method</a>.

To make this call, <a href="/blog/quick-start-guide-for-marketo-rest-api/">we'll need your Authentication and REST endpoints from your instance</a>. Once you have authenticated with your Marketo instance we'll need to make a call to the leads API at 'https://&lt;host&gt;/rest/v1/leads.json'. We then need to create a querystring to filter on the Marketo cookie like this '?filterType=cookie&amp;filterValues='. You'll need to retrieve the specific value from the '_mkto_trk' key sent to your server by the client.

NOTE: The _mkto_trk cookie value includes an ampersand and needs to be URL encoded to '%26' in order to be properly accepted by the Marketo endpoint.

By default the leads API will return four fields, id, email, firstName, and updatedAt. To set a specific set of fields, you need to include a 'fields' query parameter, with field names separated by commas like this: '&amp;fields=email,firstName,lastName,company'

Ultimately our call is going to look like this:
<pre class="lang:default decode:true ">https://&lt;host&gt;/rest/v1/leads.json?filterType=cookie&amp;filterValues=&lt;cookie&gt;&amp;fields=email,firstName,lastName,company&amp;access_token=&lt;token&gt;
</pre>
When we make this call, it will return a JSON object which looks this:
<pre class="lang:default decode:true prettyprint lang-js">{
    "requestId":"e42b#14272d07d78",
    "success":true,
    "result":[  
        {  
        "id":50,
        "firstName":"Kenny",
	"lastName":"Elkington",
        "email":"mkto@example.com",
	"company":"Marketo Inc."
        }]
};
</pre>
Now that we have our lead details, we can go about mapping these into a Marketo form, using the whenReady and vals methods in Javascript. First we need to set the Lead results as a variable on our page:
<pre class="lang:default decode:true">&lt;script&gt;
//print your JSON object dynamically as the mktoLead variable
var mktoLead = {
    "requestId":"e42b#14272d07d78",
    "success":true,
    "result":[  
        {  
        "id":50,
        "firstName":"Kenny",
		"lastName":"Elkington",
        "email":"mkto@example.com",
		"company":"Marketo Inc."
        }]
}
&lt;/script&gt;
</pre>
Now that we have our results on the page, we can map them into our form fields:
<pre class="lang:default decode:true">&lt;script&gt;
MktoForms2.whenReady( function(form) {
	//set the first result as local variable
	var mktoLeadFields = mktoLead.result[0];
    //map your results from REST call to the corresponding field name on the form
	var prefillFields = { 
			"Email" : mktoLeadFields.email,
			"FirstName" : mktoLeadFields.firstName,
			"LastName" : mktoLeadFields.lastName,
			"Company" : mktoLeadFields.company
			};
	//pass our prefillFields objects into the form.vals method to fill our fields
	form.vals(prefillFields);
	}
	);
&lt;/script&gt;
</pre><br/><br/>kelkington - 2014-10-24<br/><br/><h2>Replace Email HTML</h2><br/><br/>This post will show you how to remove the HTML generated by Markteto for an email. You can then use your own HTML without Marketo reformatting it.

<strong>Step 1: Navigate to the email, and then click Edit Draft.</strong>

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/10/zz1.png"><img class="size-full wp-image-2069 alignnone" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2014/10/zz1.png" alt="zz1" width="572" height="521" /></a>

<strong>Step 2: Click Email Actions, click HTML Tools, and then click Replace HTML.</strong>

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/10/zz2.png"><img class="size-full wp-image-2071 alignnone" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2014/10/zz2.png" alt="zz2" width="600" height="331" /></a>

<strong>Step 3: Replace the code in this box with your HTML. Then, click Save.</strong>

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/10/zz3.png"><img class="size-full wp-image-2073 alignnone" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2014/10/zz3.png" alt="zz3" width="701" height="540" /></a><br/><br/>MManzur - 2014-10-28<br/><br/><h2>Get a Visitor's Cookie ID and then Query Associated Lead Data</h2><br/><br/>Using the <a href="/documentation/rest/get-multiple-leads-by-filter-type/">Get Multiple Leads by Filter Type</a> REST endpoint, you can query lead data based on a user's cookie id. For example, you can use this approach to <a href="/blog/external-page-prefill/">prefill a form on a non-Marketo landing page</a>. This post will show you how to capture the user's cookie value during a webpage visit, query <a href="/documentation/rest/get-multiple-leads-by-filter-type/">Get Multiple Leads REST API</a> with that cookie id, and then return the user's lead data.

First, we will need the value of the user's Munchkin cookie, '_mkto_trk'. Here is an example JavaScript function that you can use to get the cookie value. Please see <a href="http://stackoverflow.com/questions/10730362/get-cookie-by-name">this StackOverflow page</a> for more information about this approach. I recommend setting a delay of 500ms after page load event before calling this function. This will give Munchkin time to load, and cookie the user.
<pre class="lang:default decode:true" title="JavaScript">//Function to read value of a cookie
function readCookie(name) {
    var cookiename = name + "=";
    var ca = document.cookie.split(';');
    for(var i=0;i &lt; ca.length;i++) {
        var c = ca[i];
        while (c.charAt(0)==' ') c = c.substring(1,c.length);
        if (c.indexOf(cookiename) == 0) return c.substring(cookiename.length,c.length);
    }
    return null;
}

//Call readCookie function to get value of user's Marketo cookie
var value = readCookie('_mkto_trk');
</pre>
Next, pass the value of the '_mkto_trk' cookie to your server. To retrieve lead data, from your server you will make a call to the <a href="/documentation/rest/get-multiple-leads-by-filter-type/">Get Multiple Leads REST API</a> with this cookie value. You'll <a href="/blog/quick-start-guide-for-marketo-rest-api/">need your Authentication and REST endpoints from your instance</a>. Your call should be structured as follows:
<pre class="lang:default decode:true " title="Ruby">#NOTE: The _mkto_trk cookie value includes an ampersand and needs to be URL encoded to '%26' in order to be properly accepted by the Marketo endpoint.

require 'rest_client'
require 'json'

#Build request URL
#Replace AAA-BBB-CCC with your Marketo instance
marketo_instance = "https://AAA-BBB-CCC.mktorest.com"
endpoint = "/rest/v1/leads.json"
#Replace with your access token
auth_token =  "?access_token=" + "cde42eff-aca0-48cf-a1ac-576ffec65a84:ab"
#Replace with filter type and values
filter_type_and_values = "&amp;filterType=cookies&amp;filterValues=id:AAA-BBB-CCC%26token:_mch-marketo.com-1418418733122-51548&amp;fields=cookies,email"
request_url = marketo_instance + endpoint + auth_token + filter_type_and_values

#Make request
response = RestClient.get request_url

#Returns Marketo API response
puts response
</pre>
The example above will return the email and all cookies associated with the user. You can then use this data to personalize the subsequent page the user visits.
<pre class="">{"requestId":"aa00#14a405aa786","result":[{"id":583,"email":"testaccount@gmail.com","cookies":"_mch-marketo.com-1418418733122-51548"}],"success":true}
</pre><br/><br/>MManzur - 2014-10-30<br/><br/><h2>When do you need a developer to help with marketing automation?</h2><br/><br/><strong>NOTE: This is a guest blog post. Josh Hill is the Marketo Practice Lead at Perkuto, a marketing automation agency. Josh works at the intersection of marketing, sales, and technology to deliver revenue generation systems. He writes about marketing automation and demand generation at <a href="http://www.marketingrockstarguides.com/">MarketingRockstarGuides.com</a>.
</strong>

Marketing automation platforms are tremendously powerful out of the box and in the hands of an experienced operator. Platforms, by definition, allow the use of extension applications to make the system do even more amazing things for your team.

You may think Marketo’s logic engine is capable of so much (and it is), but there are limitations. Marketo cannot do everything for you, nor should it. There are other tools out there that perform their function better than Marketo could build it.

Marketo’s platform is very open, enabling the <a href="http://launchpoint.marketo.com/">LaunchPoint ecosystem of applications</a> to exist. You can also use this openness to expand the capabilities of your site and Marketo to match your business needs.

The great thing about a platform like Marketo is it allows the typical marketer the ability to build pages, emails, and routing logic without being a full-fledged programmer. A marketer these days does need to understand logic, but actual programming is best left to the experts. So how do you know when you need to call in a developer?

I have a few basic rules, or heuristics, to decide when a programmer should get involved:
- When Marketo doesn’t have an obvious filter, trigger, or feature for the need, it can often be done with some Javascript or jQuery.
- Will this be too complex for Marketo by itself?
- Can Marketo even do this?
- Is this a website customization not easily supported?
- Does Marketo need to talk to a website or other database?
- Does it sound like something a computer can do, but Marketo doesn’t have a function for it?

Remember that while Marketo may not offer an out-of-the-box function, it does connect to many third-party integrations as well as custom connections. Take a look at a few of these categories at the <a href="http://launchpoint.marketo.com/">LaunchPoint marketplace</a>:
- <a href="http://launchpoint.marketo.com/applications/marketing-analytics">Analytics Tools</a>
- <a href="http://launchpoint.marketo.com/applications/customer-data">Data Appending</a>
- <a href="http://launchpoint.marketo.com/platforms/cms">Content Management Systems</a>

Some third party applications provide intuitive control panels and setup tools right within the platform (GoToWebinar). These are “native” integrations where the most work you need to do is setup the login and then use it in Marketo. Other extensions, however, require the use of the more complex API that must be programmed more directly.

<strong>Marketo’s Integration Options</strong>
- LaunchPoint Integration – usually a login or easy settings.
- API Integration – requires setup of API and programming:
(1) <a href="/documentation/rest/">REST API</a>
(2) <a href="/soap-api/">SOAP API</a>
(3) <a href="/webhooks/">Webhook Integration</a> – requires setup of special code, but fairly easy.
(4) <a href="/email-scripting/">Email Scripting</a> (Velocity)
- JavaScript and jQuery:
(1) <a href="/javascript-api/forms/">Forms 2.0</a>
(2) <a href="/javascript-api/lead-tracking/">Lead Tracking (Munchkin)</a>
(3) <a href="/javascript-api/social/">Social JS</a>
(4) <a href="/javascript-api/personalization/">RTP JS</a>

Here are a few use cases for using a developer to extend the capabilities of the Marketo platform.

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/11/Screen-Shot-2014-11-06-at-3.06.15-PM.png"><img class="size-full wp-image-2140 alignnone" src="https://marketohost.wpengine.com/wp-content/uploads/2014/11/Screen-Shot-2014-11-06-at-3.06.15-PM.png" alt="Marketo use cases where developer is needed" width="721" height="879" /></a>

Do you have any of these use cases? If so, it might be time to speak with a developer. <a href="http://launchpoint.marketo.com/services">Visit the services partner section on LaunchPoint</a>.<br/><br/>JHill - 2014-11-06<br/><br/><h2>Integrating Slack with Marketo</h2><br/><br/><a href="https://marketohost.wpengine.com/wp-content/uploads/2014/11/slacklogo.png"><img class="size-full wp-image-2194 alignnone" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2014/11/slacklogo.png" alt="slacklogo" width="200" height="200" /></a>

<a href="https://slack.com/">Slack is an enterprise collaboration platform</a>. If your team is on Slack, you can easily bring Marketo notifications into your workflow. This post will show you how to add a notification to your chat log when a specific lead activity happens in Marketo. Potential use cases include notifying your entire team about a form fill, a visit to a pricing page, or a lead that has not been contacted in 30 days.

The screenshot below shows how the Marketo notification will look like in Slack after following the steps in this help article.

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/11/slack00.png"><img class="size-large wp-image-2200 alignnone" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2014/11/slack00-1024x204.png" alt="slack00" width="1024" height="204" /></a>

<strong>Step One: Login to Slack. Click on Integrations in Slack</strong>

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/11/slack0.png"><img class="size-full wp-image-2198 alignnone" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2014/11/slack0.png" alt="slack0" width="593" height="419" /></a>

<strong>Step Two: Click Add button for Incoming Webhooks</strong>

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/11/slack1.png"><img class="size-full wp-image-2206 alignnone" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2014/11/slack1.png" alt="slack1" width="960" height="643" /></a>

<strong>Step Three: Choose the Channel for the Marketo Notification. Then Click Add Incoming Webhook Integration.
</strong>
<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/11/slack2.png"><img class="size-full wp-image-2210 alignnone" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2014/11/slack2.png" alt="slack2" width="984" height="607" /></a>

<strong>Step Four: Copy and Paste Webhook URL (which is needed for step eight)</strong>

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/11/slack3.png"><img class="size-full wp-image-2214 alignnone" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2014/11/slack3.png" alt="slack3" width="960" height="121" /></a>

<strong>Step Five: Choose a Name for the Notification</strong>

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/11/slack4.png"><img class="size-full wp-image-2216 alignnone" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2014/11/slack4.png" alt="slack4" width="962" height="145" /></a>

<strong>Step Six: Login to Marketo. Go to Admin. Click on Webhooks.</strong>

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/11/slack5.png"><img class="size-full wp-image-2220 alignnone" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2014/11/slack5.png" alt="slack5" width="252" height="690" /></a>

<strong>Step Seven: Click New Webhook</strong>
<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/11/slack6.png"><img class="size-full wp-image-2222 alignnone" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2014/11/slack6.png" alt="slack6" width="173" height="136" /></a>

<strong>Step Eight: Enter a Name for the Webhook. Enter the Webhook URL from Step Four. Enter Post as Request Type. Enter a Payload Template.</strong>

Here is the payload template from the screenshot. It uses lead-level first name, company, and email address tokens.
<pre>payload={"text": "DEVELOPER SITE ALERT: {{lead.First Name:default=edit me}} {{lead.Company=edit me}}, {{lead.Email Address:default=no email address}}" }
</pre>
<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/11/slack7.png"><img class="size-full wp-image-2224 alignnone" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2014/11/slack7.png" alt="slack7" width="521" height="598" /></a>

<strong>Step Nine: Set Up Trigger Campaign in Marketo. Flow Step is to Call Webhook to Slack. Smart List is Web Page Visit.</strong>

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/11/slack8.png"><img class="size-full wp-image-2228 alignnone" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2014/11/slack8.png" alt="slack8" width="865" height="269" /></a>

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/11/slack-marketo-flowaction.png"><img class="size-large wp-image-2230 alignnone" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2014/11/slack-marketo-flowaction-1024x228.png" alt="slack-marketo-flowaction" width="1024" height="228" /></a>

<strong>Step Ten: Verify It Works.</strong>

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/11/Screen-Shot-2014-11-10-at-5.36.39-PM.png"><img class="size-large wp-image-2234 alignnone" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2014/11/Screen-Shot-2014-11-10-at-5.36.39-PM-1024x116.png" alt="Screen Shot 2014-11-10 at 5.36.39 PM" width="1024" height="116" /></a>

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/11/slack00.png"><img class="size-large wp-image-2200 alignnone" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2014/11/slack00-1024x204.png" alt="slack00" width="1024" height="204" /></a>

Please see the <a href="/webhooks/">developer documentation</a> for more information about webhooks in Marketo.<br/><br/>MManzur - 2014-11-10<br/><br/><h2>Integrating Litmus with Marketo</h2><br/><br/><a href="https://litmus.com/">Litmus is a service</a> for testing emails across browsers and email clients. Litmus also provides analytics around emails including clicks, opens, deletions. This post will show you how to integrate Marketo with Litmus.

<strong>Step One: When setting up your email program in Marketo, click “My Tokens” on the program dashboard</strong>

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/11/Litmus-Marketo-1.png"><img class="size-full wp-image-2336 alignnone" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2014/11/Litmus-Marketo-1.png" alt="Litmus-Marketo-1" width="200" height="149" /></a>

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/11/Litmus-Marketo-2.png"><img class="size-full wp-image-2338 alignnone" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2014/11/Litmus-Marketo-2.png" alt="Litmus-Marketo-2" width="519" height="418" /></a>

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/11/Litmus-Marketo-3.png"><img class="size-large wp-image-2340 alignnone" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2014/11/Litmus-Marketo-3-1024x501.png" alt="Litmus-Marketo-3" width="1024" height="501" /></a>

<strong>Step Two: Drag “Email Script” token to the middle panel to add it.</strong>

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/11/Litmus-Marketo-4.png"><img class="size-large wp-image-2342 alignnone" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2014/11/Litmus-Marketo-4-1024x630.png" alt="Litmus-Marketo-4" width="1024" height="630" /></a>

<strong>Step Three: Name the token and click “Click to edit”</strong>

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/11/Litmus-Marketo-5.png"><img class="size-large wp-image-2344 alignnone" src="https://marketohost.wpengine.com/wp-content/uploads/2014/11/Litmus-Marketo-5-1024x223.png" alt="Litmus-Marketo-5" width="1024" height="223" /></a>

<strong>Step Four: On the right, underneath “Standard Objects,” expand the “Lead” category. Find the “Email Address” field and check the box. In the empty script space on the left of this same page, paste in the tracking code provided by Litmus. In the Litmus code, replace every instance of {{lead.Email Address}} with ${lead.Email}. Click Save to close the lightbox window and click “Save” again on the tokens page.</strong>

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/11/Litmus-Marketo-6.png"><img class="size-full wp-image-2346 alignnone" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2014/11/Litmus-Marketo-6.png" alt="Litmus-Marketo-6" width="898" height="259" /></a>

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/11/Litmus-Marketo-7.png"><img class="size-full wp-image-2356 alignnone" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2014/11/Litmus-Marketo-7.png" alt="Litmus-Marketo-7" width="902" height="577" /></a>

<strong>Step Five: Make note of the name of the token {{my.LitmusToken}}. Open the email you want to track. At the very bottom of your email, place your new script token. You can also add default information to match the Litmus version {{my.LitmusToken:default=editme}}.</strong>

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/11/Litmus-Marketo-8.png"><img class="size-full wp-image-2358 alignnone" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2014/11/Litmus-Marketo-8.png" alt="Litmus-Marketo-8" width="442" height="235" /></a>

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/11/Litmus-Marketo-9.png"><img class="size-large wp-image-2360 alignnone" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2014/11/Litmus-Marketo-9-1024x336.png" alt="Litmus-Marketo-9" width="1024" height="336" /></a>

When the email is sent, the script will be placed into the email by Marketo.<br/><br/>MManzur - 2014-11-18<br/><br/><h2>Specify an image when a Marketo landing page is shared on Facebook</h2><br/><br/>Let's say you want an image to show up automatically when you share a Marketo landing page on Facebook. Maybe you also want this image to not be on the Marketo landing page itself, but just on the Facebook share.

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/11/fbimage.png"><img class="size-full wp-image-2284 alignnone" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2014/11/fbimage.png" alt="fbimage" width="451" height="314" /></a>

You can this by adding an open-graph meta tag to your Marketo landing page. The steps to do this are below.

<strong>Step One: Select your landing page. Then click Edit Draft.</strong>

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/11/1z.png"><img class="size-full wp-image-2290 alignnone" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2014/11/1z.png" alt="1z" width="637" height="308" /></a>

<strong>Step Two: Click Edit Page Meta Tags.</strong>

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/11/2z.png"><img class="size-large wp-image-2292 alignnone" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2014/11/2z.png" alt="2z" width="316" height="237" /></a>

<strong>Step Three: Add open-graph meta to Facebook OG Tags section. Then click Save.</strong>

Here is the format: &lt;meta property="og:image" content="http://example.com/example.jpg"/&gt;

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/11/Screen-Shot-2014-11-17-at-1.23.35-PM.png"><img class="size-large wp-image-2294 alignnone" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2014/11/Screen-Shot-2014-11-17-at-1.23.35-PM.png" alt="Screen Shot 2014-11-17 at 1.23.35 PM" width="701" height="600" /></a>

<a href="https://developers.facebook.com/docs/plugins/checklist/">Please see Facebook's developer documentation</a> about open-graph meta tags for more information.<br/><br/>MManzur - 2014-11-17<br/><br/><h2>Redirect Page based on Referrer</h2><br/><br/>Let's say you would like to prevent direct traffic to a Marketo landing page. Imagine this page has downloadable content like a PDF that you would like a user to first fill out a form before receiving. You could solve this by checking if the user came from a certain page. In this case, it would be the page where the user has to fill out a form. If the user is not coming from that page, you can then redirect the user to the form fill out page.

To accomplish this, you will have to check if the referrer page to the landing page with content is the form fillout page.

<strong>Step One: Replace both instances of "http://example.com/PageWithForm" in the snippet below with a link to the page you want to the user to come from. This could be the form fill out page.</strong>
<pre class="lang:default decode:true ">&lt;script&gt;
window.onload = function() {
  if (document.referrer !== "http://example.com/PageWithForm") {
    document.location.href = "http://example.com/PageWithForm";
  };
 };
&lt;/script&gt;
</pre>
<strong>Step Two: Include the customized JavaScript snippet before the closing tag on your Marketo landing page with content.
</strong>

If the user is not sent to the landing page with content from the form fill out page, the user will now be redirected to the form fill out page.<br/><br/>MManzur - 2014-11-18<br/><br/><h2>Integrating Trello with Marketo</h2><br/><br/><a href="https://marketohost.wpengine.com/wp-content/uploads/2014/11/trello-logo-blue.png"><img class="size-large wp-image-3153 alignnone" src="https://marketohost.wpengine.com/wp-content/uploads/2014/11/trello-logo-blue-1024x314.png" alt="trello-logo-blue" width="512" height="157" /></a>

Trello is a <a href="https://trello.com/">popular web-based project management application</a>. If your team uses Trello, you can easily bring Marketo notifications into your workflow. This post will show you how to add a card with a Marketo notification to your Trello board.

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/11/Trello-Marketo-19.png"><img class="size-full wp-image-2462 alignnone" src="https://marketohost.wpengine.com/wp-content/uploads/2014/11/Trello-Marketo-19.png" alt="Trello-Marketo-19" width="619" height="251" /></a>

This card will be added when a specific lead activity happens in Marketo. Potential use cases include notifying your entire team about a form fill, a visit to a pricing page, or a lead that has not been contacted in 30 days.

<strong>Step One: Login into Trello. Navigate to the Trello board that will add Marketo notifications in. Click Add a List, and then name it.</strong>

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/11/Trello-Marketo-11.png"><img class="size-full wp-image-2394 alignnone" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2014/11/Trello-Marketo-11.png" alt="Trello-Marketo-1" width="871" height="393" /></a>

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/11/Trello-Marketo-2.png"><img class="size-full wp-image-2388 alignnone" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2014/11/Trello-Marketo-2.png" alt="Trello-Marketo-2" width="851" height="338" /></a>

<strong>Step Two: Click Show Sidebar. Click Email-to-board Settings. Note the email in "Your email address for this board" box. This email will be used in Step Six. Choose which list to add the Marketo notification.</strong>

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/11/Trello-Marketo-3.png"><img class="size-full wp-image-2408 alignnone" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2014/11/Trello-Marketo-3.png" alt="Trello-Marketo-3" width="287" height="396" /></a>

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/11/Trello-Marketo-4.png"><img class="size-full wp-image-2410 alignnone" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2014/11/Trello-Marketo-4.png" alt="Trello-Marketo-4" width="314" height="381" /></a>

<strong>Step Three: Login to Marketo. Click new Smart Campaign. Enter a name, and then click Save.</strong>

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/11/Trello-Market-5.png"><img class="size-full wp-image-2420 alignnone" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2014/11/Trello-Market-5.png" alt="Trello-Market-5" width="269" height="228" /></a>

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/11/Trello-Market-6.png"><img class="size-large wp-image-2422 alignnone" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2014/11/Trello-Market-6.png" alt="Trello-Market-6" width="605" height="409" /></a>

<strong>Step Four: Navigate to Smart List. Choose a trigger for this smart campaign. In this example, we will use Form Fill trigger. Drag Fills out Form trigger to Middle Panel. Select the Form that you would like to trigger this notification.</strong>

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/11/Trello-Marketo-7.png"><img class="size-large wp-image-2424 alignnone" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2014/11/Trello-Marketo-7-1024x577.png" alt="Trello-Marketo-7" width="1024" height="577" /></a>

<strong>Step Five: Create an email. Click New. Click Local Asset. Click New Email. Name the email. Then click Create.</strong>

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/11/Trello-Marketo-8.png"><img class="size-full wp-image-2428 alignnone" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2014/11/Trello-Marketo-8.png" alt="Trello-Marketo-8" width="200" height="202" /></a>

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/11/Trello-Marketo-9.png"><img class="size-large wp-image-2430 alignnone" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2014/11/Trello-Marketo-9.png" alt="Trello-Marketo-9" width="754" height="395" /></a>

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/11/Trello-Marketo-10.png"><img class="size-large wp-image-2432 alignnone" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2014/11/Trello-Marketo-10.png" alt="Trello-Marketo-10" width="723" height="599" /></a>

<strong>Step Six: Click Edit Draft for the email you created in Step Five. Drag the relevant tokens you would like to show in your Trello card.</strong>

<strong>The subject line of the Marketo email will appear in the title of the Trello card, and the body of the Marketo email will appear in the description of the Trello card. For example, you can use "LEAD ALERT: {{lead.First Name:default=edit me}} {{lead.Last Name:default=edit me}}" if you want the lead's first and last name to be in the title of the Trello card.</strong>

<strong>Then approve the email.</strong>

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/11/Trello-Marketo-111.png"><img class="size-large wp-image-2434 alignnone" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2014/11/Trello-Marketo-111.png" alt="Trello-Marketo-11" width="443" height="237" /></a>

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/11/Trello-Marketo-12.png"><img class="size-large wp-image-2438 alignnone" src="https://marketohost.wpengine.com/wp-content/uploads/2014/11/Trello-Marketo-12-1024x328.png" alt="Trello-Marketo-12" width="1024" height="328" /></a>

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/11/Trello-Marketo-13.png"><img class="size-large wp-image-2440 alignnone" src="https://marketohost.wpengine.com/wp-content/uploads/2014/11/Trello-Marketo-13.png" alt="Trello-Marketo-13" width="253" height="151" /></a>

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/11/Trello-Marketo-14.png"><img class="size-large wp-image-2444 alignnone" src="https://marketohost.wpengine.com/wp-content/uploads/2014/11/Trello-Marketo-14.png" alt="Trello-Marketo-14" width="450" height="260" /></a>

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/11/Trello-Marketo-12.png"><img class="size-large wp-image-2438 alignnone" src="https://marketohost.wpengine.com/wp-content/uploads/2014/11/Trello-Marketo-12-1024x328.png" alt="Trello-Marketo-12" width="1024" height="328" /></a>

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/11/Trello-Marketo-approve.png"><img class="size-full wp-image-2470 alignnone" src="https://marketohost.wpengine.com/wp-content/uploads/2014/11/Trello-Marketo-approve.png" alt="Trello-Marketo-approve" width="376" height="393" /></a>

<strong>Step Seven: Navigate to Smart Campaign. Click Flow. Drag Send Alert to the Middle Panel. Select Email that was just created. Select "Send to" as None. Select "To Other Emails" as the Trello email from Step Two.</strong>

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/11/Trello-Marketo-15.png"><img class="size-large wp-image-2448 alignnone" src="https://marketohost.wpengine.com/wp-content/uploads/2014/11/Trello-Marketo-15-1024x393.png" alt="Trello-Marketo-15" width="1024" height="393" /></a>

<strong>Step Eight: Click Schedule in the top menu. Click Activate. Click Confirm.</strong>

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/11/Trello-Marketo-16.png"><img class="size-full wp-image-2450 alignnone" src="https://marketohost.wpengine.com/wp-content/uploads/2014/11/Trello-Marketo-16.png" alt="Trello-Marketo-16" width="554" height="570" /></a>

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/11/Trello-Marketo-17.png"><img class="size-large wp-image-2452 alignnone" src="https://marketohost.wpengine.com/wp-content/uploads/2014/11/Trello-Marketo-17.png" alt="Trello-Marketo-17" width="503" height="338" /></a>

<strong>Step Nine: Test the integration. A card with the lead's first and last name in the title will show up in the Trello board.</strong>

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/11/Trello-Marketo-181.png"><img class="size-large wp-image-2456 alignnone" src="https://marketohost.wpengine.com/wp-content/uploads/2014/11/Trello-Marketo-181-1024x285.png" alt="Trello-Marketo-18" width="1024" height="285" /></a>

Please see <a href="http://help.trello.com/customer/portal/articles/1216141-creating-cards-by-email#formattingTips">Trello's documentation</a> for more information.<br/><br/>MManzur - 2014-11-18<br/><br/><h2>Find Leads by Custom Field Value</h2><br/><br/>Let's say you want to get leads from the Marketo API who match certain activity or inactivity criteria. For example, maybe you want to find leads whose score has not changed in the past 30 days. By following the steps in this post, you will be able to get this list of leads.

To do this, we will create a smart campaign in Marketo that identifies leads whose score has not changed in the past 30 days, and then store a value on these leads to identify them. We will then query the API with this value.

<strong>Step One: Create a new custom field called customLeadStatus</strong>

Login to Marketo, and go to the Admin panel. Click on Field Management.

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/11/Blog1.png"><img class="size-full wp-image-2538 alignnone" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2014/11/Blog1.png" alt="Blog1" width="244" height="443" /></a>

Click New Custom Field.

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/11/Blog2.png"><img class="size-large wp-image-2540 alignnone" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2014/11/Blog2.png" alt="Blog2" width="208" height="287" /></a>

Name the field. Then click Create.

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/11/Blog3.png"><img class="size-large wp-image-2542 alignnone" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2014/11/Blog3.png" alt="Blog3" width="499" height="332" /></a>

<strong>Step Two: Create a smart campaign with a smart list that looks for leads that have not been updated in 30 days.</strong>

Click New Smart Campaign.

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/11/Blog4.png"><img class="size-large wp-image-2558 alignnone" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2014/11/Blog4.png" alt="Blog4" width="204" height="202" /></a>

Name the new smart campaign.

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/11/Blog5.png"><img class="size-full wp-image-2554 alignnone" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2014/11/Blog5.png" alt="Blog5" width="602" height="407" /></a>

Drag Not Score Was Changed from right panel to middle panel.

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/11/Blog6.png"><img class="size-large wp-image-2556 alignnone" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2014/11/Blog6-1024x460.png" alt="Blog6" width="1024" height="460" /></a>

<strong>Step Three: Add a flow step to the smart campaign from Step 3 to update customLeadStatus field with a new value.</strong>

Drag Change Data Value from right panel to middle panel.

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/11/Blog7.png"><img class="size-large wp-image-2566 alignnone" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2014/11/Blog7-1024x286.png" alt="Blog7" width="1024" height="286" /></a>

<strong>Step Four: Update Smart Campaign to allow leads to run through multiple times.</strong>

Click Schedule. Then click Edit.

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/11/Blog8.png"><img class="size-full wp-image-2572 alignnone" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2014/11/Blog8.png" alt="Blog8" width="579" height="570" /></a>

Select every time. Then click Save.

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/11/Blog9.png"><img class="size-full wp-image-2574 alignnone" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2014/11/Blog9.png" alt="Blog9" width="404" height="418" /></a>

The campaign will now start running.

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/11/Blog10.png"><img class="size-full wp-image-2576 alignnone" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2014/11/Blog10.png" alt="Blog10" width="631" height="126" /></a>

<strong>Step Five: Query the <a href="/documentation/rest/get-multiple-leads-by-filter-type/">Get Multiple Leads by Filter Type REST API</a>. Providing the parameters filterType=customLeadStatus &amp; filterValue=needsEnrichment.</strong>

This is an example request that will return this data.

<pre>https://AAA-BBB-CCC.mktorest.com/rest/v1/leads.json?access_token=&lt;yourAccessToken&gt;&amp;filterType=customLeadStatus&amp;filterValues=needsEnrichment
</pre>
A successful API call will return JSON data with leads whose customLeadStatus field matches the value of needsEnrichment.

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/11/Blog11.png"><img class="size-full wp-image-2578 alignnone" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2014/11/Blog11.png" alt="Blog11" width="419" height="159" /></a>

Please review the the <a href="http://developers.marketo.com/documentation/rest/get-multiple-leads-by-filter-type/">Get Multiple Leads by Filter Type REST API</a> for more information.<br/><br/>MManzur - 2014-11-22<br/><br/><h2>Opportunity Sync via SOAP API</h2><br/><br/>This post describes how to insert Opportunities into Marketo via the SOAP API and associate them to companies and leads. It starts with an explanation of how this process works and then provides code samples for each of the scenarios.

<strong>Table Structure Diagram</strong>

First of all, the diagram below describes the table structure. The Id is auto-generated on creation of a record (sequential number). The field in bold are required: only Opportunity Person Role has required fields. The fields in parenthesis are optional and so are the connections with a dotted line.

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/11/opp1.png"><img class="size-full wp-image-2619 alignnone" src="https://marketohost.wpengine.com/wp-content/uploads/2014/11/opp1.png" alt="opp1" width="900" height="403" /></a>

<strong>Basic Opportunity Insertion</strong>

You first insert the Opportunity, and then the Opportunity Person Role, which links the Opportunity to the Lead(s). For this example, well use the Lead Id and the Opportunity Id to specify the Opportunity Person Role. You get the Opportunity Id in the SOAP Response when creating the Opportunity. The Lead Id is visible on every Lead in the Marketo Lead database.

<strong>Company Link</strong>

In most cases, you want to link an Opportunity to a Company, in addition to an individual. In Marketo, you can’t access the Company records via the SOAP API, only the Lead records (the Lead records contain the company fields). It is still possible to link Opportunities to a Company by adding a unique Company identifier to each Lead, and using that ID in your Opportunity.

Step 1 is to create a ‘Company Id’ field on the lead record and populate it with a unique identifier, usually from a back-end system. Step 2 is to create a ‘Company Id’

field on the Opportunity: you will have to ask Marketo Support or Consulting to create such a field for you. Then populate this field when creating Opportunities, which connects the Opportunity to the Company.

This is especially important if you use Marketo Revenue Cycle Analytics and you want to use the Opportunity Influence Analyzer, which depends on Company information.

<strong>Using External Identifiers</strong>

In many cases, you may have your own unique identifiers when integrating with a back-end system. It is possible to use these unique identifiers in Marketo through Foreign keys.

For Leads, you would typically use the Foreign System Person Id (FSPID), which is used instead of the Marketo Id or email address as unique identifier. The FSPID is a hidden system field, which is not visible inside Marketo. If you’re not already doing so, it is necessary for Opportunity sync to also save the FSPID in a custom field, for example “Foreign Id” (you can name the field anything). You can create this field yourself as a Marketo administrator.

For Opportunities, you have Marketo Support create another custom field on Opportunity, for example called “Foreign Id” (you can name it anything). Then populate this field when inserting Opportunities.

Finally, when you create the Opportunity Person Role, you use both foreign keys to specify the link between Leads and Opportunities, instead of using the Marketo IDs. You can also use the foreign keys to update Leads of Opportunities. At this time, it’s not possible to add a foreign key to the Opportunity Person Role records, so you’ll have to use the auto-generated Marketo Id for this (which you get in the SOAP response after creating the Opportunity Person Role).

<strong>Code Example</strong>

Steps:
1. Insert/update Lead with Foreign Key &amp; Company Id
2. Insert Opportunity with Foreign Key
3. Insert Opportunity Person Role with Foreign Keys

1. SOAP Request – Updating existing Lead with Foreign Key &amp; Company Id

This updates an existing Lead (Marketo Id “6”) with the Foreign Key “12346” and the Account/Company Id “C123”. We are also saving the Foreign Key in a custom field, because we need that for the Opportunity Person Role.

Using a Foreign Key is optional: you can also use the Marketo Id to link this Lead to the Opportunity. Using the Company Id is also optional, but it’s required if you want to use the Opportunity Influence Analyzer in RCA.

Request:
<pre class="lang:default decode:true">&lt;soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:mkt="http://www.marketo.com/mktows/"&gt;
   &lt;soapenv:Header&gt;
      &lt;mkt:AuthenticationHeader&gt;
         &lt;mktowsUserId&gt;***&lt;/mktowsUserId&gt;
         &lt;requestSignature&gt;***&lt;/requestSignature&gt;
         &lt;requestTimestamp&gt;2014-11-20T15:18:30-07:00&lt;/requestTimestamp&gt;
      &lt;/mkt:AuthenticationHeader&gt;
   &lt;/soapenv:Header&gt;
   &lt;soapenv:Body&gt;
      &lt;mkt:paramsSyncLead&gt;
         &lt;leadRecord&gt;
            &lt;Id&gt;6&lt;/Id&gt;
            &lt;ForeignSysPersonId&gt;12346&lt;/ForeignSysPersonId&gt;
            &lt;leadAttributeList&gt;
               &lt;attribute&gt;
                  &lt;attrName&gt;FSPID&lt;/attrName&gt;
                  &lt;attrValue&gt;12346&lt;/attrValue&gt;
               &lt;/attribute&gt;
               &lt;attribute&gt;
                  &lt;attrName&gt;cAccountFSID&lt;/attrName&gt;
                  &lt;attrValue&gt;C123&lt;/attrValue&gt;
               &lt;/attribute&gt;
            &lt;/leadAttributeList&gt;
         &lt;/leadRecord&gt;
         &lt;returnLead&gt;false&lt;/returnLead&gt;
      &lt;/mkt:paramsSyncLead&gt;
   &lt;/soapenv:Body&gt;
&lt;/soapenv:Envelope&gt;
</pre>
Response:
<pre class="lang:default decode:true">&lt;SOAP-ENV:Envelope xmlns:SOAP-ENV="http://schemas.xmlsoap.org/soap/envelope/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:ns1="http://www.marketo.com/mktows/"&gt;
   &lt;SOAP-ENV:Body&gt;
      &lt;ns1:successSyncLead&gt;
         &lt;result&gt;
            &lt;leadId&gt;6&lt;/leadId&gt;
            &lt;syncStatus&gt;
               &lt;leadId&gt;6&lt;/leadId&gt;
               &lt;status&gt;UPDATED&lt;/status&gt;
               &lt;error xsi:nil="true"/&gt;
            &lt;/syncStatus&gt;
            &lt;leadRecord xsi:nil="true"/&gt;
         &lt;/result&gt;
      &lt;/ns1:successSyncLead&gt;
   &lt;/SOAP-ENV:Body&gt;
&lt;/SOAP-ENV:Envelope&gt;
</pre>
2. SOAP Request – Opportunity Creation

In this case, 2 custom fields have been created on the Opportunity table:
- opportunityId → holds the Opportunity unique ID
- cAccountFSID → holds the company reference

Instead of specifying your own Opportunity ID, you can also use the Marketo-generated Opportunity ID. In that case you leave out the External Key node. The Company association is also optional, but required if you want to use the Opportunity Influence Analyzer in RCA.

Request:
<pre class="lang:default decode:true">&lt;soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:mkt="http://www.marketo.com/mktows/"&gt;
   &lt;soapenv:Header&gt;
      &lt;mkt:AuthenticationHeader&gt;
         &lt;mktowsUserId&gt;***&lt;/mktowsUserId&gt;
         &lt;requestSignature&gt;***&lt;/requestSignature&gt;
         &lt;requestTimestamp&gt;2014-11-20T15:03:28-07:00&lt;/requestTimestamp&gt;
      &lt;/mkt:AuthenticationHeader&gt;
   &lt;/soapenv:Header&gt;
   &lt;soapenv:Body&gt;
      &lt;mkt:paramsSyncMObjects&gt;
         &lt;mObjectList&gt;
            &lt;!--Zero or more repetitions:--&gt;
            &lt;mObject&gt;
               &lt;type&gt;Opportunity&lt;/type&gt;
               &lt;externalKey&gt;
                  &lt;name&gt;opportunityId&lt;/name&gt;
                  &lt;value&gt;Opportunity_4&lt;/value&gt;
               &lt;/externalKey&gt;
               &lt;attribList&gt;
                  &lt;attrib&gt;
                     &lt;name&gt;opportunityId&lt;/name&gt;
                     &lt;value&gt;Opportunity_4&lt;/value&gt;
                  &lt;/attrib&gt;
                  &lt;attrib&gt;
                     &lt;name&gt;Name&lt;/name&gt;
                     &lt;value&gt;Opportunity 4 for ACME&lt;/value&gt;
                  &lt;/attrib&gt;
                  &lt;attrib&gt;
                     &lt;name&gt;IsClosed&lt;/name&gt;
                     &lt;value&gt;1&lt;/value&gt;
                  &lt;/attrib&gt;
                  &lt;attrib&gt;
                     &lt;name&gt;IsWon&lt;/name&gt;
                     &lt;value&gt;1&lt;/value&gt;
                  &lt;/attrib&gt;
                  &lt;attrib&gt;
                     &lt;name&gt;Amount&lt;/name&gt;
                     &lt;value&gt;501.00&lt;/value&gt;
                  &lt;/attrib&gt;
                  &lt;attrib&gt;
                     &lt;name&gt;CloseDate&lt;/name&gt;
                     &lt;value&gt;2014-10-24&lt;/value&gt;
                  &lt;/attrib&gt;
                  &lt;attrib&gt;
                     &lt;name&gt;ExpectedRevenue&lt;/name&gt;
                     &lt;value&gt;501&lt;/value&gt;
                  &lt;/attrib&gt;
                  &lt;attrib&gt;
                     &lt;name&gt;Probability&lt;/name&gt;
                     &lt;value&gt;100&lt;/value&gt;
                  &lt;/attrib&gt;
               &lt;/attribList&gt;
               &lt;associationList&gt;
                  &lt;mObjAssociation&gt;
                     &lt;mObjType&gt;Company&lt;/mObjType&gt;
                     &lt;externalKey&gt;
                        &lt;name&gt;cAccountFSID&lt;/name&gt;
                        &lt;value&gt;C123&lt;/value&gt;
                     &lt;/externalKey&gt;
                  &lt;/mObjAssociation&gt;
               &lt;/associationList&gt;
            &lt;/mObject&gt;
         &lt;/mObjectList&gt;
         &lt;operation&gt;UPSERT&lt;/operation&gt;
      &lt;/mkt:paramsSyncMObjects&gt;
   &lt;/soapenv:Body&gt;
&lt;/soapenv:Envelope&gt;
</pre>
Response:
<pre class="lang:default decode:true prettyprint lang-xml">&lt;SOAP-ENV:Envelope xmlns:SOAP-ENV="http://schemas.xmlsoap.org/soap/envelope/" xmlns:ns1="http://www.marketo.com/mktows/"&gt;
   &lt;SOAP-ENV:Body&gt;
      &lt;ns1:successSyncMObjects&gt;
         &lt;result&gt;
            &lt;mObjStatusList&gt;
               &lt;mObjStatus&gt;
                  &lt;id&gt;40&lt;/id&gt;
                  &lt;externalKey&gt;
                     &lt;name&gt;opportunityId&lt;/name&gt;
                     &lt;value&gt;Opportunity_4&lt;/value&gt;
                  &lt;/externalKey&gt;
                  &lt;status&gt;CREATED&lt;/status&gt;
               &lt;/mObjStatus&gt;
            &lt;/mObjStatusList&gt;
         &lt;/result&gt;
      &lt;/ns1:successSyncMObjects&gt;
   &lt;/SOAP-ENV:Body&gt;
&lt;/SOAP-ENV:Envelope&gt;
</pre>
3. SOAP Request – Opportunity Person Role

This request will link the Lead to the Opportunity. You can specify multiple links in a single SOAP Request (this example links the Opportunity to only 1 Lead). This uses the foreign keys to specify the link, but in the comments it also shows how to use the actual IDs (in this case: 6 for the Lead Id and 40 for the Opportunity Id).

This “IsPrimary” and “Role” fields are optional.

Request:
<pre class="lang:default decode:true">&lt;soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:mkt="http://www.marketo.com/mktows/"&gt;
   &lt;soapenv:Header&gt;
      &lt;mkt:AuthenticationHeader&gt;
         &lt;mktowsUserId&gt;***&lt;/mktowsUserId&gt;
         &lt;requestSignature&gt;***&lt;/requestSignature&gt;
         &lt;requestTimestamp&gt;2014-11-20T15:18:30-07:00&lt;/requestTimestamp&gt;
      &lt;/mkt:AuthenticationHeader&gt;
   &lt;/soapenv:Header&gt;
   &lt;soapenv:Body&gt;
      &lt;mkt:paramsSyncMObjects&gt;
         &lt;mObjectList&gt;
            &lt;!--Zero or more repetitions:--&gt;
            &lt;mObject&gt;
               &lt;type&gt;OpportunityPersonRole&lt;/type&gt;
               &lt;attribList&gt;
                  &lt;attrib&gt;
                     &lt;name&gt;IsPrimary&lt;/name&gt;
                     &lt;value&gt;1&lt;/value&gt;
                  &lt;/attrib&gt;
                  &lt;attrib&gt;
                     &lt;name&gt;Role&lt;/name&gt;
                     &lt;value&gt;Marketing Manager&lt;/value&gt;
                  &lt;/attrib&gt;
               &lt;/attribList&gt;
               &lt;associationList&gt;
                  &lt;mObjAssociation&gt;
                     &lt;mObjType&gt;Lead&lt;/mObjType&gt;
                     &lt;!--id&gt;6&lt;/id--&gt;
                     &lt;externalKey&gt;
                     	&lt;name&gt;FSPID&lt;/name&gt;
                     	&lt;value&gt;12346&lt;/value&gt;
                     &lt;/externalKey&gt;
                  &lt;/mObjAssociation&gt;
                  &lt;mObjAssociation&gt;
                     &lt;mObjType&gt;Opportunity&lt;/mObjType&gt;
                     &lt;!--id&gt;40&lt;/id--&gt;
                     &lt;externalKey&gt;
                     	&lt;name&gt;opportunityId&lt;/name&gt;
                     	&lt;value&gt;Opportunity_4&lt;/value&gt;
                  	 &lt;/externalKey&gt;
                  &lt;/mObjAssociation&gt;
               &lt;/associationList&gt;
            &lt;/mObject&gt;
         &lt;/mObjectList&gt;
         &lt;operation&gt;UPSERT&lt;/operation&gt;
      &lt;/mkt:paramsSyncMObjects&gt;
   &lt;/soapenv:Body&gt;
&lt;/soapenv:Envelope&gt;
</pre>
Response:
<pre class="lang:default decode:true prettyprint lang-xml">&lt;SOAP-ENV:Envelope xmlns:SOAP-ENV="http://schemas.xmlsoap.org/soap/envelope/" xmlns:ns1="http://www.marketo.com/mktows/"&gt;
   &lt;SOAP-ENV:Body&gt;
      &lt;ns1:successSyncMObjects&gt;
         &lt;result&gt;
            &lt;mObjStatusList&gt;
               &lt;mObjStatus&gt;
                  &lt;id&gt;11&lt;/id&gt;
                  &lt;status&gt;CREATED&lt;/status&gt;
               &lt;/mObjStatus&gt;
            &lt;/mObjStatusList&gt;
         &lt;/result&gt;
      &lt;/ns1:successSyncMObjects&gt;
   &lt;/SOAP-ENV:Body&gt;
&lt;/SOAP-ENV:Envelope&gt;
</pre>
<strong>Alternative Approach (Do Step 2 and 3 in One Call)</strong>

While you can first insert the opportunity, then the Opportunity Person Role, it’s also possible to do this in one SOAP Call. However, you need to use the Foreign Key for Opportunity (you can’t use the auto-generated Opportunity ID in Opportunity Person Role, because the Opportunity hasn’t been generated yet). Of course, you can also link multiple Leads to this Opportunity in this same API Call (this example links the Opportunity to only 1 Lead).

Request:
<pre class="lang:default decode:true">&lt;soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:mkt="http://www.marketo.com/mktows/"&gt;
   &lt;soapenv:Header&gt;
      &lt;mkt:AuthenticationHeader&gt;
         &lt;mktowsUserId&gt;***&lt;/mktowsUserId&gt;
         &lt;requestSignature&gt;***&lt;/requestSignature&gt;
         &lt;requestTimestamp&gt;2014-11-20T15:44:08-07:00&lt;/requestTimestamp&gt;
      &lt;/mkt:AuthenticationHeader&gt;
   &lt;/soapenv:Header&gt;
   &lt;soapenv:Body&gt;
      &lt;mkt:paramsSyncMObjects&gt;
         &lt;mObjectList&gt;
            &lt;!--Zero or more repetitions:--&gt;
            &lt;mObject&gt;
               &lt;type&gt;Opportunity&lt;/type&gt;
               &lt;externalKey&gt;
                  &lt;name&gt;opportunityId&lt;/name&gt;
                  &lt;value&gt;Opportunity_5&lt;/value&gt;
               &lt;/externalKey&gt;
               &lt;attribList&gt;
                  &lt;attrib&gt;
                     &lt;name&gt;opportunityId&lt;/name&gt;
                     &lt;value&gt;Opportunity_5&lt;/value&gt;
                  &lt;/attrib&gt;
                  &lt;attrib&gt;
                     &lt;name&gt;Name&lt;/name&gt;
                     &lt;value&gt;Opportunity 5 for ACME&lt;/value&gt;
                  &lt;/attrib&gt;
                  &lt;attrib&gt;
                     &lt;name&gt;IsClosed&lt;/name&gt;
                     &lt;value&gt;1&lt;/value&gt;
                  &lt;/attrib&gt;
                  &lt;attrib&gt;
                     &lt;name&gt;IsWon&lt;/name&gt;
                     &lt;value&gt;1&lt;/value&gt;
                  &lt;/attrib&gt;
                  &lt;attrib&gt;
                     &lt;name&gt;Amount&lt;/name&gt;
                     &lt;value&gt;1500&lt;/value&gt;
                  &lt;/attrib&gt;
                  &lt;attrib&gt;
                     &lt;name&gt;CloseDate&lt;/name&gt;
                     &lt;value&gt;2014-10-24&lt;/value&gt;
                  &lt;/attrib&gt;
                  &lt;attrib&gt;
                     &lt;name&gt;ExpectedRevenue&lt;/name&gt;
                     &lt;value&gt;1500&lt;/value&gt;
                  &lt;/attrib&gt;
                  &lt;attrib&gt;
                     &lt;name&gt;Probability&lt;/name&gt;
                     &lt;value&gt;100&lt;/value&gt;
                  &lt;/attrib&gt;
               &lt;/attribList&gt;
               &lt;associationList&gt;
                  &lt;mObjAssociation&gt;
                     &lt;mObjType&gt;Company&lt;/mObjType&gt;
                     &lt;externalKey&gt;
                        &lt;name&gt;cAccountFSID&lt;/name&gt;
                        &lt;value&gt;C123&lt;/value&gt;
                     &lt;/externalKey&gt;
                  &lt;/mObjAssociation&gt;
               &lt;/associationList&gt;
            &lt;/mObject&gt;
             &lt;mObject&gt;
               &lt;type&gt;OpportunityPersonRole&lt;/type&gt;
               &lt;attribList&gt;
                  &lt;attrib&gt;
                     &lt;name&gt;IsPrimary&lt;/name&gt;
                     &lt;value&gt;1&lt;/value&gt;
                  &lt;/attrib&gt;
                  &lt;attrib&gt;
                     &lt;name&gt;Role&lt;/name&gt;
                     &lt;value&gt;Marketing Manager&lt;/value&gt;
                  &lt;/attrib&gt;
               &lt;/attribList&gt;
               &lt;associationList&gt;
                  &lt;mObjAssociation&gt;
                     &lt;mObjType&gt;Lead&lt;/mObjType&gt;
                     &lt;!--id&gt;6&lt;/id--&gt;
                     &lt;externalKey&gt;
                     	&lt;name&gt;FSPID&lt;/name&gt;
                     	&lt;value&gt;12346&lt;/value&gt;
                     &lt;/externalKey&gt;
                  &lt;/mObjAssociation&gt;
                  &lt;mObjAssociation&gt;
                     &lt;mObjType&gt;Opportunity&lt;/mObjType&gt;
                     &lt;externalKey&gt;
                     	&lt;name&gt;opportunityId&lt;/name&gt;
                     	&lt;value&gt;Opportunity_5&lt;/value&gt;
                  	 &lt;/externalKey&gt;
                  &lt;/mObjAssociation&gt;
               &lt;/associationList&gt;
            &lt;/mObject&gt;
         &lt;/mObjectList&gt;
         &lt;operation&gt;UPSERT&lt;/operation&gt;
      &lt;/mkt:paramsSyncMObjects&gt;
   &lt;/soapenv:Body&gt;
&lt;/soapenv:Envelope&gt;
</pre>
Response:
<pre class="lang:default decode:true ">&lt;SOAP-ENV:Envelope xmlns:SOAP-ENV="http://schemas.xmlsoap.org/soap/envelope/" xmlns:ns1="http://www.marketo.com/mktows/"&gt;
   &lt;SOAP-ENV:Body&gt;
      &lt;ns1:successSyncMObjects&gt;
         &lt;result&gt;
            &lt;mObjStatusList&gt;
               &lt;mObjStatus&gt;
                  &lt;id&gt;41&lt;/id&gt;
                  &lt;externalKey&gt;
                     &lt;name&gt;opportunityId&lt;/name&gt;
                     &lt;value&gt;Opportunity_5&lt;/value&gt;
                  &lt;/externalKey&gt;
                  &lt;status&gt;CREATED&lt;/status&gt;
               &lt;/mObjStatus&gt;
               &lt;mObjStatus&gt;
                  &lt;id&gt;12&lt;/id&gt;
                  &lt;status&gt;CREATED&lt;/status&gt;
               &lt;/mObjStatus&gt;
            &lt;/mObjStatusList&gt;
         &lt;/result&gt;
      &lt;/ns1:successSyncMObjects&gt;
   &lt;/SOAP-ENV:Body&gt;
&lt;/SOAP-ENV:Envelope&gt;
</pre><br/><br/>JCastelein - 2014-11-26<br/><br/><h2>Multithread REST API Requests</h2><br/><br/>If you would like to improve performance when calling the Marketo API, you can make concurrent requests. This approach will allow you to get more data in a shorter period of time.

When making an API request, part of the round-trip time between the client and server is the transfer time on the wire. So if we can reduce the transfer time on the wire for the requests in aggregate, we will improve performance.

The sample code below shows you how to do this in Ruby. It uses EventMachine, which is an <a href="https://github.com/igrigorik/em-http-request/wiki/Parallel-Requests">event-processing library used for making multithreaded requests</a>.

The example below calls the <a href="/documentation/rest/get-lead-activities/">Lead Activities API</a>, and makes two concurrent requests. This approaches eliminates the transfer time from the client to server for the second request. It does this by including the second request at the same time as the first request. The API responses are written to a text file.
<pre class="lang:default decode:true ">require 'em-http-request'
require 'json'

#Build request URL
#Replace AAA-BBB-CCC with your Marketo instance
marketo_instance = "https://AAA-BBB-CCC.mktorest.com"
endpoint = "/rest/v1/activities.json"
#Replace with your access token
auth_token =  "?access_token=" + "ac756f7a-d54d-41ac-8c3c-f2d2a39ee325:ab"
#Specify datetime needed as nextPageToken
since_date_time = ["&amp;nextPageToken=A5YMOYZQBOGD2OSYYBYDAQGEMGLBDGDANAABQGRAQWAAKKID", "&amp;nextPageToken=GIYDAOBNGEYS2MBWKQYDAORQGA5DAMBOGAYDAKZQGAYDALBQ"]
#Specify activities needed
activity_type_ids = "&amp;activityTypeIds=1&amp;activityTypeIds=12"
requesturl_a = marketo_instance + endpoint + auth_token + since_date_time.at(0) + activity_type_ids
requesturl_b = marketo_instance + endpoint + auth_token + since_date_time.at(1) + activity_type_ids

#Make request
EventMachine.run do
  http1 = EventMachine::HttpRequest.new(requesturl_a).get
  http2 = EventMachine::HttpRequest.new(requesturl_b).get

#When API response is received, write response to a text file
  http1.callback {
  File.open('response1.txt', 'w') do |t|
  t.puts http1.response
  end }

  http2.callback {
  File.open('response2.txt', 'w') do |t|
  t.puts http2.response
  end }
end
</pre><br/><br/>MManzur - 2014-12-03<br/><br/><h2>Performance Tuning API Requests</h2><br/><br/>This post discusses strategies to improve performance when requesting data from the Marketo API. However, you must weigh the benefits of these strategies against the operating constraint of Marketo API's daily limits.

<strong>Strategy 1 – Request Less Data in Each API Call</strong>

Generally, as you request more data in an API call, the amount of time it takes to look up the data in the database by the Marketo server increases.

If you are making an API call with date ranges, such as the <a href="/soap-api/getmultipleleads/">getMultipleLeads SOAP API</a>, shorten the time range per call and compensate with more calls. For example, instead of requesting data from June 1 to July 1, request a single day at a time, such as one call for June 1 to 2, and then another call for June 2 to 3.

If you are making an API call that returns data from Marketo lead fields, only request those fields necessary. Every additional lead field incrementally increases the amount of time an API call takes. Another approach is to reduce the batch size, or the number of leads requested per call.

<strong>Strategy 2 - Make Concurrent Requests</strong>

To improve performance and pull more data at once, you can make concurrent requests to the API. This blog posts show <a href="/blog/multithread-rest-api-requests/">how to do this</a>. This approach reduces the time on wire API requests spend in aggregate.

For example, let’s say you are making requests to the Get Multiple Leads by Filter Type. You can make concurrent requests for one request querying leads 1 to 300 and for another request querying leads 301 - 600.

<strong>Strategy 3 - Cache Data</strong>

Some data in Marketo is changed less often, such as the list of lead fields, than other data, such as lead activity data. If you cache data that is less often updated, then you will reduce the number of API calls you have to make. You will also get better performance because looking up the data locally is generally faster than accessing it from a remote web service.<br/><br/>MManzur - 2014-12-05<br/><br/><h2>Send Marketo Form Data to Google Analytics</h2><br/><br/>In Google Analytics, you can send custom data events, and then utilize the data to segment and analyze your website performance. The Javascript code snippet below allows you to automatically push Marketo 2.0 Form data to Google Analytics after a visitor submits a web form. Here is how to set this up.

<strong>Step One</strong>
Insert the Javascript tag onto any page that includes Marketo Forms at the bottom of the code (before the tag). The Javascript only sends only non-hidden fields (sendHiddenFields : false). This can be adjusted by changing sendHiddenFields from false to true. You can also select fields to exclude by adding additional field IDs in the ‘fieldsToExclude’ array.

<script src="https://google-code-prettify.googlecode.com/svn/loader/run_prettify.js" type="text/javascript"></script>
<pre class="prettyprint lang-js">function pushFormDataToGa(a){
setTimeout(function () {
document.getElementsByTagName('form')[0].getElementsByClassName(a.submitButton)[0].addEventListener('click', function() {
		allFields = document.getElementsByTagName('form')[0].getElementsByTagName('input');
		for(i=0;i&lt;allFields.length;i++){
			if( (allFields[i].type !="hidden" &amp;&amp; allFields[i].type !="submit" &amp;&amp; allFields[i].value !="" &amp;&amp; a.fieldsToExclude.indexOf(allFields[i].id) === -1  ) || (allFields[i].type === "hidden" &amp;&amp; a.sendHiddenFields) ){
				console.log( allFields[i].name + ": "  + allFields[i].value);
				if(typeof(_gaq) != "undefined"){
				//Classic
				_trackEvent("Marketo Form Submission", allFields[i].value , allFields[i].name 
{'nonInteraction': 1});
				}else if(typeof(ga) !="undefined"){
				//Universal
				ga('send', 'event',"Marketo Form Submission", allFields[i].value , allFields[i].name, {'nonInteraction': 1});
}}}}, false);
}, 3000);}
pushFormDataToGa({
	submitButton: "mktoButton",
	fieldsToExclude: ["Email","LastName", "FirstName"],
	sendHiddenFields : false		
});
</pre>
<strong>Step Two</strong>
The data in GA will appear in the Reporting section. Go to Behavior &gt; Events &gt; Top Events.

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/12/ga.png"><img class="size-full wp-image-2756 alignnone" src="https://marketohost.wpengine.com/wp-content/uploads/2014/12/ga.png" alt="ga" width="975" height="530" /></a>

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/12/Screen-Shot-2014-12-16-at-2.55.03-PM.png"><img class="size-full wp-image-2758 alignnone" src="https://marketohost.wpengine.com/wp-content/uploads/2014/12/Screen-Shot-2014-12-16-at-2.55.03-PM.png" alt="Screen Shot 2014-12-16 at 2.55.03 PM" width="705" height="104" /></a>

<strong>Script Restrictions:</strong>
- This code sample is only compatible with <a href="http://developers.marketo.com/documentation/websites/forms-2-0/">Marketo Forms 2.0</a>.
- Due to Google’s privacy policy you may not send any personal information ( email or name). Aside from potential privacy concerns, this is personally identifiable info and so breaches <a href="http://www.google.com/analytics/terms/us.html">Google Analytics’ Terms of Service</a>:
<blockquote>"You will not (and will not allow any third party to) use the Service to track, collect or upload any data that personally identifies an individual (such as a name, email address or billing information), or other data which can be reasonably linked to such information by Google."</blockquote><br/><br/>YCalisar - 2014-12-16<br/><br/><h2>Add a Full Name Field to a Marketo Form</h2><br/><br/>We know that <a href="http://blog.marketo.com/2013/02/landing-page-techniques-that-drive-higher-conversion.html" target="_blank">shorter web forms improve conversion rates</a>. The Javascript code sample below allows you to make your forms even shorter by merging the First and Last Name fields into one Full Name field.

When visitors are typing in their full name, the script will automatically break the text into first and last name fields. For known visitors the script will join the first and last names, and then copy them to the new field so they won’t have to fill the field again. Here is how to set this up.

<strong>Step One</strong>
Create a new custom field in Marketo called Full Name. No need to create it in your CRM platform, as the script will only use this field to display the full name.

<strong>Step Two</strong>
Add this field to all your web forms. Set your first name and last name fields as hidden. In the Javascript, change the “splitFullName” configuration to contain the 3 field names.

Note: Please make sure these names do not appear anywhere else on the page.

<strong>Step Three</strong>
Insert the Javascript into all your landing pages at the bottom of the code, before the tag.
<pre class="lang:default decode:true prettyprint lang-js">&lt;script&gt;
MktoForms2.whenReady(function (form){
        function splitFullName(a,b,c){
                String.prototype.capitalize = function(){
                        return this.replace( /(^|s)([a-z])/g , function(m,p1,p2){ return p1+p2.toUpperCase(); } );
                };
                document.getElementsByName(c)[0].oninput=function(){
                        var fullName = document.getElementsByName(c)[0].value;
                        if((fullName.match(/ /g) || []).length ===0 || fullName.substring(fullName.indexOf(" ")+1,fullName.length) === ""){
                                var first = fullName.capitalize();;
                                var last = "null";
                        }else if(fullName.substring(0,fullName.indexOf(" ")).indexOf(".")&gt;-1){
                                var first = fullName.substring(0,fullName.indexOf(" ")).capitalize() + " " + fullName.substring(fullName.indexOf(" ")+1,fullName.length).substring(0,fullName.substring(fullName.indexOf(" ")+1,fullName.length).indexOf(" ")).capitalize();
                                var last = fullName.substring(first.length +1,fullName.length).capitalize();
                        }else{
                                var first = fullName.substring(0,fullName.indexOf(" ")).capitalize();
                                var last = fullName.substring(fullName.indexOf(" ")+1,fullName.length).capitalize();
                        }
                        document.getElementsByName(a)[0].value = first;
                        document.getElementsByName(b)[0].value = last;
                };
                //Initial Values
                if(document.getElementsByName(c)[0].value.length &lt; 2 &amp;&amp; document.getElementsByName(b)[0].value.length.length &gt;2 &amp;&amp; document.getElementsByName(a)[0].value.length.length &gt;2 ){
                        var first = document.getElementsByName(a)[0].value.capitalize();
                        var last = document.getElementsByName(b)[0].value.capitalize();
                        var fullName =  first + " " + last ;
                        console.log(fullName);
                        document.getElementsByName(c)[0].value = fullName;
                }
        }
        splitFullName("FirstName","LastName","leadFullName");
});
&lt;/script&gt;
</pre>
Note: This code works only with Marketo Forms 2.0.

<strong>Here are a few examples of the expected results:</strong>
<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/12/Screen-Shot-2014-12-16-at-3.01.47-PM.png"><img class="size-full wp-image-2766 alignnone" src="https://marketohost.wpengine.com/wp-content/uploads/2014/12/Screen-Shot-2014-12-16-at-3.01.47-PM.png" alt="Screen Shot 2014-12-16 at 3.01.47 PM" width="704" height="229" /></a><br/><br/>YCalisar - 2014-12-16<br/><br/><h2>Use cURL to Import Leads via the REST API</h2><br/><br/>Do you want to import leads from a CSV file through the REST API, but noticed this is challenging to do using the Postman Chrome extension. In this post, we'll walk through how to do this with cURL.

<strong>Step One</strong>
<a href="http://curl.haxx.se/download.html">Download and install cURL</a>, a command line tool we'll use to push data to Marketo's REST API.

<strong>Step Two </strong>
Open the command line, and then navigate to the location where the CSV file is located. <a href="/wp-content/uploads/2014/12/testfile.csv">Here is an example file with the expected format</a>. The column headers in the CSV file must match the API field names, not the Marketo field names.

<strong>Step Three</strong>
You will need an access token. Login to Marketo, go to Admin, and then LaunchPoint. Find your REST API user and click “View Details”. Click the “Get Token” button. If you have not authenticated with the Marketo REST API before, <a href="/blog/quick-start-guide-for-marketo-rest-api/">please follow this guide</a>.

<strong>Step Four</strong>
You will also need your REST endpoint that is specific to your Marketo instance. Login to Marketo, and go to Admin, and then Web Services. In the section marked “REST API” you’ll find the Endpoint URL.

<strong>Step Five</strong>
On the command line, follow this format for the cURL call. Replace &lt;accesstoken&gt; with your access token from Step Three and replace &lt;REST API Endpoint URL&gt; with your REST API Endpoint URL from Step Four.

More info is <a href="http://developers.marketo.com/documentation/rest/import-lead/">available here</a>. The "/bulk" here will replace the "/rest" at the end of the Endpoint URL. If you have the endpoint set for /rest/bulk it will return an error.
<pre class="lang:default decode:true prettyprint lang-js ">curl -i -F format=csv -F file=@leaddata.csv -F access_token=&lt;accesstoken&gt; &lt;REST API Endpoint URL&gt;/bulk/v1/leads.json
</pre><br/><br/>JLund - 2014-12-16<br/><br/><h2>Add a Confirmation Alert to a Marketo Form</h2><br/><br/>Let's say when a user click the "Send" button on a Marketo form, you would like to display a notification that asks the user if "Is it really ok to send"?. This possible by implementing a few lines of JavaScript, which will show a confirmation box when somebody clicks the Send button.

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/12/Screen-Shot-2014-12-17-at-11.48.05-AM.png"><img class="size-full wp-image-2866 alignnone" src="https://marketohost.wpengine.com/wp-content/uploads/2014/12/Screen-Shot-2014-12-17-at-11.48.05-AM.png" alt="Screen Shot 2014-12-17 at 11.48.05 AM" width="505" height="430" /></a>
Here's an example of how to do this. Add the onSubmit function to your Marketo form as shown below. For more information about Marketo Forms API, please <a href="http://developers.marketo.com/documentation/websites/forms-2-0/">check out the developer documentation</a>.
<pre class="lang:default decode:true prettyprint lang-js ">&lt;script src="//app-e.marketo.com/js/forms2/js/forms2.js"&gt;&lt;/script&gt;
&lt;form id="mktoForm_19"&gt;&lt;/form&gt;
&lt;script&gt;
MktoForms2.loadForm("//app-e.marketo.com", "212-RBI-463", 19,function(form){
 
//Add this function to your Marketo form script
form.onSubmit(function(){
alert("Do you really want to submit the form?");
});
});
&lt;/script&gt;
</pre><br/><br/>deverly - 2014-12-17<br/><br/><h2>Show Thank You Message Without a Follow-Up Landing Page</h2><br/><br/>Typically, when you use Marketo forms, you create two landing pages – one to place the form on and one to redirect to after the form is completed. However, in some cases, you may not want to have two separate but very similar landing pages to maintain. You can actually use the same landing page for the form and for the thank you message using the Forms 2.0 JavaScript API.

To do this, first create your registration landing page and form and place the form on the landing page as you would normally. Then, add an HTML element to the page. In this element, we will add some code that activates at the moment the form is submitted. It will then hide the form and reveal a hidden &lt;div&gt; that contains the thank you message. Your JavaScript should look like this:
<pre class="lang:default decode:true prettyprint lang-js">//Edit host with your Marketo instance info
&lt;script src="//&lt;host&gt;/js/forms2/js/forms2.js"&gt;&lt;/script&gt;
&lt;script&gt;
MktoForms2.whenReady(function (form){
 //Add an onSuccess handler
  form.onSuccess(function(values, followUpUrl){
   //get the form's jQuery element and hide it
   form.getFormElem().hide();
   document.getElementById('confirmform').style.visibility = 'visible';
   //return false to prevent the submission handler from taking the lead to the follow up url.
   return false;
 });
});
&lt;/script&gt;
//Edit thank you message text.
&lt;div id="confirmform" style="visibility:hidden;"&gt;&lt;p&gt;&lt;strong&gt;Thank you. Check your email for details on your request.&lt;/strong&gt;&lt;/p&gt;&lt;/div&gt;
</pre>
You will want to edit the host name and thank you message in the code sample. The first should reference your Marketo instance (e.g. “//app-sj06.marketo.com/js/forms2/js/forms2.js”) and the second should contain the thank you text that you want to display once the form is completed.

The text will display on the landing page in the exact position where you place the HTML element, so be sure you edit that in the property sheet. You should also make sure the layer of your HTML element is smaller than the layer for your form. By default, both will be put at Layer 15, so you will be safe if you make your HTML element Layer 14. If you don’t do this, you won’t be able to type in any form field boxes that overlap with the thank you message.

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/12/Untitled.png"><img class="size-full wp-image-2910 alignnone" src="https://marketohost.wpengine.com/wp-content/uploads/2014/12/Untitled.png" alt="Untitled" width="630" height="364" /></a>

It is not necessary to change the follow-up type on the form or on the landing page, as the JavaScript will overwrite those settings.

For more information about Marketo Forms API, please check out the <a href="/javascript-api/forms/">developer documentation</a>.<br/><br/>KCarmean - 2014-12-19<br/><br/><h2>Highlighting Open Source Projects Built on the Marketo Platform</h2><br/><br/>This will be the first post in an ongoing series highlighting open-source projects built around the Marketo platform by the developer community.

We maintain <a href="https://github.com/Marketo/Community-Supported-Client-Libraries">a list on Marketo's GitHub account</a> where we track client libraries and projects created by the Marketo developer community. Below are three projects developed around the Marketo REST and SOAP APIs.

<strong>Daniel Chesterton created <a href="https://github.com/dchesterton/marketo-rest-api">a client library in PHP for the Marketo REST API</a>. The client library currently has coverage for 12 REST API endpoints.</strong>

<a href="https://marketohost.wpengine.com/wp-content/uploads/2015/01/Screen-Shot-2015-01-02-at-2.45.22-PM.png"><img class="size-large wp-image-2939 alignnone" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2015/01/Screen-Shot-2015-01-02-at-2.45.22-PM-1024x709.png" alt="Screen Shot 2015-01-02 at 2.45.22 PM" width="1024" height="709" /></a>

<strong>Kyle Halstvedt of Elixiter created a project to <a href="https://github.com/Elixiter/mkto_google-spreadsheet">pull leads from Marketo static lists into a Google Spreadsheet</a>. Kyle's project uses the Marketo REST API.</strong>

<a href="https://marketohost.wpengine.com/wp-content/uploads/2015/01/Screen-Shot-2015-01-02-at-2.46.28-PM.png"><img class="size-full wp-image-2941 alignnone" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2015/01/Screen-Shot-2015-01-02-at-2.46.28-PM.png" alt="Screen Shot 2015-01-02 at 2.46.28 PM" width="1023" height="790" /></a>

<strong>David Santoso created a <a href="https://github.com/davidsantoso/markety">Ruby gem for the Marketo SOAP API.</a> This project can help you more quickly integrate the Marketo SOAP API with a Ruby on Rails app.</strong>

<a href="https://marketohost.wpengine.com/wp-content/uploads/2015/01/Screen-Shot-2015-01-02-at-2.44.38-PM.png"><img class="size-full wp-image-2937 alignnone" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2015/01/Screen-Shot-2015-01-02-at-2.44.38-PM.png" alt="Screen Shot 2015-01-02 at 2.44.38 PM" width="1019" height="780" /></a>

We are excited to see more projects created by the developer community on the Marketo platform. If you are working on an open source project for the Marketo platform, please <a href="https://github.com/Marketo/Community-Supported-Client-Libraries">submit it to this GitHub repo via a pull request</a>.<br/><br/>MManzur - 2015-01-02<br/><br/><h2>Dynamically Change Page Content Based on a User's Location</h2><br/><br/>Let's say you would like to dynamically change the phone number on a landing page depending on where a user is located. For example, if the person is in California you would like to show them the phone number for your California office on your landing page, but if they are in Japan you would like to show them the phone number for the Japanese office.

<a href="https://marketohost.wpengine.com/wp-content/uploads/2015/01/show-nearest-office-san-mateo.png"><img class="size-full wp-image-3107 alignnone" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2015/01/show-nearest-office-san-mateo.png" alt="show-nearest-office-san-mateo" width="358" height="96" /></a>

One way to implement this is using JavaScript and the <a href="https://developer.mozilla.org/en-US/docs/Web/API/Geolocation/Using_geolocation">HTML5 Geolocation API</a>. The benefit of this approach is we can create one landing page and dynamically change it based on a user's location, instead of multiple static landing pages.

<a href="/wp-content/uploads/2015/01/test-location-live.html" target="_blank">Here is a demo of a landing page</a>, where we show the phone number for the closest Marketo office to the user. We'll walk through the technical implementation details below.

We create an object for office locations with latitude and longitude coordinates, and a second object with office phone numbers. In production, it would be a better practice to combine these two objects into a single object.
<pre class="lang:default decode:true prettyprint lang-js">//Coordinates for Marketo offices
var officeLocations = {
    "San Mateo": {latitude: 37.5596465, longitude: -122.2870142},
    "Atlanta": {latitude: 33.8547013, longitude: -84.35552349999999},
    "Tokyo": {latitude: 35.6895, longitude: 139.6917},
    "Dublin": {latitude: 53.3478, longitude: -6.2603097},
    "Sydney": {latitude: -33.873651, longitude: 151.2068896},
    "Portland": {latitude: 45.512089, longitude: -122.6763367},
    "Tel Aviv": {latitude: 32.0852999, longitude: 34.78176759999999}
}

//Phone numbers for Marketo offices
var officePhoneNumbers = {
    "San Mateo": "+1-650-376-2300",
    "Atlanta": "+1-877-260-6586",
    "Tokyo": "+81-03-6759-8280",
    "Dublin": "+353-1-242-3000",
    "Sydney": "+61-2-9045-2711",
    "Portland": "+1-877-260-6586",
    "Tel Aviv": "+1-877-260-6586"
}
</pre>
We create a method to request a user's location. To handle errors, if the user's location is not accessible, we will default to Marketo's headquarters and its phone number.
<pre class="lang:default decode:true prettyprint lang-js">//Method to get user's current location. Returns a position object with user's geo coordinates
function getLocation() {
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(findNearestOffice);
    } else {
        x.innerHTML = "Marketo Location: San Mateo
Marketo Phone Number: +1-877-260-6586";
    }
}
</pre>
Lastly, we'll create a method to find the closest office to the user's location, and then return the phone number for the closest office on the page. This method uses the findNearest method from <a href="https://github.com/manuelbieh/Geolib">Geolib, which is JavaScript library that provides geospatial operations</a>.
<pre class="lang:default decode:true prettyprint lang-js">//Find nearest Marketo office to user's location
function findNearestOffice(position) {
        var nearestOffice = geolib.findNearest({latitude: position.coords.latitude, longitude: position.coords.longitude}, officeLocations);
        x.innerHTML = "Marketo Location: " + nearestOffice.key + "
Marketo Phone Number: " +  officePhoneNumbers[nearestOffice.key];
}
</pre>
Here's the full implementation. We trigger the getLocation method when the user clicks the button on the page.
<script src="https://gist.github.com/MurtzaM/7702cc07c6bf65b38736.js"></script>

This <a href="https://github.com/MurtzaM/Find-Nearest-Marketo-Office">GitHub repo</a> has files needed to set up this demo.<br/><br/>MManzur - 2015-01-08<br/><br/><h2>January 2015 Release Updates</h2><br/><br/>There are three new endpoints available for the REST APIs: <a href="/documentation/rest/delete-lead">Delete Lead</a>, <a href="/documentation/rest/get-multiple-leads-by-program-id">Get Multiple Leads By Program Id</a>, and <a href="/documentation/rest/get-deleted-leads/">Get Deleted Leads</a>. There is also an update to the <a href="/documentation/rest/createupdate-leads/">Create/Update Leads API endpoint</a> that allows you to request asynchronous processing.<br/><br/>MManzur - 2015-01-07<br/><br/><h2>December 2014 Release Updates</h2><br/><br/>There are three new endpoints available for the REST APIs: <a href="/documentation/rest/associate-lead/">Associate Lead</a>, <a href="/documentation/rest/merge-lead/">Merge Lead</a>, and <a href="/documentation/rest/get-lead-partitions/">Get Lead Partitions</a>.<br/><br/>MManzur - 2014-12-20<br/><br/><h2>Lead Tracking and Multiple Domains</h2><br/><br/>Marketo’s Munchkin tracking code helps you track visits to your web site. You’re likely to want to use Munchkin tracking code to cookie anonymous leads for most or all of the pages on your website. Let's walk through how Munchkin works.

Visits to the page are recorded for existing leads, and a visit to the page by a non-cookied visitor will cause a new cookie to be created and stored, and a new anonymous lead to be created in your Marketo database. The Munchkin-tracker will automatically cookie a visitor if they don't already have an existing cookie for the current domain. In Marketo, it logs the event (click link, visit web page, or new lead) in the lead's Activity Log. The value stored within the cookie is unique for a given visitor. The value is a combination of the unique Munchkin account tracking id, domain name, time stamp and random integer.

<strong>What happens if I have multiple domains?</strong>
Lets say you have two sites that you would like to track: www.apples.com and www.bananas.com. You can put the tracking code on both sites, however you need to consider the following. Marketo cookies are ‘first-party cookies’ and are therefore domain specific.

This means that a visitor to site 1 will be created as an anonymous lead in Marketo, if that same lead then goes to site 2 this will create a second separate anonymous lead in Marketo. If the lead fills out a form on site 1 then this record will become known, the anonymous record for site 2 will remain and continue to accumulate subsequent visits to that site. If the lead then goes on to fill out a form on site 2 with the exact same email address as used on site 1, then both known leads will merge automatically and all past and future behavior will be tracked on one single record in Marketo. Both cookie IDs are tied to the same lead and all web activity (from either domain) will be on that lead.

<strong>What about multiple subdomains?</strong>
Subdomains are not an issue. Let's use use Marketo.com as an example. It has multiple subdomains for different languages, such as fr.marketo.com and de.marketo.com.
With subdomains all activity will be recorded against the same lead record/cookie.<br/><br/>deverly - 2015-01-13<br/><br/><h2>Change the Hint Text Color on a Marketo Form</h2><br/><br/>Let's say you want to change the hint text color (also referred to as the placeholder text) in Forms 2.0. This is possible via custom CSS. For example, in the screenshot below I made the hint text in this Marketo Form blue.

<a href="https://marketohost.wpengine.com/wp-content/uploads/2015/01/Screen-Shot-2015-01-13-at-4.31.04-PM.png"><img class="size-full wp-image-3169 alignnone" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2015/01/Screen-Shot-2015-01-13-at-4.31.04-PM.png" alt="Screen Shot 2015-01-13 at 4.31.04 PM" width="470" height="183" /></a>

There are three options on how to do this depending on how you are using Marketo Forms.

<strong>Option 1: If you are embedding a Marketo form, add the CSS below directly to your main CSS file. </strong>
<pre class="lang:default decode:true prettyprint lang-js">::-webkit-input-placeholder {
  color: blue;
}
::-moz-placeholder {
  color: blue;
}
:-ms-input-placeholder {
  color: blue;
}
:-moz-placeholder {
  color: blue;
}
</pre>
<strong>Option 2: When you are embedding a Marketo form, you can add the CSS directly on the page between &lt;style&gt;&lt;/style&gt; tags in the &lt;head&gt; section. </strong>
<pre class="lang:default decode:true prettyprint lang-js">&lt;style&gt;
::-webkit-input-placeholder {
  color: blue;
}
::-moz-placeholder {
  color: blue;
}
:-ms-input-placeholder {
  color: blue;
}
:-moz-placeholder {
  color: blue;
}
&lt;/style&gt;
</pre>
<strong>Option 3: If you are using a Marketo form on a Marketo landing page, you can add this custom CSS through the Marketo UI.
</strong>

Find the landing page in the Marketo navigation tree. Then click Edit Draft.

<a href="https://marketohost.wpengine.com/wp-content/uploads/2015/01/hint-text-1.png"><img class="size-large wp-image-3187 alignnone" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2015/01/hint-text-1.png" alt="hint-text-1" width="311" height="237" /></a>

Click Edit Page Meta Tags.

<a href="https://marketohost.wpengine.com/wp-content/uploads/2015/01/hint-text-2.png"><img class="size-large wp-image-3185 alignnone" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2015/01/hint-text-2.png" alt="hint-text-2" width="379" height="221" /></a>

Add the CSS below to the Custom HEAD HTML section. The &lt;style&gt;&lt;/style&gt; tags should be included.
<pre class="lang:default decode:true prettyprint lang-js">&lt;style&gt;
::-webkit-input-placeholder {
  color: blue;
}
::-moz-placeholder {
  color: blue;
}
:-ms-input-placeholder {
  color: blue;
}
:-moz-placeholder {
  color: blue;
}
&lt;/style&gt;
</pre>
<a href="https://marketohost.wpengine.com/wp-content/uploads/2015/01/hint-text-3.png"><img class="size-full wp-image-3183 alignnone" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2015/01/hint-text-3.png" alt="hint-text-3" width="703" height="597" /></a>

Click Approve Draft.

<a href="https://marketohost.wpengine.com/wp-content/uploads/2015/01/hint-text-4.png"><img class="size-large wp-image-3189 alignnone" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2015/01/hint-text-4.png" alt="hint-text-4" width="206" height="456" /></a>

When you now visit the Marketo landing page, the hint text will be the color you defined in the CSS.

<a href="https://marketohost.wpengine.com/wp-content/uploads/2015/01/Screen-Shot-2015-01-13-at-4.31.04-PM.png"><img class="size-full wp-image-3169 alignnone" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2015/01/Screen-Shot-2015-01-13-at-4.31.04-PM.png" alt="Screen Shot 2015-01-13 at 4.31.04 PM" width="470" height="183" /></a>

For more information about Marketo Forms, <a href="/javascript-api/forms/">please visit the documentation</a>.<br/><br/>MManzur - 2015-01-14<br/><br/><h2>Get Activity Data via the REST API</h2><br/><br/>Let's say you want to get all leads that were added to a list this month. Using the <a href="/documentation/rest/get-lead-activities/">Get Lead Activities REST API</a>, you can get this data.

Before calling the Get Lead Activities API, it is necessary to get an access token from the <a href="/rest-api/authentication/">Authentication API</a> and also get a starting date token from the <a href="/documentation/rest/get-paging-token/">Get Paging Token API</a>.

Below is example code in Ruby that walks through the individual API endpoints you would have to call to return all leads added to a list this month.

<strong>Step One: Get Access Token</strong>
<pre class="lang:default decode:true prettyprint lang-rb">require 'rest_client'
require 'json'

#Build request URL
#Replace AAA-BBB-CCC with your Marketo instance
marketo_instance = "https://AAA-BBB-CCC.mktorest.com/identity/oauth/token?grant_type=client_credentials"
#Relace with your client id
client_id = "99985d09-22a9-3jl2-84av-f5baae7c3a45"
#Replace with your your  client secret
client_secret = "tZPVrKiEmUDezE18yZfeaPlTJ2vKn2fw"
request_url = marketo_instance + "&amp;client_id=" + client_id + "&amp;client_secret=" + client_secret

#Make request
response = RestClient.get request_url

#Parse reponse and return only access token
results = JSON.parse(response.body)
access_token = results["access_token"]
puts access_token
</pre>
<strong>Step Two: Get Paging Token</strong>
<pre class="lang:default decode:true prettyprint lang-rb">require 'rest_client'
require 'json'

#Build request URL
#Replace AAA-BBB-CCC with your Marketo instance
marketo_instance = "https://AAA-BBB-CCC.mktorest.com"
endpoint = "/rest/v1/activities/pagingtoken.json"
#Replace with your access token
auth_token =  "?access_token=" + "ac756f7a-d54d-41ac-8c3c-f2d2a39ee325:ab"
#Specify date
since_date_time = "&amp;sinceDatetime=2015-01-01T00:00:00-08:00"
request_url = marketo_instance + endpoint + auth_token + since_date_time

#Make request
response = RestClient.get request_url

#Returns Marketo API response
puts response
</pre>
<strong>Step Three: Get Activity Data</strong>

To determine the Activity Type Id needed for this call, query the <a href="/documentation/rest/get-activity-types/">Get Activity Types API</a>. The Get Activity Types API will return a schema with all activity types and associated ids. For example, it will return id 12 for new leads created and id 1 for webpage visit.
<pre class="lang:default decode:true prettyprint lang-rb">require 'rest_client'
require 'json'

#Build request URL
#Replace AAA-BBB-CCC with your Marketo instance
marketo_instance = "https://AAA-BBB-CCC.mktorest.com"
endpoint = "/rest/v1/activities.json"
#Replace with your access token
auth_token =  "?access_token=" + "ac756f7a-d54d-41ac-8c3c-f2d2a39ee325:ab"
#Specify datetime needed as nextPageToken
since_date_time = "&amp;nextPageToken=GIYDAOBNGEYS2MBWKQYDAORQGA5DAMBOGAYDAKZQGAYDALBQ"
#Specify activities needed
activity_type_ids = "&amp;activityTypeIds=24"
request_url = marketo_instance + endpoint + auth_token + since_date_time + activity_type_ids

#Make request
response = RestClient.get request_url

#Returns Marketo API response
puts response
</pre>
<strong>Step Four: The Get Lead Activites API will return a paging token with each response that you can use to paginate through the results set.</strong>

For more information, please see the <a href="/documentation/rest/">REST API documentation</a>.<br/><br/>MManzur - 2015-01-20<br/><br/><h2>Highlighting Open Source Projects Built on the Marketo Platform: Part Two</h2><br/><br/>This is the second post in an ongoing series highlighting open-source projects built around the Marketo platform by the developer community. The <a href="/blog/highlighting-open-source-projects-built-on-the-marketo-platform/">first post in this series is available here</a>.

We maintain <a href="https://github.com/Marketo/Community-Supported-Client-Libraries">a list on Marketo's GitHub account</a> where we track client libraries and projects created by the Marketo developer community. Below are three projects developed around the Marketo SOAP and Munchkin APIs.

<strong><a href="https://www.punchtab.com/">PunchTab</a> created <a href="https://github.com/PunchTab/suds-marketo">a client library in Python for the Marketo SOAP API</a>.</strong>

<a href="https://marketohost.wpengine.com/wp-content/uploads/2015/01/Screen-Shot-2015-01-19-at-4.54.03-PM.png"><img class="alignleft size-full wp-image-3275" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2015/01/Screen-Shot-2015-01-19-at-4.54.03-PM.png" alt="Screen Shot 2015-01-19 at 4.54.03 PM" width="1001" height="484" /></a>

<strong><a href="http://www.flickerbox.com/">Flickerbox</a> created <a href="https://github.com/flickerbox/marketo">a client library in PHP for the Marketo SOAP API</a>.</strong>

<a href="https://marketohost.wpengine.com/wp-content/uploads/2015/01/Screen-Shot-2015-01-19-at-4.54.19-PM.png"><img class="alignleft size-full wp-image-3277" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2015/01/Screen-Shot-2015-01-19-at-4.54.19-PM.png" alt="Screen Shot 2015-01-19 at 4.54.19 PM" width="1006" height="379" /></a>

<strong><a href="https://twitter.com/mozz100">Richard Morrison</a> created <a href="https://github.com/mozz100/marketo-whodat">a PHP script to get lead data from the Marketo SOAP API, and then pass this data to the client using Javascript.</a> This project can help you modify a page based on a user's data in Marketo.</strong>

<a href="https://marketohost.wpengine.com/wp-content/uploads/2015/01/Screen-Shot-2015-01-19-at-4.54.30-PM.png"><img class="alignleft size-full wp-image-3285" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2015/01/Screen-Shot-2015-01-19-at-4.54.30-PM.png" alt="Screen Shot 2015-01-19 at 4.54.30 PM" width="1002" height="508" /></a>

We are excited to see more projects created by the developer community on the Marketo platform. If you are working on an open source project for the Marketo platform, please <a href="https://github.com/Marketo/Community-Supported-Client-Libraries">submit it to this GitHub repo via a pull request</a>.<br/><br/>MManzur - 2015-01-20<br/><br/><h2>Marketo API Debugging Checklist</h2><br/><br/>Below are a few of the common errors we see.

Check the error code against error code list
Are approparite permissions assigned to user
Is there data?
Above known limit (650kb request campaign limit, 10MB import lead limit)
rate limit

Exception handling?<br/><br/>MManzur - 1970-01-01<br/><br/><h2>Send RTP Recommendation Engine Clicks to Google Analytics</h2><br/><br/>Here is a solution for Marketo Real-Time Personalization (RTP) users to see clicks from the Content Recommendation Engine within Google Analytics. Once a visitor clicks the Content Recommendation bar, an event is sent to Google Analytics under Event Category “RTP-Recommendations”. In Analytics, the Recommendation Text (as it appears in the bar) will be appended to Event Label and the URL of the recommended asset will be appended to Event Action.

The script works for both Classic Google Analytics and Google Universal Analytics. This tag should be pasted at the end of the HTML page code, so it will be the last tag before the &lt;/body&gt; tag.
<pre class="lang:default decode:true">$( document ).ready(function() {
if(document.getElementsByClassName("insightera-bar-content").length
 &gt;0){
document.getElementsByClassName("insightera-bar-content")[0].getElementsByTagName('a')[0].addEventListener("click",
 function(){
assetName
 = document.getElementsByClassName("insightera-bar-content")[0].getElementsByTagName('a')[0].innerText;
assetURL
 = document.getElementsByClassName("insightera-bar-content")[0].getElementsByTagName('a')[0].href;
assetURL=
 assetURL.substring(assetURL.lastIndexOf("/"),assetURL.indexOf("?iesrc"));
console.log(assetName
 + " | " + assetURL);
if(typeof(_gaq)
 != "undefined"){
//Classic
_trackEvent("RTP-Recommendations",
 assetName , assetURL , {'nonInteraction': 1});
}else
 if(typeof(ga) !="undefined"){
//Universal
ga('send',
 'event',"RTP-Recommendations", assetName , assetURL, {'nonInteraction': 1});
}
});
}
});
</pre>
As shown in the image below, asset names will show up under the events report in Google Analytics.

<a href="https://marketohost.wpengine.com/wp-content/uploads/2015/01/rtp1.png"><img class="alignleft size-large wp-image-3328" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2015/01/rtp1-1024x380.png" alt="rtp1" width="1024" height="380" /></a><br/><br/>YCalisar - 2015-01-22<br/><br/><h2>Using the Marketo REST API with Boomi: Getting and Storing a REST Authentication Token</h2><br/><br/>Setting up an automatic export of leads that meet a certain criteria is a very common use case with Marketo. Although this can’t currently be done in the Marketo interface, its pretty straightforward to accomplish using the a 3rd party tool like Dell Boomi, a static list with some data management campaigns, and the Marketo REST API.

The REST API? I thought Boomi didn’t have a Marketo REST API Connector! Well, currently, it doesn’t, but its possible to accomplish the same thing using the HTTP Connector and manually defining the jSON response shapes.

The first step is to set up your Marketo instance to use the REST API as outlined in the <a href="/documentation/rest/">REST API Marketo Developer page</a> or simply follow the <a href="/blog/quick-start-guide-for-marketo-rest-api/">quick-start REST API guide on the Marketo Developer Blog</a>. I’ll also assume you have access to a Dell Boomi account and have the Boomi skills to create these types of integration processes.

The final process will look like the following, and will include calls to the following Marketo REST API operations, each of which has an associated jSON response shape which can be found on the developer site. To save time, I’ve listed them below

Example JSON for <a href="/rest-api/authentication/">Authentication</a>
<pre class="lang:default decode:true prettyprint lang-js">{
  "access_token": "",
  "token_type": "",
  "expires_in": 0,
  "scope": ""
}
</pre>
Example JSON for <a href="/documentation/rest/get-multiple-leads-by-list-id/">Get Multiple Leads By List ID </a>
<pre class="lang:default decode:true prettyprint lang-js">{
  "requestId": "",
  "success": true,
  "nextPageToken": "",
  "result": [
    {
      "id": 0,
      "email": "",
      "firstName": "",
      "lastName": ""
    },
    {
      "id": 0,
      "email": "",
      "firstName": "",
      "lastName": ""
    },
    {
      "id": 0,
      "email": "",
      "firstName": "",
      "lastName": ""
    }
  ]
}
</pre>
Example JSON for <a href="/documentation/rest/remove-leads-from-list/">Remove Leads from List </a>
<pre class="lang:default decode:true prettyprint lang-js">{
  "requestId": "",
  "success": true,
  "result": [
    {
      "id": 1,
      "status": ""
    },
    {
      "id": 2,
      "status": "",
      "reasons": [
        {
          "code": "",
          "message": ""
        }
      ]
    }
  ]
}
</pre>
<a href="https://marketohost.wpengine.com/wp-content/uploads/2015/01/boom1.png"><img class="alignleft size-large wp-image-3360" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2015/01/boom1-1024x585.png" alt="boom1" width="1024" height="585" /></a>

<strong>Step 1: Define Properties</strong>

Before we start calling REST, it’s important to externalize and encapsulate variables you’ll be using. I’ve defined the following shown below.

<a href="https://marketohost.wpengine.com/wp-content/uploads/2015/01/boomi2.png"><img class="size-full wp-image-3356 alignnone" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2015/01/boomi2.png" alt="boomi2" width="422" height="277" /></a>

- ClientID: Get this from your REST Launchpoint Service
- Client Secret: Get this from your REST Launchpoint Service
- AccessToken: We’ll get this from a REST call
- Static ListID: The LIST ID of the static list we’ll operate on. Get this from the URL in Marketo
- Fields: A comma separated list of fields the rest service will get from Marketo for each lead. Mine is "id,email,firstName,lastName"
- IDStringToDelete: Will eventually contain the ID of all the leads in the static list to be used in their removal from the list.
- ActivityTypes: Will be used in Part 2 of this blog, where I expand on this!
- SinceDateTime: Will be used in Part 2 of this blog, where I expand on this!
- PagingToken: Will be used in Part 2 of this blog, where I expand on this!
- Folder - Outgoing: The path to the outgoing folder on the SFTP Server. I will use “/data/outgoing” in this example. It allows us to parameterize the SFTP Operation to make it generic.

<strong>Step 2: The Authentication Token</strong>

As I mentioned, we’ll place a Connector on the canvas after creating the process with a “No Data” start shape (this is just a personal choice, I like all my connectors looking like British plugs).

The Connector should be configured as follows:

- Connector is an HTTP GET Client
- Connection uses URL: https://123-ABC-456.mktorest.com (note no /rest at the end so that we can use this for REST calls as well as using it to get the identity access token.. and change 123-ABC-456 to the right one for your Marketo instance)
- Operation is "Get oAuth Token” (new!)
- Request Profile = None
- Response Profile = JSON
- New Profile called "Authentication Token Response”
- Content Type: Plain
- HTTP Method: GET
- Resource Path (add 4 without quotation marks): "identity/oAuth/token?grant_type=client_credentials&amp;client_id="; "ClientID (Replacement variable)"; "&amp;client_secret="; "ClientSecret (Replacement variable)"
- Set Parameters under Configure —&gt; Parameters —&gt;(+): Set ClientID = Process Property Client ID; Set ClientSecret = Process Property Client Secret

After this, store the success token in the Process Properties “AccessToken” variable as shown, extracting it from the jSON response.

<a href="https://marketohost.wpengine.com/wp-content/uploads/2015/01/boomi3.png"><img class="size-full wp-image-3368 alignnone" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2015/01/boomi3.png" alt="boomi3" width="356" height="294" /></a>

The pattern for this step will be repeated for the next steps, but using new operations with different jSON return profiles. In fact, many of the REST calls will be dealt with in the same way with minor changes!

In the next installment we’ll expand on this and get a list of leads from a static list using REST!

For now, run the process, but put a stop shape after your “Set Properties” then run in debug to make sure you see the same token that you see in Marketo. They should match up perfectly!<br/><br/>JMattos - 2015-01-26<br/><br/><h2>Use a Google Font API to Add a Custom Font to a Marketo Landing Page</h2><br/><br/><strong>Note: This is a blog post by <a href="https://www.linkedin.com/in/murtzam">Murtza Manzur</a>. Murtza is a Marketo Developer Evangelist based out of the San Francisco Bay Area.</strong>

Let's say you are creating a landing page in Marketo and would like to use a custom font. This is possible using Google Font API.

Step One: Choose y

<strong>Step Two: Add a import method to your CSS file with reference to Google Fonts </strong>
<script type="text/javascript" src="https://google-code-prettify.googlecode.com/svn/loader/run_prettify.js"></script>
<pre class="prettyprint lang-js">
@import url(http://fonts.googleapis.com/css?family=Open+Sans:400,300,600);
</pre>

Step Two<br/><br/>MManzur - 2015-01-26<br/><br/><h2>Capitalize a Lead's First Name Using Email Scripting</h2><br/><br/>Let's say a lead enters their name in lowercase, such as "john doe". But when you send out an email campaign, you would like to capitalize the lead's name in the email, like John Doe. You can capitalize a lead's name using email scripting. Here's how to do this.

<strong>Step One: In your email program, click the "My Tokens" tab. </strong>

<a href="https://marketohost.wpengine.com/wp-content/uploads/2015/01/Screen-Shot-2015-01-26-at-12.13.44-PM.png"><img class="alignleft size-large wp-image-3406" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2015/01/Screen-Shot-2015-01-26-at-12.13.44-PM-1024x275.png" alt="Screen Shot 2015-01-26 at 12.13.44 PM" width="1024" height="275" /></a>

<strong>Step Two: Create a new email script token by dragging "Email Script" from right panel to the middle panel. Name the token.</strong>

<a href="https://marketohost.wpengine.com/wp-content/uploads/2015/01/Screen-Shot-2015-01-26-at-12.15.04-PM.png"><img class="alignleft size-full wp-image-3414" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2015/01/Screen-Shot-2015-01-26-at-12.15.04-PM.png" alt="Screen Shot 2015-01-26 at 12.15.04 PM" width="303" height="282" /></a>

<a href="https://marketohost.wpengine.com/wp-content/uploads/2015/01/Screen-Shot-2015-01-26-at-12.16.25-PM.png"><img class="alignleft size-large wp-image-3408" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2015/01/Screen-Shot-2015-01-26-at-12.16.25-PM-1024x26.png" alt="Screen Shot 2015-01-26 at 12.16.25 PM" width="1024" height="26" /></a>

<strong>Step Three: In the Edit Script Token text box, paste the code below. In the right panel, under Lead object, select the First Name checkbox. Then click Save.</strong>

<script src="https://google-code-prettify.googlecode.com/svn/loader/run_prettify.js" type="text/javascript"></script>
<pre class="prettyprint lang-js">#set($name = ${lead.FirstName})
#set($formattedFirstName = $name.substring(0).toUpperCase())
$formattedFirstName
</pre>
<a href="https://marketohost.wpengine.com/wp-content/uploads/2015/01/Screen-Shot-2015-01-26-at-12.16.02-PM.png"><img class="alignleft size-full wp-image-3412" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2015/01/Screen-Shot-2015-01-26-at-12.16.02-PM.png" alt="Screen Shot 2015-01-26 at 12.16.02 PM" width="900" height="579" /></a>

<a href="https://marketohost.wpengine.com/wp-content/uploads/2015/01/Screen-Shot-2015-01-26-at-12.22.37-PM.png"><img class="alignleft size-full wp-image-3422" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2015/01/Screen-Shot-2015-01-26-at-12.22.37-PM.png" alt="Screen Shot 2015-01-26 at 12.22.37 PM" width="248" height="212" /></a>

<strong>Step Four: Reference the token in your email asset.</strong>

<a href="https://marketohost.wpengine.com/wp-content/uploads/2015/01/Screen-Shot-2015-01-26-at-12.26.53-PM.png"><img class="alignleft size-full wp-image-3424" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2015/01/Screen-Shot-2015-01-26-at-12.26.53-PM.png" alt="Screen Shot 2015-01-26 at 12.26.53 PM" width="493" height="423" /></a>

<a href="https://marketohost.wpengine.com/wp-content/uploads/2015/01/Screen-Shot-2015-01-26-at-12.25.08-PM.png"><img class="alignleft size-large wp-image-3426" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2015/01/Screen-Shot-2015-01-26-at-12.25.08-PM.png" alt="Screen Shot 2015-01-26 at 12.25.08 PM" width="453" height="257" /></a>

<a href="https://marketohost.wpengine.com/wp-content/uploads/2015/01/Screen-Shot-2015-01-26-at-12.25.15-PM.png"><img class="alignleft size-large wp-image-3428" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2015/01/Screen-Shot-2015-01-26-at-12.25.15-PM.png" alt="Screen Shot 2015-01-26 at 12.25.15 PM" width="924" height="622" /></a>

<a href="https://marketohost.wpengine.com/wp-content/uploads/2015/01/Screen-Shot-2015-01-26-at-12.25.44-PM.png"><img class="alignleft size-large wp-image-3430" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2015/01/Screen-Shot-2015-01-26-at-12.25.44-PM.png" alt="Screen Shot 2015-01-26 at 12.25.44 PM" width="442" height="237" /></a>

It will output the first name of the lead with the first letter capitalized. For more information about email scripting, please visit the <a href="http://developers.marketo.com/documentation/email-scripting/">email scripting documentation</a>.<br/><br/>MManzur - 2015-01-26<br/><br/><h2>Get All Leads from the Marketo REST API</h2><br/><br/>There was a <a href="http://stackoverflow.com/q/28184900/3639923">question on StackOverflow asking how to get a list of all leads from Marketo through the REST API</a>. You can query this data using the <a href="/documentation/rest/get-multiple-leads-by-filter-type/">Get Multiple Leads by Filter Type REST API endpoint</a>.

Leads in Marketo are assigned lead ids in sequential order starting with 1. Using the <a href="/documentation/rest/get-multiple-leads-by-filter-type/">Get Multiple Leads by Filter Type REST API endpoint</a>, you can query 300 leads by lead id with each call. You would have to specify id as the filterType and the lead ids as the filterValues with each call to this endpoint.

To get all leads, you would iterate through the total number of leads 300 at a time. You can get the total count of leads in a Marketo instance through the Marketo UI.

In the Marketo UI, go to the Lead Database tab, click on System Smart Lists, click on All Leads Smart List, and then finally click on the "Leads" tab. Then click on the Id column and sort descending. After leads are sorted, the id of the first lead will be the upper bound for leads id when you are querying all leads.

<a href="https://marketohost.wpengine.com/wp-content/uploads/2015/01/Screen-Shot-2015-02-12-at-3.08.02-PM.png"><img class="size-full wp-image-3738 alignnone" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2015/01/Screen-Shot-2015-02-12-at-3.08.02-PM.png" alt="Screen Shot 2015-02-12 at 3.08.02 PM" width="453" height="276" /></a>

If you do not have access to the Marketo UI to get the total count of leads, there is an <a href="http://stackoverflow.com/questions/28419967/get-all-leads-programmatically-in-marketo-v1">alternate approach to get this value using the Get Lead Activities REST API</a>.

<strong>Step One: First API Call</strong>

<script src="https://google-code-prettify.googlecode.com/svn/loader/run_prettify.js" type="text/javascript"></script>
<pre class="lang:default decode:true prettyprint lang-js">//replace ... with all the values in between
/rest/v1/leads.json?filterType=Id&amp;filterValues=1,2,3,...,298,299,300
</pre>
Here is sample code in Ruby for the first call.
<pre class="lang:default decode:true prettyprint lang-rb">require 'rest_client'
require 'json'

#Build request URL
#Replace AAA-BBB-CCC with your Marketo instance
marketo_instance = "https://AAA-BBB-CCC.mktorest.com"
endpoint = "/rest/v1/leads.json"
#Replace with your access token
auth_token =  "?access_token=" + "ac756f7a-d54d-41ac-8c3c-f2d2a39ee325:ab"
#Replace with filter type and values
ids_needed = (1..300).to_a.join(",")
filter_type_and_values = "&amp;filterType=Id&amp;filterValues=" + ids_needed
request_url = marketo_instance + endpoint + auth_token + filter_type_and_values

#Make request
response = RestClient.get request_url

#Returns Marketo API response
puts response
</pre>
<strong>Step Two: Subsequent API Calls</strong>

The second API call, and each subsequent API call would follow the same pattern until the total count of leads is reached:
<pre class="lang:default decode:true prettyprint lang-js ">//replace ... with all the values in between
/rest/v1/leads.json?filterType=Id&amp;filterValues=301,302,303,...,598,599,600
</pre>
For more information, please see the <a href="http://developers.marketo.com/documentation/rest/get-multiple-leads-by-filter-type">REST API documentation</a>.<br/><br/>MManzur - 2015-01-28<br/><br/><h2>Execute Form Submission Actions from Iframe to Parent Page</h2><br/><br/>We have seen a few cases where users use iframe forms and want to direct visitors that filled in the form to a thank you page or PDF, video, etc.

The problem is that since the form is embedded on a landing page which is different from the parent one, the action happens only on the inner page where the form is.

To solve that, below are 2 Javascript tags we created. Insert in as an HTML element to your iframe pages or directly to the landing page template you use for iframes. Place it before the last &lt;/body&gt; tag.

The first tag will perform the action on the parent page and the second tag will open it in a new tab.

<strong>Form Action on a Parent Page</strong>
<pre class="lang:default decode:true prettyprint lang-js">&lt;script&gt;
MktoForms2.whenReady(function (form){
form.onSuccess(function (values, url){
window.parent.location.assign(url);
return false;
           });
});
&lt;/script&gt;
</pre>
<strong>Form Action in a New Tab</strong>
<pre class="lang:default decode:true prettyprint lang-js">&lt;script&gt;
MktoForms2.whenReady(function (form){
var newWin;
form.onSubmit(function (){
newWin = window.open('about:blank', 'myWindow');
});
form.onSuccess(function (values, url){
newWin.location.replace(url);
return
 false;
});
});
&lt;/script&gt;
</pre><br/><br/>YCalisar - 2015-02-02<br/><br/><h2>Send View Data from a YouTube Video to Marketo</h2><br/><br/>Let's say you want to segment leads in Marketo based on if they have a started or finished a specific video. This is possible to do using Munchkin, YouTube's Iframe API, and Smart Lists in Marketo.

The example code in this post will let you to send video started and video finished events into Marketo through Munchkin. For this to work, Munchkin must also be loaded on the page before you can start sending video view events into Marketo.

The video started and finished will show up on the lead's activity log as shown in the first and second screenshot below.

<a href="https://marketohost.wpengine.com/wp-content/uploads/2015/02/Screen-Shot-2015-02-02-at-5.30.30-PM-1.png"><img class="size-full wp-image-3551 alignnone" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2015/02/Screen-Shot-2015-02-02-at-5.30.30-PM-1.png" alt="Screen Shot 2015-02-02 at 5.30.30 PM" width="683" height="478" /></a>

<a href="https://marketohost.wpengine.com/wp-content/uploads/2015/02/Screen-Shot-2015-02-02-at-5.30.45-PM-1.png"><img class="size-large wp-image-3553 alignnone" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2015/02/Screen-Shot-2015-02-02-at-5.30.45-PM-1.png" alt="Screen Shot 2015-02-02 at 5.30.45 PM" width="682" height="483" /></a>

After the data is in Marketo, you can then create a smart list and segment leads that have started or finished a video, as shown in the screenshot below.

<a href="https://marketohost.wpengine.com/wp-content/uploads/2015/02/Screen-Shot-2015-02-02-at-5.37.51-PM-1.png"><img class="size-full wp-image-3557 alignnone" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2015/02/Screen-Shot-2015-02-02-at-5.37.51-PM-1.png" alt="Screen Shot 2015-02-02 at 5.37.51 PM" width="829" height="188" /></a>

<strong>Step One: Get the id of the YouTube video you want to embed.</strong>
From the URL of the YouTube video you would like to use, note the id, which is the series of random characters after "v=".

<a href="https://marketohost.wpengine.com/wp-content/uploads/2015/02/Screen-Shot-2015-02-02-at-5.47.02-PM.png"><img class="size-full wp-image-3573 alignnone" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2015/02/Screen-Shot-2015-02-02-at-5.47.02-PM.png" alt="Screen Shot 2015-02-02 at 5.47.02 PM" width="861" height="608" /></a>

<strong>Step Two: Place YouTube video id from Step One in the eighth line of this code sample. Then place the code before the &lt;/body&gt; in the HTML of your page.</strong>
<script src="https://google-code-prettify.googlecode.com/svn/loader/run_prettify.js" type="text/javascript"></script>
<pre class="lang:default decode:true prettyprint lang-js">&lt;div id="player"&gt;&lt;/div&gt;
&lt;script&gt;
var tag = document.createElement('script');
tag.src = "https://www.youtube.com/iframe_api";
document.getElementsByTagName('head')[0].appendChild(tag);

//Change 'iiqxcjxJ5Us' to video needed
var player, videoId = 'iiqxcjxJ5Us';
function onYouTubeIframeAPIReady() {
player = new YT.Player('player', {
height: '390',
width: '640',
videoId: videoId,
events: {
'onStateChange': onPlayerStateChange
}
});
}

function onPlayerStateChange(event) {
switch( event.data ) {
//Send video started event to Marketo
case YT.PlayerState.PLAYING: Munchkin.munchkinFunction('visitWebPage', {
url: '/video/'+videoId
, params: 'video=started'
}
);
break;
//Send video finished event to Marketo
case YT.PlayerState.ENDED: Munchkin.munchkinFunction('visitWebPage', {
url: '/video/'+videoId
, params: 'video=finished'
}
);
break;
}

}
&lt;/script&gt;
</pre>
<strong>Step Three: Create a Smart List in Marketo with the URL of the video and the view event you are looking for as the value of "Querystring contains". </strong>
<a href="https://marketohost.wpengine.com/wp-content/uploads/2015/02/Screen-Shot-2015-02-02-at-5.37.51-PM-1.png"><img class="size-full wp-image-3557 alignnone" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2015/02/Screen-Shot-2015-02-02-at-5.37.51-PM-1.png" alt="Screen Shot 2015-02-02 at 5.37.51 PM" width="829" height="188" /></a>

<a href="/wp-content/uploads/2015/02/video1.html" target="_blank">Here is a page with a working example</a> of the implementation below.

For more information about YouTube Iframe API, <a href="https://developers.google.com/youtube/iframe_api_reference">please visit YouTube's API documentation</a>. For more information about Munchkin, <a href="/javascript-api/lead-tracking/">please review the Marketo developer documentation</a>.<br/><br/>MManzur - 2015-02-02<br/><br/><h2>Marketo SOAP API Tips and Tricks</h2><br/><br/><strong>NOTE: This is a guest blog post. <a href="https://www.linkedin.com/profile/view?id=2777965">Ed Blachman is a Senior Architect</a> at <a href="https://launchpoint.marketo.com/tibco/1389-tibco-activematrixtm-businessworks-6/">TIBCO Software, a well-known vendor of enterprise software</a>. Ed is working on products that allow what Gartner calls “citizen developers” to integrate the cloud services they use without needing to do any programming themselves.</strong>

<a href="/soap-api/">Marketo’s SOAP API</a> is a powerful tool by which developers can harness the power of Marketo and integrate it with our own applications. Between <a href="/getting-started/">the formal documentation</a> and <a href="https://community.marketo.com/">the community resources</a>, there’s a lot of information available regarding how to use it. When I was getting started, I leaned heavily on that information and found it invaluable. However, in that process, I built up some tips and tricks that I hadn’t seen in any of those places. Here’s some of what I figured out.

<strong>The Developers’ Sandbox</strong>
The Sandbox is, of course, a wonderful resource for API developers: a safe place in which you can experiment with Marketo features, adding and removing objects without interfering with real marketing activities carried on by your organization’s actual Marketo users. However, the Sandbox is not a panacea. For example, I needed to share our Sandbox with another development group, and this took some doing, because they had gotten accustomed to the notion that they owned the Sandbox. Eventually, we figured out a couple of Best Practices for sharing:

- Don’t write tests that depend on complete knowledge of the contents of your Sandbox. As a shared resource, schemas may be subject to change without notice, as well as entire entries in your leads database or programs or other entities. If your tests assume complete knowledge of the Sandbox, your development cycle will create blackout periods for the groups with whom you’re sharing it. Since typically their development cycle will not coincide with yours, this amounts to hogging the resource–not cool. It’s also not necessary, if you think it through.

- Do use a convention to label all of your stuff–your leads, your lead schema fields, your programs, whatever. If you each can identify your own objects, and if you can agree with your co-tenants that each of you will leave the others’ objects alone, you should be on a firm foundation for sharing. For leads, you could create a custom field, and create a convention using this custom field to identify these leads as your test leads. For lists or programs, you might start the names of your objects with some string that identifies those objects as belonging to you.

- Consider writing tests that clean up after themselves–that first create the objects you’re interested in, then access or update or selectively delete them, then finally remove them. (Note that this is not achievable 100% in the SOAP API because not everything in the Sandbox, or in a real instance for that matter, can be managed via the SOAP API. Even so, it’s still worthwhile to do this as much as you can.)

<strong>Real Instances</strong>
The problem with the Sandbox is that it’s not being used in production, so it’s difficult to get a sense of what real usage looks like in a Marketo instance. Now, if you’re lucky enough to have a Marketo power user on your team, or if you’re doing bespoke development for internal Marketo users, that’s not such a problem. But in the case of my team, it was a big deal indeed. None of us were Marketo experts, and since we were being asked to understand a large number of cloud services, we just didn’t have the headcount to become experts in anything. Here are some of the insights we gleaned from access to a real instance:

- Large lead schemas. The lead schema in the production instance we accessed has over 200 fields. That made it crystal clear to our UI designers that the UI they were designing had to accommodate schemas of that size (or larger).

- Bursty usage. We saw two orders of magnitude difference between the highest-usage times and low-usage times (in terms of numbers of leads created or updated). This impacted both the volume of data we’d get back from API calls (obvious) and the time it would take for an API call to respond (possibly less obvious).

<strong>API Call Response Time</strong>
Depending on the time of day, the details of your API call, and the contents of your instance, you may find the SOAP API’s response time will take longer than average. On occasion, we had API calls that took a minute and a half to respond. You need to be aware of the possibility in order to deal with it:

- Test. Maybe this is not a problem for your usage. But don’t just assume that, do some testing.

- Tweak your usage. In our case, the biggest issue was that we set the page size for our calls to <a href="/soap-api/getmultipleleads/">getMultipleLeads</a> to be as big as the API allows. In our context, that makes a certain amount of sense, because our goal is to be as efficient as possible with our customer's API quota. But in your context, you may not need to worry so intensely about your users’ API call quotas, in which case you’ll definitely get better response time by asking for smaller pages of data.

<strong>Lead Partitioning</strong>
Marketo provides powerful tools–partitions and workspaces–that allow multiple marketing groups to share a single Marketo instance. However, those tools aren’t reflected directly in the SOAP API. For instance, when you use getMultipleLeads to get all leads that have been updated or created since some datetime, you get back all the leads in your instance for which that’s the case, without regard for (and with nothing to indicate) which partition or workspace contains any given lead. Lead creation and adding leads to lists are other contexts in which lead partitioning may impact what your API calls actually do. Note that this means that partitions and workspaces may not be the solution you’ll need to the problem of Sandbox sharing discussed above.

So how do you figure out whether this is an issue for you? I’ve found all of these to be helpful:

- <a href="http://developers.marketo.com/support/overview/">Marketo Developer Support</a>. The Developer Evangelists are committed to our success in using the APIs, and where there are questions, they’re amazingly good at working to find answers.

- <a href="/getting-started/">API Documentation</a>. The Evangelists have already brought this issue into some of the documentation, and as part of their commitment to our success, they’re really good about updating the doc.

- Your Own Test Cases. Although using partitions and workspaces for sharing the sandbox may not be a great idea, the Sandbox is a great place to play with partitions and workspaces to figure out whether they pose challenges for your intended usage. (It’s also a good way to narrow down your questions for the Evangelists, which is always a good idea.)

<strong>TIMTOWTDI and Testing</strong>
“There is more than one way to do it”–the Perl programming motto–actually applies in certain contexts to the Marketo SOAP API. For instance, I wanted to combine updating a set of leads with adding those leads to some list. The SOAP API gives you two ways to do this:

1. <a href="/soap-api/importtolist/">importToList</a> + <a href="/soap-api/getimporttoliststatus/">getImportToListStatus</a>. Reading the documentation, this is obviously the “normal” way to do this. However, the fact that you have to poll for the status of your import operation raised a yellow flag for me. Was this really the way I wanted to implement my import?

2. <a href="/soap-api/syncmultipleleads/">syncMultipleLeads</a> + <a href="/soap-api/listoperation/">listOperation</a>. This seems much less elegant than a unitary importToList call, but it doesn’t rely on polling. Was it a viable option?

Cases like these are hard for the Evangelists to deal with, because they really depend on the nature of the instances that you’re dealing with and exactly what you’re trying to do. Luckily, if you’ve set up a robust unit testing environment, you should be able to use it to explore questions like these as well. In this particular case, it turned out that option 2 was better for my use case than option 1–not because of the polling but rather because I ran into field-oriented limitations on importToList, and also because I was trying to write code that could be used in contexts and instances over which I had no control. But your use case may be different–and testing is the only way you’ll find out.

<strong>Conclusion</strong>
I don’t think any of this is a huge secret. On the other hand, I’d have been ahead of the game if I’d known all this before I got started. I hope you find it useful.<br/><br/>deverly - 2015-02-05<br/><br/><h2>Using the Marketo REST API with Boomi: Getting and Deleting Leads from a Static List</h2><br/><br/><a href="/blog/using-the-marketo-rest-api-with-boomi-getting-and-storing-a-rest-authentication-token/">In part 1 of this series</a>, I discussed how it was possible to start using the REST API through Boomi with the Boomi HTTP connector, specifically getting the authentication token needed to access the REST API, and storing it in a Process Variable.

Next up, we’ll begin making calls into Marketo, and in this installment, I’ll show you how you can both <a href="/documentation/rest/get-multiple-leads-by-list-id/">Get Multiple Leads By List ID</a> and <a href="/documentation/rest/remove-leads-from-list/">Remove Leads from List</a>. Pay particular attention to the removal of leads from a list because there is a very “lightly documented” and subtle aspect of Boomi at work there that I’ll expand on when we get there.

In out NEXT installment we’ll expand on this functionality to start doing interesting things like getting Lead activity, but that’s a blog for another day.

<a href="https://marketohost.wpengine.com/wp-content/uploads/2015/02/boomi1.png"><img class="size-large wp-image-3631 alignnone" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2015/02/boomi1-1024x537.png" alt="boomi1" width="1024" height="537" /></a>

For this installment we’ll be looking at the second and third highlighted areas.

As a review, I’ve included the JSON responses we’ll be needing below. Recall that to create a JSON profile in Boomi, all you need to do is create a profile component of type JSON, and click “import” and select the file. Boomi does the rest, extrapolating things like if there should be multiple IDs allowed.

Example JSON for <a href="/documentation/rest/get-multiple-leads-by-list-id/">Get Multiple Leads By List ID </a>
<pre class="lang:default decode:true prettyprint lang-js">{
  "requestId": "",
  "success": true,
  "nextPageToken": "",
  "result": [
    {
      "id": 0,
      "email": "",
      "firstName": "",
      "lastName": ""
    },
    {
      "id": 0,
      "email": "",
      "firstName": "",
      "lastName": ""
    },
    {
      "id": 0,
      "email": "",
      "firstName": "",
      "lastName": ""
    }
  ]
}
</pre>
Example JSON for <a href="/documentation/rest/remove-leads-from-list/">Remove Leads from List Request</a>
<pre class="lang:default decode:true prettyprint lang-js">{
   "input":[
      {
         "id": ""
      },
      {
         "id": ""
      }
   ]
}
</pre>
Example JSON for <a href="/documentation/rest/remove-leads-from-list/">Remove Leads from List Response</a>
<pre class="lang:default decode:true prettyprint lang-js">{
  "requestId": "",
  "success": true,
  "result": [
    {
      "id": 1,
      "status": ""
    },
    {
      "id": 2,
      "status": "",
      "reasons": [
        {
          "code": "",
          "message": ""
        }
      ]
    }
  ]
}
</pre>
<strong>Step 1: The Get Multiple Leads by List ID</strong>

Drop another connector (Get) into your process, using the same connection as defined in the previous article.

Create a new operation called “Get Multiple Leads by List ID” (I’m a stickler for consistency) It’s attributes are as follows
- Request Profile: None (this one uses the request URL)
- Response Profile Type: jSON
- Response Profile: Create a new profile based on the Get Multiple Leads by List ID Response above.

Note that you can change it so that it returns the fields you want, not just the ones listed. Its important to remember that the JSON response profile should really match the list of fields you’re asking for from the REST API, and you should request only the fields you need. In the Process Properties object, we defined a property called “fields” which is a comma separated list of the fields you want REST to return.. and that’s the list that has to match the profile.
Content Type: text/plain (this is just a URL request)
HTTP Method: GET (you look this up in the REST API docs, its always listed)
Resource Path (add 5)
rest/v1/list/
listID (replacement variable)
/leads.json?access_token=
access_token (replacement variable)
&amp;fields=
fields (replacement variable)

<a href="https://marketohost.wpengine.com/wp-content/uploads/2015/02/booomi2.png"><img class="size-full wp-image-3637 alignnone" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2015/02/booomi2.png" alt="booomi2" width="643" height="936" /></a>

Then in the parameters tab on the connector, you can enter the variable values, all of which we previously populated into the process properties. In the next section I’ll talk about how you can avoid populating these manually

<a href="https://marketohost.wpengine.com/wp-content/uploads/2015/02/boomi3.png"><img class="size-full wp-image-3639 alignnone" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2015/02/boomi3.png" alt="boomi3" width="564" height="386" /></a>

Im going to skip the part of the process where I map the response for Get Multiple Leads by List Id into a flat file profile and stick it on an FTP server because that’s straightforward Boomi functionality.

<strong>Step 2: Delete Leads from a List</strong>
So this one is interesting, one of my coworkers, <a href="https://www.linkedin.com/profile/view?id=7429494">Ken Niwa</a> taught me this next technique and it’s pretty cool and based on a Boomi article titled "How to Build a POST Request for a RESTful Application”, shown below.

<a href="https://marketohost.wpengine.com/wp-content/uploads/2015/02/boomi4.png"><img class="size-large wp-image-3641 alignnone" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2015/02/boomi4-1024x695.png" alt="boomi4" width="1024" height="695" /></a>

<a href="https://marketohost.wpengine.com/wp-content/uploads/2015/02/boomi5.png"><img class="size-large wp-image-3643 alignnone" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2015/02/boomi5-1024x695.png" alt="boomi5" width="1024" height="695" /></a>

...but first things first. In the process, coming out of the “Get Multiple Leads by List Id” we have the Get Multiple Leads by List Id Response shape, and we need to map that into the "Remove Leads from List Request” that mapping is fairly simple, just mapping the id we got from the leads in the original list into the id list we’re passing into the delete jSON.

<a href="https://marketohost.wpengine.com/wp-content/uploads/2015/02/boomi6.png"><img class="size-full wp-image-3645 alignnone" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2015/02/boomi6.png" alt="boomi6" width="709" height="738" /></a>

Next, drop another Connector with an action of “Send”, using the same Connection

Create a new operation called "Remove Leads from List Request”.. whose attributes are
Request Profile: jSON
Content Type: application/json
Request Profile: [JSON Profile] Remove Leads from List Request (created from the above file)

Response Profile Type: jSON
Response Profile: [JSON Profile] Remove Leads From List Response (created from the above file)
Content Type: application/json

HTTP Method: DELETE
Resource Path (add 4)
rest/v1/lists/
listID (replacement variable)
/leads.json?access_token=
access_token (replacement variable)

Here’s the interesting thing about this connector. We’re NOT going to explicitly add the parameters in the connector tab. Instead, as the article states, we’ll create dynamic document properties that have the same names as the replacement variables. In this case, those variables listID and access_token. When you do this, the jSON shape will flow into the REST call and the parameters will appear in their proper place on the URL. We can’t do this with the previous call because it’s a GET not a POST.

<a href="https://marketohost.wpengine.com/wp-content/uploads/2015/02/boomi7.png"><img class="size-full wp-image-3647 alignnone" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2015/02/boomi7.png" alt="boomi7" width="753" height="985" /></a>

So at this point you’ve seen a GET and a POST REST API call and you can start to see the pattern for making these REST calls. In the next installment we'll start looking at Lead Activity export through the REST API, which is a bit more involved.<br/><br/>JMattos - 2015-02-06<br/><br/><h2>Embed a YouTube Video with Lead Tracking on a Marketo Landing Page</h2><br/><br/><a href="/blog/send-view-data-from-a-youtube-video-to-marketo/">In a previous blog post</a>, I described how to segment leads in Marketo based on if they have a started or finished a specific YouTube video. In this blog post, we'll walk through how to take the implementation from that post and use it on a Marketo landing page.

<strong><a href="https://marketohost.wpengine.com/wp-content/uploads/2015/02/youtube0.png"><img class="size-full wp-image-3716 alignnone" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2015/02/youtube0.png" alt="youtube0" width="240" height="207" /></a></strong>

Step One: Navigate to the Program in Marketo where you want to create the new landing page. Click New Local Asset, and then click Landing Page.

<a href="https://marketohost.wpengine.com/wp-content/uploads/2015/02/youtube1.png"><img class="size-full wp-image-3692 alignnone" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2015/02/youtube1.png" alt="youtube1" width="749" height="391" /></a>

<strong>Step Two: Name the landing page. Assign a page URL. Select a template. Then click Create.</strong>

<a href="https://marketohost.wpengine.com/wp-content/uploads/2015/02/youtube2.png"><img class="size-large wp-image-3694 alignnone" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2015/02/youtube2.png" alt="youtube2" width="633" height="519" /></a>

<strong>Step Three: After the landing page is created, click Edit Draft.</strong>

<a href="https://marketohost.wpengine.com/wp-content/uploads/2015/02/youtube3.png"><img class="size-full wp-image-3696 alignnone" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2015/02/youtube3.png" alt="youtube3" width="450" height="225" /></a>

<strong>Step Four: From the right panel, drag the HTML button to the main canvas on the left.</strong>

<a href="https://marketohost.wpengine.com/wp-content/uploads/2015/02/youtube4.png"><img class="size-full wp-image-3698 alignnone" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2015/02/youtube4.png" alt="youtube4" width="249" height="245" /></a>

<strong>Step Five: In the Custom HTML Editor box that pops up, <a href="/blog/send-view-data-from-a-youtube-video-to-marketo/">insert the code generated from this blog post in the box</a>. Then click Save.</strong>

<a href="https://marketohost.wpengine.com/wp-content/uploads/2015/02/youtube5.png"><img class="size-full wp-image-3700 alignnone" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2015/02/youtube5.png" alt="youtube5" width="662" height="523" /></a>

<strong>Step Six: Adjust size of HTML element by dragging the box outline. Then click Approve and Close.</strong>

<a href="https://marketohost.wpengine.com/wp-content/uploads/2015/02/youtube6.png"><img class="size-full wp-image-3702 alignnone" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2015/02/youtube6.png" alt="youtube6" width="763" height="606" /></a>

<a href="https://marketohost.wpengine.com/wp-content/uploads/2015/02/youtube7.png"><img class="size-large wp-image-3704 alignnone" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2015/02/youtube7.png" alt="youtube7" width="977" height="658" /></a>

<strong>Step Seven: Test the live version of the landing page by clicking View Approved Page.</strong>

<a href="https://marketohost.wpengine.com/wp-content/uploads/2015/02/youtube8.png"><img class="size-full wp-image-3710 alignnone" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2015/02/youtube8.png" alt="youtube8" width="595" height="711" /></a>

A landing page with the YouTube will open in a new window.

<a href="https://marketohost.wpengine.com/wp-content/uploads/2015/02/youtube9.png"><img class="size-large wp-image-3712 alignnone" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2015/02/youtube9.png" alt="youtube9" width="776" height="501" /></a>

The video started and finished will show up on the lead's activity log as shown in the first and second screenshot below.

<a href="https://marketohost.wpengine.com/wp-content/uploads/2015/02/Screen-Shot-2015-02-02-at-5.30.30-PM.png"><img class="size-full wp-image-3551 alignnone" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2015/02/Screen-Shot-2015-02-02-at-5.30.30-PM.png" alt="Screen Shot 2015-02-02 at 5.30.30 PM" width="683" height="478" /></a>

<a href="https://marketohost.wpengine.com/wp-content/uploads/2015/02/Screen-Shot-2015-02-02-at-5.30.45-PM.png"><img class="size-large wp-image-3553 alignnone" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2015/02/Screen-Shot-2015-02-02-at-5.30.45-PM.png" alt="Screen Shot 2015-02-02 at 5.30.45 PM" width="682" height="483" /></a>

After the data is in Marketo, you can then create a smart list and segment leads that have started or finished a video, as shown in the screenshot below.

<a href="https://marketohost.wpengine.com/wp-content/uploads/2015/02/Screen-Shot-2015-02-02-at-5.37.51-PM.png"><img class="size-full wp-image-3557 alignnone" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2015/02/Screen-Shot-2015-02-02-at-5.37.51-PM.png" alt="Screen Shot 2015-02-02 at 5.37.51 PM" width="829" height="188" /></a>

For more information about YouTube Iframe API, <a href="https://developers.google.com/youtube/iframe_api_reference">please visit YouTube's API documentation</a>. For more information about Munchkin, <a href="/javascript-api/lead-tracking/">please review the Marketo developer documentation</a>.<br/><br/>MManzur - 2015-02-09<br/><br/><h2>Single Page Application Web Tracking with Munchkin</h2><br/><br/>A Single Page Application is a website that loads all of the resources required to navigate the site on the first page load. When a user clicks a link the content is loaded from the first page load data. To the user, the website behaves as expected because the URL in the address bar is like the traditional page navigation.

Munchkin works well with traditional websites because Munchkin runs every single time the users load a new page. However, with a single page application if you are not loading a new page, Munchkin will run only once.

The approach I'll walk through in this post is to track when a user clicks on a link, and then send this information to Munchkin. We'll implement this using the clickLink Munchkin function. Below is an example implementation in jQuery that binds for click events to the clickLink Munchkin method. When calling the clickLink Munchkin method it passes the parameter for the URL that was clicked.
<pre class="lang:default decode:true prettyprint lang-js ">&lt;script&gt;
$("a").on('click', function(event) {
    var urlThatWasClicked = $(this).attr('href');
    Munchkin.munchkinFunction('clickLink', { href: urlThatWasClicked});
});
&lt;/script&gt;
</pre><br/><br/>MManzur - 2015-02-11<br/><br/><h2>Change a Lead's Score via the REST API</h2><br/><br/>Let's say you want to change a lead's score in Marketo using the APIs. This is possible to do with the REST API using the <a href="/documentation/rest/createupdate-leads/">Create/Update Lead endpoint</a>.

Below is a code sample in Ruby that shows how to make this call.
<pre class="lang:default decode:true prettyprint lang-rb">require 'rest_client'
require 'json'

#Build request URL
#Replace AAA-BBB-CCC with your Marketo instance
marketo_instance = "https://AAA-BBB-CCC.mktorest.com"
endpoint = "/rest/v1/leads.json"
#Replace with your access token
auth_token =  "?access_token=" + "ac756f7a-d54d-41ac-8c3c-f2d2a39ee325:ab"
request_url = marketo_instance + endpoint + auth_token

#Build request body
data = { "action" =&gt; "updateOnly", "input" =&gt; [ { "email" =&gt; "example@email.com", "leadScore" =&gt; "30" } ] }

#Make request
response = RestClient.post request_url, data.to_json, :content_type =&gt; :json, :accept =&gt; :json

#Returns Marketo API response
puts response
</pre>
In the JSON body of the request, we specify updateOnly as the action. This means the request will only work if the lead exists, otherwise it will fail. If you want to create a lead if one does not exist, then specify createOrUpdate as the action.

We use the lead's email as the primary identifier to find the lead record in Marketo. Finally, we specify the value for the lead's score using the key leadScore.

It possible to update 300 leads at time using this method. For more information, please see the <a href="/documentation/rest/createupdate-leads/">Create/Update Lead endpoint</a>.<br/><br/>MManzur - 2015-02-19<br/><br/><h2>Highlighting Open Source Projects Built on the Marketo Platform: Part Three</h2><br/><br/>This is the third post in an ongoing series highlighting open-source projects built around the Marketo platform by the developer community. The <a href="/blog/highlighting-open-source-projects-built-on-the-marketo-platform/">first post in this series is available here</a>, and the <a href="/blog/highlighting-open-source-projects-built-on-the-marketo-platform-part-two/">second post is available here</a>.

We maintain <a href="https://github.com/Marketo/Community-Supported-Client-Libraries">a list on Marketo's GitHub account</a> where we track client libraries and projects created by the Marketo developer community. Below are three projects developed around the Marketo REST APIs.

<strong><a href="http://www.usermind.com/">Usermind</a> created <a href="https://github.com/usermindinc/node-marketo">a Node.js client library for the Marketo REST API</a>.</strong>

<a href="https://marketohost.wpengine.com/wp-content/uploads/2015/02/Screen-Shot-2015-02-19-at-5.07.43-PM.png"><img class="alignleft size-large wp-image-3811" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2015/02/Screen-Shot-2015-02-19-at-5.07.43-PM-1024x617.png" alt="Screen Shot 2015-02-19 at 5.07.43 PM" width="1024" height="617" /></a>

<strong><a href="https://github.com/asamat">Arunim Samat</a> created <a href="https://github.com/asamat/python_marketo">a client library in Python for the Marketo REST API</a>.</strong>

<a href="https://marketohost.wpengine.com/wp-content/uploads/2015/02/Screen-Shot-2015-02-19-at-5.09.23-PM.png"><img class="alignleft size-large wp-image-3813" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2015/02/Screen-Shot-2015-02-19-at-5.09.23-PM-1024x452.png" alt="Screen Shot 2015-02-19 at 5.09.23 PM" width="1024" height="452" /></a>

<strong><a href="https://www.linkedin.com/in/jalemieux">Jacques Lemieux from Marketo</a> created <a href="https://github.com/jalemieux/mkto_rest">a client library in Ruby for the Marketo REST API.</a></strong>

<a href="https://marketohost.wpengine.com/wp-content/uploads/2015/02/Screen-Shot-2015-02-19-at-5.11.37-PM.png"><img class="alignleft size-full wp-image-3815" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2015/02/Screen-Shot-2015-02-19-at-5.11.37-PM.png" alt="Screen Shot 2015-02-19 at 5.11.37 PM" width="1009" height="678" /></a>

We are excited to see more projects created by the developer community on the Marketo platform. If you are working on an open source project for the Marketo platform, please <a href="https://github.com/Marketo/Community-Supported-Client-Libraries">submit it to this GitHub repo via a pull request</a>.<br/><br/>MManzur - 2015-02-20<br/><br/><h2>Insert a Marketo Form into an RTP campaign</h2><br/><br/>Many marketers are interested in placing a Marketo Form into a Marketo Real-Time Personalization (RTP) campaign. Whether it’s a Dialog, In Zone or Widget RTP campaign type, you can copy your Form HTML code and paste it into RTP’s campaign editor.

I’ve seen these examples of this being used:
- Getting visitors to sign up to your newsletter after a 2nd or 3rd click on your site
- Quick, effective sign up form for webinars
- Downloading a gated case study
- Offering leads that unsubscribed in the past to re-subscribe

Fill out a form in the campaign and receive the thank you or content requested, resulting in one less clicks to get to your goals. So, here goes the explanation of how to do this and embed a Marketo Form 2.0 into a Marketo RTP campaign.

See a great example below from eMarketer, RTP users that took it one step further and instead of directing the visitors to a thank you page - decided to display a Thank You message within the RTP campaign.

The code for this option is also below.

Enjoy and I will be happy to hear about your experience with it!
<ol>
 	<li>Right click on an approved form. Select <strong>Embed Code.</strong>
<strong><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" src="https://docs.marketo.com/download/attachments/10095554/image2015-12-16%2010%3A58%3A39.png?version=1&amp;modificationDate=1450256319000&amp;api=v2" alt="" width="700" data-image-src="/download/attachments/10095554/image2015-12-16%2010%3A58%3A39.png?version=1&amp;modificationDate=1450256319000&amp;api=v2" data-linked-resource-id="10096636" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="image2015-12-16 10:58:39.png" data-base-url="https://docs.marketo.com" data-linked-resource-content-type="image/png" data-linked-resource-container-id="10095554" data-linked-resource-container-version="12" /></span></strong></li>
 	<li>Copy the <strong>Code.</strong>
<span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" src="https://docs.marketo.com/download/attachments/10095554/image2015-12-16%2011%3A16%3A24.png?version=1&amp;modificationDate=1450257385000&amp;api=v2" alt="" width="500" data-image-src="/download/attachments/10095554/image2015-12-16%2011%3A16%3A24.png?version=1&amp;modificationDate=1450257385000&amp;api=v2" data-linked-resource-id="10096642" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="image2015-12-16 11:16:24.png" data-base-url="https://docs.marketo.com" data-linked-resource-content-type="image/png" data-linked-resource-container-id="10095554" data-linked-resource-container-version="12" /></span></li>
 	<li>In Marketo RTP, go to<strong> Campaigns</strong>.
<span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" src="https://docs.marketo.com/download/attachments/10095554/image2015-12-16%2011%3A6%3A37.png?version=1&amp;modificationDate=1450256798000&amp;api=v2" alt="" width="200" data-image-src="/download/attachments/10095554/image2015-12-16%2011%3A6%3A37.png?version=1&amp;modificationDate=1450256798000&amp;api=v2" data-linked-resource-id="10096638" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="image2015-12-16 11:6:37.png" data-base-url="https://docs.marketo.com" data-linked-resource-content-type="image/png" data-linked-resource-container-id="10095554" data-linked-resource-container-version="12" /></span></li>
 	<li>Click <strong>CREATE NEW CAMPAIGN</strong>.
<strong><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image confluence-thumbnail" src="https://docs.marketo.com/download/thumbnails/10095554/image2015-12-16%2011%3A7%3A30.png?version=1&amp;modificationDate=1450256851000&amp;api=v2" alt="" width="300" data-image-src="/download/attachments/10095554/image2015-12-16%2011%3A7%3A30.png?version=1&amp;modificationDate=1450256851000&amp;api=v2" data-linked-resource-id="10096639" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="image2015-12-16 11:7:30.png" data-base-url="https://docs.marketo.com" data-linked-resource-content-type="image/png" data-linked-resource-container-id="10095554" data-linked-resource-container-version="12" /></span></strong></li>
 	<li>In the Rich Text Editor, click on the <strong>HTML icon</strong>.
<span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image confluence-thumbnail" src="https://docs.marketo.com/download/thumbnails/10095554/image2015-12-16%2011%3A8%3A39.png?version=1&amp;modificationDate=1450256920000&amp;api=v2" alt="" width="300" data-image-src="/download/attachments/10095554/image2015-12-16%2011%3A8%3A39.png?version=1&amp;modificationDate=1450256920000&amp;api=v2" data-linked-resource-id="10096640" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="image2015-12-16 11:8:39.png" data-base-url="https://docs.marketo.com" data-linked-resource-content-type="image/png" data-linked-resource-container-id="10095554" data-linked-resource-container-version="12" /></span></li>
 	<li>Paste the form embed code into the HTML Source Editor. Click <strong>Update</strong>.
<span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" src="https://docs.marketo.com/download/attachments/10095554/image2015-12-16%2011%3A10%3A11.png?version=1&amp;modificationDate=1450257012000&amp;api=v2" alt="" width="700" data-image-src="/download/attachments/10095554/image2015-12-16%2011%3A10%3A11.png?version=1&amp;modificationDate=1450257012000&amp;api=v2" data-linked-resource-id="10096641" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="image2015-12-16 11:10:11.png" data-base-url="https://docs.marketo.com" data-linked-resource-content-type="image/png" data-linked-resource-container-id="10095554" data-linked-resource-container-version="12" /></span></li>
 	<li>The form will not display in the editor view, but you can preview it to see how it will render in a campaign.</li>
 	<li>Click <strong>Launch</strong> to start the campaign.</li>
</ol>
<div class="callout">
<h3 id="EmbedaFormintoanRTPCampaign-Note">Note</h3>
Any changes to the form must be done within Marketo's Marketing Activities in Edit Draft of the Form.

</div>
<div class="callout rel">
<h3></h3>
<h3 id="EmbedaFormintoanRTPCampaign-RelatedArticles">Related Articles</h3>
<ul>
 	<li><a class="external-link" href="/blog/show-thank-you-message-without-a-follow-up-landing-page/" target="_blank" rel="nofollow">Show Thank You Message Without a Follow-Up Landing Page</a></li>
 	<li><a class="external-link" href="/javascript-api/forms/" target="_blank" rel="nofollow">Forms 2.0</a></li>
</ul>
</div>
<script>// <![CDATA[
forms.js








<br />
<form><p>
<script> MktoForms2

Make the following customization:

//AJAX Script 1 code (attached)
// ]]></script><br/><br/>YCalisar - 2015-12-20<br/><br/><h2>Add a Reset Button to a Marketo Form</h2><br/><br/><pre class="lang:default decode:true prettyprint lang-js  ">&lt;script src="//app-sj01.marketo.com/js/forms2/js/forms2.min.js"&gt;&lt;/script&gt;
&lt;form id="mktoForm_116"&gt;&lt;/form&gt;
&lt;script&gt;MktoForms2.loadForm("//app-sj01.marketo.com", "410-XOR-673", 116,
function(form) { form.getFormElem()[0].querySelector('button[type="submit"]').insertAdjacentHTML('afterend','&lt;button type="reset" class="mktoButton"&gt;Reset&lt;/button&gt;') });
&lt;/script&gt;
</pre><br/><br/>MManzur - 2015-03-18<br/><br/><h2>March 2015 Release Updates</h2><br/><br/>The <a href="/documentation/asset-api/">Marketo REST Asset API was released in the March 2015 release</a>. This API allows to access Marketo's file, folder, token, email, and email template objects.

Note that two role permissions were added to provide access to the Asset API endpoints: Read-Only Assets, Read-Write Assets.  If your API user role predates the release of the Asset APIs, then you will need to create a new API user role with these permissions to enable access.  Otherwise, you will receive a 603 "Access Denied" error response.

In addition to the release of the REST Asset API, there were updates to existing REST API endpoints. The <a href="/documentation/rest/merge-lead/">Merge Lead REST API endpoint</a> was updated to allow for merging of multiple leads. The <a href="/documentation/rest/schedule-campaign/">Schedule Campaign REST API endpoint</a> was updated to allow for cloning of a campaign while scheduling a campaign. The <a href="/documentation/rest/createupdate-leads/">Create/Update Leads REST API endpoint</a> was updated to allow for changing of a lead's partition.

&nbsp;

&nbsp;<br/><br/>MManzur - 2015-03-23<br/><br/><h2>Triggering RTP Campaigns with a Delay</h2><br/><br/>This custom Javascript allows RTP users to show campaigns a few seconds after the web page loads. This is recommended for dialog box and widget campaigns. It can be used to show a campaign after a delay, once the visitor viewed the regular content on the page.

It is recommended to implement this code only on specific pages where the campaign/s should be displayed. Using this code across all pages is not recommended as it may affect performance.

<strong>Setup Instructions</strong>

The custom code sends an RTP Custom Data Event (t=timeOnPage, i.e: t=60) and then loads the campaign that matches this event. By default, it will be triggered after 60 seconds. You can customize it by changing the sendCustomRTPEvent parameter to any other number.

Place the code immediately after the standard RTP code:
<pre class="lang:default decode:true prettyprint lang-js ">&lt;script&gt;
function sendCustomRTPEvent(a){
	var eventValue="t="+a;
	setTimeout(function(){ 
		rtp('send', 'event', {value: eventValue}); 
		rtp('get', 'campaign',true);
	}, 1000 * a);
}
sendCustomRTPEvent(60); //Seconds
&lt;/script&gt;
</pre>
To setup a RTP campaign to react after a time delay:

1. Login to your RTP account
2. Create a new segment
3. In the Segment Events section add: ‘t=60’

<a href="https://marketohost.wpengine.com/wp-content/uploads/2015/03/Screen-Shot-2015-03-24-at-12.20.10-PM.png"><img class="size-full wp-image-3861 alignnone" src="https://marketohost.wpengine.com/wp-content/uploads/2015/03/Screen-Shot-2015-03-24-at-12.20.10-PM.png" alt="Screen Shot 2015-03-24 at 12.20.10 PM" width="685" height="140" /></a>

A visitor can only match each RTP segment once per session, therefore seeing each campaign only once (unless it is set to sticky).<br/><br/>YCalisar - 2015-03-24<br/><br/><h2>April 2015 Release Updates</h2><br/><br/><h3>Marketo Mobile Engagement SDK v0.3.2</h3>
Marketo now includes marketing automation and user engagement for mobile apps.  Installing the <a href="/mobile/">Marketo Mobile SDK</a> into your iOS or Android app allows Marketers to listen for in app events and send relevant push notifications.
<h3>REST API Enhancements</h3>
<ul>
 	<li>Custom Objects</li>
</ul>
<p style="padding-left: 30px;">New <a href="/documentation/custom-api/">custom object endpoints</a> have been introduced that allow you to programmatically list, describe and CRUD the data residing with a Marketo custom object.<b>  </b></p>
<p style="padding-left: 30px;">Note that role permissions were added to provide access to the Custom Object API endpoints: Read-Only Custom Object, Read-Write Custom Object.  If your API user role predates the release of the Custom Objects APIs, then you will need to create a new API user role with these permissions to enable access.  Otherwise, you will receive a 603 "Access Denied" error response.</p>

<ul>
 	<li>Schedule Campaign - Clone Program</li>
</ul>
<p style="padding-left: 30px;">A new optional parameter "cloneToProgramName" was introduced in the <a href="/documentation/rest/schedule-campaign/">schedule campaign API</a>. When this parameter is present, the campaign’s parent program will be cloned and the newly created campaign will be scheduled. The parameter specifies the desired name for the resulting program.</p><br/><br/>TKaufman - 2015-04-28<br/><br/><h2>Synchronizing Email Unsubscribes Across Instances</h2><br/><br/>Do you manage multiple instances of Marketo?  Keeping lead information synchronized across instances can be challenging.  Here is a way to sync email unsubscribes across instances using a webhook that calls an external web service.  The external web service loops through each instance looking for the known lead that triggered the unsubscribe event.  When a matching lead is found the “unsubscribed” field in the corresponding lead record is updated.

Here is a diagram illustrating the idea.

<a href="https://marketohost.wpengine.com/wp-content/uploads/2015/05/Email_Unsubscribe_Sync_Overview.png"><img class="alignnone size-full wp-image-3973" src="https://marketohost.wpengine.com/wp-content/uploads/2015/05/Email_Unsubscribe_Sync_Overview.png" alt="Email_Unsubscribe_Sync_Overview" width="1340" height="677" /></a>

It's up to you to implement the web service, but the code below should help you jumpstart the process!
<h3><strong>External Web Service</strong></h3>
Here is the proposed REST endpoint specification for the external web service:

<strong>URI: </strong>/unsubscribe

<strong>Method: </strong>POST
<table>
<tbody>
<tr>
<td><b>Parameter</b></td>
<td><strong>Description</strong></td>
<td><strong>Example</strong></td>
</tr>
<tr>
<td>id</td>
<td>Account id that triggered the unsubscribe event.</td>
<td>AAA-111-BBB</td>
</tr>
<tr>
<td>email</td>
<td>Email address of the lead that triggered the unsubscribe event.</td>
<td>jdoe@marketo.com</td>
</tr>
</tbody>
</table>
The external web service performs the following steps for each Marketo instance that needs to be synchronized:
<ol>
 	<li>Composes instance-specific REST API <a href="/documentation/rest/endpoint-url/">Endpoint URL</a></li>
 	<li>Obtains access token using <a href="/rest-api/authentication/">Identity</a></li>
 	<li>Obtains list of lead records that match email address using <a href="/documentation/rest/get-multiple-leads-by-filter-type/">Get Multiple Leads by Filter Type</a></li>
 	<li>Updates “unsubscribed” field of each lead record using <a href="/documentation/rest/createupdate-leads/">Create/Update Leads</a></li>
</ol>
Here is another diagram showing the external web service call and Marketo REST API calls in detail.

<a href="https://marketohost.wpengine.com/wp-content/uploads/2015/05/Email_Unsubscribe_Sync_Detail.png"><img class="alignnone size-full wp-image-3975" src="https://marketohost.wpengine.com/wp-content/uploads/2015/05/Email_Unsubscribe_Sync_Detail.png" alt="Email_Unsubscribe_Sync_Detail" width="1258" height="600" /></a>

The sample code below is not an out of the box web service.  Rather, it is a console mode program that you can pass arguments to via the command line.  The intent here is to show how to call the appropriate Marketo APIs to update lead records across instances.  Implementing the web service is left as an exercise for the reader ;)

<strong>Sample Code</strong>

To get the sample code up and running, you will need to create a Java project in your favorite IDE.  After that, you will need to make the following changes:

1. The sample code uses <a href="https://code.google.com/p/json-simple/">json-simple</a> to parse JSON strings.  Add the json-simple jar to your Java project.

2. The sample code has a structure that holds metadata for each Marketo instance.  Place actual values from your instances into the structure as follows:
<pre class="lang:default decode:true ">public static String instanceInfo[][] = {
{ "AccountId1", "ClientId1","ClientSecret1" },    // Instance 1 metadata
{ "AccountId2", "ClientId2","ClientSecret2" },    // Instance 2 metadata
{ "AccountId3", "ClientId3","ClientSecret3" }     // Instance 3 metadata
};</pre>
You can find the metadata for the instance in the Marketo Admin panel:
<ul>
 	<li>Account Id
Admin &gt;  Integration &gt; Munchkin &gt; Munchkin Account</li>
 	<li>Client Id &amp; Client Secret
Admin &gt; Integration &gt; LaunchPoint &gt; Email Unsubscribe Sync &gt; View Details</li>
</ul>
3. The sample code takes two command line arguments that simulate the "id" and "email" query parameters for external web service described above.
<ol>
 	<li>args[0] = Account Id</li>
 	<li>args[1] = Email Address</li>
</ol>
Pass actual values from your instance as arguments to the program.  Here is a project configuration screenshot from Intellij IDEA.

<a href="https://marketohost.wpengine.com/wp-content/uploads/2015/05/email_unsubscribe_intellij_project1.png"><img class="alignnone size-full wp-image-4025" src="https://marketohost.wpengine.com/wp-content/uploads/2015/05/email_unsubscribe_intellij_project1.png" alt="email_unsubscribe_intellij_project" width="740" height="423" /></a>

<strong>SyncEmailUnsubscribe.java</strong>

<pre class="lang:default decode:true prettyprint lang-js">package com.marketo;

import org.json.simple.JSONArray;
import org.json.simple.JSONObject;
import org.json.simple.parser.JSONParser;
import org.json.simple.parser.ParseException;

import javax.net.ssl.HttpsURLConnection;
import java.io.IOException;
import java.io.InputStream;
import java.io.OutputStream;
import java.net.MalformedURLException;
import java.net.URL;
import java.util.Iterator;
import java.util.NoSuchElementException;
import java.util.Scanner;

public class SyncEmailUnsubscribe {
    // Define Marketo instance meta data here.  
    // Each row contains three elements: Account Id, Client Id, Client Secret.
    // For example:
    //  public static String instanceData[][] = {
    //    {"111-AAA-222", "2f4a4435-f6fa-4bd9-3248-098754982345", "asdf6IVE9h4Jjcl59cOMAKFSk78ut12W"},
    //    {"222-BBB-333", "5f4a6657-f6fa-4cd9-4356-123083238821", "gfjgfIVE9h4Jjcl59cOMAKFSk78ut12W"},
    //    {"444-CCC-444", "9f4a4678-f6fa-4dd9-7735-908713247721", "xzcxvbVE9h4Jjcl59cOMAKFSk78ut12W"}
    //  };
    //
    public static String instanceData[][] = {
            // ADD YOUR INSTANCE META DATA HERE
    };

    public static void main(String[] args) {
        String accountId = args[0];     // Account id that processed the unsubscribe
        String emailAddress = args[1];  // Email address of lead that unsubscribed

        SyncEmailUnsubscribe seu = new SyncEmailUnsubscribe();

        // Loop through each Marketo instance
        for (int i = 0; i &lt; instanceData.length; i++) {

            // Make sure we skip instance that triggered the webhook
            if (!accountId.equals(instanceData[i][0])) {
                String endpointUrl = String.format("https://%s.mktorest.com", instanceData[i][0]);

                // Generate access token
                String identityUrl = String.format("%s/identity/oauth/token?grant_type=client_credentials&amp;client_id=%s&amp;client_secret=%s", endpointUrl, instanceData[i][1], instanceData[i][2]);
                String token = seu.getToken(identityUrl);

                // Get lead records for given email address (may be duplicates)
                String getLeadsUrl = String.format("%s/rest/v1/leads.json?access_token=%s&amp;filterType=email&amp;filterValues=%s", endpointUrl, token, emailAddress);
                String leads = seu.getLeads(getLeadsUrl);

                // Update unsubscribed field in lead record
                String updateLeadsUrl = String.format("%s/rest/v1/leads.json?access_token=%s", endpointUrl, token);
                seu.updateLeads(updateLeadsUrl, leads, accountId);
            }
        }

        System.exit(0);
    }

    // Call Identity Service to generate access token
    public String getToken(String url) {
        // Call Identity Service
        String tokenData = getData(url);

        // Convert response into JSONObject
        JSONParser parser = new JSONParser();
        Object obj = null;
        try {
            obj = parser.parse(tokenData);
        } catch (ParseException pe) {
            System.out.println("position: " + pe.getPosition());
            System.out.println(pe);
        }

        // Retrieve access_token
        JSONObject jsonObject = (JSONObject)obj;
        return jsonObject.get("access_token").toString();
    }

    // Call Get Multiple Leads by Filter Type Service to get lead records
    public String getLeads(String url) {
        return getData(url);
    }

    // Call Create/Update Lead Service to update "unsubscribed" flag in lead record
    public void updateLeads(String url, String leads, String account) {
        JSONObject body = composeBody(leads, account);
        if (body != null) {
            postData(url, body);
        }
    }

    // Compose JSON body for Create/Update Leads Service
    private JSONObject composeBody(String leads, String account) {
        JSONObject body = new JSONObject();

        // Convert leads into JSONObject
        JSONParser parser = new JSONParser();
        Object obj = null;
        try {
            obj = parser.parse(leads);
        } catch (ParseException pe) {
            System.out.println("position: " + pe.getPosition());
            System.out.println(pe);
        }
        JSONObject leadsObj = (JSONObject)obj;

        Object success = leadsObj.get("success");
        if (success.equals(true)) {
            body.put("action", "updateOnly");
            body.put("lookupField", "id");
            body.put("asyncProcessing", "true");

            // Build array of lead objects
            JSONArray input = new JSONArray();
            JSONArray result = (JSONArray) leadsObj.get("result");
            Iterator&lt;JSONObject&gt; iterator = result.iterator();
            while (iterator.hasNext()) {
                JSONObject leadIn = (JSONObject)iterator.next();
                JSONObject lead = new JSONObject();
                lead.put("id", leadIn.get("id"));
                lead.put("unsubscribed", "true");
                lead.put("unsubscribedReason", "Cross instance synch triggered by webhook from: " + account);
                input.add(lead);
            }

            body.put("input", input);
        }
        return body;
    }

    // HTTP POST request
    private String postData(String endpoint, JSONObject body) {
        String data = "";
        try {
            // Make request
            URL url = new URL(endpoint);
            HttpsURLConnection urlConn = (HttpsURLConnection) url.openConnection();
            urlConn.setRequestMethod("POST");
            urlConn.setAllowUserInteraction(false);
            urlConn.setDoOutput(true);
            urlConn.setRequestProperty("Content-type", "application/json");
            urlConn.setRequestProperty("accept", "application/json");
            urlConn.connect();
            OutputStream os = urlConn.getOutputStream();
            os.write(body.toJSONString().getBytes());
            os.close();
            int responseCode = urlConn.getResponseCode();
            if (responseCode == 200) {
                System.out.println("Status: 200");
                InputStream inStream = urlConn.getInputStream();
                data = convertStreamToString(inStream);
                System.out.println(data);
            } else {
                System.out.println(responseCode);
                data = "Status:" + responseCode;
            }
        } catch (MalformedURLException e) {
            System.out.println("URL not valid.");
        } catch (IOException e) {
            System.out.println("IOException: " + e.getMessage());
            e.printStackTrace();
        }
        return data;
    }

    // HTTP GET request
    private String getData(String endpoint) {
        String data = "";
        try {
            URL url = new URL(endpoint);
            HttpsURLConnection urlConn = (HttpsURLConnection) url.openConnection();
            urlConn.setRequestMethod("GET");
            urlConn.setAllowUserInteraction(false);
            urlConn.setDoOutput(true);
            int responseCode = urlConn.getResponseCode();
            if (responseCode == 200) {
                System.out.println("Status: 200");
                InputStream inStream = urlConn.getInputStream();
                data = convertStreamToString(inStream);
                System.out.println(data);
            } else {
                System.out.println(responseCode);
                data = "Status:" + responseCode;
            }
        } catch (MalformedURLException e) {
            System.out.println("URL not valid.");
        } catch (IOException e) {
            System.out.println("IOException: " + e.getMessage());
            e.printStackTrace();
        }
        return data;
    }

    private String convertStreamToString(InputStream inputStream) {
        try {
            return new Scanner(inputStream).useDelimiter("A").next();
        } catch (NoSuchElementException e) {
            return "";
        }
    }
}</pre>
<h3><strong>Marketo Setup</strong></h3>
Perform the following steps for each Marketo instance that you would like to sync.
<ol>
 	<li>Create a Custom Service with role permission: Read-Write Lead. If you are unfamiliar with creating a Custom Service, click <a href="/rest-api/custom-services/">here</a>.</li>
 	<li>Create a Webhook that calls your external web service. If you are unfamiliar with creating Webhooks, click <a href="/webhooks/">here</a>.</li>
 	<li>Add Webhook as flow step in Smart Campaign.</li>
</ol>
The screenshot below shows how to create a webhook to invoke the service specified above using tokens to automatically populate the query parameters.

<a href="https://marketohost.wpengine.com/wp-content/uploads/2015/05/email_unsubscribe_webhook.png"><img class="alignnone size-full wp-image-3901" src="https://marketohost.wpengine.com/wp-content/uploads/2015/05/email_unsubscribe_webhook.png" alt="email_unsubscribe_webhook" width="881" height="596" /></a>

Now that we have created our webhook, we can add it to a Smart Campaign as a flow action.

<a href="https://marketohost.wpengine.com/wp-content/uploads/2015/05/email_unsubscribe_flow_step.png"><img class="alignnone size-full wp-image-3951" src="https://marketohost.wpengine.com/wp-content/uploads/2015/05/email_unsubscribe_flow_step.png" alt="email_unsubscribe_flow_step" width="609" height="273" /></a>

The Smart List should contain an “Unsubsubscribes from Email” trigger.

<a href="https://marketohost.wpengine.com/wp-content/uploads/2015/05/email_unsubscribe_smartlist.png"><img class="alignnone size-full wp-image-3949" src="https://marketohost.wpengine.com/wp-content/uploads/2015/05/email_unsubscribe_smartlist.png" alt="email_unsubscribe_smartlist" width="672" height="272" /></a>
<h3> <strong>Validation</strong></h3>
To test this all out, create a lead with the same email address in several Marketo instances.  Make sure that you own the email address!  In one instance trigger a send email flow action, open the resultant email, and click unsubscribe.  To validate results, log into each of the other instances and inspect the lead records associated with the email address.  The “Unsubscribed” checkbox should be checked, and the “Unsubscribed Reason” field should contain a note with the source account id that initiated the sync.

<a href="https://marketohost.wpengine.com/wp-content/uploads/2015/05/email_unsubscribe_lead_record.png"><img class="alignnone size-full wp-image-3981" src="https://marketohost.wpengine.com/wp-content/uploads/2015/05/email_unsubscribe_lead_record.png" alt="email_unsubscribe_lead_record" width="630" height="796" /></a><br/><br/>deverly - 2015-05-11<br/><br/><h2>Synchronizing Lead Data Changes using REST API</h2><br/><br/>Over a year ago we posted <a title="Retrieving customer and prospect information from Marketo using the API" href="/blog/retrieving-customer-and-prospect-information-from-marketo-using-the-api/">Retrieving customer and prospect information from Marketo using the API</a>.  That post presented a code sample that could be run on a recurring basis to poll Marketo for updates.  The idea was to use Marketo APIs to identify changes to lead data, and extract the lead data that had changed.  This data could then be pushed to an external system for synchronization purposes.

The code sample presented used our SOAP API.  Well we have a <a href="https://youtu.be/G-7ZJjLy5D8">new way to walk</a>, and that way is using the <a href="/documentation/rest/">Marketo REST API</a>.  This post will show you how to accomplish that same goal using two REST endpoints: <a href="/documentation/rest/get-lead-changes/">Get Lead Changes</a>, <a href="/documentation/rest/get-lead-by-id/">Get Lead by Id</a>.

The program contains 2 main steps:
<ol>
 	<li>Call Get Lead Changes to generate a list of all Lead Ids that either had specific lead fields changed, or were added during a given time period.</li>
 	<li>Call Get Lead Id for each Lead Id in the list to retrieve field data from the lead record.</li>
</ol>
We'll take the data retrieved in step 2 and format it for consumption by an external system.

<a href="https://marketohost.wpengine.com/wp-content/uploads/2015/07/Lead_Change_Sync_Overview1.png"><img class="alignnone size-full wp-image-4689" src="https://marketohost.wpengine.com/wp-content/uploads/2015/07/Lead_Change_Sync_Overview1.png" alt="Lead_Change_Sync_Overview" width="1460" height="764" /></a>

<strong>Program Input</strong>

By default the program "goes back" one day from the current date to look for changes.  So you could run this program at the same time each day for example.  To go farther back in time, you can specify the number of days as a command <span style="line-height: 1.5;">line argument, effectively increasing the time window.</span>

The program contains several variables that you can modify:

CUSTOM_SERVICE_DATA - This contains your Marketo <a href="/rest-api/custom-services/">Custom Service</a> data (Account Id, Client Id, Client Secret).

LEAD_CHANGE_FIELD_FILTER - This contains a comma seperated list of lead fields that we will inspect for changes.

READ_BATCH_SIZE - This is the number of records to retrieve at a time.  Use this to tune the response body size.

<strong>Program Output</strong>

The program gathers up all of the changed lead records and formats them in JSON as an array of lead objects as follows:
<pre class="lang:default decode:true prettyprint lang-java">{
    "result": [
        {
            "leadId": "318592",
            "updatedAt": "2015-07-22T19:19:07Z",
            "firstName": "David",
            "lastName": "Everly",
            "email": "deverly@marketo.com"
        },

        ...more lead objects here...
    ]
}
</pre>
The idea is that you could then pass this JSON as the request payload to an external web service to synchronize the data.

<strong>Program Logic</strong>

First we establish our time window, compose our REST endpoint URLS, and obtain our Authentication access token.  Next we fire up a Get Paging Token/Get Lead Changes loop in which runs until we exhaust the supply of lead changes.  The purpose of this loop is to accumulate a list of unique Lead Ids so that we can pass them to Get Lead by Id later in the program.  For this example, we tell Get Lead Changes to look for changes to the following fields: firstName, lastName, email.  You are free to select any combination of fields for your purposes.

Get Lead Changes returns "result" objects that contain an Activity Type Id, which we can use to filter results.  Note: You can get a list of Activity Types by calling <a href="http://developers.marketo.com/documentation/rest/get-activity-types/">Get Activity Types</a> REST endpoint.  We are interested in 2 activity types that are returned:

1. New Lead (12)
<pre class="lang:default mark:5 decode:true prettyprint lang-java">{
    "id": 12024682,
    "leadId": 318581,
    "activityDate": "2015-03-17T00:18:41Z",
    "activityTypeId": 12,
    "primaryAttributeValueId": 318581,
    "primaryAttributeValue": "David Everly",
    "attributes": [
        {
            "name": "Created Date",
            "value": "2015-03-16"
        },
        {
            "name": "Source Type",
            "value": "New lead"
        }
    ]
}</pre>
2. Change Data Value (13)

We can tell which field changed by inspecting the "name" property in the Change Data Value response.
<pre class="lang:default mark:5,9 decode:true prettyprint lang-java ">{
    "id": 12024689,
    "leadId": 318581,
    "activityDate": "2015-03-17T22:58:18Z",
    "activityTypeId": 13,
    "fields": [
        {
            "id": 31,
            "name": "lastName",
            "newValue": "Evely",
            "oldValue": "Everly"
        }
    ],
    "attributes": [
        {
            "name": "Source",
            "value": "Web form fillout"
        }
    ]
}
</pre>
When either of these two types of activities are returned, we store the associated Lead Id in a list.  Once we have our list, we can iterate through it calling Get Lead by Id for each item.  This will retrieve the latest lead data for each lead in the list.  For this example we retrieve the following lead fields: leadId, updatedAt, firstName, lastName, email.  You are free to select any combination of fields for your purposes.  This is done by specifying the fields parameter to Get Lead by Id.  And finally we JSONify the results as an array of lead objects as described above.

<a href="https://marketohost.wpengine.com/wp-content/uploads/2015/07/Lead_Change_Sync_Detail1.png"><img class="alignnone size-full wp-image-4701" src="https://marketohost.wpengine.com/wp-content/uploads/2015/07/Lead_Change_Sync_Detail1.png" alt="Lead_Change_Sync_Detail" width="1460" height="1824" /></a>

<strong>Program Code</strong>

<pre class="lang:default decode:true prettyprint lang-java ">package com.marketo;

// minimal-json library (https://github.com/ralfstx/minimal-json)
import com.eclipsesource.json.JsonArray;
import com.eclipsesource.json.JsonObject;
import com.eclipsesource.json.JsonValue;

import java.io.*;
import java.net.MalformedURLException;
import java.net.URL;
import java.text.DateFormat;
import java.text.ParseException;
import java.text.SimpleDateFormat;
import java.util.*;

import javax.net.ssl.HttpsURLConnection;

public class LeadChanges {
    //
    // Define Marketo REST API access credentials: Account Id, Client Id, Client Secret.  For example:
    //    public static String CUSTOM_SERVICE_DATA[] =
    //      {"111-AAA-222", "2f4a4435-f6fa-4bd9-3248-098754982345", "asdf6IVE9h4Jjcl59cOMAKFSk78ut12W"};
    //
    private static final String CUSTOM_SERVICE_DATA[] =
            {INSERT YOUR CUSTOM SERVICE DATA HERE};

    // Lead fields that we are interested in
    private static final String LEAD_CHANGE_FIELD_FILTER = "firstName,lastName,email";

    // Number of lead records to read at a time
    private static final String READ_BATCH_SIZE = "200";

    // Activity type ids that we are interested in
    private static final int ACTIVITY_TYPE_ID_NEW_LEAD = 12;
    private static final int ACTIVITY_TYPE_ID_CHANGE_DATA_VALE = 13;

    public static void main(String[] args) {
        // Command line argument to set how far back to look for lead changes (number of days)
        int lookBackNumDays = 1;
        if (args.length == 1) {
            lookBackNumDays = Integer.parseInt(args[0]);
        }

        // Establish "since date" using current timestamp minus some number of days (default is 1 day)
        Calendar cal = Calendar.getInstance();
        cal.add(Calendar.DAY_OF_MONTH, -lookBackNumDays);
        SimpleDateFormat sdf = new SimpleDateFormat("yyyy-MM-dd'T'HH:mm:ssZ");
        String sinceDateTime = sdf.format(cal.getTime());

        // Compose base URL
        String baseUrl = String.format("https://%s.mktorest.com",
                CUSTOM_SERVICE_DATA[0]);

        // Compose Identity URL
        String identityUrl = String.format("%s/identity/oauth/token?grant_type=%s&amp;client_id=%s&amp;client_secret=%s",
                baseUrl, "client_credentials", CUSTOM_SERVICE_DATA[1], CUSTOM_SERVICE_DATA[2]);

        // Call Identity API
        JsonObject identityObj = JsonObject.readFrom(getData(identityUrl));
        String accessToken = identityObj.get("access_token").asString();

        // Compose URLs for Get Lead Changes, and Get Paging Token
        String leadChangesUrl = String.format("%s/rest/v1/activities/leadchanges.json?access_token=%s&amp;fields=%s&amp;batchSize=%s",
                baseUrl, accessToken, LEAD_CHANGE_FIELD_FILTER, READ_BATCH_SIZE);
        String pagingTokenUrl = String.format("%s/rest/v1/activities/pagingtoken.json?access_token=%s&amp;sinceDatetime=%s",
                baseUrl, accessToken, sinceDateTime);

        HashSet leadIdList = new HashSet();

        // Call Get Paging Token API
        JsonObject pagingTokenObj = JsonObject.readFrom(getData(pagingTokenUrl));
        if (pagingTokenObj.get("success").asBoolean()) {

            String nextPageToken = pagingTokenObj.get("nextPageToken").asString();
            boolean moreResult;

            do {
                moreResult = false;

                // Call Get Lead Changes API
                JsonObject leadChangesObj = JsonObject.readFrom(getData(String.format("%s&amp;nextPageToken=%s",
                        leadChangesUrl, nextPageToken)));
                if (leadChangesObj.get("success").asBoolean()) {
                    moreResult = leadChangesObj.get("moreResult").asBoolean();
                    nextPageToken = leadChangesObj.get("nextPageToken").asString();

                    if (leadChangesObj.get("result") != null) {
                        JsonArray resultAry = leadChangesObj.get("result").asArray();
                        for (JsonValue resultObj : resultAry) {
                            int activityTypeId = resultObj.asObject().get("activityTypeId").asInt();


                            // Store lead ids for later use
                            boolean storeThisId = false;
                            if (activityTypeId == ACTIVITY_TYPE_ID_NEW_LEAD) {
                                storeThisId = true;
                            } else if (activityTypeId == ACTIVITY_TYPE_ID_CHANGE_DATA_VALE) {
                                // See if any of the changed fields are of interest to us
                                JsonArray fieldsAry = resultObj.asObject().get("fields").asArray();
                                for (JsonValue fieldsObj : fieldsAry) {
                                    String name = fieldsObj.asObject().get("name").asString();
                                    if (LEAD_CHANGE_FIELD_FILTER.contains(name)) {
                                        storeThisId = true;
                                    }
                                }

                            }

                            if (storeThisId) {
                                leadIdList.add(resultObj.asObject().get("leadId").toString());
                            }
                        }
                    }
                }

            } while (moreResult);
        }

        JsonObject result = new JsonObject();
        JsonArray leads = new JsonArray();

        for (Object o : leadIdList) {
            String leadId = o.toString();

            // Compose Get Lead by Id URL
            String getLeadUrl = String.format("%s/rest/v1/lead/%s.json?access_token=%s",
                    baseUrl, leadId, accessToken);

            // Call Get Lead by Id API
            JsonObject leadObj = JsonObject.readFrom(getData(getLeadUrl));
            if (leadObj.get("success").asBoolean()) {
                if (leadObj.get("result") != null) {
                    JsonArray resultAry = leadObj.get("result").asArray();
                    for (JsonValue resultObj : resultAry) {

                        // Create lead object
                        JsonObject lead = new JsonObject();
                        lead.add("leadId", leadId);
                        lead.add("updatedAt", resultObj.asObject().get("updatedAt").asString());
                        lead.add("firstName", resultObj.asObject().get("firstName").asString());
                        lead.add("lastName", resultObj.asObject().get("lastName").asString());
                        lead.add("email", resultObj.asObject().get("email").asString());

                        // Add lead object to leads array
                        leads.add(lead);
                    }
                }
            }
        }

        // Add leads array to result object
        result.add("result", leads);

        // Print out result object
        System.out.println(result);

        System.exit(0);
    }

    // Perform HTTP GET request
    private static String getData(String endpoint) {
        String data = "";
        try {
            URL url = new URL(endpoint);
            HttpsURLConnection urlConn = (HttpsURLConnection) url.openConnection();
            urlConn.setRequestMethod("GET");
            urlConn.setAllowUserInteraction(false);
            urlConn.setDoOutput(true);
            int responseCode = urlConn.getResponseCode();
            if (responseCode == 200) {
                InputStream inStream = urlConn.getInputStream();
                data = convertStreamToString(inStream);
            } else {
                System.out.println(responseCode);
                data = "Status:" + responseCode;
            }
        } catch (MalformedURLException e) {
            System.out.println("URL not valid.");
        } catch (IOException e) {
            System.out.println("IOException: " + e.getMessage());
            e.printStackTrace();
        }
        return data;
    }

    private static String convertStreamToString(InputStream inputStream) {
        try {
            return new Scanner(inputStream).useDelimiter("A").next();
        } catch (NoSuchElementException e) {
            return "";
        }
    }
}</pre>
So there you have it, <a href="https://www.youtube.com/watch?v=zFaBwZDywLk">life's a happy song</a>.  Enjoy!<br/><br/>deverly - 2015-07-31<br/><br/><h2>May 2015 Release Updates</h2><br/><br/><h5>REST API</h5>
<ul>
 	<li>Opportunity API.  New <a href="http://developers.marketo.com/documentation/opportunity-api/">opportunity endpoints</a> have been introduced that allow you to programmatically list, describe, and CRUD the data residing within a Marketo opportunity object.<b>  </b></li>
</ul>
<p style="padding-left: 60px;">Note:  Role permissions were added to provide access to the Opportunity endpoints: Read-Only Opportunity, Read-Write Opportunity.  If your API user role predates the release of the Opportunity APIs, then you will need to create a new API user role with these permissions to enable access.  Otherwise, you will receive a 603 "Access Denied" error response.</p>

<ul>
 	<li>Asset API - Snippets.  New <a href="http://developers.marketo.com/documentation/asset-api/#snippet_endpoints">asset endpoints for snippets</a> have been introduced to allow you to programmatically manipulate snippet objects.  Snippets can be used as dynamic content blocks in Emails and Landing Pages.</li>
 	<li>Leads API - Update Leads Partition.  A new <a href="http://developers.marketo.com/documentation/rest/update-leads-partition/">lead endpoint for partitions</a> has been added to allow you to update the partition for one or more  leads.</li>
 	<li>Fixed issue where Lead-related API's were missing time zone offset in "createdAt" and "updatedAt" attributes.  [LM-52671]</li>
 	<li>Fixed issue where Schedule Campaign was not returning the proper error code when daily maximum number of calls had been exceeded.  [LM-57082]</li>
 	<li>Fixed issue where Get Folder by Id would sometimes return null for "parent" and "description" attributes.  [LM-57956]</li>
 	<li>Fixed issue where Approve Email by Id would give system error in certain cases.  [LM-58271]</li>
 	<li>Fixed issue where Create Token by Folder Id would produce a token that was unusable in certain cases. [LM-58073]</li>
</ul>
<h5>Real-Time Personalization (RTP)</h5>
<ul>
 	<li>Rich Media Recommendation API.  New <a href="http://developers.marketo.com/documentation/websites/rtp-rich-media-recommendations-api/">rich media recommendation</a> capabilities have been added to the RTP JavaScript API.  The Rich Media Content Recommendation engages your web visitors with the most relevant content powered by machine learning and predictive analytics. Enhance your content assets with text descriptions and images and embed multiple content recommendations on your website.</li>
</ul>
<h5>Mobile Engagement SDK</h5>
iOS v0.3.4/Android v0.3.3
<ul>
 	<li>Custom Actions.  Added the ability to track user interaction by sending custom actions.  For details, see "Sending Custom Actions" <a href="http://developers.marketo.com/documentation/mobile/">here</a>.</li>
 	<li>The trackPushNotification method has been deprecated.</li>
</ul><br/><br/>deverly - 2015-05-26<br/><br/><h2>June 2015 Release Updates</h2><br/><br/><h5>REST API</h5>
<ul>
 	<li><span style="line-height: 1.5;">Company API</span></li>
</ul>
<p style="line-height: 1.5; padding-left: 30px;">New <a href="/documentation/company-api/">company endpoints</a> have been introduced that allow you to programmatically list, describe, and CRUD the data residing within a Marketo company object.<strong> </strong></p>
<p style="padding-left: 30px;">Note:  Role permissions were added to provide access to the Program endpoints: Read-Only Company, Read-Write Company.  If your API user role predates the release of the Company APIs, then you will need to update your API user role with these permissions to enable access.  Otherwise, you will receive a 603 "Access Denied" error response</p>

<ul>
 	<li>Asset API - Programs</li>
</ul>
<p style="padding-left: 30px;">Updated Asset API to support both Application folders and Program folders.  Several Asset APIs had accepted a folder id in the request in the form of an integer.  The folder id could be passed as part of the URI, or part of request body, depending on the API.</p>
<p style="padding-left: 30px;">Now you must specify the folder type alongside the folder id.  The folder type is either "Program" or "Folder".  "Folder" specifies an Application folder, whereas "Program" specifies a Program folder.  The folder type is specified in two different ways, depending on the API that you are calling:</p>
<p style="padding-left: 60px;">1. Use the "FolderIdType" data structure.  FolderIdType is a simple JSON block containing the id and the type pair as follows:</p>
<p style="padding-left: 120px;">{ "id" : <strong>id</strong>, "type" : "<strong>type</strong>" }</p>
<p style="padding-left: 90px;">Where <strong>id</strong> is the folder id, and "<strong>type</strong>" is the folder type.  Permissible values for "<strong>type</strong>" are "Folder" or "Program".</p>
<p style="padding-left: 90px;">Example - Create Folder</p>
<p style="padding-left: 120px;">POST /asset/v1/folders.json</p>
<p style="padding-left: 120px;">parent=<strong>{"id":416,"type":"Folder"}</strong>&amp;name=Test Folder&amp;description=This is a test folder</p>
<p style="padding-left: 60px;"> 2. Use the existing id parameter and specifying its type using  a "type" query parameter.</p>
<p style="padding-left: 90px;">Example - Get Folder by Id</p>
<p style="padding-left: 120px;">GET /rest/asset/v1/folder/1016.json?<strong>type=Program</strong></p>
<p style="padding-left: 30px;">All API responses that had contained a folder id in the Result object will now also contain a folderId attribute whose value is a FolderIdType.  This can be used to determine the folder type for a given folder id.</p>
<p style="padding-left: 60px;">Example - Get Folder by Name</p>
<p style="padding-left: 90px;">GET /rest/asset/v1/folder/byName.json?name=Social Media</p>
<p style="padding-left: 90px;">"result": [</p>
<p style="padding-left: 120px;">{</p>
<p style="padding-left: 150px;">...</p>
<p style="padding-left: 150px;"><strong>"folderId": {"id":341, "type": "Program"},</strong></p>
<p style="padding-left: 150px;">...</p>
<p style="padding-left: 150px;">"id":"341"</p>
<p style="padding-left: 120px;">}</p>
<p style="padding-left: 90px;">]</p>
<p style="padding-left: 30px;">To determine the folder type for a given id, you may use <a href="http://developers.marketo.com/documentation/asset-api/browse-folders/">Browse Folders</a> API.</p>
<p style="padding-left: 30px;"><span class="prop jv">The "type" attribute in API responses has been renamed to "folderType".  This is to avoid confusion with the "type" element contained in FolderIdType.</span></p>
<p style="padding-left: 60px;"><span class="prop jv">For example, from this:</span></p>
<p style="padding-left: 90px;"><span class="prop jv">"<strong>type</strong>":"Marketing Folder"</span></p>
<p style="padding-left: 60px;">to this:</p>
<p style="padding-left: 90px;"><span class="prop jv">"<strong>folderType</strong>"</span>: <span class="string jv">"Marketing Folder"</span></p>
<p style="padding-left: 30px;">The following table lists the Asset APIs were changed.</p>

<table style="height: 1271px;" width="660">
<tbody>
<tr>
<td width="115"><strong>API Group</strong></td>
<td width="126"><b>API</b></td>
<td width="162"><b>Change Description</b></td>
</tr>
<tr>
<td width="115">Folder</td>
<td width="126"><strong> </strong></td>
<td width="162"></td>
</tr>
<tr>
<td width="115"></td>
<td width="126"><a href="/documentation/asset-api/create-folder">Create Folder</a></td>
<td width="162">Changed "parent" parameter from integer to FolderIdType</td>
</tr>
<tr>
<td width="115"></td>
<td width="126"><a href="/documentation/asset-api/get-folder-by-id">Get Folder by Id</a></td>
<td width="162">Added "type" parameter</td>
</tr>
<tr>
<td width="115"></td>
<td width="126"><a href="/documentation/asset-api/get-folder-by-name">Get Folder by Name</a></td>
<td width="162">Added "type" parameter</td>
</tr>
<tr>
<td width="115"></td>
<td width="126"><a href="/documentation/asset-api/update-folder">Update Folder</a></td>
<td width="162">Added "type" parameter</td>
</tr>
<tr>
<td width="115"></td>
<td width="126"><a href="/documentation/asset-api/delete-folder-by-id">Delete Folder by Id</a></td>
<td width="162">Added "type" parameter</td>
</tr>
<tr>
<td width="115"></td>
<td width="126"><a href="/documentation/asset-api/browse-folders">Browse Folders </a></td>
<td width="162">Changed "root" parameter from integer to FolderIdType</td>
</tr>
<tr>
<td width="115"></td>
<td width="126"><a href="/documentation/asset-api/get-folder-contents">Get Folder Contents</a></td>
<td width="162">Added "type" parameter</td>
</tr>
<tr>
<td width="115">Email Template</td>
<td width="126"></td>
<td width="162"></td>
</tr>
<tr>
<td width="115"></td>
<td width="126"><a href="/documentation/asset-api/create-email-template">Create Email Template</a></td>
<td width="162">Changed "folder" parameter from integer to FolderIdType</td>
</tr>
<tr>
<td width="115"></td>
<td width="126"><a href="/documentation/asset-api/clone-email-template">Clone Email Template</a></td>
<td width="162">Changed "folder" parameter from integer to FolderIdType</td>
</tr>
<tr>
<td width="115">Email</td>
<td width="126"></td>
<td width="162"></td>
</tr>
<tr>
<td width="115"></td>
<td width="126"><a href="/documentation/asset-api/create-email">Create Email</a></td>
<td width="162">Changed "folder" parameter from integer to FolderIdType</td>
</tr>
<tr>
<td width="115"></td>
<td width="126"><a href="/documentation/asset-api/get-emails">Get Emails</a></td>
<td width="162">Changed "folder" parameter from integer to FolderIdType</td>
</tr>
<tr>
<td width="115"></td>
<td width="126"><a href="/documentation/asset-api/clone-email">Clone Email</a></td>
<td width="162">Changed "folder" parameter from integer to FolderIdType</td>
</tr>
<tr>
<td width="115"></td>
<td width="126"><a href="/documentation/asset-api/get-email-by-name">Get Email by Name</a></td>
<td width="162">Changed "folder" parameter from integer to FolderIdType</td>
</tr>
<tr>
<td width="115">Snippet</td>
<td width="126"></td>
<td width="162"></td>
</tr>
<tr>
<td width="115"></td>
<td width="126"><a href="/documentation/asset-api/create-snippet/">Create Snippet</a></td>
<td width="162">Changed "folder" parameter from integer to FolderIdType</td>
</tr>
<tr>
<td width="115"></td>
<td width="126"><a href="/documentation/asset-api/clone-snippet/">Clone Snippet</a></td>
<td width="162">Changed "folder" parameter from integer to FolderIdType</td>
</tr>
<tr>
<td width="115">File</td>
<td width="126"></td>
<td width="162"></td>
</tr>
<tr>
<td width="115"></td>
<td width="126"><a href="/documentation/asset-api/create-a-file">Create a File</a></td>
<td width="162">Changed "folder" parameter from integer to FolderIdType</td>
</tr>
<tr>
<td width="115"></td>
<td width="126"><a href="/documentation/asset-api/list-files">List Files</a></td>
<td width="162">Changed "folder" parameter from integer to FolderIdType</td>
</tr>
<tr>
<td width="115">Token</td>
<td width="126"></td>
<td width="162"></td>
</tr>
<tr>
<td width="115"></td>
<td width="126"><a href="/documentation/asset-api/create-token-by-folder-id/">Create Token by Folder Id</a></td>
<td width="162">Added "folderType" parameter</td>
</tr>
<tr>
<td width="115"></td>
<td width="126"><a href="/documentation/asset-api/get-tokens-by-folder-id/">Get Tokens by Folder Id</a></td>
<td width="162">Added "folderType" parameter</td>
</tr>
<tr>
<td width="115"></td>
<td width="126"><a href="/documentation/asset-api/delete-tokens-by-folder-id/">Delete Tokens by Folder Id</a></td>
<td width="162">Added "folderType" parameter</td>
</tr>
</tbody>
</table>
<h5>Real-Time Personalization (RTP)</h5>
<ul>
 	<li>In-App Web Personalization (Beta)</li>
</ul>
<p style="padding-left: 30px;">Added an API to allow personalization of content based on web app data.  See blog post <a href="/blog/in-app-web-personalization-beta-using-the-rtp-api/">here</a>.</p>

<h5>Mobile Engagement SDK</h5>
iOS 0.3.5
<ul>
 	<li>Fixed issue where the set test device dialog was running on the main thread. [MOB-638]</li>
 	<li>Added error handling in the case of failure to register test device. [MOB-639]</li>
</ul>
Android 0.3.3
<ul>
 	<li>Added android:configChanges attribute to AndroidManifest.xml &lt;activity&gt; element to keep progress dialog from being dismissed when you added a test device and changed the orientation.   [MOB-687]</li>
</ul><br/><br/>deverly - 2015-06-30<br/><br/><h2>In-App Web Personalization (Beta) using the RTP API</h2><br/><br/>Several of our customers provide web app solutions for their users and we receive requests if they can use Marketo Real-Time Personalization (RTP) within their secured web app environment. The answer is yes! We’ve released an API for In-App messaging, so you can personalize content and promote marketing activities like webinars, new feature releases, up-sells and engage your users based on your web app data.

For example, personalizing In-App content for:
<ul>
 	<li>Trial offers based on user activity</li>
 	<li>Different subscription types (up-sell, cross-sell, or webinar training)</li>
 	<li>New features relevant to the user activity</li>
</ul>
<strong>Use Case Example</strong>

Marketo’s Customer Success team uses In-App Web Personalization to communicate with specific subscription types (Spark, Standard, Select, or Enterprise) with personalized content, making sure they are seeing progressive campaigns and nurturing in-app users based on their engagement.

Let’s see how this can be done for a user with an Enterprise subscription type.

<strong>Prerequisite</strong>

Understand the <a href="/javascript-api/web-personalization/user-context/">RTP User Context API</a>.

<strong>Enable the User Context API</strong>

Request from Marketo Support to enable the User Context API for your RTP account.

<strong>Set the Custom Variable</strong>

There are 5 custom variable slots available in RTP to send data to. In this example, we will send user subscription type Enterprise to Custom Variable 1.
<pre class="lang:default decode:true prettyprint lang-js ">rtp('set', 'customVar1', 'Enterprise');
</pre>
<strong>Create a New RTP Segment</strong>

Go to <strong>Segments</strong>, click <strong>CREATE NEW</strong>.

<a href="https://marketohost.wpengine.com/wp-content/uploads/2015/06/RTP_New_Segment.png"><img class="alignnone wp-image-4207 size-full" src="https://marketohost.wpengine.com/wp-content/uploads/2015/06/RTP_New_Segment.png" alt="RTP_New_Segment" width="235" height="526" /></a>
<ol>
 	<li>Drag the<strong> User Context API</strong> filter to the segment builder.</li>
 	<li>Select the <strong>Custom Variable 1 </strong>(Subscription Type) that <strong>value </strong>is <strong>Enterprise</strong>.</li>
</ol>
<a href="https://marketohost.wpengine.com/wp-content/uploads/2015/06/RTP_Segment.png"><img class="alignnone wp-image-4209 size-full" src="https://marketohost.wpengine.com/wp-content/uploads/2015/06/RTP_Segment.png" alt="RTP_Segment" width="1267" height="722" /></a>

<strong>Show Campaign Based on Previous Visit History</strong>

To show the visitor another campaign if they already clicked on a campaign in a previous visit.
<ol start="3">
 	<li>Within the <strong>User Context API</strong>, click <strong>(+) </strong>to add another User Context API attribute</li>
 	<li>Add the <strong>operator (AND or OR).</strong></li>
 	<li>Select <strong>Campaigns - Clicked. </strong>Set <strong>Campaign ID</strong> to the ID of the campaign. (See note below how to find the Campaign ID.)</li>
 	<li>Click <strong>SAVE &amp; DEFINE CAMPAIGN </strong>to create the campaign creative.</li>
</ol>
Overall, this segment will match if a visitor is associated with the custom variable (subscription type) equal to Enterprise and if they clicked on the campaign (ID: 5390) in a previous visit.

The next step is to define a personalized campaign to this segment. The screenshot below shows a RTP dialog campaign (bottom left) appearing on the My Marketo page promoting a webinar for Enterprise users.

<a href="https://marketohost.wpengine.com/wp-content/uploads/2015/06/RTP_Campaign_Screenshot.png"><img class="alignnone wp-image-4205 size-medium" src="https://marketohost.wpengine.com/wp-content/uploads/2015/06/RTP_Campaign_Screenshot-300x197.png" alt="RTP_Campaign_Screenshot" width="300" height="197" /></a>

<strong>NOTE:</strong>

<strong>Locating the Campaign ID</strong>

Go to <strong>Campaigns</strong>, hover over the <strong>Campaign Name</strong> to locate the Campaign ID.

<a href="https://marketohost.wpengine.com/wp-content/uploads/2015/06/RTP_Campaign_Code.png"><img class="alignnone wp-image-4203 size-full" src="https://marketohost.wpengine.com/wp-content/uploads/2015/06/RTP_Campaign_Code.png" alt="RTP_Campaign_Code" width="802" height="349" /></a><br/><br/>deverly - 2015-06-17<br/><br/><h2>Sending Transactional Emails with the Marketo REST API: Part 1</h2><br/><br/>A common use case for the Marketo API is to trigger the sending of transactional emails to specific records via the <a href="/documentation/rest/request-campaign/">Request Campaign</a> API call.  You can find an example covering this use case with the SOAP API <a href="/blog/sending-a-transactional-email-from-marketo-using-the-api/">here</a>.  There are a few configuration requirements within Marketo in order to execute the required call with the Marketo REST API.
<ul>
 	<li>The recipient must have a record within Marketo</li>
 	<li>There needs to be a Transactional Email created and approved in your Marketo instance.</li>
 	<li> There needs to be an active trigger campaign with the Campaign is Requested, Source: Web Service API, that is set up to send the email</li>
</ul>
First <a href="https://docs.marketo.com/display/public/DOCS/Create+a+New+Email">create and approve your email</a>.  If the email is truly transactional, you will likely need to set it to operational, but be sure that it legally qualifies as operational.  This is configured from with the Edit Screen under Email Actions &gt; Email Settings:

<img class="alignnone size-full wp-image-4397" src="https://marketohost.wpengine.com/wp-content/uploads/2015/07/Request-Campaign-Email-Settings.png" alt="Request Campaign - Email Settings" width="630" height="228" />

<img class="alignnone size-full wp-image-4401" src="https://marketohost.wpengine.com/wp-content/uploads/2015/07/Request-Campaign-Operational.png" alt="Request Campaign - Operational" width="575" height="378" />

Approve it and we’re ready to create our campaign:

<img class="alignnone size-full wp-image-4407" src="https://marketohost.wpengine.com/wp-content/uploads/2015/07/RequestCampaign-Approve-Draft.png" alt="RequestCampaign - Approve Draft" width="627" height="482" />

If you’re new to creating campaigns, check out the <a href="https://docs.marketo.com/display/public/DOCS/Create+a+New+Smart+Campaign">Create a New Smart Campaign</a> article on docs.marketo.com.  Once you’ve created your campaign, we need to go through these steps.  Configure your Smart List with the Campaign is Requested trigger: <a href="https://marketohost.wpengine.com/wp-content/uploads/2015/07/Request-Campaign-Smart-List.png"><img class="alignnone size-full wp-image-4405" src="https://marketohost.wpengine.com/wp-content/uploads/2015/07/Request-Campaign-Smart-List.png" alt="Request Campaign - Smart List" width="1312" height="520" /></a>

Now we need to configure the flow to point a Send Email step to our email: <a href="https://marketohost.wpengine.com/wp-content/uploads/2015/07/Request-Campaign-Flow.png"><img class="alignnone size-full wp-image-4399" src="https://marketohost.wpengine.com/wp-content/uploads/2015/07/Request-Campaign-Flow.png" alt="Request Campaign - Flow" width="1311" height="279" /></a>

Before activation, you’ll need to decide on some settings in the Schedule tab.  If this particular email should only ever be sent once to a given record, then leave the qualification settings as is.  If it’s required that they receive the email multiple times, though, you’ll want to adjust this to either every time or to one of the available cadences: <a href="https://marketohost.wpengine.com/wp-content/uploads/2015/07/Qualification-Rules.png"><img class="alignnone size-full wp-image-4395" src="https://marketohost.wpengine.com/wp-content/uploads/2015/07/Qualification-Rules.png" alt="Qualification Rules" width="963" height="521" /></a>

Now we’re ready to activate:

<a href="https://marketohost.wpengine.com/wp-content/uploads/2015/07/Request-Campaign-Schedule.png"><img class="alignnone size-full wp-image-4403" src="https://marketohost.wpengine.com/wp-content/uploads/2015/07/Request-Campaign-Schedule.png" alt="Request Campaign - Schedule" width="1070" height="446" /></a>
<h2>Sending the API Calls</h2>
<strong>Note:</strong> In the Java examples below, we’ll be using the minimal-json package to handle JSON representations in our code.  You can read more about this project here: <a href="https://github.com/ralfstx/minimal-json">https://github.com/ralfstx/minimal-json</a>

The first part of sending a transactional email through the API is ensuring that a record with the corresponding email address exists in your Marketo instance and that we have access to its lead ID.  For the purposes of this post, we will assume that the email addresses are in Marketo already, and we only need to retrieve the ID of the record.  For this, we will be using the <a href="/documentation/rest/get-multiple-leads-by-filter-type/">Get Multiple Leads by Filter Type</a> call, and we will be reusing some of the Java code from the previous post on <a href="/blog/authenticating-and-retrieving-lead-data-from-marketo-with-the-rest-api" target="_blank">authenticating and retrieving lead data from Marketo</a>. Let's take a look at our Main method for to request the campaign:
<pre class="lang:default decode:true prettyprint lang-java">package dev.marketo.blog_request_campaign;

import com.eclipsesource.json.JsonArray;

public class App
{
    public static void main( String[] args )
    {
    	//Create an instance of Auth so that we can authenticate with our Marketo instance
        Leads leadsRequest = new Leads(auth).setFilterType("email").addFilterValue("requestCampaign.test@marketo.com");

        //Create and parameterize an instance of Leads
        //Set your email filterValue appropriately
        Leads leadsRequest = new Leads(auth).setFilterType("email").addFilterValue("test.requestCamapign@example.com");

        //Get the inner results array of the response
        JsonArray leadsResult = leadsRequest.getData().get("result").asArray();

        //Get the id of the record indexed at 0
        int lead = leadsResult.get(0).asObject().get("id").asInt();

        //Set the ID of your campaign from Marketo
        int campaignId = 0;
        RequestCampaign rc = new RequestCampaign(auth, campaignId).addLead(lead);

        //Send the request to Marketo
        rc.postData();
    }
}</pre>
To get to these results from the JsonObject response of leadsRequest, we'll need to write some code .  To retrieve the first result in the Array, we need to extract the Array from the JsonObject and get the object indexed at 0:
<pre class="lang:default decode:true prettyprint lang-java">JsonArray leadsResult = leadsRequest.getData().get("result").asArray();
int leadId = leadsResult.get(0).asObject().get("id").asInt();</pre>
From here now all we need to do is the Request Campaign call.  For this, the required parameters are ID in the URL of the request, and an array of JSON objects containing one member, "id."  Let's take a look at the code for this:
<pre class="lang:default decode:true prettyprint lang-java">package dev.marketo.blog_request_campaign;
import java.io.IOException;
import java.io.InputStream;
import java.io.InputStreamReader;
import java.io.OutputStreamWriter;
import java.io.Reader;
import java.net.MalformedURLException;
import java.net.URL;
import java.util.ArrayList;
import javax.net.ssl.HttpsURLConnection;
import com.eclipsesource.json.JsonArray;
import com.eclipsesource.json.JsonObject;

public class RequestCampaign {
	private String endpoint;
	private Auth auth;
	public ArrayList leads = new ArrayList();
	public ArrayList tokens = new ArrayList();
	
	public RequestCampaign(Auth auth, int campaignId) {
		this.auth = auth;
		this.endpoint = this.auth.marketoInstance + "/rest/v1/campaigns/" + campaignId + "/trigger.json";
	}
	public RequestCampaign setLeads(ArrayList leads) {
		this.leads = leads;
		return this;
	}
	public RequestCampaign addLead(int lead){
		leads.add(lead);
		return this;
	}
	public RequestCampaign setTokens(ArrayList tokens) {
		this.tokens = tokens;
		return this;
	}
	public RequestCampaign addToken(String tokenKey, String val){
		JsonObject jo = new JsonObject().add("name", tokenKey);
		jo.add("value", val);
		tokens.add(jo);
		return this;
	}
	public JsonObject postData(){
		JsonObject result = null;
		try {
			JsonObject requestBody = buildRequest(); //builds the Json Request Body
			String s = endpoint + "?access_token=" + auth.getToken(); //takes the endpoint URL and appends the access_token parameter to authenticate
			System.out.println("Executing RequestCampaign calln" + "Endpoint: " + s + "nRequest Body:n"  + requestBody);
			URL url = new URL(s); 
			HttpsURLConnection urlConn = (HttpsURLConnection) url.openConnection(); //Return a URL connection and cast to HttpsURLConnection
			urlConn.setRequestMethod("POST");
			urlConn.setRequestProperty("Content-type", "application/json");
            urlConn.setRequestProperty("accept", "text/json");
            urlConn.setDoOutput(true);
			OutputStreamWriter wr = new OutputStreamWriter(urlConn.getOutputStream());
			wr.write(requestBody.toString());
			wr.flush();
			InputStream inStream = urlConn.getInputStream(); //get the inputStream from the URL connection
			Reader reader = new InputStreamReader(inStream);
			result = JsonObject.readFrom(reader); //Read from the stream into a JsonObject
			System.out.println("Result:n" + result);
		} catch (MalformedURLException e) {
			e.printStackTrace();
		} catch (IOException e) {
			e.printStackTrace();
		}
		return result;
	}
	
	private JsonObject buildRequest(){
		JsonObject requestBody = new JsonObject(); //Create a new JsonObject for the Request Body
		JsonObject input = new JsonObject();
		JsonArray leadsArray = new JsonArray();
		for (int lead : leads) {
			JsonObject jo = new JsonObject().add("id", lead);
			leadsArray.add(jo);
		}
		input.add("leads", leadsArray);
		JsonArray tokensArray = new JsonArray();
		for (JsonObject jo : tokens) {
			tokensArray.add(jo);
		}
		input.add("tokens", tokensArray);
		requestBody.add("input", input);
		return requestBody;
	}

}
</pre>
This class has one constructor taking an Auth, and the Id of the campaign.  Leads are added to the object either by passing an ArrayList&lt;Integer&gt; containing the Ids of the records to setLeads, or by using addLead, which takes one integer and appends it to the existing ArrayList in the leads property.  To trigger the API call to pass the lead records to the campaign, postData needs to be called, which returns a JsonObject containing the response data from the request.  When request campaign is called, every lead passed to the call will be processed by the target trigger campaign in Marketo and be sent the email which was created previously. Congratulations, you've triggered an email through the Marketo REST API.  Keep an eye out for Part 2 where we'll look at dynamically customizing the content of an email through Request Campaign.

Read Part 2 <a href="/blog/sending-transactional-emails-with-the-marketo-rest-api-part-2-custom-content/">here</a>.<br/><br/>kelkington - 2015-07-17<br/><br/><h2>Authenticating and Retrieving Lead Data from Marketo with the REST API</h2><br/><br/><strong>Note: </strong>In the Java examples below, we’ll be using the minimal-json package to handle JSON representations in our code.  You can read more about this project here: <a href="https://github.com/ralfstx/minimal-json">https://github.com/ralfstx/minimal-json</a>

One of the most common requirements when integrating with Marketo is the retrieval of lead data.  Most, if not all integrations will require either the retrieval or submission of lead data from a Marketo subscription, so today we will take a look at a basic lead information retrieval task, by <a href="/rest-api/authentication/" target="_blank">authenticating</a> with a subscription and then retrieving lead data from it.  If you haven’t yet provisioned an API user and a <a href="/rest-api/custom-services/" target="_blank">Custom Service</a>, check out our <a href="/blog/quick-start-guide-for-marketo-rest-api/">Quick Start Guide</a> for some quick configuration instructions.

To retrieve our leads, first we need to authenticate with the target Marketo instance using OAuth 2.0.   There are three pieces of information we need to authenticate with Marketo, the client ID, client secret, and the host of the Marketo instance.  Here’s the class we’ll be using to authenticate:

<pre class="lang:default decode:true prettyprint lang-java">package dev.marketo.blog_leads;
import java.io.IOException;
import java.io.InputStream;
import java.io.InputStreamReader;
import java.io.Reader;
import java.net.MalformedURLException;
import java.net.URL;
import javax.net.ssl.HttpsURLConnection;
import com.eclipsesource.json.JsonObject;

public class Auth {
	protected String marketoInstance; //Instance Host obtained from Admin -&gt; Web Service
	private String clientId; //clientId obtained from Admin -&gt; Launchpoint -&gt; View Details for selected service
	private String clientSecret; //clientSecret obtained from Admin -&gt; Launchpoint -&gt; View Details for selected service
	private String idEndpoint; //idEndpoint constructed to authenticate with service when constructor is used
	private String token; //token is stored for reuse until expiration
	private Long expiry; //used to store time of expiration
	
	//Creates an instance of Auth which is used to Authenticate with a particular service on a particular instance
	public Auth(String id, String secret, String instanceUrl) {
		this.clientId = id;
		this.clientSecret = secret;
		this.marketoInstance = instanceUrl;
		this.idEndpoint = marketoInstance + "/identity/oauth/token?grant_type=client_credentials&amp;client_id=" + clientId + "&amp;client_secret=" + clientSecret;
	}
	//The only public method of Auth, used to check if the current value of Token is valid, and then to retrieve a new one if it is not
	public String getToken(){
		long now  = System.currentTimeMillis();
		if (expiry == null || expiry &lt; now){
			System.out.println("Token is empty or expired. Trying new authentication");
			JsonObject jo = getData();
			System.out.println("Got Authentication Response: " + jo);
			this.token = jo.get("access_token").asString();
                        //expires_in is reported as seconds, set expiry to system time in ms + expires * 1000
			this.expiry = System.currentTimeMillis() + (jo.get("expires_in").asLong() * 1000);
		}
		return this.token;
	}
	//Executes the authentication request
	private JsonObject getData(){
		JsonObject jsonObject = null;
		try {
			URL url = new URL(idEndpoint);
			HttpsURLConnection urlConn = (HttpsURLConnection) url.openConnection();
			urlConn.setRequestMethod("GET");
            urlConn.setRequestProperty("accept", "application/json");
            System.out.println("Trying to authenticate with " + idEndpoint);
            int responseCode = urlConn.getResponseCode();
            if (responseCode == 200) {
                InputStream inStream = urlConn.getInputStream();
                Reader reader = new InputStreamReader(inStream);
                jsonObject = JsonObject.readFrom(reader);
            }else {
                throw new IOException("Status: " + responseCode);
            }
		} catch (MalformedURLException e) {
			e.printStackTrace();
		}catch (IOException e) {
            e.printStackTrace();
        }
		return jsonObject;
	}
}</pre>
This code allows you to create an instance of Auth with our client ID, client secret and host (as marketoInstance) from Admin -&gt; Launchpoint (ID and Secret) and Admin -&gt; Web Services (Host).  It exposes the getToken method which tests whether the currently stored token is null or expired, and then returns either the existing token, or makes a new authentication request then returns the new token from the "access_token" member of the JSON response.

Now that you can authenticate with your Marketo instance, the next step is to retrieve our leads.  We'll be using this class:
<pre class="lang:default decode:true prettyprint lang-java">package dev.marketo.blog_leads;
import java.io.IOException;
import java.io.InputStream;
import java.io.InputStreamReader;
import java.io.Reader;
import java.net.MalformedURLException;
import java.net.URL;
import java.util.ArrayList;
import javax.net.ssl.HttpsURLConnection;
import com.eclipsesource.json.JsonObject;

public class Leads {
	private StringBuilder endpoint;
	private Auth auth;
	public String filterType;
	public ArrayList filterValues = new ArrayList();
	public Integer batchSize;
	public String nextPageToken;
	public ArrayList fields = new ArrayList();
	
	public Leads(Auth a) {
		this.auth = a;
		this.endpoint = new StringBuilder(this.auth.marketoInstance + "/rest/v1/leads.json");
	}
	public Leads setFilterType(String filterType) {
		this.filterType = filterType;
		return this;
	}
	public Leads setFilterValues(ArrayList filterValues) {
		this.filterValues = filterValues;
		return this;
	}
	public Leads addFilterValue(String filterVal) {
		this.filterValues.add(filterVal);
		return this;
	}
	public Leads setBatchSize(Integer batchSize) {
		this.batchSize = batchSize;
		return this;
	}
	public Leads setNextPageToken(String nextPageToken) {
		this.nextPageToken = nextPageToken;
		return this;
	}
	public Leads setFields(ArrayList fields) {
		this.fields = fields;
		return this;
	}

	public JsonObject getData() {
        JsonObject result = null;
        try {
        	endpoint.append("?access_token=" + auth.getToken() + "&amp;filterType=" + filterType + "&amp;filterValues=" + csvString(filterValues));
        	if (batchSize != null &amp;&amp; batchSize &gt; 0 &amp;&amp; batchSize &lt;= 300){
            	endpoint.append("&amp;batchSize=" + batchSize);
            }
            if (nextPageToken != null){
            	endpoint.append("&amp;nextPageToken=" + nextPageToken);
            }
            if (fields != null){
            	endpoint.append("&amp;fields=" + csvString(fields));
            }
            URL url = new URL(endpoint.toString());
            HttpsURLConnection urlConn = (HttpsURLConnection) url.openConnection();
            urlConn.setRequestMethod("GET");
            urlConn.setRequestProperty("accept", "text/json");
            InputStream inStream = urlConn.getInputStream();
            Reader reader = new InputStreamReader(inStream);
            result = JsonObject.readFrom(reader);
        } catch (MalformedURLException e) {
            System.out.println("URL not valid.");
        } catch (IOException e) {
            System.out.println("IOException: " + e.getMessage());
            e.printStackTrace();
        }
        return result;
    }
	private String csvString(ArrayList fields) {
		StringBuilder fieldCsv = new StringBuilder();
    	for (int i = 0; i &lt; fields.size(); i++){
    		fieldCsv.append(fields.get(i));
    		if (i + 1 != fields.size()){
    			fieldCsv.append(",");
    		}
    	}
		return fieldCsv.toString();
	}
}
</pre>
This class has a single constructor which accepts an Auth object, and then exposes several setters for both optional and required parameters.  In this case, we really only need to concern ourselves with setting the filterType and filterValues to perform get leads by email address.  So we'll use setFilterType for "email", and addFilterValue for the email address that we need to retrieve an ID for.  When you've set your parameters, you can use the getData method to retrieve a JsonObject from the leads endpoint, containing a results array which has a JSON representation of the lead records which were retrieved.
<h3>Putting it together</h3>
Now that we've gone through the sample code that we'll be using let's take a look at a simple example to retrieve leads matching a test email address, testlead@marketo.com.  For this we'll need to use setFilterType for "email", and addFilterValue for the email address that we need to retrieve information for.  When you've set your parameters, you can use the getData method to retrieve a JsonObject from the leads endpoint, containing a results array which has a JSON representation of the lead records which were retrieved.
<pre class="lang:default decode:true prettyprint lang-java">package dev.marketo.blog_leads;

import com.eclipsesource.json.JsonObject;

public class App
{
    public static void main( String[] args )
    {
    	//Create an instance of Auth so that we can authenticate with our Marketo instance
        //Change the credentials here to your own
        Auth auth = new Auth("CHANGE ME", "CHANGE ME", "CHANGE ME");
        //Create and parameterize an instance of Leads
        Leads getLeads = new Leads(auth)
        						.setFilterType("email")
        						.addFilterValue("testlead@marketo.com");
        //get the inner results array of the response
        JsonObject leadsResult = getLeads.getData();
        System.out.println(leadsResult);
    }
}</pre>
In this main method example, we create an instance of Auth, and then pass this to a new Leads constructor.  Using setFilterType, and addFilterValue, we configure our instance of Leads to retrieve just leads matching the email address "testlead@marketo.com."  This example prints this out to the console:
<pre class="lang:default decode:true ">Token is empty or expired. Trying new authentication
Trying to authenticate with https://299-BYM-827.mktorest.com/identity/oauth/token?grant_type=client_credentials&amp;client_id=b417d98f-9289-47d1-a61f-db141bf0267f&amp;client_secret=0DipOvz4h2wP1ANeVjlfwMvECJpo0ZYc
Got Authentication Response: {"access_token":"ec0f02c0-28ac-4d6c-b7d7-00e47ae85ff1:st","token_type":"bearer","expires_in":538,"scope":"apiuser@mktosupport.com"}
{"requestId":"14fb6#14e6a7a9ad6","result":[{"id":1026322,"updatedAt":"2015-07-07T21:43:25Z","lastName":"Lead","email":"testlead@marketo.com","createdAt":"2015-07-07T21:43:25Z","firstName":"Test"},{"id":1026323,"updatedAt":"2015-07-07T21:43:43Z","lastName":"Lead2","email":"testlead@marketo.com","createdAt":"2015-07-07T21:43:43Z","firstName":"Test"}],"success":true}</pre>
Now we have lead data which we can process in whatever way that we need.  Thanks for reading, and please leave any feedback you have in the comments.<br/><br/>kelkington - 2015-07-10<br/><br/><h2>July 2015 Release Updates</h2><br/><br/>REST API
<ul>
 	<li>Sales Person API</li>
</ul>
<p style="padding-left: 60px;">New <a href="/documentation/sales-persons">sales person endpoints</a> have been introduced that allow you to programmatically list, describe, and CRUD the data residing within a Marketo sales person object.<b>  </b>In addition, a sales person can be assigned to a lead, opportunity, or company.  This is done by specifying an "externalSalesPersonId" attribute when calling the Create/Update/Upsert endpoint for lead, opportunity, or company.</p>
<p style="padding-left: 60px;">Note:  Role permissions were added to provide access to the Program endpoints: Read-Only Sales Person, Read-Write Sales Person.  If your API user role predates the release of the Sales Person APIs, then you will need to update your API user role with these permissions to enable access.  Otherwise, you will receive a 603 “Access Denied” error response.</p>

<ul>
 	<li>Asset API - Landing Page Template</li>
</ul>
<p style="padding-left: 60px;">New <a href="/documentation/asset-api/#landing_page_templates_endpoints">landing page template endpoints</a> have been introduced that allow you to programmatically list, create, and update the data associated with a landing page template.</p>

<ul>
 	<li>Asset API - Segments</li>
</ul>
<p style="padding-left: 60px;">Two segment-related endpoints have been introduced:</p>
<p style="padding-left: 90px;"><a href="/documentation/asset-api/get-segments">Get Segments</a></p>
<p style="padding-left: 90px;"><a href="/documentation/asset-api/get-segmentation-by-id">Get Segmentation by Id</a></p>

<ul>
 	<li>Fixed issue where Get Folder by Name was not honoring the "workSpace" parameter.  [LM-61059]</li>
 	<li>Made several performance improvements to the Custom Object APIs.</li>
</ul><br/><br/>deverly - 2015-07-17<br/><br/><h2>Create and Associate Leads, Companies, and Opportunities with the Marketo REST API</h2><br/><br/>In order to take full advantage of Marketo analytics it is crucial to build out correct and robust associations between your lead, company and opportunity records.  When you are not leveraging a native CRM-sync, building these relationships can pose some difficulties, so today we'll walk through building them.
<h4>Object Relationships</h4>
In Marketo, there are a few vital relationships to fully establish opportunity reporting:
<ul>
 	<li>Leads and Opportunities have a many to many relationship via the OpportunityRole object.</li>
 	<li>OpportunityRole has both a leadId and externalopportunityid field to create the relationship from lead to opportunity.</li>
 	<li>In order to qualify for a Has Opportunity smart list filter, a lead must have an OpportunityRole related to an opportunity.</li>
 	<li>Opportunities have a many-to-one relationship to the Company object via the externalCompanyId field.</li>
 	<li>Leads have a one-to-many relationship to Companies via the externalCompanyId field.</li>
 	<li>Opportunities are attributed to a program based on a lead's Acquisition Program or their membership and success in a program (See <a href="https://docs.marketo.com/display/public/DOCS/Understanding+Attribution">Understanding Attribution</a>).</li>
</ul>
Building out these relationships across your lead database will allow you to fully leverage Marketo analytics and see the influence that your programs have on opportunity creation and win rates.
<h4>Companies</h4>
The simplest way to build out these relationships is by starting with company creation.  This ensures that we can pass externalCompanyId to our opportunities during creation, instead of having to perform additional API calls to update opportunities after they've been created.  Depending on existing configuration, this may or may not be a necessary step, but net new leads and contacts with associated companies will need to have these records added to your Marketo instance in order for the relationships to be built, so let's take a look at some code to create company records.
<pre class="lang:default decode:true prettyprint">package dev.marketo.opportunities;

import java.io.IOException;
import java.io.InputStream;
import java.io.InputStreamReader;
import java.io.OutputStreamWriter;
import java.io.Reader;
import java.net.MalformedURLException;
import java.net.URL;
import java.util.ArrayList;
import java.util.List;

import javax.net.ssl.HttpsURLConnection;

import com.eclipsesource.json.JsonArray;
import com.eclipsesource.json.JsonObject;

public class UpsertCompanies {
	public List&lt;JsonObject&gt; input; //a list of Companies to use for input.  Each must have a member "externalCompanyId".
	public String action; //specify the action to be undertaken, createOnly, updateOnly, createOrUpdate 
	public String dedupeBy; //select mode of Deduplication, dedupeFields for all dedupe parameters(externalCompanyId), idField for marketoId
	private String endpoint; //endpoint URL created with Constructor
	private Auth auth; //Marketo Auth Object
	
	
	//Constructs an UpsertOpportunities with Auth, but with no input set
	public UpsertCompanies(Auth auth){
		this.auth = auth;
		this.endpoint = this.auth.marketoInstance + "/rest/v1/companies.json";
	}
	//Constructs and UpsertOpportunities with Auth and input set
	public UpsertCompanies(Auth auth, List&lt;JsonObject&gt; input) {
		this(auth);
		this.input = input;
	}
	//adds input to existing list, creates arraylist if it was built without a list
	public UpsertCompanies addCompanies(JsonObject... companies){
		if (this.input == null){
			this.input = new ArrayList();
		}
		for (JsonObject jo : companies) {
			System.out.println(jo);
			this.input.add(jo);
		}
		return this;
	}
	
	public JsonObject postData(){
		JsonObject result = null;
		try {
			JsonObject requestBody = buildRequest(); //builds the Json Request Body
			String s = endpoint + "?access_token=" + auth.getToken(); //takes the endpoint URL and appends the access_token parameter to authenticate
			URL url = new URL(s); 
			HttpsURLConnection urlConn = (HttpsURLConnection) url.openConnection(); //Return a URL connection and cast to HttpsURLConnection
			urlConn.setRequestMethod("POST");
			urlConn.setRequestProperty("Content-type", "application/json");
            urlConn.setRequestProperty("accept", "text/json");
            urlConn.setDoOutput(true);
			OutputStreamWriter wr = new OutputStreamWriter(urlConn.getOutputStream());
			wr.write(requestBody.toString());
			wr.flush();
			InputStream inStream = urlConn.getInputStream(); //get the inputStream from the URL connection
			Reader reader = new InputStreamReader(inStream);
			result = JsonObject.readFrom(reader); //Read from the stream into a JsonObject
			urlConn.disconnect();
		} catch (MalformedURLException e) {
			e.printStackTrace();
		} catch (IOException e) {
			e.printStackTrace();
		}
		return result;
	}
	
	private JsonObject buildRequest(){
		JsonObject requestBody = new JsonObject(); //Create a new JsonObject for the Request Body
		JsonArray in = new JsonArray(); //Create a JsonArray for the "input" member to hold Opp records
		for (JsonObject jo : input) {
			in.add(jo); //add our company records to the input array
		}
		requestBody.add("input", in);
		if (this.action != null){
			requestBody.add("action", action); //add the action member if available
		}
		if (this.dedupeBy != null){
			requestBody.add("dedupeBy", dedupeBy); //add the dedupeBy member if available
		}
		return requestBody;
	}
	//Getters and Setters
	//Setters return the UpsertCompanies instance to allow simple formatting:
	public List&lt;JsonObject&gt; getInput() {
		return input;
	}
	//sets or replaces existing input with list
	public UpsertCompanies setInput(List input) {
		this.input = input;
		return this;
	}
	public String getAction() {
		return action;
	}
	public UpsertCompanies setAction(String action) {
		this.action = action;
		return this;
	}
	public String getDedupeBy() {
		return dedupeBy;
	}
	public UpsertCompanies setDedupeBy(String dedupeBy) {
		this.dedupeBy = dedupeBy;
		return this;
	}
	
}
</pre>
The companies API provides two deduplication options, set by the dedupeBy parameter in the request, "dedupeFields" and "idField."  These can be explicitly retrieved by calling <a href="/documentation/company-api/describe-company/">Describe Companies</a>.  If dedupeBy is unset, it defaults to dedupeFields.  In the case of company records, dedupeFields always corresponds to "externalCompanyId," which is an arbitrary string set by an external source, and idField, corresponding to the "marketoId" field, which is an integer generated and returned by Marketo after creation.  Depending on the selection for dedupeBy, one of externalCompanyId or marketoId must be included in any upsert call for a company record.  These same requirements apply to the Opportunity and Opportunity Role object APIs.

Our code exposes two constructors: one accepting a single argument of an <a title="Authenticating and Retrieving Lead Data from Marketo with the REST API" href="/blog/authenticating-and-retrieving-lead-data-from-marketo-with-the-rest-api/">Auth</a> object, and another which accepts Auth and a list of <a href="https://github.com/ralfstx/minimal-json">JsonObject</a> company records.  If constructed without an input List, then company records must be added through the addCompanies method, which will check create a new ArrayList if the input is null, and then add all JsonObject arguments to the input List. Here's an example usage:
<pre class="lang:default decode:true prettyprint">        //Create a new company to associate to
        JsonObject myCompany = new JsonObject().add("externalCompanyId", "myCompany");
        UpsertCompanies upsertCompanies = new UpsertCompanies(auth).addCompanies(myCompany);
        JsonObject companiesResult = upsertCompanies.postData();
        System.out.println(companiesResult);
</pre>
We're creating a single company JsonObject with just one field, externalCompanyId, then constructing an instance of UpsertCompanies, and adding our company to the input list with addCompanies.
<h4>Opportunities</h4>
Similar to the company objects, the opportunity API has a dedupeBy parameter, accepting "dedupeFields" or "idField," corresponding to "externalopportunityid" and "marketoGUID" respectively.  So here's our code, which looks quite similar to the UpsertCompanies class:
<pre class="lang:default decode:true prettyprint">package dev.marketo.opportunities;

import java.io.IOException;
import java.io.InputStream;
import java.io.InputStreamReader;
import java.io.OutputStreamWriter;
import java.io.Reader;
import java.net.MalformedURLException;
import java.net.URL;
import java.util.ArrayList;
import java.util.List;

import javax.net.ssl.HttpsURLConnection;

import com.eclipsesource.json.JsonArray;
import com.eclipsesource.json.JsonObject;

public class UpsertOpportunities {
	public List&lt;JsonObject&gt; input; //a list of Opportunities to use for input.  Each must have a member "externalopportunityid".  Each can optionally include "externalCompanyId" for company association
	public String action; //specify the action to be undertaken, createOnly, updateOnly, createOrUpdate 
	public String dedupeBy; //select mode of Deduplication, dedupeFields for all dedupe parameters, idField for marketoId
	private String endpoint; //endpoint URL created with Constructor
	private Auth auth; //Marketo Auth Object
	
	
	//Constructs an UpsertOpportunities with Auth, but with no input set
	public UpsertOpportunities(Auth auth){
		this.auth = auth;
		this.endpoint = this.auth.marketoInstance + "/rest/v1/opportunities.json";
	}
	//Constructs and UpsertOpportunities with Auth and input set
	public UpsertOpportunities(Auth auth, List&lt;JsonObject&gt; input) {
		this(auth);
		this.input = input;
	}
	public UpsertOpportunities addOpportunities(JsonObject... opp){
		if (this.input == null){
			this.input = new ArrayList();
		}
		for (JsonObject jo : opp) {
			System.out.println(jo);
			this.input.add(jo);
		}
		return this;
	}
	
	public JsonObject postData(){
		JsonObject result = null;
		try {
			JsonObject requestBody = buildRequest(); //builds the Json Request Body
			String s = endpoint + "?access_token=" + auth.getToken(); //takes the endpoint URL and appends the access_token parameter to authenticate
			URL url = new URL(s); 
			HttpsURLConnection urlConn = (HttpsURLConnection) url.openConnection(); //Return a URL connection and cast to HttpsURLConnection
			urlConn.setRequestMethod("POST");
			urlConn.setRequestProperty("Content-type", "application/json");
            urlConn.setRequestProperty("accept", "text/json");
            urlConn.setDoOutput(true);
			OutputStreamWriter wr = new OutputStreamWriter(urlConn.getOutputStream());
			wr.write(requestBody.toString());
			wr.flush();
			InputStream inStream = urlConn.getInputStream(); //get the inputStream from the URL connection
			Reader reader = new InputStreamReader(inStream);
			result = JsonObject.readFrom(reader); //Read from the stream into a JsonObject
			urlConn.disconnect();
		} catch (MalformedURLException e) {
			e.printStackTrace();
		} catch (IOException e) {
			e.printStackTrace();
		}
		return result;
	}
	
	private JsonObject buildRequest(){
		JsonObject requestBody = new JsonObject(); //Create a new JsonObject for the Request Body
		JsonArray in = new JsonArray(); //Create a JsonArray for the "input" member to hold Opp records
		for (JsonObject jo : input) {
			in.add(jo); //add our Opportunity records to the input array
		}
		requestBody.add("input", in);
		if (this.action != null){
			requestBody.add("action", action); //add the action member if available
		}
		if (this.dedupeBy != null){
			requestBody.add("dedupeBy", dedupeBy); //add the dedupeBy member if available
		}
		return requestBody;
	}
	//Getters and Setters
	//Setters return the UpsertOpportunites instance to allow simple formatting:
	public List&lt;JsonObject&gt; getInput() {
		return input;
	}
	public UpsertOpportunities setInput(List&lt;JsonObject&gt; input) {
		this.input = input;
		return this;
	}
	public String getAction() {
		return action;
	}
	public UpsertOpportunities setAction(String action) {
		this.action = action;
		return this;
	}
	public String getDedupeBy() {
		return dedupeBy;
	}
	public UpsertOpportunities setDedupeBy(String dedupeBy) {
		this.dedupeBy = dedupeBy;
		return this;
	}
	
}
</pre>
The same constructor options are provided, taking an Auth or Auth+List&lt;JsonObject&gt;, and an addOpportunities method to input JsonObject opportunities.  Here's a usage example:
<pre class="lang:default decode:true prettyprint">        //Create some JsonObjects for Opportunity Data
        JsonObject opp1 = new JsonObject().add("name", "opportunity1")
        			.add("externalopportunityid", "Opportunity1Test")
        			.add("externalCompanyId", "myCompany")
        			.add("externalCreatedDate", "2015-01-01T00:00:00z");
        JsonObject opp2 = new JsonObject().add("name", "opportunity2")
        			.add("externalopportunityid", "Opportunity2Test")
        			.add("externalCompanyId", "myCompany")
        			.add("externalCreatedDate", "2015-01-01T00:00:00z");

        //Create an Instance of UpsertOpportunities and POST it
        UpsertOpportunities upsertOpps = new UpsertOpportunities(auth)
                                .setAction("createOnly")
                                .addOpportunities(opp1, opp2);
        JsonObject oppsResult = upsertOpps.postData();
        System.out.println(oppsResult);
</pre>
Here, we're creating two example opportunities and then giving them values for the name, externalopportunityid, externalCompanyId, and externalCreatedDate fields.  We haven't discussed externalCreatedDate yet, but it is important to utilize since it is treated as the master field in RCE for when an opportunity was created, making it important for correct attribution.  You can use your organization's business logic to determine what you input in this field, based on whether you're backfilling existing opportunity data, or creating new ones on the fly.  We'll create our instance of UpsertOpportunities and then add our JsonObjects via addOpportunities.  Now that the instance is configured you can push this to Marketo with postData and print out your result
<h4>Roles</h4>
Roles are quite similar to the preceding two objects, except that they have a slightly different requirement when setting dedupeBy to dedupeFields.  Roles require that three fields be included when creating or updating a record via this method, "leadId," "role," and"externalopportunityid."  "role" may be any string value, but the other two must refer to a valid Id of a lead, and a valid Id of an opportunity respectively.
<pre class="lang:default decode:true prettyprint">package dev.marketo.opportunities;

import java.io.IOException;
import java.io.InputStream;
import java.io.InputStreamReader;
import java.io.OutputStreamWriter;
import java.io.Reader;
import java.net.MalformedURLException;
import java.net.URL;
import java.util.ArrayList;
import java.util.List;

import javax.net.ssl.HttpsURLConnection;

import com.eclipsesource.json.JsonArray;
import com.eclipsesource.json.JsonObject;

public class UpsertOpportunityRoles {
	public List&lt;JsonObject&gt; input; //Array of Opportunity Roles as JsonObjects, must have "leadId", "role" and "externalopprtunityid"
	public String action; //specify the action to be undertaken, createOnly, updateOnly, createOrUpdate, defaults to createOrUpdate if unset
	public String dedupeBy;//select mode of Deduplication, dedupeFields for all dedupe parameters, idField for marketoId
	private String endpoint; //endpoint URL created with Constructor
	private Auth auth; //Marketo Auth Object
	
	//Constructs an UpsertOpportunityRoles with Auth, but with no input set
	public UpsertOpportunityRoles(Auth auth) {
		this.auth = auth;
		this.endpoint = this.auth.marketoInstance + "/rest/v1/opportunities/roles.json";
	}
	//Constructs and UpsertOpportunities with Auth and input set
	public UpsertOpportunityRoles(Auth auth, List&lt;JsonObject&gt; input) {
		this(auth);
		this.input = input;
	}
	public UpsertOpportunityRoles addRoles(JsonObject... role){
		if (this.input == null){
			this.input = new ArrayList();
		}
		for (JsonObject jo : role) {
			System.out.println(jo);
			this.input.add(jo);
		}
		return this;
	}
	//executes the request to Marketo, body will be empty if input is not set
	public JsonObject postData(){
		JsonObject result = null;
		try {
			JsonObject requestBody = buildRequest(); //builds the Json Request Body
			String s = endpoint + "?access_token=" + auth.getToken(); //takes the endpoint URL and appends the access_token parameter to authenticate
			URL url = new URL(s);
			HttpsURLConnection urlConn = (HttpsURLConnection) url.openConnection(); //Return a URL connection and cast to HttpsURLConnection
			urlConn.setRequestMethod("POST");
			urlConn.setRequestProperty("Content-type", "application/json");//"application/json" content-type is required.
            urlConn.setRequestProperty("accept", "text/json");
            urlConn.setDoOutput(true);
			OutputStreamWriter wr = new OutputStreamWriter(urlConn.getOutputStream());
			wr.write(requestBody.toString());
			wr.flush();
			InputStream inStream = urlConn.getInputStream();  //get the inputStream from the URL connection
			Reader reader = new InputStreamReader(inStream);
			result = JsonObject.readFrom(reader); //Read from the stream into a JsonObject
			urlConn.disconnect();
		} catch (MalformedURLException e) {
			e.printStackTrace();
		} catch (IOException e) {
			e.printStackTrace();
		}
		return result;
	}
	
	public JsonObject buildRequest(){
		JsonObject requestBody = new JsonObject();
		JsonArray in = new JsonArray();
		for (JsonObject jo : input) {
			in.add(jo);
		}
		requestBody.add("input", in);
		if (this.action != null){
			requestBody.add("action", action);
		}
		if (this.dedupeBy != null){
			requestBody.add("dedupeBy", dedupeBy);
		}
		return requestBody;
	}
	//Getters and Setters
	//Setters return the UpsertOpportunites instance to allow simple formatting:
	public List&lt;JsonObject&gt; getInput() {
		return input;
	}
	public UpsertOpportunityRoles setInput(List&lt;JsonObject&gt; input) {
		this.input = input;
		return this;
	}
	public String getAction() {
		return action;
	}
	public UpsertOpportunityRoles setAction(String action) {
		this.action = action;
		return this;
	}
	public String getDedupeBy() {
		return dedupeBy;
	}
	public UpsertOpportunityRoles setDedupeBy(String dedupeBy) {
		this.dedupeBy = dedupeBy;
		return this;
	}
	
}
</pre>
We're following a similar pattern for the constructors and addRoles method as the previous examples.  Here's an example.
<pre class="lang:default decode:true prettyprint">        //Create Some opp roles now
        JsonObject opp1Role = new JsonObject()
                                .add("role", "Captain")
                                .add("externalopportunityid", opp1.get("externalopportunityid").asString())
                                .add("leadId", 318794);
        JsonObject opp2Role = new JsonObject()
                                .add("role", "Commander")
                                .add("externalopportunityid", opp2.get("externalopportunityid").asString())
                                .add("leadId", 318795);
        
        //Create an Instance of UpsertOpportunityRoles and POST it
        UpsertOpportunityRoles upsertRoles = new UpsertOpportunityRoles(auth)
                                .setAction("createOnly")
                                .addRoles(opp1Role, opp2Role);
        JsonObject rolesResult = upsertRoles.postData();
        System.out.println(rolesResult);

</pre>
Here we're creating the new JsonObjects for our 2 example roles, and adding their required dedupeFields, pulling the externalopportunityid from the opportunities we already created, then pushing them down to Marketo.
<h4>Putting It All Together</h4>
Here is the complete example of our main method:
<pre class="lang:default decode:true prettyprint ">package dev.marketo.opportunities;

import com.eclipsesource.json.JsonObject;

public class App
{
    public static void main( String[] args )
    {
    	//create an Instance of Auth 
        Auth auth = new Auth("CLIENT_ID_CHANGE_ME", "CLIENT_SECRET_CHANGE_ME", "MARKETO_HOST_CHANGE_ME");
        
        //Create a new company to associate to
        JsonObject myCompany = new JsonObject().add("externalCompanyId", "myCompany");
        UpsertCompanies upsertCompanies = new UpsertCompanies(auth).addCompanies(myCompany);
        JsonObject companiesResult = upsertCompanies.postData();
        System.out.println(companiesResult);
        
        //Create some JsonObjects for Opportunity Data
        JsonObject opp1 = new JsonObject().add("name", "opportunity1")
        			.add("externalopportunityid", "Opportunity1Test")
        			.add("externalCompanyId", "myCompany")
        			.add("externalCreatedDate", "2015-01-01T00:00:00z");
        JsonObject opp2 = new JsonObject().add("name", "opportunity2")
        			.add("externalopportunityid", "Opportunity2Test")
        			.add("externalCompanyId", "myCompany")
       				.add("externalCreatedDate", "2015-01-01T00:00:00z");

        //Create an Instance of UpsertOpportunities and POST it
        UpsertOpportunities upsertOpps = new UpsertOpportunities(auth)
                                .setAction("createOnly")
                                .addOpportunities(opp1, opp2);
        JsonObject oppsResult = upsertOpps.postData();
        System.out.println(oppsResult);
        
        //Create Some opp roles now
        JsonObject opp1Role = new JsonObject()
        			.add("role", "Captain")
        			.add("externalopportunityid", opp1.get("externalopportunityid").asString())
        			.add("leadId", 318794);
        JsonObject opp2Role = new JsonObject()
        			.add("role", "Commander")
        			.add("externalopportunityid", opp2.get("externalopportunityid").asString())
        			.add("leadId", 318795);
        
        //Create an Instance of UpsertOpportunityRoles and POST it
        UpsertOpportunityRoles upsertRoles = new UpsertOpportunityRoles(auth)
        			.setAction("createOnly")
        			.addRoles(opp1Role, opp2Role);
        JsonObject rolesResult = upsertRoles.postData();
        System.out.println(rolesResult);

    }
}
</pre>
You can see the sequence of creating companies, opportunities, and roles.  Now you're all set to sync your Company and Opportunity data to Marketo.<br/><br/>kelkington - 2015-08-07<br/><br/><h2>Sending Transactional Emails with the Marketo REST API: Part 2, Custom Content</h2><br/><br/><a href="/blog/sending-transactional-emails-with-the-marketo-rest-api-part-1/">Last time</a>, we took a look at triggering transactional emails from outside of Marketo.  This week we'll be looking at how to pass dynamic content to our emails via the Request Campaign API call.  Request Campaign not only allows the triggering of emails externally, but you can  also replace the content of <a href="https://docs.marketo.com/display/public/DOCS/Understanding+My+Tokens+in+a+Program">My Tokens</a> within an email.  My tokens are reusable content that can be customized at the program or marketing folder level.  These can also just exist as placeholders to be replaced through your request campaign call.  For instructions on configuring the smart campaign, see <a title="Sending Transactional Emails with the Marketo REST API: Part 1" href="/blog/sending-transactional-emails-with-the-marketo-rest-api-part-1/">part one</a>.
<h4>Building your Email</h4>
In order to customize our content, first we will need to configure a <a href="https://docs.marketo.com/display/public/DOCS/Create+a+Program">program</a> and an <a href="https://docs.marketo.com/display/public/DOCS/Create+a+New+Email">email</a> in Marketo.  To generate our custom content, we will need to create tokens inside of the program, and then place them into the email that we're going to be sending.  For simplicity's sake, we'll be using just one token in this example, but you can replace any number of tokens in an email, in the From Email, From Name, Reply-to or any piece of content in the email.  So let's create one token Rich Text for replacement and call it "bodyReplacement".  Rich Text allows us to replace any content in the token with arbitrary HTML that we want to input. <a href="https://marketohost.wpengine.com/wp-content/uploads/2015/07/New-Token.png"><img class="alignnone size-full wp-image-4569" src="https://marketohost.wpengine.com/wp-content/uploads/2015/07/New-Token.png" alt="create a new token" width="1633" height="940" /></a>

Tokens can't be saved while empty, so go ahead and insert some placeholder text here.  Now we need to insert our token into the email:

<a href="https://marketohost.wpengine.com/wp-content/uploads/2015/07/Add-Token.png"><img class="alignnone size-full wp-image-4567" src="https://marketohost.wpengine.com/wp-content/uploads/2015/07/Add-Token.png" alt="add token to email" width="979" height="617" /></a>

This token will now be accessible for replacement through a Request Campaign call.  This token can be as simple as a single line of text which needs to be replaced on a per-email basis, or can include almost the entire layout of the email.
<h4>The Code</h4>
In previous posts, we've looked at <a title="Authenticating and Retrieving Lead Data from Marketo with the REST API" href="/blog/authenticating-and-retrieving-lead-data-from-marketo-with-the-rest-api/">authenticating and retrieving lead records</a>, and <a title="Sending Transactional Emails with the Marketo REST API: Part 1" href="/blog/sending-transactional-emails-with-the-marketo-rest-api-part-1/">then sending an email to those leads</a>.  We'll be expanding on the code from last week to pass in customized tokens to our request campaign call.
<pre class="lang:default decode:true prettyprint lang-java">package dev.marketo.blog_request_campaign;

import com.eclipsesource.json.JsonArray;

public class App
{
    public static void main( String[] args )
    {
    	//Create an instance of Auth so that we can authenticate with our Marketo instance
        Auth auth = new Auth("Client ID - CHANGE ME", "Client Secret - CHANGE ME", "Host - CHANGE ME");
        
        //Create and parameterize an instance of Leads
        Leads leadsRequest = new Leads(auth).setFilterType("email").addFilterValue("requestCampaign.test@marketo.com");
        
        //get the inner results array of the response
        JsonArray leadsResult = leadsRequest.getData().get("result").asArray();
        
        //get the id of the record indexed at 0
        int lead = leadsResult.get(0).asObject().get("id").asInt();
        
        //Set the ID of our campaign from Marketo
        int campaignId = 1578;
        RequestCampaign rc = new RequestCampaign(auth, campaignId).addLead(lead);

        //Create the content of the token here, and add it to the request
        String bodyReplacement = "&lt;div class="replacedContent"&gt;&lt;p&gt;This content has been replaced&lt;/p&gt;&lt;/div&gt;";
        rc.addToken("{{my.bodyReplacement}}", bodyReplacement);
        rc.postData();
    }
}
</pre>
If the code looks familiar, that's because it only has two additional lines from the main method in the <a title="Sending Transactional Emails with the Marketo REST API: Part 1" href="/blog/sending-transactional-emails-with-the-marketo-rest-api-part-1/">previous post</a>.  This time we're creating the content of our token in the bodyReplacement variable and then using the addToken method to add it to the request.  addToken takes a key and a value and then creates a JsonObject representation and adds it to the internal tokens array.  This is then serialized during the postData method and creates a body that looks like this:
<pre class="lang:default decode:true prettyprint">{"input":{"leads":[{"id":1}],"tokens":[{"name":"{{my.bodyReplacement}}","value":"&lt;div class="replacedContent"&gt;&lt;p&gt;This content has been replaced&lt;/p&gt;&lt;/div&gt;"}]}}</pre>
Combined, our console output looks like this:
<pre class="lang:default decode:true prettyprint">Token is empty or expired. Trying new authentication
Trying to authenticate with&amp;nbsp;...
Got Authentication Response: {"access_token":"19d51b9a-ff60-4222-bbd5-be8b206f1d40:st","token_type":"bearer","expires_in":3565,"scope":"apiuser@mktosupport.com"}
Executing RequestCampaign call
Endpoint: .../rest/v1/campaigns/1578/trigger.json?access_token=19d51b9a-ff60-4222-bbd5-be8b206f1d40:st
Request Body:
{"input":{"leads":[{"id":1}],"tokens":[{"name":"{{my.bodyReplacement}}","value":"&lt;div class="replacedContent"&gt;&lt;p&gt;This content has been replaced&lt;/p&gt;&lt;/div&gt;"}]}}
Result:
{"requestId":"1e8d#14eadc5143d","result":[{"id":1578}],"success":true}
</pre>
<h4>Wrapping Up</h4>
This method is extensible in a multitude of ways, changing content in emails within individual layout sections, or outside emails, allowing custom values to be passed into tasks or interesting moments.  Anywhere a my token can be used from within a program can be customized using this method.  Similar functionality is also available with the <a href="/documentation/rest/schedule-campaign/">Schedule Campaign</a> call which will allow you to process tokens across an entire batch campaign.  These can't be customized on a per lead basis, but are very useful for customizing content across a wide set of leads.<br/><br/>kelkington - 2015-07-24<br/><br/><h2>Updating Lead Data in Marketo using the API</h2><br/><br/>Over a year ago we posted <a href="/blog/updating-customer-and-prospect-information-in-marketo-using-the-api/">Updating customer and prospect information in Marketo using the API</a>.  That post presented a code sample that could be run on a recurring basis to poll a external system for updates.  The idea was to retrieve the external data and push it into Marketo to update lead information.  The code sample presented used our SOAP API.  This post will show you how to use <a href="/documentation/rest/createupdate-leads/">Create/Update Leads</a> REST endpoint to accomplish the same goal.

<a href="https://marketohost.wpengine.com/wp-content/uploads/2015/08/Updating_Lead_Data_Overview1.png"><img class="alignnone size-full wp-image-4753" src="https://marketohost.wpengine.com/wp-content/uploads/2015/08/Updating_Lead_Data_Overview1.png" alt="Updating_Lead_Data_Overview" width="1000" height="690" /></a>

<strong>Program Input</strong>

It is likely that you will need to transform the data from the external system into a format that is consumable by Marketo REST APIs.  Since we're using the Create/Update Leads API, the data must be formatted as JSON which is sent in the request body.  This is best explained by an example.

In the Java sample code below, we have placed mock lead data in an array of strings.  Each string following data for each lead: first name, last name, email address, job title.
<pre class="lang:default decode:true prettyprint lang-java">private static String externalLeadData[] = {
        "Henry, Adams, henry@superstar.com, Director of Demand Generation",
        "Suzie, Smith, ssmith@gmail.com, VP Marketing"
};</pre>
The sample code transforms the array into the JSON block below.
<pre class="lang:default decode:true prettyprint lang-java">{
    "input":
        [
            {"firstName":"Henry", "lastName":"Adams", "email":"henry@superstar.com", "title":"Director of Demand Generation"},
            {"firstName":"Suzie", "lastName":"Smith", "email":"ssmith@gmail.com", "title":"VP Marketing"}
        ]
}</pre>
Each "input" array item corresponds to an individual lead in Marketo.  The array items are JSON objects that contain one or more Marketo lead field names and their respective values.

The field names that you decide to specify (in this case firstName, lastName, email, and title) must match the REST API name defined for the Marketo subscription.  You can find the REST API Names in the field management section within Marketo admin panel by exporting the field names.

<a href="https://marketohost.wpengine.com/wp-content/uploads/2015/08/field_management_export_field_names.png"><img class="alignnone size-full wp-image-4733" src="https://marketohost.wpengine.com/wp-content/uploads/2015/08/field_management_export_field_names.png" alt="field_management_export_field_names" width="995" height="497" /></a>

The field names will be exported into an excel file as seen below.

<a href="https://marketohost.wpengine.com/wp-content/uploads/2015/08/field_names_in_excel.png"><img class="alignnone size-full wp-image-4735" src="https://marketohost.wpengine.com/wp-content/uploads/2015/08/field_names_in_excel.png" alt="field_names_in_excel" width="670" height="123" /></a>

Alternatively, you can find field names programmatically by calling the <a href="http://developers.marketo.com/documentation/rest/describe/">Describe Lead</a> API.  For example, here is a Describe response snippet that contains the REST API name for the First Name field.
<pre class="lang:default mark:11 decode:true prettyprint lang-java ">{
    "id": 29,
    "displayName": "First Name",
    "dataType": "string",
    "length": 255,
    "soap": {
        "name": "FirstName",
        "readOnly": false
    },
    "rest": {
        "name": "firstName",
        "readOnly": false
    }
},
</pre>
<strong>Program Logic</strong>

Once the payload is in the proper format, we are ready to call Create/Update Leads.  Note that in this sample we do not specify any of the optional parameters.  The default behavior is to create or update lead records (upsert), use email for deduplication purposes, and use synchronous processing.

If the call to Create/Update leads is successful, then the response body contains a "result" array containing the Marketo Lead Id and the status of the Create/Update operation.  Depending on the "action" parameter you passed in the request, the status can be either "updated", "created", or "skipped".

Continuing with our example, suppose the first lead did not exist (Henry Adams), and the second lead did exist (Suzie Smith).  A response similar to the following would indicate the first lead was created, and the second lead was updated.
<pre class="lang:default decode:true prettyprint lang-java">{
    "success":true,
    "requestId":"118f8#14f1a0b82fc",
    "result":[
        {
            "id":318798,
            "status":"created"
        },
        {
            "id":318797,
            "status":"updated"
        }
    ]
}
</pre>
That's it for now.  Happy coding!

<strong>Program Code</strong>
<pre class="lang:default decode:true prettyprint lang-java ">package com.marketo;

// minimal-json library (https://github.com/ralfstx/minimal-json)
import com.eclipsesource.json.JsonArray;
import com.eclipsesource.json.JsonObject;

import javax.net.ssl.HttpsURLConnection;
import java.io.IOException;
import java.io.InputStream;
import java.io.OutputStreamWriter;
import java.net.MalformedURLException;
import java.net.URL;
import java.util.*;

public class CreateUpdateLeads {
    //
    // Define Marketo REST API access credentials: Account Id, Client Id, Client Secret.  For example:
    //    public static String CUSTOM_SERVICE_DATA[] =
    //      {"111-AAA-222", "2f4a4435-f6fa-4bd9-3248-098754982345", "asdf6IVE9h4Jjcl59cOMAKFSk78ut12W"};
    //
    private static final String CUSTOM_SERVICE_DATA[] =
            { INSERT YOUR CUSTOM SERVICE DATA HERE };

    //
    // Mock up data that could be read from an external data source.
    // An array of CSV strings the form:
    //   "firstName, lastName, email, title"
    private static String externalLeadData[] = {
        "Henry, Adams, henry@superstar.com, Director of Demand Generation",
        "Suzie, Smith, ssmith@gmail.com, VP Marketing"
    };

    public static void main(String[] args) {
        // Compose base URL
        String baseUrl = String.format("https://%s.mktorest.com",
                CUSTOM_SERVICE_DATA[0]);

        // Compose Identity URL
        String identityUrl = String.format("%s/identity/oauth/token?grant_type=%s&amp;client_id=%s&amp;client_secret=%s",
                baseUrl, "client_credentials", CUSTOM_SERVICE_DATA[1], CUSTOM_SERVICE_DATA[2]);

        // Call Identity API
        JsonObject identityObj = JsonObject.readFrom(httpRequest("GET", identityUrl, null));
        String accessToken = identityObj.get("access_token").asString();

        // Compose URL for Create/Update Leads
        String createUpdateLeadsUrl = String.format("%s/rest/v1/leads.json?access_token=%s", baseUrl, accessToken);

        // Convert String array into JsonArray to pass as part of request body
        JsonArray input = convertExternalLeadDataToJson(externalLeadData);

        // Build request body JSON
        JsonObject requestObj = new JsonObject();
        requestObj.add("input", input);

        // Call Create/Update Lead API
        JsonArray result = new JsonArray();
        JsonObject leadObj = JsonObject.readFrom(httpRequest("POST", createUpdateLeadsUrl, requestObj.toString()));
        if (leadObj.get("success").asBoolean()) {
            if (leadObj.get("result") != null) {
                result = leadObj.get("result").asArray();
            }
        }

        // Print out results object
        System.out.println(result);
        System.exit(0);
    }

    // Convert array of CSV formatted Strings into an array of JSON objects
    private static JsonArray convertExternalLeadDataToJson(String input[]) {
        JsonArray output = new JsonArray();

        // Loop through each CSV row in array
        for (int i = 0; i &lt; input.length; i++) {
            // Split CSV row into separate fields
            List items = Arrays.asList(input[i].split(","));

            // Add fields to JSON object
            JsonObject lead = new JsonObject();
            lead.add("firstName", items.get(0));
            lead.add("lastName", items.get(1));
            lead.add("email", items.get(2));
            lead.add("title", items.get(3));
            output.add(lead);
        }
        return output;
    }

    // Perform HTTP request
    private static String httpRequest(String method, String endpoint, String body) {
        String data = "";
        try {
            URL url = new URL(endpoint);
            HttpsURLConnection urlConn = (HttpsURLConnection) url.openConnection();
            urlConn.setDoOutput(true);
            urlConn.setRequestMethod(method);
            switch (method) {
                case "GET":
                    break;
                case "POST":
                    urlConn.setRequestProperty("Content-type", "application/json");
                    urlConn.setRequestProperty("accept", "text/json");
                    OutputStreamWriter wr = new OutputStreamWriter(urlConn.getOutputStream());
                    wr.write(body);
                    wr.flush();
                    break;
                default:
                    System.out.println("Error: Invalid method.");
                    return data;
            }
            int responseCode = urlConn.getResponseCode();
            if (responseCode == 200) {
                InputStream inStream = urlConn.getInputStream();
                data = convertStreamToString(inStream);
            } else {
                System.out.println(responseCode);
                data = "Status:" + responseCode;
            }
        } catch (MalformedURLException e) {
            System.out.println("URL not valid.");
        } catch (IOException e) {
            System.out.println("IOException: " + e.getMessage());
            e.printStackTrace();
        }
        return data;
    }

    private static String convertStreamToString(InputStream inputStream) {
        try {
            return new Scanner(inputStream).useDelimiter("A").next();
        } catch (NoSuchElementException e) {
            return "";
        }
    }
}</pre>
&nbsp;<br/><br/>deverly - 2015-08-14<br/><br/><h2>Add SalesPerson Data to Marketo</h2><br/><br/>With the new SalesPerson APIs, you can freely associate Marketo leads to SalesPerson records in instances without a native CRM integration. This allows usage of {{lead.Lead Owner Email Address}} and related fields and tokens within Marketo.
<h4>Creating SalesPerson records</h4>
In order to associate leads to SalesPerson records, we first need to input our SalesPerson records into Marketo. This is done with the <a href="/documentation/sales-persons/createupdateupsert-sales-persons/">Create/Update/Upsert SalesPerson endpoint</a>. Here’s an example class in PHP:
<pre class="lang:default decode:true prettyprint lang-php">&lt;?php

class SalesPerson{
	private $auth;//auth object
	private $action;// string designating request action, createOnly, updateOnly, createOrUpdate
	private $dedupeBy;//dedupeFields or idField
	private $input;//array of salesperson objects for input
	
	//takes an Auth object as the first argument
	public function __construct($auth, $input){
		$this-&gt;auth = $auth;
		$this-&gt;input = $input;
	}
	
	//constructs the json request body
	private function bodyBuilder(){
		$body = new stdClass();
		$body-&gt;input = $this-&gt;input;
		if (isset($this-&gt;action)){
			$body-&gt;action = $this-&gt;action;
		}
		if (isset($this-&gt;dedupeBy)){
			$body-&gt;dedupeBy = $this-&gt;dedupeBy;
		}
		return json_encode($body);
	}
	//submits the request to Marketo and returns the response as a string
	public function postData(){
		$url = $this-&gt;auth-&gt;getHost() . "/rest/v1/salespersons.json?access_token=" . $this-&gt;auth-&gt;getToken();
		$ch = curl_init($url);
		$requestBody = $this-&gt;bodyBuilder();
		curl_setopt($ch,  CURLOPT_RETURNTRANSFER, 1);
		curl_setopt($ch, CURLOPT_HTTPHEADER, array('accept: application/json','Content-Type: application/json'));
		curl_setopt($ch, CURLOPT_POST, 1);
		curl_setopt($ch, CURLOPT_POSTFIELDS, $requestBody);
		curl_getinfo($ch);
		$response = curl_exec($ch);
		curl_close($ch);
		return $response;
	}
	//getters and setters
	public function setAction($action){
		$this-&gt;action = $action;
	}
	public function getAction($action){
		return $this-&gt;action;
	}
	public function setDedupeBy($dedupeBy){
		$this-&gt;dedupeBy = $dedupeBy;
	}
	public function getDedupeBy($dedupeBy){
		return $this-&gt;dedupeBy;
	}
	public function addSalesPersons($input){
		if($this-&gt;input != null){
			if (is_array($input)){
				foreach($input as $item){
					array_push($this-&gt;input, $item);
				}
			}else{
				array_push($this-&gt;input, $input);
			}
		}else{
			$this-&gt;input = $input;
		}
	}
	public function getInput(){
		return $this-&gt;input;
	}
	
}</pre>
In the above class, the $input variable is an array of stdClass objects with possible members:
<ul>
 	<li>externalSalesPersonId(only valid on create)</li>
 	<li>id(only as key in updateOnly mode)</li>
 	<li>email</li>
 	<li>fax</li>
 	<li>firstName</li>
 	<li>lastName</li>
 	<li>mobilePhone</li>
 	<li>phone</li>
 	<li>title</li>
</ul>
More detailed information about types and fields lengths can be retrieved through the Describe SalesPerson call.
<h4>Synching Leads</h4>
Here’s a quick example class for synching the leads we need:
<pre class="lang:default decode:true prettyprint lang-php">&lt;?php

class Leads{
	private $auth;//auth object
	private $action;// string designating request action, createOnly, updateOnly, createOrUpdate
	private $lookupField;//dedupeFields or idField
	private $input;//array of salesperson objects for input
	private $asyncProcessing;//specify whether input should be processed asynchronously
	private $partitionName;//partition name for update if requires

	//takes an Auth object as the first argument
	public function __construct($auth, $input){
		$this-&gt;auth = $auth;
		$this-&gt;input = $input;
	}

	//constructs the json request body
	private function bodyBuilder(){
		$body = new stdClass();
		$body-&gt;input = $this-&gt;input;
		if (isset($this-&gt;action)){
			$body-&gt;action = $this-&gt;action;
		}
		if (isset($this-&gt;lookupField)){
			$body-&gt;lookupField = $this-&gt;lookupField;
		}
		return json_encode($body);
	}
	//submits the request to Marketo and returns the response as a string
	public function postData(){
		$url = $this-&gt;auth-&gt;getHost() . "/rest/v1/leads.json?access_token=" . $this-&gt;auth-&gt;getToken();
		$ch = curl_init($url);
		$requestBody = $this-&gt;bodyBuilder();
		curl_setopt($ch,  CURLOPT_RETURNTRANSFER, 1);
		curl_setopt($ch, CURLOPT_HTTPHEADER, array('accept: application/json','Content-Type: application/json'));
		curl_setopt($ch, CURLOPT_POST, 1);
		curl_setopt($ch, CURLOPT_POSTFIELDS, $requestBody);
		curl_getinfo($ch);
		$response = curl_exec($ch);
		curl_close($ch);
		return $response;
	}
	//getters and setters
	public function setAction($action){
		$this-&gt;action = $action;
	}
	public function getAction(){
		return $this-&gt;action;
	}
	public function setDedupeBy($lookupField){
		$this-&gt;dedupeBy = $lookupField;
	}
	public function getDedupeBy(){
		return $this-&gt;dedupeBy;
	}
	public function addLeads($input){
		if($this-&gt;input != null){
			if (is_array($input)){
				foreach($input as $item){
					array_push($this-&gt;input, $item);
				}
			}else{
				array_push($this-&gt;input, $input);
			}
		}else if (is_array($input)){
			$this-&gt;input = $input;
		}else{
			$this-&gt;input = [$input];
		}
	}
	public function getInput(){
		return $this-&gt;input;
	}
	public function setAsyncProcessing($asyncProcessing){
		$this-&gt;asyncProcessing = $asyncProcessing;
	}
	public function getAsyncProcessing() {
		return $this-&gt;asyncProcessing;
	}
	public function setPartitionName($partitionName){
		$this-&gt;partitionName = $partitionName;
	}
	public function getPartitionName() {
		return $this-&gt;partitionName;
	}
	
}
</pre>
<h4>Process</h4>
Here's an example creating two salesperson records and associating them to two lead records:
<pre class="lang:default decode:true prettyprint lang-php">&lt;?php

require 'Auth.php';
require 'SalesPerson.php';
require 'Leads.php';

//Create an Auth object for authentication
$auth = new Auth("https://284-RPR-133.mktorest.com", "7f99bd49-0e0e-4715-a72a-0c9319f75552", "O5lZHhrQDfDKRhulY89IU42PfdhRSe6m");

//Compose new SalesPerson Records
$sales1 = new stdClass();
$sales1-&gt;externalSalesPersonId = "SalesPerson 1";
$sales1-&gt;email = "sales1@example.com";
$sales1-&gt;firstName = "Jane";
$sales1-&gt;lastName = "Doe";

$sales2 = new stdClass();
$sales2-&gt;externalSalesPersonId = "SalesPerson 2";
$sales2-&gt;email = "sales2@example.com";
$sales2-&gt;firstName = "John";
$sales2-&gt;lastName = "Doe";

//Compose lead records
$lead1 = new stdClass();
$lead1-&gt;email = "marketoDev@example.com";
//Add the external id of the desired salesperson
$lead1-&gt;externalSalesPersonId = $sales1-&gt;externalSalesPersonId;

$lead2 = new stdClass();
$lead2-&gt;email = "devBlog@example.com";
$lead2-&gt;externalSalesPersonId = $sales2-&gt;externalSalesPersonId;

//Create a new instance of SalesPerson to submit records
$salesPerson = new SalesPerson($auth, [$sales1, $sales2]);
$spResponse = $salesPerson-&gt;postData();
print_r($spResponse . "rn");
$json = json_decode($spResponse);

//Check for success on synching SalesPersons
if ($json-&gt;success){
	$leads = new Leads($auth, [$lead1, $lead2]);
	$leadsResponse = $leads-&gt;postData();
	print_r($leadsResponse . "rn");
}else{
	print_r("SalesPerson request failed with errors:rn");
	foreach ($json-&gt;errors as $error){
		print_r("code: " . $error-&gt;code . ", message: " . $error-&gt;message . "rn");
	}
}
</pre>
For our example classes, we’re just creating stdClass objects to represent our SalesPerson and Lead records which need to be synched, with each desired field added as a member. After execution of this code, the leads marketoDev@example.com and devBlog@example.com will both have the Lead Owner Email, Lead Owner First Name, and Lead Owner Last name fields populated, affording them the ability to use the relevant tokens for those fields and be filtered by the relevant smart list filters.
<h4>Auth Class</h4>
<pre class="lang:default decode:true prettyprint lang-php ">&lt;?php

class Auth{
	private $host;//host of the target Marketo instance
	private $clientId;//client Id
	private $clientSecret;//client secret
	private $token;//access_token
	private $expiry;
	
	function __construct($host, $clientId, $clientSecret){
		$this-&gt;host = $host;
		$this-&gt;clientId = $clientId;
		$this-&gt;clientSecret = $clientSecret;
	}
	public function getToken(){
		if (!isset($this-&gt;token) || $this-&gt;expiry &gt; time()){
			$data = $this-&gt;getData();
			$this-&gt;expiry = time() + $data-&gt;expires_in;
			$this-&gt;token = $data-&gt;access_token;
			return $this-&gt;token;
		}else{
			return $this-&gt;token;
		}
	}
	private function getData(){
		$url = $this-&gt;host . "/identity/oauth/token?grant_type=client_credentials&amp;client_id=" . $this-&gt;clientId . "&amp;client_secret="
					. $this-&gt;clientSecret;
		$ch = curl_init($url);
		curl_setopt($ch,  CURLOPT_RETURNTRANSFER, 1);
		curl_setopt($ch, CURLOPT_HTTPHEADER, array('accept: application/json','Content-Type: application/json'));
		$response = curl_exec($ch);
		$json = json_decode($response);
		curl_close($ch);
		return $json;
	}
	public function getHost(){
		return $this-&gt;host;
	}
}
</pre><br/><br/>kelkington - 2015-08-21<br/><br/><h2>Best Practices for API Users and Custom Services</h2><br/><br/>Marketo's REST APIs use custom services for authentication and each of these services is owned by an API-only Marketo user. The capabilities of each custom service are determined by the permissions of each role assigned to that user. Allocating individual users and custom services to your integrations gives you multiple benefits:
<ul>
 	<li>You can fine-tune the <a href="/rest-api/custom-services/">permissions</a> given to each individual service through the role given to your user.</li>
 	<li>You can disable individual web services from making calls to your instance by deleting the corresponding custom service, without disabling others.</li>
 	<li>Reporting on API call usage will be broken down by user, allowing you to identify high and abnormal utilization</li>
 	<li>It is easier to determine what data each web service is being given access to</li>
 	<li>Workspace-enabled instances can restrict access to specific business units, by only awarding roles to accessible workspaces</li>
</ul>
<h4>API Usage</h4>
Each of your API users is reported individually in the API usage report, so splitting up your web services by user allows you to easily account for the usage of each of your integrations. If the number of API calls to your instance are exceeding the limit and causing subsequent calls to fail, using this practice will allow you to account for the volume from each of your services and let you evaluate how to resolve the issue. See your usage by going to Admin -&gt; Web Services and clicking on the number of calls in the past 7 days. You can also get the same information from the <a href="/documentation/rest/get-daily-usage/">Usage APIs</a>

<img class="alignnone size-full wp-image-4887" src="https://marketohost.wpengine.com/wp-content/uploads/2015/08/API.png" alt="API" width="596" height="118" />
<img class="alignnone size-full wp-image-4889" src="https://marketohost.wpengine.com/wp-content/uploads/2015/08/Per-Users.png" alt="Per Users" width="549" height="399" />
<h4>Disable a Service</h4>
If an integration is having undesirable effects, it can be tedious and difficult to disable if you have not assigned each one an individual custom service. Having them broken out one by one makes it as easy as deleting the offending service in your Admin -&gt; Launchpoint.

<img class="alignnone size-full wp-image-4893" src="https://marketohost.wpengine.com/wp-content/uploads/2015/08/Delete-Service.png" alt="Delete Service" width="1031" height="721" />
<h4>Workspace Management</h4>
For Marketo Enterprise subscriptions, it is common for a service to only need access to a single workspace, and this can be <a href="https://docs.marketo.com/display/public/DOCS/Allow+User+Access+to+a+Workspace">enforced by role assignment to the API User</a>. Each user role can be assigned either globally, or on a per-workspace basis, so access can be restricted in workspaces wherever appropriate, providing the most minimal permissions set possible.<br/><br/>kelkington - 2015-08-28<br/><br/><h2>How to Specify Lead Partitions Using the REST API</h2><br/><br/><strong>Lead Partitioning</strong>

Marketo Lead Partitions provide a convenient way to isolate leads.  Partitions can allow different marketing groups within your organization to share a single Marketo instance.  For more information, see <a href="https://experienceleague.adobe.com/docs/marketo/using/product-docs/administration/workspaces-and-person-partitions/understanding-workspaces-and-person-partitions.html?lang=en">Understanding Workspaces and Lead Partitions</a>.

Suppose that you are using lead partitions and creating leads programmatically using the Marketo REST API.  How do you ensure the leads that you create will end up in the correct partition?  This post will show you how!

For the sake of this example, we'll use Workspaces and Partitions to isolate our leads based on geography.  First we'll define a workspace called "Country".  Next, we'll create two partitions within that workspace called "Mexico" and "Canada".

<a href="https://marketohost.wpengine.com/wp-content/uploads/2015/09/edit_workspace.png"><img class="alignnone size-full wp-image-4929" src="https://marketohost.wpengine.com/wp-content/uploads/2015/09/edit_workspace.png" alt="edit_workspace" width="1159" height="664" /></a>

<strong>Create Lead in Partition</strong>

Suppose now that we want to create two leads in the "Mexico" partition.  To create leads, we call the <a href="/documentation/rest/createupdate-leads/">Create/Update Leads</a> API.  To specify the partition, we must include the "partitionName" attribute in the request body.

How do we know what to use for the partitionName value?  We can retrieve a list of valid partition name values for our instance by calling the <a href="/documentation/rest/get-lead-partitions/">Get Lead Partitions</a> API as follows:
<pre class="lang:default mark:12-13 decode:true prettyprint lang-php">GET /rest/v1/leads/partitions.json

{
    "requestId": "20ae#14f9a1a5a30",
    "result": [
        {
            "id": 1,
            "name": "Default",
            "description": "Initial system lead partition"
        },
        {
            "id": 2,
            "name": "Mexico",
            "description": "Leads that live in Mexico"
        },
        {
            "id": 3,
            "name": "Canada",
            "description": "Leads that live in Canada"
        }
    ],
    "success": true
}
</pre>
In this case, the correct value is "Mexico", so we then pass that to Create/Update Leads as follows:
<pre class="lang:default mark:9 decode:true prettyprint lang-php">POST /rest/v1/leads.json

{
    "input": [
        {"email":"enrique.pena-nieto@gob.mx"},
        {"email":"angelica.rivera@gob.mx"}
    ],
    "action":"createOrUpdate",
    "partitionName":"Mexico"
}
</pre>
Here are our newly created leads in Marketo.
<a href="https://marketohost.wpengine.com/wp-content/uploads/2015/09/lead_create.png"><img class="alignnone size-full wp-image-4937" src="https://marketohost.wpengine.com/wp-content/uploads/2015/09/lead_create.png" alt="lead_create" width="1401" height="563" /></a>

<strong>Update Lead in Partition</strong>

To update existing leads in a partition, we simply call Create/Update Leads and specify partitionName the same as we did before. For this update, we'll assign first name, last name, and title to the leads that we created above.
<pre class="lang:default mark:9 decode:true prettyprint lang-php">POST /rest/v1/leads.json

{
"input": [
        {"email":"enrique.pena-nieto@gob.mx", "firstName":"Enrique", "lastName":"Pena Neito", "title": "El Presidente"},
        {"email":"angelica.rivera@gob.mx", "firstName":"Angelica", "lastName": "Rivera", "title": "Primera Dama"}
    ],
    "action":"createOrUpdate",
    "partitionName":"Mexico"
}
</pre>
Here are our newly updated leads in Marketo.
<a href="https://marketohost.wpengine.com/wp-content/uploads/2015/09/lead_update.png"><img class="alignnone size-full wp-image-4933" src="https://marketohost.wpengine.com/wp-content/uploads/2015/09/lead_update.png" alt="lead_update" width="1401" height="563" /></a>

<strong>Identify Partition for a Lead</strong>

How do we know which partition that a lead is in?  For this we use the <a href="/documentation/rest/get-lead-by-id/">Get Lead by Id</a> API and specify "leadPartitionId" in the "fields" query parameter.  In this case we will retrieve the information for lead id 318816 that we created above.
<pre class="lang:default mark:11 decode:true prettyprint lang-php ">GET /rest/v1/lead/318816.json?fields=leadPartitionId,email,firstName,lastName,title
{
    "requestId": "5c57#14f9a495b1f",
    "result": [
        {
            "id": 318816,
            "lastName": "Pena Neito",
            "title": "El Presidente",
            "email": "enrique.pena-nieto@gob.mx",
            "firstName": "Enrique",
            "leadPartitionId": 2
        }
    ],
    "success": true
}
</pre>
Note that we get back leadPartitionId rather than the partitionName.  To get the partitionName we need to revisit the output from Get Lead Partitions API from above.
<pre class="lang:default decode:true prettyprint lang-php ">{
    "id": 2,
    "name": "Mexico",
    "description": "Leads that live in Mexico"
},</pre>
In this case a leadPartitionId value of 2 maps to partitionName of "Mexico".

That's all for now.  Happy partitioning!<br/><br/>deverly - 2015-09-04<br/><br/><h2>Comparing Score fields in Marketo Email Scripting</h2><br/><br/><strong>Note:</strong> This is a guest post by Cathal Moran. Cathal is a Solutions Consultant, working out of Marketo's EMEA Office in Dublin, Ireland.
<h4>Comparing Score fields</h4>
Many Marketo customers, particularly those focused on cross-selling, have multiple score fields and this is often used to measure a lead’s interest in a particular product /area.
Imagine I sell apples and bananas, if a lead has a score of 50 for apples and 10 for bananas then it’s clear where the preference lies, wouldn’t it be nice if my content reflected this preference.
Email scripting can be used to compare scores and to personalise content in an email depending what score is highest (or lowest) for that particular lead receiving the email.
<pre class="lang:default decode:true prettyprint ">## As I want to compare 2 numbers I need convert my field values to integers
#set ($score1 = $math.toInteger(${lead.Apple_Score})) 
#set ($score2 = $math.toInteger(${lead.Banana_Score})) 
##check if the lead score is greater than feature score
#if($score1 &gt;= $score2)
                ##if Apple score is greater
                #set($Interest = "Special offer on Apples")
##check is the feature score is higher
#elseif($score2 &gt;= $score1)
                ##if Feature score is greater
                #set($Interest = "Special offer on Bananas")
#else
                ##otherwise
                #set($Interest = "Special offer on Fruit")
#end
##display the Interest as content
${Interest}
</pre>
In the above example I’m just personalising text but I could just as easily for example display a different image based on the higher score.<br/><br/>kelkington - 2015-09-14<br/><br/><h2>Make a Marketo Form Submission in the Background</h2><br/><br/>When your organization has many different platforms for hosting web content and customer data it becomes fairly common to need parallel submissions from a form so that the resulting data can be gathered in separate platforms. There are several strategies to do this, but the best one is often the simplest: Using the Forms 2 API to submit a hidden Marketo form. This will work with any new Marketo Form, but ideally you should create an empty form for this, which has no fields:

<img class="alignnone size-full wp-image-4973" src="https://marketohost.wpengine.com/wp-content/uploads/2015/09/Capture.png" alt="Empty Form" width="1201" height="801" />

This will ensure that the form doesn't load any more data than necessary, since we don't need to render anything. Now just grab the <a href="https://docs.marketo.com/display/public/DOCS/Embed+a+Form+on+your+Website">embed code</a> from your form and add it to the body of your desired page, making a small modification. Your embed code includes a form element like this:
<pre class="lang:default decode:true prettyprint html">&lt;form id="mktoForm_1068"&gt;&lt;/form&gt;
</pre>
You'll want to add 'style="display:none"' to the element so it is not visible, like this:
<pre class="lang:default decode:true prettyprint html">&lt;form id="mktoForm_1068" style="display:none"&gt;&lt;/form&gt;
</pre>
Once the form is embedded and hidden, the code to submit the form is really quite simple:
<pre class="lang:default decode:true prettyprint html">var myForm = MktoForms2.allForms()[0];
myForm.addHiddenFields({
	//These are the values which will be submitted to Marketo
	"Email":"test@example.com",
	"FirstName":"John",
	"LastName":"Doe"
	});
myForm.submit();
</pre>
Forms submitted this way will behave exactly like if the lead had filled out and submitted a visible form. Triggering the submission will vary between implementations since each one will have a different action to prompt it, but you can make it occur on basically any action. The important part is setting your fields and values correctly. Be sure to use the SOAP API name of your fields which you can find with <a href="/documentation/rest/field-names/">Export Field Names</a> to ensure correct submission of values.
<h2>Migrating from Munchkin Associate Lead</h2>
Background form submission is one of the recommended replacement methods for Munchkin Associate Lead.  The sample HTML page below demonstrates migration at a high level, by reusing the same values which are submitted to Associate Lead.
<pre class="lang:default decode:true ">&lt;html&gt;

&lt;head&gt;
    &lt;!--
      Munchkin Code
      Replace with your own instance code
    --&gt;
    &lt;script type="text/javascript"&gt;
        (function() {
          var didInit = false;
          function initMunchkin() {
            if(didInit === false) {
              didInit = true;
              Munchkin.init('CHANGE ME');
            }
          }
          var s = document.createElement('script');
          s.type = 'text/javascript';
          s.async = true;
          s.src = '//munchkin.marketo.net/munchkin-beta.js';
          s.onreadystatechange = function() {
            if (this.readyState == 'complete' || this.readyState == 'loaded') {
              initMunchkin();
            }
          };
          s.onload = initMunchkin;
          document.getElementsByTagName('head')[0].appendChild(s);
        })();
        &lt;/script&gt;
&lt;/head&gt;

&lt;body&gt;
  &lt;!--
    Start Embed code.  
    Pasted from Form Actions -&gt; Embed Code except for addition of 'style="display:none"' to the form tag in order to hide it, and instance-specific codes redacted
    Replace with your own code for testing
  --&gt;
  &lt;script src="CHANGE ME"&gt;&lt;/script&gt;
  &lt;form id="CHANGE ME" style="display:none"&gt;&lt;/form&gt;
  &lt;script&gt;MktoForms2.loadForm("CHANGE ME", "CHANGE ME", "CHANGE ME TO AN INTEGER ID");&lt;/script&gt;
  &lt;!--End Embed Code--&gt;

  &lt;!--Demo code--&gt;
    &lt;script&gt;
        //The same map which is assembled for the Munchkin submission can be reused for the form submission
        let values = {
            "Email": "email@example.com",
            "FirstName": "Test",
            "LastName": "Record"
        }
        //whenReady lets us apply a callback to all mkto forms on the page
        //the callback function fires whenever a form is completely loaded
        //for most use cases this will just be used to capture a reference to the form for later usage
        //submission is done in line here for demonstration only
        MktoForms2.whenReady(function(form){

            //the addHiddenFields methods lets us add arbitrary fields to the form as well as their values
            form.addHiddenFields(values);
            
            //submit the form
            form.submit();
            
            
        })
    &lt;/script&gt;
&lt;/body&gt;

&lt;/html&gt;</pre>
&nbsp;<br/><br/>kelkington - 2015-09-25<br/><br/><h2>Marketo REST API Exception and Error Handling: Part 1</h2><br/><br/>The Marketo REST API may return an exception or error, which, for convenience, we will just call errors from here on out.  Errors can occur at three different levels:
<ul>
 	<li>HTTP level, these errors are indicated by a 4xx code</li>
 	<li>Response level, these errors are included in the "errors" array of the JSON response</li>
 	<li>Record level, these errors are included in the "result" array of the JSON response, and are indicated on an individual record basis with the "status" field and "reasons" array</li>
</ul>
<h4>HTTP Errors</h4>
Under normal operating circumstances Marketo should only return two HTTP status errors, 413 Request Entity Too Large, and 414 Request URI Too Long.  These are both recoverable through catching the error, modifying the request and retrying, but with smart coding practices, you should never encounter these in the wild.

Marketo will return 413 if the Request Payload exceeds 1MB, or 10MB in the case of <a href="/documentation/rest/import-lead/">Import Lead</a>.  In most scenarios it unlikely to hit these limits, but adding a check to the size of the request and moving any records which cause the limit to be exceeded to a new request should prevent any circumstances which lead to this error being returned by any endpoints.

414 will be returned when the URI of a GET request exceeds 8KiB.  To avoid it, check against the length of your query string to see if it exceeds this limit.  If it does change your request to a POST method, then input your query string as the request body with the additional parameter '_method=GET'.  This forgoes the limitation on URIs.  It's rare to hit this limit in most cases, but is somewhat common when retrieving large batches of records with long individual filter values such as a GUID.
<h4>Response-Level Errors</h4>
Response level errors are present when the "success" parameter of the response is set to false.  Each entry in "errors" has two members, "code" a number, either 6xx or 7xx, and a "message" giving the plaintext reason for the error.  6xx codes always indicate that a request failed completely and were not executed.  An example of this is a 601, "Access token invalid," which is recoverable by re-authenticating and passing the new access token with the request.  7xx errors indicate that the request failed, either because no data was returned, or the request was incorrectly parameterized, such as including an invalid date, or missing a required parameter.
<h4>Record-Level Errors</h4>
Record level errors indicate that an operation could not be completed for an individual record, but the request itself was valid.  These occur within individual record in the "result" array of a response.  The "status" field of these records will be "skipped" and a "reasons" array will be present.  Each reason contains a "code" member, and a "message" member.  The code will always be 1xxx, and the message will indicate why the record was skipped.  An example would be where a Create/Update Leads request has "action" set to "createOnly" but a lead already exists for one of the keys in the submitted records.  This case will return a code of 1005, and a message of "Lead already exists."

In the next few posts, we will take a look at recoverable errors, and some examples of how to handle these inside of your code.<br/><br/>kelkington - 2015-10-09<br/><br/><h2>Guest Post - Direct SQL Connectors to the Marketo Database</h2><br/><br/><strong>This is a guest post from Sumit Sarkar of Progress, Inc.  </strong>

<strong>SQL connectors to Marketo database</strong>

Marketo has well documented APIs for accessing data.  However, sometimes organizations need direct SQL access.  We are seeing the lines blur at Marketo shops between Marketing and IT which is increasing the demand for standards based SQL connectivity.

<img class="alignnone size-full wp-image-5025" src="https://marketohost.wpengine.com/wp-content/uploads/2015/12/ProgressInc-1.png" alt="ProgressInc - 1" width="621" height="346" />

Direct SQL connectors to Marketo are available through <a href="https://www.progress.com/cloud-data-integration">Progress DataDirect Cloud</a>.  DataDirect Cloud is a data connectivity service that exposes Marketo data through open industry standards for SQL access across ODBC (“Open Database Connectivity”) or JDBC (“Java Database Connectivity”); and REST with OData (“Open Data Protocol”).  Below are some popular use cases for connecting Marketo data out-of-box using DataDirect Cloud:
<ul>
 	<li>Data Discovery and Visualization (Qlik, Tableau, SAP Lumira)</li>
 	<li>Enterprise Reporting (SAP Business Objects, Microstrategy, Cognos)</li>
 	<li>Data Integration (SQL Server Integration Services - SSIS, Oracle Data Integrator - ODI, Informatica)</li>
 	<li>Data Federation (SQL Server Linked Server, SAP Hana SDA, Oracle Database Gateway)</li>
 	<li>Ad Hoc Query (Microsoft Office, DB Visualizer, Aqua Data Studio)</li>
 	<li>Data Preparation (Alteryx, Trifecta, Paxata)</li>
</ul>
<strong>How does SQL access to Marketo work?</strong>
<ul>
 	<li>DataDirect Cloud creates a logical schema for data exposed by Marketo’s integration APIs.</li>
 	<li>DataDirect Cloud processes SQL requests from lightweight ODBC or JDBC clients using an elastic real-time query engine on data fetched from the Marketo APIs.</li>
 	<li>DataDirect Cloud connectivity is direct and real-time without any duplication of data.</li>
 	<li>DataDirect Cloud Service abstracts the Marketo API such that end users do not have to worry about API version changes, or using SOAP versus REST.</li>
</ul>
DataDirect has been building this style of connectivity to SaaS data sources since 2006 starting with the first Salesforce ODBC driver built on top of its web service APIs.

<strong>Getting started connecting to Marketo:</strong>
<ul>
 	<li><a href="https://pacific.progress.com/console/register?productName=d2c&amp;ignoreCookie=true">Register for a DataDirect Cloud Login</a></li>
 	<li>Click “Data Sources” and then “+New Data Source” button</li>
</ul>
<a href="https://marketohost.wpengine.com/wp-content/uploads/2015/12/ProgressInc-2.png"><img class="alignnone size-full wp-image-5362" src="https://marketohost.wpengine.com/wp-content/uploads/2015/12/ProgressInc-2.png" alt="ProgressInc - 2" width="1029" height="968" /></a>
<ul>
 	<li>Select “Marketo” and enter the connection information. You can check with your Marketo administrator or login to find <a href="/soap-api/">connection information for SOAP integration</a>.</li>
</ul>
<a href="https://marketohost.wpengine.com/wp-content/uploads/2015/12/ProgressInc-3.png"><img class="alignnone size-full wp-image-5363" src="https://marketohost.wpengine.com/wp-content/uploads/2015/12/ProgressInc-3.png" alt="ProgressInc - 3" width="1361" height="968" /></a>
<ul>
 	<li>Click “Test Connection” button. Note there is an OData tab to produce OData from Marketo and we will discuss in a future blog post.</li>
 	<li>Click on “SQL Testing” if you want to inspect the Marketo schema exposed or issue basic SQL queries from within the UI.</li>
</ul>
<a href="https://marketohost.wpengine.com/wp-content/uploads/2015/12/ProgressInc-4.png"><img class="alignnone size-full wp-image-5364" src="https://marketohost.wpengine.com/wp-content/uploads/2015/12/ProgressInc-4.png" alt="ProgressInc - 4" width="1029" height="968" /></a>
<ul>
 	<li>Click “Downloads” on the left and select the DataDirect Cloud ODBC or JDBC driver for your application and platform to install.</li>
 	<li>Once the DataDirect Cloud ODBC or JDBC driver is installed, you can connect any standards based applications to Marketo.</li>
</ul>
Here’s a video example of <a href="https://www.youtube.com/watch?v=H6PHra56Iig">connecting using the DataDirect Cloud ODBC client</a>.

Here are other DataDirect Cloud tutorials that apply to Marketo:
<ul>
 	<li><a href="http://scn.sap.com/community/lumira/blog/2015/08/05/connect-sap-lumira-to-eloqua-marketo-google-analytics">SAP Data Analtyics</a></li>
 	<li><a href="http://community.microstrategy.com/t5/Tech-Corner/What-MSTR-developers-should-know-about-Cloud-Data-Sources/ba-p/253083">Microstrategy Enterprise Reporting</a></li>
 	<li><a href="http://www.ateam-oracle.com/a-universal-cloud-applications-adapter-for-odi/">Oracle Data Integration</a></li>
</ul>
<strong>R&amp;D challenges building SQL connectivity across cloud sources such as Marketo</strong>
<ul>
 	<li>Not all SaaS APIs expose a standard query language. In those cases, the engineering team looks at each object individually.  Each object may be exposed with a different API with unique rules for invoking, searching filtering, etc.  It required a significant effort to provide a standard experience querying across the entire data model.</li>
 	<li>Handling full join capabilities. In cases where the SaaS APIs do not support a query language with JOIN capability, the engineering team has to perform that operation.  This requires a translation from SQL to efficiently call Marketo APIs to return the minimal amount of data prior to performing the join.  When joining two very large objects, the data access layer may use up considerable resources on the application server or desktop.  Therefore, deployment of the data access layer to an elastic cloud service such as DataDirect Cloud makes a lot of sense for two reasons:
<ol>
 	<li>Faster performance and use fewer memory/CPU resources on the client application server or desktop</li>
 	<li>Leverage the superior bandwidth between DataDirect Cloud and Marketo where pre-joined datasets get exchanged.</li>
</ol>
</li>
 	<li>How to handle data models? Is it static or dynamic?  How are changes detected and communicated to the client?  Each SaaS data source is different and in the case of Marketo, certain objects are better queried through views and others through tables.  Handling this matrix of data models and objects across all SaaS sources was certainly a challenge.</li>
</ul>
<strong> Marketo and DataDirect Cloud Reference for Developers:</strong>
<ul>
 	<li>Marketo Connection Properties (<a href="http://documentation.progress.com/output/DataDirect/DataDirectCloud/index.html#page/connectivity/marketo-parameters.html">link to docs</a>)</li>
 	<li>Supported SQL and extensions with Marketo (<a href="http://documentation.progress.com/output/DataDirect/DataDirectCloud/index.html#page/queries/oracle-eloqua,-hubspot,-and-marketo.html">link to docs</a>)</li>
 	<li>Exposed Marketo Tables and Views (<a href="http://documentation.progress.com/output/DataDirect/DataDirectCloud/index.html#page/queries/tables-exposed-by-marketo.html">link to docs</a>)</li>
 	<li>Common error messages returned from Marketo (<a href="http://documentation.progress.com/output/DataDirect/DataDirectCloud/index.html#page/queries/marketo-error-messages.html">link to docs</a>)</li>
</ul>
<strong>Biography: </strong>

Sumit Sarkar is a Chief Data Evangelist at Progress, with over 10 years experience working in the data connectivity field. The world's leading consultant on open data standards connectivity with cloud data, Sumit's interests include performance tuning of the data access layer for which he has developed a patent pending technology for its analysis; business intelligence and data warehousing for SaaS platforms; and data connectivity for PaaS environments, with a focus on standards such as ODBC, JDBC, ADO.NET and ODATA. He is an IBM Certified Consultant for IBM Cognos Business Intelligence and TDWI member. He has presented sessions on data connectivity at various conferences including Dreamforce, Oracle OpenWorld, Strata Hadoop, MongoDB World and SAP Analytics and Business Objects Conference, among many others.

Twitter: @SAsInSumit

LinkedIn: <a href="http://www.linkedin.com/in/meetsumit">www.linkedin.com/in/meetsumit</a><br/><br/>kelkington - 2015-12-07<br/><br/><h2>Create a Dashboard for API Usage and Error Counts</h2><br/><br/>As mentioned in an earlier <a href="/blog/best-practices-for-api-users-and-custom-services/">post</a>, you can view API usage data for the prior week by going to the Admin &gt; Web Services panel in Marketo.  This gives you a daily rollup of the number of calls made by user.  As a Marketo API consumer, this is useful information that you should keep an eye on.

What if you could get historical usage data to help detect trends over time?

What if you could get a summary of API error codes to help measure the health of your integration?

As a Marketo Technology Partner, what if you could get usage and error data across all of your customer accounts in one dashboard?

This post will provide an approach to answering the questions above.

Buckle up, here we go!

<strong>Diagram</strong>

Here is a high level diagram of the dashboard system.

<a href="https://marketohost.wpengine.com/wp-content/uploads/2015/10/API_Stats_Dashboard2.png"><img src="https://marketohost.wpengine.com/wp-content/uploads/2015/10/API_Stats_Dashboard2.png" alt="" /></a>

<strong>Scheduled Job for Stats Retrieval</strong>

Let's create an app that retrieves usage and error data using <a href="/documentation/rest/get-daily-usage/">Get Daily Usage</a> and <a href="/documentation/rest/get-daily-errors/">Get Daily Errors</a> endpoints.  The app is designed to be scheduled to run once per day.  Each time the app runs, it appends a day’s worth of usage data to one file, and a day’s worth of error data to another file.  At the beginning of each month, a new pair of files are created.  These files will serve as a historical record that we can access at any time.

Here is the app logic …
<ul>
 	<li>Read Marketo account information (Munchkin id and Client credentials) from an external source .  Note: This source must be secure to keep others from accessing account data.</li>
 	<li>Iterate through each account and...
<ul>
 	<li>Call Get Daily Usage to retrieve usage data for one day</li>
 	<li>Append daily usage data to a montly “usage” file</li>
 	<li>Call Get Daily Errors to retrieve errors data for one day</li>
 	<li>Append daily errors data to a monthly “errors” file</li>
</ul>
</li>
</ul>
Output File Format

The format for the output files is JSON which matches up with the “result” array returned from the respective API calls (Usage and Error).  Each element of the “result” array is a JSON object that contains data for one day.

Output File Naming

The output files are named as follows:
<p style="padding-left: 30px;">&lt;type&gt;_&lt;yyyy&gt;_&lt;mm&gt;_&lt;account&gt;.json</p>
where,
<p style="padding-left: 30px;">&lt;type&gt;  -  The type of data (“usage” or “errors”)
&lt;yyyy&gt; - The year (4-digits)
&lt;mm&gt; - The month (2-digits)
&lt;account&gt; - The account id (Munchkin id)</p>
Output File Examples

usage_2015_10_111-AAA-222.json
<pre class="lang:default decode:true prettyprint lang-js">[
    { "date": "2015-10-15", "total": 0, "users" : [] }, 
    { "date": "2015-10-16", "total": 9, "users": [ { "userId": "some.body@yahoo.com", "count": 9 } ] },
    { "date": "2015-10-17", "total": 1120, "users": [ { "userId": "some.body@yahoo.com", "count": 200 }, { "userId": "some.body@marketo.com", "count": 200 }, { "userId": "some.body@gmail.com", "count": 720 } ] },
&lt;span class="pun"&gt;]&lt;/span&gt;</pre>
errors_2015_10_111-AAA-222.json
<pre class="lang:default decode:true prettyprint lang-js">[
    { "date": "2015-10-15", "total":80, "errors": [ { "errorCode":"1003", "count":80 } ] },
    { "date": "2015-10-16", "total":148, "errors": [ { "errorCode":"612", "count":40 }, { "errorCode":"609", "count":70 }, { "errorCode":"1008", "count":38 } ] },
    { "date": "2015-10-17", "total":73, "errors": [ { "errorCode":"604", "count":1 }, { "errorCode":"609", "count":56 }, { "errorCode":"610", "count":16 } ] },
]</pre>
Code for this app is presented at the end of this post (Stats.java).

<strong>Stats Web Service</strong>

So now we need a way to get this data into our browser.  The proposal is to create a web service to deliver the data.  The web service will consume the app's output files and then return data to the browser in a form that can be readily presented.  For simplicity's sake, and to get around same-origin policy restrictions, we will leverage the <a href="https://en.wikipedia.org/wiki/JSONP">JSONP</a> pattern.

Here is the proposed REST endpoint specification for the external web service:

<strong>URI</strong>: /stats

<strong>Method</strong>: GET
<table>
<tbody>
<tr>
<td><b>Parameter</b></td>
<td><strong>Description</strong></td>
<td><strong>Example</strong></td>
</tr>
<tr>
<td>month</td>
<td>Retrieve data for this month.  Comma seperated list of months to include (2-digit representation).   Default to all months.</td>
<td>10,11</td>
</tr>
<tr>
<td>year</td>
<td>Retrieve data for this year.  Comma seperated list of years to include  (4-digit representation).  Default to all years.</td>
<td>2015</td>
</tr>
<tr>
<td>account</td>
<td>Retrieve data for this account (Munchkin id).</td>
<td>111-AAA-222</td>
</tr>
<tr>
<td>callback</td>
<td>Name of function to wrap JSON content with.</td>
<td>processStats</td>
</tr>
</tbody>
</table>
Example Request
<p style="padding-left: 30px;">GET //localhost:8080/stats?month=10&amp;year=2015&amp;account=111-AAA-222&amp;callback=processStats</p>
The web service reads “usage” and “error” files, and combines them together and returns them in this format:
<p style="padding-left: 30px;"><strong>&lt;Name of Callback here&gt;(</strong></p>
<p style="padding-left: 60px;">&lt;Contents of Usage file here&gt;,</p>
<p style="padding-left: 60px;">&lt;Contents of Error file here&gt;</p>
<p style="padding-left: 30px;"><strong>);</strong></p>
This is a JSONP callback with 2 arguments.  First argument is usage "result" array.  Second argument is errors "result" array.

Example Response
<pre class="lang:default decode:true prettyprint lang-js">&lt;strong&gt;processStats(&lt;/strong&gt;
    [
        { "date": "2015-10-15", "total": 0, "users" : [] },
        { "date": "2015-10-16", "total": 9, "users": [ { "userId": "some.body@yahoo.com", "count": 9 } ] },
        { "date": "2015-10-17", "total": 1120, "users": [ { "userId": "some.body@yahoo.com", "count": 200 }, { "userId": "some.body@marketo.com", "count": 200 }, { "userId": "some.body@gmail.com", "count": 720 } ] }
    ]&lt;strong&gt;,&lt;/strong&gt;
    [
        { "date": "2015-10-15", "total":80, "errors": [ { "errorCode":"1003", "count":80 } ] },
        { "date": "2015-10-16", "total":148, "errors": [ { "errorCode":"612", "count":40 }, { "errorCode":"609", "count":70 }, { "errorCode":"1008", "count":38 } ] },
        { "date": "2015-10-17", "total":73, "errors": [ { "errorCode":"604", "count":1 }, { "errorCode":"609", "count":56 }, { "errorCode":"610", "count":16 } ] },
    ]
&lt;strong&gt;);&lt;/strong&gt;</pre>
As you can see, the web service has simply wrapped the contents of the two output files from our app.  We have created a mock web service response using <a href="http://www.mocky.io/">Mocky</a>.  An example of the web service the mock is <a href="http://www.mocky.io/v2/5627b2f9270000f2226eec63?month=10&amp;year=2015&amp;account=111-AAA-222&amp;callback=processStats">here.</a>

Creation of this web service is left as an exercise for the reader :)

<strong>Dashboard Web Page</strong>

So now all we need is a web page that calls our web service and formats the data.

To use the JSONP pattern we just need to add a &lt;script&gt; tag that invokes the web service:
<p style="padding-left: 30px;">&lt;script src=”http: //&lt;hostname&gt;/stats?month=10&amp;year=2015&amp;account=284-RPR-133&amp;callback=processStats”&gt;&lt;/script&gt;</p>
This will inject the web service response body directly into the HTML page.

We then  add the JSONP callback function :
<pre class="lang:default decode:true prettyprint lang-js">function processStats(usage, errors) {
    var cfg = { maxDepth: 5};
    document.write("&lt;h2&gt;Usage&lt;/h2&gt;");
    document.body.appendChild(prettyPrint(usage, cfg));
    document.write("&lt;h2&gt;Errors&lt;/h2&gt;");
    document.body.appendChild(prettyPrint(errors, cfg));
;</pre>
This function is automatically called after the web service call.  In this example, we call a simple JavaScript "variable dumper" called <a href="https://github.com/padolsey-archive/prettyprint.js/tree/master">prettyPrint.js</a> on each array.  The prettyPrint function simply produces an HTML table using the contents of the array.

Here is a screen shot of the HTML tables:

<a href="https://marketohost.wpengine.com/wp-content/uploads/2015/10/dashboard_screenshot.jpg"><img class="alignnone size-full wp-image-4025" src="https://marketohost.wpengine.com/wp-content/uploads/2015/10/dashboard_screenshot.jpg" alt="" width="740" height="423" /></a>

Voilà, that is our our dashboard!

Granted this isn't very elegant, but it should give you an idea of what is possible.  There is nothing stopping you from transforming the data any way you like to make your own eye catching visualizations.

The HTML page is below (Index.html)

You can view the tables above live in your browser using the following steps:
<ol>
 	<li>Save a local copy of Index.html</li>
 	<li>Save a local copy of prettyPrint.js</li>
 	<li>Open Index.html in your browser</li>
</ol>
So that’s it.  Hopefully this post has given you some ideas about monitoring your Marketo API stats.  Happy coding!

<strong>Stats.java</strong>

<pre class="lang:default decode:true prettyprint lang-js">package com.marketo;

// minimal-json library (https://github.com/ralfstx/minimal-json)
import com.eclipsesource.json.JsonArray;
import com.eclipsesource.json.JsonObject;

import java.io.*;
import java.lang.reflect.Array;
import java.net.MalformedURLException;
import java.net.URL;
import java.util.*;

import java.nio.file.Files;
import java.nio.file.Paths;

import javax.net.ssl.HttpsURLConnection;

public class Stats {
    //
    // Define Marketo instance meta data here. Each row contains three elements: Account Id, Client Id, Client Secret.
    //
    // Note: that this information would typically be stored read from an external source (i.e. database)
    //
    // For example:
    //
    // private static String final CUSTOM_SERVICE_DATA[][] = {
    // {"111-AAA-222", "2f4a4435-f6fa-4bd9-3248-098754982345", "asdf6IVE9h4Jjcl59cOMAKFSk78ut12W"},
    // {"222-BBB-333", "5f4a6657-f6fa-4cd9-4356-123083238821", "gfjgfIVE9h4Jjcl59cOMAKFSk78ut12W"},
    // {"444-CCC-444", "9f4a4678-f6fa-4dd9-7735-908713247721", "xzcxvbVE9h4Jjcl59cOMAKFSk78ut12W"}
    // };
    //
    private static final String CUSTOM_SERVICE_DATA[][] = {
    };

    // Output directory for stats files
    private static final String OUTPUT_DIR = "C:stats";

public static void main(String[] args) {

    // Loop through each Marketo instance
    for (int i = 0; i &lt; CUSTOM_SERVICE_DATA.length; i++) {

        // Compose base URL
        String baseUrl = String.format("https://%s.mktorest.com",
            CUSTOM_SERVICE_DATA[i][0]);

        // Compose Identity URL
        String identityUrl = String.format("%s/identity/oauth/token?grant_type=%s&amp;client_id=%s&amp;client_secret=%s",
            baseUrl, "client_credentials", CUSTOM_SERVICE_DATA[i][1], CUSTOM_SERVICE_DATA[i][2]);

        // Call Identity API
        JsonObject identityObj = JsonObject.readFrom(httpRequest("GET", identityUrl, null));
        String accessToken = identityObj.get("access_token").asString();

        // Compose Get Last 7 Days Usage URL
        String usageUrl = String.format("%s/rest/v1/stats/usage/last7days.json?access_token=%s",
            baseUrl, accessToken);

        // Compose Get Last 7 Days Errors URL
        String errorsUrl = String.format("%s/rest/v1/stats/errors/last7days.json?access_token=%s",
            baseUrl, accessToken);

        // Process usage data
        JsonObject usageObj = JsonObject.readFrom(httpRequest("GET", usageUrl, null));
        if (usageObj.get("success").asBoolean()) {
            if (usageObj.get("result") != null) {
                updateFile(usageObj, "usage", CUSTOM_SERVICE_DATA[i][0]);
            }
        }

        // Process errors data
        JsonObject errorsObj = JsonObject.readFrom(httpRequest("GET", errorsUrl, null));
        if (usageObj.get("success").asBoolean()) {
            if (errorsObj.get("result") != null) {
                updateFile(errorsObj, "errors", CUSTOM_SERVICE_DATA[i][0]);
            }
        }
    }
    System.exit(0);
}

// Write yesterday's data to output file
private static void updateFile(JsonObject usageObj, String statsType, String account){

    JsonArray usageResultAry = usageObj.get("result").asArray();
    JsonObject yesterdayUsageResultObj = usageResultAry.get(1).asObject();

    String yesterdayDate = yesterdayUsageResultObj.get("date").asString();
    String[] yesterdayDateAry = yesterdayDate.split("[-]+");

    // "C:statsstats_yyyy_mm_account.json"
    String statsFile = String.format("%s%s_%s_%s_%s.json",
        OUTPUT_DIR, statsType, yesterdayDateAry[0], yesterdayDateAry[1], account);

    // Create file
    File file = new File(statsFile);
    try {
        if (file.createNewFile()) {
            // created new file, seed with empty array
            FileWriter fw = new FileWriter(file.getAbsoluteFile());
            BufferedWriter bw = new BufferedWriter(fw);
            bw.write("[n]");
            bw.close();
        }
    } catch (IOException e) {
        e.printStackTrace();
    }

    // Read file
    String content = null;
    try {
        content = new String(Files.readAllBytes(Paths.get(statsFile)));
    } catch (IOException e) {
        e.printStackTrace();
    }

    // Remove trailing "]", append new record, append trailing "]"
    content = content.substring(0, content.length() - 1);
    content += yesterdayUsageResultObj.toString();
    content += "n]";

    // Write file
    FileWriter fw = null;
    try {
        fw = new FileWriter(file.getAbsoluteFile());
        BufferedWriter bw = new BufferedWriter(fw);
        bw.write(content);
        bw.close();
    } catch (IOException e) {
        e.printStackTrace();
    }
}

// Perform HTTP request
private static String httpRequest(String method, String endpoint, String body) {
    String data = "";
    try {
        URL url = new URL(endpoint);
        HttpsURLConnection urlConn = (HttpsURLConnection) url.openConnection();
        urlConn.setDoOutput(true);
        urlConn.setRequestMethod(method);
        switch (method) {
            case "GET":
                break;
            case "POST":
                urlConn.setRequestProperty("Content-type", "application/json");
                urlConn.setRequestProperty("accept", "text/json");
                OutputStreamWriter wr = new OutputStreamWriter(urlConn.getOutputStream());
                wr.write(body);
                wr.flush();
                break;
            default:
                System.out.println("Error: Invalid method.");
                return data;
        }
        int responseCode = urlConn.getResponseCode();
        if (responseCode == 200) {
            InputStream inStream = urlConn.getInputStream();
            data = convertStreamToString(inStream);
        } else {
            System.out.println(responseCode);
            data = "Status:" + responseCode;
        }
    } catch (MalformedURLException e) {
        System.out.println("URL not valid.");
    } catch (IOException e) {
        System.out.println("IOException: " + e.getMessage());
        e.printStackTrace();
    }
    return data;
}

private static String convertStreamToString(InputStream inputStream) {
    try {
        return new Scanner(inputStream).useDelimiter("A").next();
    } catch (NoSuchElementException e) {
        return "";
    }
}
}
</pre>
<strong>Index.html</strong>
<pre class="lang:default decode:true prettyprint lang-js ">&lt;html&gt;
&lt;head&gt;
&lt;title&gt;Marketo API Stats&lt;/title&gt;
&lt;!-- Browser JavaScript variable dumper                  --&gt;
&lt;!-- https://github.com/padolsey-archive/prettyprint.js  --&gt;
&lt;script src="prettyPrint.js"&gt;&lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;

&lt;h1&gt;Marketo API Stats&lt;/h1&gt;

&lt;script&gt;
// JSONP callback that uses prettyPrint to format API stats
function processStats(usage, errors) {
    var cfg = { maxDepth: 5};
    document.write("&lt;h2&gt;Usage&lt;/h2&gt;");
    document.body.appendChild(prettyPrint(usage, cfg));
    document.write("&lt;h2&gt;Errors&lt;/h2&gt;");
    document.body.appendChild(prettyPrint(errors, cfg));
};
&lt;/script&gt;

&lt;!-- Web service for you to implement as an exercise                                                        --&gt;
&lt;!-- &lt;script src="http://localhost:8080/stats?month=10&amp;account=111-AAA-222&amp;callback=processStats"&gt;&lt;/script&gt; --&gt;

&lt;!-- Mock web service that returns sample payload --&gt;
&lt;!-- http://www.mocky.io/                         --&gt;
&lt;script src="http://www.mocky.io/v2/5627b2f9270000f2226eec63?month=10&amp;year=2015&amp;account=111-AAA-222&amp;callback=processStats"&gt;&lt;/script&gt;"
&lt;/body&gt;
&lt;/html&gt;</pre><br/><br/>deverly - 2015-10-22<br/><br/><h2>Marketo REST API Exception and Error Handling: Part 2</h2><br/><br/><a href="/blog/marketo-rest-api-exception-and-error-handling-part-1/">Read Part 1 here</a>

For the most part, errors received back from the Marketo REST API will not be automatically recoverable.  However, there are a handful of cases where you can recover automatically, or ensure you never see a certain type of error.
<h4>Request-Size Errors</h4>
As we looked at in the last post of this series, Marketo will emit HTTP Status code 414 if your URI exceeds 8KiB in length, or 413 if your request body exceeds 1MB, or 10MB for Import Lead.  Though 414s will be rare, you might see them if you're using Get Leads By Filter type to request records based on 300 separate GUIDs or similar criteria.  Say you have the following request:

https://AAA-BBB-CCC.mktorest.com/rest/v1/leads.json?filterType=customGUID&amp;fields=email,company...firstName,lastName

When you submit the request, Marketo returns a status of 414 because the URI exceeds 8KiB.  To handle this, we need to alter the pattern of this request, and submit a POST instead of a GET, append '_method=GET' to the URI, and pass the querystring in the request body as a x-www-form-urlencoded request instead:

URI:

https://AAA-BBB-CCC.mktorest.com/rest/v1/leads.json?_method=GET

Request Body:

filterType=customGUID&amp;fields=email,company...firstName,lastName

Instead of catching this exception from the HTTP response, however, we can just check the total length of the request at runtime, and deploy this alternative pattern if the URI exceeds 8k.  Alternatively, you could use the POST Method in all cases for batch retrievals of records.

For 413s, we can follow a similar pattern, checking the length of the request body when adding records during the serialization step, and splitting the request into multiple parts if this limit would be exceeded.
<h4>Authentication Errors</h4>
Our next class of recoverable errors is related to authentication.  When a formerly valid access token is used after its expires_in period has elapsed, the first usage will return an error code of 602, "Access token expired."  After this, using the same token will return a 601, "Access token invalid."  Any other usage of a string which is not a valid access token for the target subscription will result in a 601.  In both cases, this error can be recovered from by reauthenticating and passing the new access token with a retry of the failed request.
<h4>Timeouts</h4>
In very rare circumstances, a call may return a 604, "Request timed out," after the 30 second timeout period has elapsed.  For batched requests, such as <a href="/documentation/rest/createupdate-leads/">Create/Update Leads</a>, the request can be split up into smaller batches and retried until success is returned (if the batch is split to less than 100 records and the request is still timing out, you should probably file a support case).  The most common other case is with asset approval calls, where a lock may be held on the current approved record by another user or service, such as the case of an <a href="/documentation/asset-api/approve-email-by-id/">Email</a> or <a href="/documentation/asset-api/approve-email-template-by-id/">Email Template</a>.  In these cases, <a href="https://en.wikipedia.org/wiki/Exponential_backoff">exponential backoff</a> should be used for retries to allow for any existing locks to be resolved.

Check back in the coming weeks for the final part of the series where we'll take a closer look at some specific, non-recoverable errors.<br/><br/>kelkington - 2015-10-30<br/><br/><h2>Marketo Security Enhancements</h2><br/><br/>At Marketo we take security seriously. As a part of an <strong><a class="jive-link-external-small" href="https://googleonlinesecurity.blogspot.com.au/2014/09/gradually-sunsetting-sha-1.html" target="_blank" rel="nofollow">industry-wide initiative</a></strong>, Marketo is upgrading our web authentication and encryption to enhance our security protections.  The rollout is scheduled to occur on December 12, 2015.

<strong>Who will be affected?</strong>

Only a small number of users will be affected, only those who have an integration to Marketo from a system that is over ten years old and hasn't been updated recently.  See <strong><a class="jive-link-external-small" href="https://www.digicert.com/sha-2-compatibility.htm" target="_blank" rel="nofollow">this list</a></strong>  for more info on what systems and versions are supported.

<strong>The following users will not be impacted:</strong>
<ul>
	<li>End users accessing Marketo.com through modern browsers (<a class="jive-link-external-small" href="https://www.digicert.com/sha-2-compatibility.htm" target="_blank" rel="nofollow">see list</a>)</li>
	<li>Customers using integration partners such as Informatica, Dell Boomi, and Scribe.</li>
	<li>Customers using Launchpoint partners.</li>
</ul>
<strong>Rollout schedule</strong>

The following rollout schedule is planned:
<table class="jiveBorder tablesorter" border="1">
<thead>
<tr>
<th class="header" valign="middle"><strong>Service</strong></th>
<th class="header" valign="middle"><strong>URL</strong></th>
<th class="header" valign="middle"><strong>SHA-2 Rollout Date
</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>API access</td>
<td>mktoapi.com</td>
<td>Dec 12, 2015</td>
</tr>
<tr>
<td>API access</td>
<td>mktoresp.com</td>
<td>Dec 12, 2015</td>
</tr>
<tr>
<td>Part of MLM Application</td>
<td>marketodesigner.com</td>
<td>Dec 12, 2015</td>
</tr>
</tbody>
</table>
All other Marketo domains already use SHA2 certificates.<br/><br/>kelkington - 2015-11-18<br/><br/><h2>Polling for Activities using REST API</h2><br/><br/>Earlier this year we published this <a href="/blog/synchronizing-lead-data-changes-using-rest-api/">post</a> that described how to poll for lead changes within Marketo.  This post is similar, but this time we’ll poll for activities.

Activities are a core object in the Marketo Platform. Activities are the behavioral data that is stored about every webpage visit, email open, webinar attendance, or trade show attendance.  A common use case is combining activity data with data from other parts of an organization.

This sample program contains 6 steps:
<ol>
 	<li>Call <a href="/documentation/rest/get-lead-activities/">Get Lead Activities</a> to generate a list of all activity records created since a given date/time. We use a filter to limit the type of activity records that are returned.</li>
 	<li>Extract fields of interest from each activity record.</li>
 	<li>Call <a href="/documentation/rest/get-multiple-leads-by-filter-type/">Get Multiple Leads by Filter Type</a> to generate a list of lead records that correspond with the activities from Step 1. We use the leadId field extracted from activity record in Step 2 as our filter to specify which leads are returned.</li>
 	<li>Extract fields of interest from each lead record.</li>
 	<li>Join the activity data from step 2 with the lead data from Step 4.</li>
 	<li>Transform the data from Step 5 into a format that is consumable by an external system.</li>
</ol>
As the diagram below shows, for this example we have chosen to capture email-related activities.

<a href="https://marketohost.wpengine.com/wp-content/uploads/2015/11/Activity-Sync_Overview2.png"><img class="alignnone size-full wp-image-4689" src="https://marketohost.wpengine.com/wp-content/uploads/2015/11/Activity-Sync_Overview2.png" alt="Activity_Sync_Overview" width="1460" height="764" /></a>
<strong>Program Input</strong>

By default the program goes back in time one day from the current date to look for changes.  So you could run this program at the same time each day for example.  To go farther back in time, you can specify the number of days as a command line argument, effectively increasing the window of time.

The program contains several variables that you can modify:

CUSTOM_SERVICE_DATA – This contains your Marketo Custom Service data (Account Id, Client Id, Client Secret).

READ_BATCH_SIZE – This is the number of records to retrieve at a time.  Use this to tune the response body size.

LEAD_FIELDS – This contains a list of lead fields that we want to collect.

ACTIVITY_TYPES – This contains a list of activity types that we want to collect.

<strong>Program Logic</strong>

First we establish our time window, compose our REST endpoint URLS, and obtain our Authentication access token.  Next we fire up a Get Paging Token/Get Lead Activities loop which runs until we exhaust the supply of activities.  The purpose of this loop is to retrieve activity records, and extract fields of interest from those records.

We tell Get Lead Activities to look only for the following activity types:
<ul>
 	<li>Email Delivered</li>
 	<li>Unsubscribe Email</li>
 	<li>Open Email</li>
 	<li>Click Email.</li>
</ul>
We extract the following fields of interest from each activity record:
<ul>
 	<li>leadId</li>
 	<li>activityType</li>
 	<li>activityDate</li>
 	<li>primaryAttributeValue</li>
</ul>
You are free to select any combination of activity types and activity fields to suit your purpose.

Next we fire up a Get Multiple Leads by Filter Type loop which runs until we exhaust the supply of leads.  Note that we use the “filterType=id” parameter in combination with a series of “filterValues” parameters to limit the lead records retrieved to only those leads associated with activities that we retrieved earlier.

We extract the following fields of interest from each lead record:
<ul>
 	<li>firstName</li>
 	<li>lastName</li>
 	<li>email</li>
</ul>
Again, you are feel to select any lead fields that you like.

Next we join the lead fields with the activity fields by using the lead id to link them together.

Finally, we loop through all of the data, transform it into JSON format, and print it to the console.

<strong>Program Output</strong>

Here is an example of output from the sample program.  This shows the activity fields and the lead fields combined together as JSON "result" objects.  The idea here is that you could pass this JSON as a request payload to an external web service.
<pre class="lang:default decode:true prettyprint lang-java">{

    "result": [
        {
            "leadId": 318581,
            "activityType": "Email Delivered",
            "activityDate": "2015-03-17T20:00:06Z",
            "primaryAttributeValue": "My Email Program",
            "firstName": "David",
            "lastName": "Everly",
            "email": "everlyd@marketo.com"
        },
        {
            "leadId":318581,
            "activityType":"Open Email",
            "activityDate":"2015-03-17T23:23:12Z",
            "primaryAttributeValue":"My Email Program - Auto Response",
            "firstName":"David",
            "lastName":"Everly",
            "email":"everlyd@marketo.com"
       },
        ... more result objects here...
    ]
}
</pre>
<strong>Program Code</strong>
<pre class="lang:default decode:true prettyprint lang-java ">package com.marketo;

// minimal-json library (https://github.com/ralfstx/minimal-json)
import com.eclipsesource.json.JsonArray;
import com.eclipsesource.json.JsonObject;
import com.eclipsesource.json.JsonValue;

import java.io.*;
import java.net.MalformedURLException;
import java.net.URL;
import java.text.DateFormat;
import java.text.ParseException;
import java.text.SimpleDateFormat;
import java.util.*;

import javax.net.ssl.HttpsURLConnection;

public class LeadActivities {
//
// Define Marketo REST API access credentials: Account Id, Client Id, Client Secret.  For example:
    private static Map&lt;String, String&gt; CUSTOM_SERVICE_DATA;
    static {
        CUSTOM_SERVICE_DATA = new HashMap&lt;String, String&gt;();
//        CUSTOM_SERVICE_DATA.put("accountId", "111-AAA-222");
//        CUSTOM_SERVICE_DATA.put("clientId", "2f4a4435-f6fa-4bd9-3248-098754982345");
//        CUSTOM_SERVICE_DATA.put("clientSecret", "asdf6IVE9h4Jjcl59cOMAKFSk78ut12W");
    }

    // Number of lead records to read at a time
    private static final String READ_BATCH_SIZE = "200";

    // Lookup lead records using lead id as primary key
    private static final String LEAD_FILTER_TYPE = "id";

    // Lead record lookup returns these fields
    private static final String LEAD_FIELDS = "firstName,lastName,email";

    // Lookup activity records for these activity types
    private static Map&lt;Integer, String&gt; ACTIVITY_TYPES;
    static {
        ACTIVITY_TYPES = new HashMap&lt;Integer, String&gt;();
        ACTIVITY_TYPES.put(7, "Email Delivered");
        ACTIVITY_TYPES.put(9, "Unsubscribe Email");
        ACTIVITY_TYPES.put(10, "Open Email");
        ACTIVITY_TYPES.put(11, "Click Email");
    }

    public static void main(String[] args) {
        // Command line argument to set how far back to look for lead changes (number of days)
        int lookBackNumDays = 1;
        if (args.length == 1) {
            lookBackNumDays = Integer.parseInt(args[0]);
        }

        // Establish "since date" using current timestamp minus some number of days (default is 1 day)
        Calendar cal = Calendar.getInstance();
        cal.add(Calendar.DAY_OF_MONTH, -lookBackNumDays);
        SimpleDateFormat sdf = new SimpleDateFormat("yyyy-MM-dd'T'HH:mm:ssZ");
        String sinceDateTime = sdf.format(cal.getTime());

        // Compose base URL
        String baseUrl = String.format("https://%s.mktorest.com",
            CUSTOM_SERVICE_DATA.get("accountId"));

        // Compose Identity URL
        String identityUrl = String.format("%s/identity/oauth/token?grant_type=%s&amp;client_id=%s&amp;client_secret=%s",
                baseUrl, "client_credentials", CUSTOM_SERVICE_DATA.get("clientId"), CUSTOM_SERVICE_DATA.get("clientSecret"));

        // Call Identity API
        JsonObject identityObj = JsonObject.readFrom(getData(identityUrl));
        String accessToken = identityObj.get("access_token").asString();

        // Compose URLs for Get Lead Changes, and Get Paging Token
        String activityTypesUrl = String.format("%s/rest/v1/activities/types.json?access_token=%s",
                baseUrl, accessToken);
        String pagingTokenUrl = String.format("%s/rest/v1/activities/pagingtoken.json?access_token=%s&amp;sinceDatetime=%s",
                baseUrl, accessToken, sinceDateTime);

        // Use activity ids to create filter parameter
        String activityTypeIds = "";
        for (Integer id : ACTIVITY_TYPES.keySet()) {
            activityTypeIds += "&amp;activityTypeIds=" + id.toString();
        }

        // Compose URL for Get Lead Activities
        // Only retrieve activities that match our defined activity types
        String leadActivitiesUrl = String.format("%s/rest/v1/activities.json?access_token=%s%s&amp;batchSize=%s",
                baseUrl, accessToken, activityTypeIds, READ_BATCH_SIZE);

        Map&lt;Integer, List&gt; activitiesMap = new HashMap&lt;Integer, List&gt;();
        Set leadsSet = new HashSet();

        // Call Get Paging Token API
        JsonObject pagingTokenObj = JsonObject.readFrom(getData(pagingTokenUrl));
        if (pagingTokenObj.get("success").asBoolean()) {
            String nextPageToken = pagingTokenObj.get("nextPageToken").asString();
            boolean moreResult;
            do {
                moreResult = false;

                // Call Get Lead Activities API to retrieve activity data
                JsonObject leadActivitiesObj = JsonObject.readFrom(getData(String.format("%s&amp;nextPageToken=%s",
                        leadActivitiesUrl, nextPageToken)));
                if (leadActivitiesObj.get("success").asBoolean()) {
                    moreResult = leadActivitiesObj.get("moreResult").asBoolean();
                    nextPageToken = leadActivitiesObj.get("nextPageToken").asString();

                    if (leadActivitiesObj.get("result") != null) {
                        JsonArray activitiesResultAry = leadActivitiesObj.get("result").asArray();
                        for (JsonValue activitiesResultObj : activitiesResultAry) {

                            // Extract activity fields of interest (leadID, activityType, activityDate, primaryAttributeValue)
                            JsonObject leadObj = new JsonObject();
                            int leadId = activitiesResultObj.asObject().get("leadId").asInt();
                            leadObj.add("activityType", ACTIVITY_TYPES.get(activitiesResultObj.asObject().get("activityTypeId").asInt()));
                            leadObj.add("activityDate", activitiesResultObj.asObject().get("activityDate").asString());
                            leadObj.add("primaryAttributeValue", activitiesResultObj.asObject().get("primaryAttributeValue").asString());

                            // Store JSON containing activity fields in a map using lead id as key
                            List leadLst = activitiesMap.get(leadId);
                            if (leadLst == null) {
                                activitiesMap.put(leadId, new ArrayList());
                                leadLst = activitiesMap.get(leadId);
                            }
                            leadLst.add(leadObj);

                            // Store unique lead ids for use as lead filter value below
                            leadsSet.add(leadId);
                        }
                    }
                }
            } while (moreResult);
        }

        // Use unique lead id values to create filter parameter
        String filterValues = "";
        for (Object object : leadsSet) {
            if (filterValues.length() &gt; 0) {
                filterValues += ",";
            }
            filterValues += String.format("%s", object);
        }

        // Compose Get Multiple Leads by Filter Type URL
        // Only retrieve leads that match the list of lead ids that was accumulated during activity query
        String getMultipleLeadsUrl = String.format("%s/rest/v1/leads.json?access_token=%s&amp;filterType=%s&amp;fields=%s&amp;filterValues=%s&amp;batchSize=%s",
                baseUrl, accessToken, LEAD_FILTER_TYPE, LEAD_FIELDS, filterValues, READ_BATCH_SIZE);
        String nextPageToken = "";

        do {
            String gmlUrl = getMultipleLeadsUrl;

            // Append paging token to Get Multiple Leads by Filter Type URL
            if (nextPageToken.length() &gt; 0) {
                gmlUrl = String.format("%s&amp;nextPageToken=%s", getMultipleLeadsUrl, nextPageToken);
            }

            // Call Get Multiple Leads by Filter Type API to retrieve lead data
            JsonObject multipleLeadsObj = JsonObject.readFrom(getData(gmlUrl));
            if (multipleLeadsObj.get("success").asBoolean()) {
                if (multipleLeadsObj.get("result") != null) {
                    JsonArray multipleLeadsResultAry = multipleLeadsObj.get("result").asArray();

                    // Iterate through lead data
                    for (JsonValue leadResultObj : multipleLeadsResultAry) {
                        int leadId = leadResultObj.asObject().get("id").asInt();

                        // Join activity data with lead fields of interest (firstName, lastName, email)
                        List leadLst = activitiesMap.get(leadId);
                        for (JsonObject leadObj : leadLst) {
                            leadObj.add("firstName", leadResultObj.asObject().get("firstName").asString());
                            leadObj.add("lastName", leadResultObj.asObject().get("lastName").asString());
                            leadObj.add("email", leadResultObj.asObject().get("email").asString());
                        }
                    }
                }
            }

            nextPageToken = "";
            if (multipleLeadsObj.asObject().get("nextPageToken") != null) {
                nextPageToken = multipleLeadsObj.get("nextPageToken").asString();
            }
        } while (nextPageToken.length() &gt; 0);

        // Now place activity data into an array of JSON objects
        JsonArray activitiesAry = new JsonArray();
        for (Map.Entry&lt;Integer, List&gt; activity : activitiesMap.entrySet()) {
            int leadId = activity.getKey();
            for (JsonObject leadObj : activity.getValue()) {
                // do something with leadId and each leadObj
                leadObj.add("leadId", leadId);
                activitiesAry.add(leadObj);
            }
        }

        // Print out result objects
        JsonObject result = new JsonObject();
        result.add("result", activitiesAry);
        System.out.println(result);

        System.exit(0);
    }

    // Perform HTTP GET request
    private static String getData(String endpoint) {
        String data = "";
        try {
            URL url = new URL(endpoint);
            HttpsURLConnection urlConn = (HttpsURLConnection) url.openConnection();
            urlConn.setRequestMethod("GET");
            urlConn.setAllowUserInteraction(false);
            urlConn.setDoOutput(true);
            int responseCode = urlConn.getResponseCode();
            if (responseCode == 200) {
                InputStream inStream = urlConn.getInputStream();
                data = convertStreamToString(inStream);
            } else {
                System.out.println(responseCode);
                data = "Status:" + responseCode;
            }
        } catch (MalformedURLException e) {
            System.out.println("URL not valid.");
        } catch (IOException e) {
            System.out.println("IOException: " + e.getMessage());
            e.printStackTrace();
        }
        return data;
    }

    private static String convertStreamToString(InputStream inputStream) {
        try {
            return new Scanner(inputStream).useDelimiter("A").next();
        } catch (NoSuchElementException e) {
            return "";
        }
    }
}
</pre>
That’s it.  Happy coding!<br/><br/>deverly - 2015-11-20<br/><br/><h2>Integrating the SoundCloud player with the Munchkin API</h2><br/><br/><script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js"></script>
SoundCloud provides an incredible audio hosting platform, with rich analytics and functionality for everything from aspiring indie rock acts, to EDM artists at the top of the music industry, to storytelling podcasts.  Along with the incredible native functionality of the platform comes a world-class API program to move your data and track listening behavior.  This is especially useful for podcasters, and can allow you to correlate specific listening actions, like plays, pauses, and shares to specific content in the script and the audio.  Today we'll take a look at leveraging <a href="https://developers.soundcloud.com/docs/api/html5-widget">SoundCloud's widget API</a> to send and track these activities in Marketo.  The pattern we'll be using may seem familiar if you've read our post on <a href="/blog/embed-a-youtube-video-with-lead-tracking-on-a-marketo-landing-page/">tracking YouTube video views</a>.

First let's look at generating a Munchkin activity which will be recorded to a lead's activity log in Marketo.  At it's most basic, we make a call to Munchkin.munchkinFunction and pass "visitWebPage" as the first argument.   This will log a Visits Web Page activity with Marketo, and record any arbitrary URL and Query String data which we pass to the method.  The second argument accepts a JavaScript object with our data, which has two members, "url," and"params," both strings.  The url member corresponds to the Web Page of the activity in Marketo, while params corresponds to the Querystring.  For our purposes, we'll use the url as an identifier for SoundCloud related actions, "soundCloudInteraction," while params will contain additional data about the particular activity.  Here's the function we'll be using to track each action:
<pre class="lang:default decode:true prettyprint lang-js">var trackActivity = function(action){

    //set action param to be the string passed to the function
    var qs = "action=" + action;

    //use getCurrentSound callback to get the name of the current track
    soundCloudMunchkin.widget.getCurrentSound(function(currentSound){

        //add it to our querystring
        qs = qs + "&amp;sound=" + currentSound.title;

        //use the getPosition callback to get the position of the track in ms
        soundCloudMunchkin.widget.getPosition(function(position){

            //add it to the querystring
            qs = qs + "&amp;position=" + position;

            //assemble our data object for the munchkin activity
            var dataObject = {
                "url": "soundCloudInteraction",
                "params": qs
            }

            //call the munchkinFunction to submit the activity
            Munchkin.munchkinFunction("visitWebPage", dataObject);
        });
    });
}
</pre>
Since the standard SoundCloud widget is embedded in an iframe, the widget uses post messages to communicate and callbacks need to be used to obtain data, as you can see with the currentSound and getPosition methods.

The SoundCloud widget API provides a set of JavaScript callbacks that we can use to respond to individual events in the player and submit these to Marketo.  The events that we're interested in are what the user listens to, how long the user listens, and interactions that the user makes with the player, so we're looking at the following events:
<ul>
 	<li>PLAY</li>
 	<li>PAUSE</li>
 	<li>FINISH</li>
 	<li>SEEK</li>
 	<li>CLICK_DOWNLOAD</li>
 	<li>CLICK_BUY</li>
 	<li>OPEN_SHARE_PANEL</li>
</ul>
We'll also need to use the bind() method from the widget to add callbacks to each of these events.  Let's look at one example:
<pre class="lang:default decode:true prettyprint lang-js">widget.bind(SC.Widget.Events.PLAY, function(){
    soundCloudMunchkin.trackPlay();
});
</pre>
This will make it so that whenever a track is played, we'll fire the trackPlay method to send an event to Marketo with data about the current track.  You can find the full script <a href="https://gist.github.com/kelkingtron/6750bb07c1397d93d9c7#file-soundcloudmunchkin-js">here</a>.  The soundCloudMunchkin object has an init method, which accepts a SoundCloud widget object as it's only argument, which binds the tracking methods to the relevant callbacks, and will set up your widget to track activity down to Marketo.  Your page will need to have your <a href="/javascript-api/lead-tracking/">Munchkin code</a> loaded, as well as the <a href="https://w.soundcloud.com/player/api.js" target="_blank" rel="noopener noreferrer">SoundCloud API library</a>.  You'll also need to initialize everything, in addition to embedding your actual SoundCloud widget:
<pre class="lang:default decode:true prettyprint lang-js ">window.onload=function(){
var iframe = document.getElementById(iframeId);
    if(iframe) {
        widget = SC.Widget(iframe);
        soundCloudMunchkin.init(widget);
    };
};
</pre><br/><br/>kelkington - 2015-12-21<br/><br/><h2>RTP and the EU E-Privacy Directive</h2><br/><br/>This post explains you you can use RTP to notify website visitors they are being tracked or automatically disable tracking for European visitors.

Since 2012, any website available to European visitors must comply with the EU E-Privacy Directive.

New laws came into effect in 2011 which prevent identifying information being stored a user’s computer without their knowledge and consent.

If you’re using cookies or any other technologies for non-essential tracking, you must:
<ol>
	<li>Tell users that tracking technologies are used.</li>
	<li>Explain the reasons for using those technologies.</li>
	<li>Obtain the user’s consent prior to using that technology and allow them to withdraw permission at any time.</li>
</ol>
&nbsp;<br/><br/>YCalisar - 1970-01-01<br/><br/><h2>Updating customer and prospect information in Marketo using the API</h2><br/><br/>There are scenarios where proprietary systems are used to update customer and prospect information.  The Marketing team would like to have those updates reflected back in Marketo so they have the most accurate system of record to use in their marketing campaigns.  Using the below approach you can setup periodic uploads to Marketo to keep your Marketo contact information updated with the data modified in that proprietary system.

The diagram below shows the API calls that are made on a set periodic timer.

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/03/syncMultipleLeads-Diagram.png"><img class="aligncenter size-full wp-image-118" src="https://marketohost.wpengine.com/wp-content/uploads/2014/03/syncMultipleLeads-Diagram.png" alt="syncMultipleLeads-Diagram" width="980" height="321" /></a>

As the periodic timer is triggered the client logic will first retrieve updated contacts from the proprietary system.  How this is done will differ from system to system using either APIs or data exports from the proprietary system.  We’ll detail the Marketo APIs that are executed once the updated contact information is retrieved.

SOAP Request for syncMultipleLeads:
<pre class="lang:default decode:true prettyprint lang-xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;ns2:paramsSyncMultipleLeads xmlns:ns2="http://www.marketo.com/mktows/"&gt;
  &lt;leadRecordList&gt;
    &lt;leadRecord&gt;
      &lt;Email&gt;henry@superstar.com&lt;/Email&gt;
      &lt;ns2:leadAttributeList&gt;
        &lt;attribute&gt;
          &lt;attrName&gt;FirstName&lt;/attrName&gt;
          &lt;attrValue&gt;Henry&lt;/attrValue&gt;
        &lt;/attribute&gt;
        &lt;attribute&gt;
          &lt;attrName&gt;LastName&lt;/attrName&gt;
          &lt;attrValue&gt;Adams&lt;/attrValue&gt;
        &lt;/attribute&gt;
        &lt;attribute&gt;
          &lt;attrName&gt;Title&lt;/attrName&gt;
          &lt;attrValue&gt;Director of Demand Generation&lt;/attrValue&gt;
        &lt;/attribute&gt;
      &lt;/ns2:leadAttributeList&gt;
    &lt;/leadRecord&gt;
    &lt;leadRecord&gt;
      &lt;Email&gt;ssmith@gmail.com&lt;/Email&gt;
      &lt;ns2:leadAttributeList&gt;
        &lt;attribute&gt;
          &lt;attrName&gt;FirstName&lt;/attrName&gt;
          &lt;attrValue&gt;Suzie&lt;/attrValue&gt;
        &lt;/attribute&gt;
        &lt;attribute&gt;
          &lt;attrName&gt;LastName&lt;/attrName&gt;
          &lt;attrValue&gt;Smith&lt;/attrValue&gt;
        &lt;/attribute&gt;
        &lt;attribute&gt;
          &lt;attrName&gt;Title&lt;/attrName&gt;
          &lt;attrValue&gt;VP Marketing&lt;/attrValue&gt;
        &lt;/attribute&gt;
      &lt;/ns2:leadAttributeList&gt;
    &lt;/leadRecord&gt;
  &lt;/leadRecordList&gt;
  &lt;dedupEnabled&gt;true&lt;/dedupEnabled&gt;
&lt;/ns2:paramsSyncMultipleLeads&gt;</pre>
SOAP Response from the syncMultilpeLeads:
<pre class="lang:default decode:true prettyprint lang-xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;ns2:successSyncMultipleLeads xmlns:ns2="http://www.marketo.com/mktows/"&gt;
  &lt;result&gt;
    &lt;syncStatusList&gt;
      &lt;syncStatus&gt;
        &lt;leadId&gt;1094593&lt;/leadId&gt;
        &lt;status&gt;UPDATED&lt;/status&gt;
        &lt;error xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true" /&gt;
      &lt;/syncStatus&gt;
      &lt;syncStatus&gt;
        &lt;leadId&gt;1094594&lt;/leadId&gt;
        &lt;status&gt;UPDATED&lt;/status&gt;
        &lt;error xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true" /&gt;
      &lt;/syncStatus&gt;
    &lt;/syncStatusList&gt;
  &lt;/result&gt;
&lt;/ns2:successSyncMultipleLeads&gt;</pre>
syncMultipleLeads will perform an UPSERT operation.  If a contact within Marketo already exists based on the email address submitted, the attributes will be updated.  If a contact does not exist it will be created.  The response from syncMultipleLeads will return the status for each of the contacts submitted.

The &lt;attrName/&gt; values within the &lt;leadAttributeList/&gt; must match the SOAP API Name defined for that Marketo subscription.  You can discover the SOAP API Names within the field management section within Marketo admin panel by exporting the field names.
<p style="text-align: center;"><a href="https://marketohost.wpengine.com/wp-content/uploads/2014/03/marketo-admin.png"><img class="aligncenter size-full wp-image-120" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2014/03/marketo-admin.png" alt="marketo-admin" width="640" height="339" /></a></p>
&nbsp;

The field names will be exported into an excel file as seen below.
<p style="text-align: center;"><a href="https://marketohost.wpengine.com/wp-content/uploads/2014/03/exported-field-names.png"><img class="aligncenter size-full wp-image-124" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2014/03/exported-field-names.png" alt="exported-field-names" width="370" height="77" /></a></p>
See the below sample Java program that executes the scenario described above:
<pre class="lang:default decode:true prettyprint lang-java">import com.marketo.mktows.*;
import java.net.URL;
import javax.xml.namespace.QName;
import java.text.DateFormat;
import java.text.SimpleDateFormat;
import java.util.Date;
import javax.crypto.Mac;
import javax.crypto.spec.SecretKeySpec;
import org.apache.commons.codec.binary.Hex;
import javax.xml.bind.JAXBContext;
import javax.xml.bind.JAXBElement;
import javax.xml.bind.Marshaller;
import java.util.*;

public class SyncMultipleLeadsExample {

  public static void main(String[] args) {

    try {
      URL marketoSoapEndPoint = new URL("CHANGE ME" + "?WSDL");
      String marketoUserId = "CHANGE ME";
      String marketoSecretKey = "CHANGE ME";

      QName serviceName = new QName("http://www.marketo.com/mktows/", "MktMktowsApiService");
      MktMktowsApiService service = new MktMktowsApiService(marketoSoapEndPoint, serviceName);
      MktowsPort port = service.getMktowsApiSoapPort();

      // Create Signature
      DateFormat df = new SimpleDateFormat("yyyy-MM-dd'T'HH:mm:ssZ");
      String text = df.format(new Date());
      String requestTimestamp = text.substring(0, 22) + ":" + text.substring(22);      
      String encryptString = requestTimestamp + marketoUserId ;

      SecretKeySpec secretKey = new SecretKeySpec(marketoSecretKey.getBytes(), "HmacSHA1");
      Mac mac = Mac.getInstance("HmacSHA1");
      mac.init(secretKey);
      byte[] rawHmac = mac.doFinal(encryptString.getBytes());
      char[] hexChars = Hex.encodeHex(rawHmac);
      String signature = new String(hexChars); 

      // Set Authentication Header
      AuthenticationHeader header = new AuthenticationHeader();
      header.setMktowsUserId(marketoUserId);
      header.setRequestTimestamp(requestTimestamp);
      header.setRequestSignature(signature);

      // Create Request
      ParamsSyncMultipleLeads request = new ParamsSyncMultipleLeads();

      ObjectFactory objectFactory = new ObjectFactory();

      JAXBElement dedup = objectFactory.createParamsSyncMultipleLeadsDedupEnabled(true);
      request.setDedupEnabled(dedup);

      // The list of contacts defined here would be retrieved from the proprietary system
      Contact contact = new Contact("Henry","Adams","henry@superstar.com", "Director of Demand Generation");
      Contact contact2 = new Contact("Suzie","Smith","ssmith@gmail.com", "VP Marketing");

      ArrayList updatedContacts = new ArrayList();
      updatedContacts.add(contact);
      updatedContacts.add(contact2);

      ArrayOfLeadRecord arrayOfLeadRecords = new ArrayOfLeadRecord();

      Iterator it = updatedContacts.iterator();
      while(it.hasNext())
      {
        Contact c = it.next();

        LeadRecord leadRec = new LeadRecord();

        JAXBElement email = objectFactory.createLeadRecordEmail(c.email);
        leadRec.setEmail(email);      

        Attribute attr1 = new Attribute();
        attr1.setAttrName("FirstName");
        attr1.setAttrValue(c.fname);

        Attribute attr2 = new Attribute();
        attr2.setAttrName("LastName");
        attr2.setAttrValue(c.lname);

        Attribute attr3 = new Attribute();
        attr3.setAttrName("Title");
        attr3.setAttrValue(c.title);

        ArrayOfAttribute aoa = new ArrayOfAttribute();
        aoa.getAttributes().add(attr1);
        aoa.getAttributes().add(attr2);
        aoa.getAttributes().add(attr3);

        QName qname = new QName("http://www.marketo.com/mktows/", "leadAttributeList");
        JAXBElement attrList = new JAXBElement(qname, ArrayOfAttribute.class, aoa);

        leadRec.setLeadAttributeList(attrList);
        arrayOfLeadRecords.getLeadRecords().add(leadRec);

      }

      request.setLeadRecordList(arrayOfLeadRecords);      

      JAXBContext context = JAXBContext.newInstance(SuccessSyncMultipleLeads.class);
      Marshaller m = context.createMarshaller();
      m.setProperty(Marshaller.JAXB_FORMATTED_OUTPUT, true);
      m.marshal(request, System.out);

      SuccessSyncMultipleLeads result = port.syncMultipleLeads(request, header);

      m.marshal(result, System.out);
    }

    catch(Exception e) {
      e.printStackTrace();
    }
  }

  public static class Contact {
    public String fname, lname, email, title;

      public Contact(String fname, String lname, String email, String title) {
          this.fname = fname;
          this.lname = lname;
          this.email = email;
          this.title = title;
      }
  }
}</pre>
&nbsp;
<p style="font-size: x-small;">* This article contains code used to implement custom integrations. Due to its customized nature, The Marketo Technical Support team is unable to troubleshoot custom work. Please do not attempt to implement the following code sample without appropriate technical experience, or access to an experienced developer.</p><br/><br/>TKaufman - 2014-03-24<br/><br/><h2>Sending a transactional email from Marketo using the API</h2><br/><br/>You can send a transactional email from Marketo using the <a href="/soap-api/requestcampaign/">requestCampaign</a> SOAP API. It requires an existing Smart Campaign to be created using the Marketo UI. It also requires the email recipient to exist in Marketo. So before calling the requestCampaign API, use the <a href="/soap-api/getlead/">getLead API</a> to verify if the email exists in Marketo. After you make a call via the <a href="/soap-api/requestcampaign/">requestCampaign</a> API, you can confirm it by checking to see if the Smart Campaign has run in Marketo.

We'll show you first how to create a Smart Campaign, second how to set up a trigger to send a campaign via the API, third how to define an email as part of a flow action, and fourth a code sample that would be used to execute this campaign.

<strong>How to Create a New Smart Campaign in Marketo</strong>

Smart Campaigns in Marketo execute all of your marketing activities. You can set up a series of automated actions to take on a smart list of contacts. In the case of sending transactional emails, you set up a trigger in the campaign, as shown below, to send emails using the API. First let's set up the Smart Campaign.

1. In Marketing Activities, choose a Program and then under the New dropdown, click on New Local Asset

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/03/smart1.png"><img class="alignnone size-full wp-image-190" src="https://marketohost.wpengine.com/wp-content/uploads/2014/03/smart1.png" alt="smart1" width="603" height="243" /></a>

2. Click on Smart Campaign

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/03/smart2.png"><img class="alignnone size-full wp-image-192" src="https://marketohost.wpengine.com/wp-content/uploads/2014/03/smart2.png" alt="smart2" width="573" height="306" /></a>

3. Enter smart campaign name and click Create

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/03/smart3.png"><img class="alignnone size-full wp-image-194" src="https://marketohost.wpengine.com/wp-content/uploads/2014/03/smart3.png" alt="smart3" width="520" height="330" /></a>

<strong>Add Triggers to a Smart Campaign</strong>

Adding Triggers to a Smart Campaign allows you to make a Smart Campaign run on one person at a time based on a live event, which in this case is a request via the <a href="/soap-api/requestcampaign/">requestCampaign API</a>.

1. Search for the "Campaign is Requested" trigger and then drag and drop it to the canvas.
<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/03/campaignrequest.png"><img class="alignnone size-full wp-image-216" src="https://marketohost.wpengine.com/wp-content/uploads/2014/03/campaignrequest.png" alt="campaignrequest" width="602" height="296" /></a>
2. In the trigger, select "is" and "Web Service API."
<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/03/webserviceapi.png"><img class="alignnone size-full wp-image-202" src="https://marketohost.wpengine.com/wp-content/uploads/2014/03/webserviceapi.png" alt="webserviceapi" width="562" height="138" /></a>

<strong>How to Create Email Flow Action on a Campaign</strong>

The association of an email with a Smart Campaign allows marketers to manage how they want an email to look, and allows the third-party application to determine who receives it and when.

After creating an email as a new Local Asset, you can set it as a flow action in a campaign.

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/03/email1.png"><img class="alignnone size-full wp-image-292" src="https://marketohost.wpengine.com/wp-content/uploads/2014/03/email1.png" alt="email1" width="637" height="118" /></a>

Find and select the email you want to send.

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/03/email2.png"><img class="alignnone size-full wp-image-284" src="https://marketohost.wpengine.com/wp-content/uploads/2014/03/email2.png" alt="email2" width="639" height="158" /></a>

<strong>Code Sample to Call the requestCampaign API</strong>

After setting up the campaign and triggers in the Marketo interface, we will show you how to use the API to send an email. The first sample is a XML request, the second is a XML response, and the final one is a Java code sample that can be used to generate the XML request. We also show you how to find the campaign ID that is used when making a call to the requestCampaign API.

The API call also requires you to know the ID of the Marketo campaign beforehand. You can determine the campaign ID using either of the following methods:

1. Use the <a href="/soap-api/getcampaignsforsource/">getCampaignsForSource</a> API

2. Open the Marketo campaign in a browser and look at the URL address bar. The campaign ID (represented as a 4-digit integer) can be found immediately following "SC". For example, https://app-stage.marketo.com/#SC<strong>1025</strong>A1. The bolded portion is the campaign ID - "1025."

SOAP Request for requestCampaign
<pre class="lang:default decode:true prettyprint linenums lang-xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;SOAP-ENV:Envelope xmlns:SOAP-ENV="http://schemas.xmlsoap.org/soap/envelope/" xmlns:ns1="http://www.marketo.com/mktows/"&gt;
  &lt;SOAP-ENV:Header&gt;
    &lt;ns1:AuthenticationHeader&gt;
      &lt;mktowsUserId&gt;demo17_1_809939944BFABAE58E5D27&lt;/mktowsUserId&gt;&lt;requestSignature&gt;48397ad47b71a1439f13a51eea3137df46441979&lt;/requestSignature&gt;&lt;requestTimestamp&gt;2013-08-01T12:31:14-07:00&lt;/requestTimestamp&gt;
    &lt;/ns1:AuthenticationHeader&gt;
  &lt;/SOAP-ENV:Header&gt;
  &lt;SOAP-ENV:Body&gt;
    &lt;ns1:paramsRequestCampaign&gt;
      &lt;source&gt;MKTOWS&lt;/source&gt;
      &lt;campaignId&gt;4496&lt;/campaignId&gt;
      &lt;leadList&gt;
        &lt;leadKey&gt;
          &lt;keyType&gt;EMAIL&lt;/keyType&gt;
          &lt;keyValue&gt;lead@company.com&lt;/keyValue&gt;
        &lt;/leadKey&gt;
        &lt;leadKey&gt;
          &lt;keyType&gt;EMAIL&lt;/keyType&gt;
          &lt;keyValue&gt;anotherlead@company.com&lt;/keyValue&gt;
        &lt;/leadKey&gt;
      &lt;/leadList&gt;
    &lt;/ns1:paramsRequestCampaign&gt;
  &lt;/SOAP-ENV:Body&gt;
&lt;/SOAP-ENV:Envelope&gt;</pre>
SOAP Response for requestCampaign
<pre class="lang:default decode:true prettyprint linenums lang-xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;SOAP-ENV:Envelope xmlns:SOAP-ENV="http://schemas.xmlsoap.org/soap/envelope/" xmlns:ns1="http://www.marketo.com/mktows/"&gt;
  &lt;SOAP-ENV:Body&gt;
    &lt;ns1:successRequestCampaign&gt;
      &lt;result&gt;
        &lt;success&gt;true&lt;/success&gt;
      &lt;/result&gt;
    &lt;/ns1:successRequestCampaign&gt;
  &lt;/SOAP-ENV:Body&gt;
&lt;/SOAP-ENV:Envelope&gt;</pre>
See below a sample Java program that executes the scenario described above.
<pre class="lang:default decode:true prettyprint lang-java ">import com.marketo.mktows.*;
import java.net.URL;
import javax.xml.namespace.QName;
import java.text.DateFormat;
import java.text.SimpleDateFormat;
import java.util.Date;
import javax.crypto.Mac;
import javax.crypto.spec.SecretKeySpec;
import org.apache.commons.codec.binary.Hex;
import javax.xml.bind.JAXBContext;
import javax.xml.bind.JAXBElement;
import javax.xml.bind.Marshaller;
 
 
public class RequestCampaign {
 
    public static void main(String[] args) {
        System.out.println("Executing Request Campaign");
        try {
            URL marketoSoapEndPoint = new URL("CHANGE ME" + "?WSDL");
            String marketoUserId = "CHANGE ME";
            String marketoSecretKey = "CHANGE ME";
             
            QName serviceName = new QName("http://www.marketo.com/mktows/", "MktMktowsApiService");
            MktMktowsApiService service = new MktMktowsApiService(marketoSoapEndPoint, serviceName);
            MktowsPort port = service.getMktowsApiSoapPort();
             
            // Create Signature
            DateFormat df = new SimpleDateFormat("yyyy-MM-dd'T'HH:mm:ssZ");
            String text = df.format(new Date());
            String requestTimestamp = text.substring(0, 22) + ":" + text.substring(22);           
            String encryptString = requestTimestamp + marketoUserId ;
             
            SecretKeySpec secretKey = new SecretKeySpec(marketoSecretKey.getBytes(), "HmacSHA1");
            Mac mac = Mac.getInstance("HmacSHA1");
            mac.init(secretKey);
            byte[] rawHmac = mac.doFinal(encryptString.getBytes());
            char[] hexChars = Hex.encodeHex(rawHmac);
            String signature = new String(hexChars); 
             
            // Set Authentication Header
            AuthenticationHeader header = new AuthenticationHeader();
            header.setMktowsUserId(marketoUserId);
            header.setRequestTimestamp(requestTimestamp);
            header.setRequestSignature(signature);
             
            // Create Request
            ParamsRequestCampaign request = new ParamsRequestCampaign();
             
            request.setSource(ReqCampSourceType.MKTOWS);
             
            ObjectFactory objectFactory = new ObjectFactory();
            JAXBElement&lt;Integer&gt; campaignId = objectFactory.createParamsRequestCampaignCampaignId(4496);
            request.setCampaignId(campaignId);
             
            ArrayOfLeadKey leadKeyList = new ArrayOfLeadKey();
            LeadKey key = new LeadKey();
            key.setKeyType(LeadKeyRef.EMAIL);
            key.setKeyValue("lead@company.com");
             
            LeadKey key2 = new LeadKey();
            key2.setKeyType(LeadKeyRef.EMAIL);
            key2.setKeyValue("anotherlead@company.com");
             
            leadKeyList.getLeadKeies().add(key);
            leadKeyList.getLeadKeies().add(key2);
             
            JAXBElement&lt;ArrayOfLeadKey&gt; arrayOfLeadKey = objectFactory.createParamsRequestCampaignLeadList(leadKeyList);
            request.setLeadList(arrayOfLeadKey);
 
            SuccessRequestCampaign result = port.requestCampaign(request, header);
 
            JAXBContext context = JAXBContext.newInstance(SuccessRequestCampaign.class);
            Marshaller m = context.createMarshaller();
            m.setProperty(Marshaller.JAXB_FORMATTED_OUTPUT, true);
            m.marshal(result, System.out);
             
        }
        catch(Exception e) {
            e.printStackTrace();
        }
    }
}</pre>
<p style="font-size: x-small;">* This article contains code used to implement custom integrations. Due to its customized nature, The Marketo Technical Support team is unable to troubleshoot custom work. Please do not attempt to implement the following code sample without appropriate technical experience, or access to an experienced developer.</p><br/><br/>MManzur - 2014-03-27<br/><br/><h2>Sending an Email with Dynamic Content from Marketo using the API</h2><br/><br/>Imagine you want to automate your call center follow-up emails. After your support rep speaks with a customer, you would like to automatically send an email thanking them for contacting your company. Let's take this a step further, and say you want to include the specific conversation topic discussed with the customer that you track in your CRM. You can do this from Marketo using the <a href="/soap-api/requestcampaign/">requestCampaign</a> SOAP API to send an email with dynamic content.

The requestCampaign API allows you to pass in a lead or leads. It also allows you to pass in Program Tokens that can be used with an existing Campaign to send dynamic content. The requestCampaign SOAP API requires the email recipient to exist in Marketo. So before calling the requestCampaign API, use the <a href="/soap-api/getlead/">getLead API</a> to verify if the email exists in Marketo.

We'll show you first how to create a Smart Campaign, second how to set up a trigger to send a campaign via the API, third how to create an email that accepts dynamic content via Program Tokens, fourth how to define an email as part of a flow action, and fifth a code sample that would be used to execute this campaign.

<strong>How to Create a New Smart Campaign in Marketo</strong>

Smart Campaigns in Marketo execute all of your marketing activities. You can set up a series of automated actions to take on a smart list of contacts. In the case of sending transactional emails, you set up a trigger in the campaign, as shown below, to send emails using the API. First let's set up the Smart Campaign.

1. In Marketing Activities, choose a Program and then under the New dropdown, click on New Local Asset

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/04/smart1.png"><img class="alignnone size-full wp-image-190" src="https://marketohost.wpengine.com/wp-content/uploads/2014/04/smart1.png" alt="smart1" width="603" height="243" /></a>

2. Click on Smart Campaign

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/04/smart2.png"><img class="alignnone size-full wp-image-192" src="https://marketohost.wpengine.com/wp-content/uploads/2014/04/smart2.png" alt="smart2" width="573" height="306" /></a>

3. Enter smart campaign name and click Create

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/04/new-campaign.png"><img class="alignnone size-full wp-image-440" src="https://marketohost.wpengine.com/wp-content/uploads/2014/04/new-campaign.png" alt="new-campaign" width="543" height="344" /></a>

<strong>Add Triggers to a Smart Campaign</strong>

Adding Triggers to a Smart Campaign allows you to make a Smart Campaign run on one person at a time based on a live event, which in this case is a request via the <a href="/soap-api/requestcampaign/">requestCampaign API</a>.

1. Search for the "Campaign is Requested" trigger and then drag and drop it to the canvas.
<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/04/campaignrequest.png"><img class="alignnone size-full wp-image-216" src="https://marketohost.wpengine.com/wp-content/uploads/2014/04/campaignrequest.png" alt="campaignrequest" width="602" height="296" /></a>
2. In the trigger, select "is" and "Web Service API."
<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/04/webserviceapi.png"><img class="alignnone size-full wp-image-202" src="https://marketohost.wpengine.com/wp-content/uploads/2014/04/webserviceapi.png" alt="webserviceapi" width="562" height="138" /></a>

<strong>How to Pass in Dynamic Content Using the API</strong>

In Marketo, My Tokens are variables that you can use in your Program. My Tokens enable you to enter information pertaining to your Program in one place, replace that information with a value you specify, and retrieve this information in other parts of the application, such as an email template.

Using the <a href="/soap-api/requestcampaign/">requestCampaign</a> SOAP API, you can pass an array of Program Tokens, which will override existing tokens. After the campaign runs, the tokens are discarded.

You create My Tokens at either the Campaign folder level, or at the Program level. My Tokens at the Campaign folder level will inherit down to all Programs contained within the Campaign folder. If you create My Tokens at the Campaign folder level, you can overwrite the inherited value at the Program level. For example, if you define tokens for the Program Date and the Program Description at the Campaign folder level, you can overwrite these values at the individual Program level. Here's how to do this.

1. From the Marketing Activities tree, select the Campaign folder or Program where you want to create the tokens. From the top menu bar, select My Tokens. Then the My Tokens canvas will display. From the right hand side tree, drag a Token Type to the canvas, which in this case is "Text." In the Token Name field, highlight My Token and enter a unique Token Name, which in this case is "my.conversationtopic." In the Value field, enter a relevant Value for the token, which in this case is "Thank you for calling us today." Note by using the API we will override the default My Token value. Click "Save" to save the custom token.

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/04/My-Tokens.png"><img class="alignnone size-full wp-image-400" src="https://marketohost.wpengine.com/wp-content/uploads/2014/04/My-Tokens.png" alt="My-Tokens" width="1440" height="400" /></a>

2. Create a New Email by clicking New. Then click on New Local Assets and select Email. Next fill out the relevant fields to name your email. When drafting your email, click the Token icon to include tokens in your email. Now that you have created your template email with Tokens, we will add the email as a flow action for the Campaign in the subsequent step. So when you call the campaign via the API, the email will be sent out.

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/04/email-token1.png"><img class="alignnone size-full wp-image-406" src="https://marketohost.wpengine.com/wp-content/uploads/2014/04/email-token1.png" alt="email-token1" width="1411" height="710" /></a>

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/04/email-token.png"><img class="alignnone size-full wp-image-404" src="https://marketohost.wpengine.com/wp-content/uploads/2014/04/email-token.png" alt="email-token" width="1440" height="775" /></a>

<strong>How to Create Email Flow Action on a Campaign</strong>

The association of an email with a Smart Campaign allows marketers to manage how they want an email to look, and allows the third-party application to determine who receives it and when.

After creating an email as a new Local Asset, you can set it as a flow action in a campaign.

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/04/email1.png"><img class="alignnone size-full wp-image-292" src="https://marketohost.wpengine.com/wp-content/uploads/2014/04/email1.png" alt="email1" width="637" height="118" /></a>

Find and select the email you want to send.

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/04/email2.png"><img class="alignnone size-full wp-image-284" src="https://marketohost.wpengine.com/wp-content/uploads/2014/04/email2.png" alt="email2" width="639" height="158" /></a>

<strong>Code Sample to Call the requestCampaign API</strong>

After setting up the campaign and triggers in the Marketo interface, we will show you how to use the API to send an email. The first sample is a XML request, the second is a XML response, and the final one is a Java code sample that can be used to generate the XML request. We also show you how to find the campaign ID that is used when making a call to the requestCampaign API.

The API call also requires you to know the ID of the Marketo campaign beforehand. You can determine the campaign ID using either of the following methods:

1. Use the <a href="/soap-api/getcampaignsforsource/">getCampaignsForSource</a> API

2. Open the Marketo campaign in a browser and look at the URL address bar. The campaign ID (represented as a 4-digit integer) can be found immediately following "SC". For example, https://app-stage.marketo.com/#SC<strong>1025</strong>A1. The bolded portion is the campaign ID - "1025."

SOAP Request for requestCampaign
<pre class="lang:default decode:true prettyprint linenums lang-xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;SOAP-ENV:Envelope xmlns:SOAP-ENV="http://schemas.xmlsoap.org/soap/envelope/" xmlns:ns1="http://www.marketo.com/mktows/"&gt;
  &lt;SOAP-ENV:Header&gt;
    &lt;ns1:AuthenticationHeader&gt;
      &lt;mktowsUserId&gt;demo17_1_809939944BFABAE58E5D27&lt;/mktowsUserId&gt;&lt;requestSignature&gt;48397ad47b71a1439f13a51eea3137df46441979&lt;/requestSignature&gt;&lt;requestTimestamp&gt;2013-08-01T12:31:14-07:00&lt;/requestTimestamp&gt;
    &lt;/ns1:AuthenticationHeader&gt;
  &lt;/SOAP-ENV:Header&gt;
  &lt;SOAP-ENV:Body&gt;
    &lt;ns1:paramsRequestCampaign&gt;
      &lt;source&gt;MKTOWS&lt;/source&gt;
      &lt;campaignId&gt;4496&lt;/campaignId&gt;
      &lt;leadList&gt;
        &lt;leadKey&gt;
          &lt;keyType&gt;EMAIL&lt;/keyType&gt;
          &lt;keyValue&gt;lead@company.com&lt;/keyValue&gt;
        &lt;/leadKey&gt;
      &lt;/leadList&gt;
      &lt;programTokenList&gt;
        &lt;attrib&gt;
          &lt;name&gt;{{my.conversationtopic}}&lt;/name&gt;
          &lt;value&gt;Thank you for calling about adding a line of service to your current plan.&lt;/value&gt;
        &lt;/attrib&gt;
      &lt;/programTokenList&gt;
    &lt;/ns1:paramsRequestCampaign&gt;
  &lt;/SOAP-ENV:Body&gt;
&lt;/SOAP-ENV:Envelope&gt;</pre>
SOAP Response for requestCampaign
<pre class="lang:default decode:true prettyprint linenums lang-xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;SOAP-ENV:Envelope xmlns:SOAP-ENV="http://schemas.xmlsoap.org/soap/envelope/" xmlns:ns1="http://www.marketo.com/mktows/"&gt;
  &lt;SOAP-ENV:Body&gt;
    &lt;ns1:successRequestCampaign&gt;
      &lt;result&gt;
        &lt;success&gt;true&lt;/success&gt;
      &lt;/result&gt;
    &lt;/ns1:successRequestCampaign&gt;
  &lt;/SOAP-ENV:Body&gt;
&lt;/SOAP-ENV:Envelope&gt;</pre>
See below a sample Java program that executes the scenario described above.
<pre class="lang:default decode:true prettyprint linenums lang-java">import com.marketo.mktows.*;
import java.net.URL;
import javax.xml.namespace.QName;
import java.text.DateFormat;
import java.text.SimpleDateFormat;
import java.util.Date;
import javax.crypto.Mac;
import javax.crypto.spec.SecretKeySpec;
import org.apache.commons.codec.binary.Hex;
import javax.xml.bind.JAXBContext;
import javax.xml.bind.JAXBElement;
import javax.xml.bind.Marshaller;
 
 
public class RequestCampaign {
 
    public static void main(String[] args) {
        System.out.println("Executing Request Campaign");
        try {
            URL marketoSoapEndPoint = new URL("CHANGE ME" + "?WSDL");
            String marketoUserId = "CHANGE ME";
            String marketoSecretKey = "CHANGE ME";
             
            QName serviceName = new QName("http://www.marketo.com/mktows/", "MktMktowsApiService");
            MktMktowsApiService service = new MktMktowsApiService(marketoSoapEndPoint, serviceName);
            MktowsPort port = service.getMktowsApiSoapPort();
             
            // Create Signature
            DateFormat df = new SimpleDateFormat("yyyy-MM-dd'T'HH:mm:ssZ");
            String text = df.format(new Date());
            String requestTimestamp = text.substring(0, 22) + ":" + text.substring(22);           
            String encryptString = requestTimestamp + marketoUserId ;
             
            SecretKeySpec secretKey = new SecretKeySpec(marketoSecretKey.getBytes(), "HmacSHA1");
            Mac mac = Mac.getInstance("HmacSHA1");
            mac.init(secretKey);
            byte[] rawHmac = mac.doFinal(encryptString.getBytes());
            char[] hexChars = Hex.encodeHex(rawHmac);
            String signature = new String(hexChars); 
             
            // Set Authentication Header
            AuthenticationHeader header = new AuthenticationHeader();
            header.setMktowsUserId(marketoUserId);
            header.setRequestTimestamp(requestTimestamp);
            header.setRequestSignature(signature);
             
            // Create Request
            ParamsRequestCampaign request = new ParamsRequestCampaign();
             
            request.setSource(ReqCampSourceType.MKTOWS);
             
            ObjectFactory objectFactory = new ObjectFactory();
            JAXBElement&lt;Integer&gt; campaignId = objectFactory.createParamsRequestCampaignCampaignId(4496);
            request.setCampaignId(campaignId);
             
            ArrayOfLeadKey leadKeyList = new ArrayOfLeadKey();
            LeadKey key = new LeadKey();
            key.setKeyType(LeadKeyRef.EMAIL);
            key.setKeyValue("lead@company.com");
             
            leadKeyList.getLeadKeies().add(key);
             
            JAXBElement&lt;ArrayOfLeadKey&gt; arrayOfLeadKey = objectFactory.createParamsRequestCampaignLeadList(leadKeyList);
            request.setLeadList(arrayOfLeadKey);

            ArrayOfAttrib aoa = new ArrayOfAttrib();
             
            Attrib attrib = new Attrib();
            attrib.setName("{{my.conversationtopic}}");
            attrib.setValue("Thank you for calling about adding a line of service to your current plan.");
             
            aoa.getAttribs().add(attrib);
             
            JAXBElement&lt;ArrayOfAttrib&gt; arrayOfAttrib = objectFactory.createParamsRequestCampaignProgramTokenList(aoa);
            request.setProgramTokenList(arrayOfAttrib);
 
            SuccessRequestCampaign result = port.requestCampaign(request, header);
 
            JAXBContext context = JAXBContext.newInstance(SuccessRequestCampaign.class);
            Marshaller m = context.createMarshaller();
            m.setProperty(Marshaller.JAXB_FORMATTED_OUTPUT, true);
            m.marshal(result, System.out);
             
        }
        catch(Exception e) {
            e.printStackTrace();
        }
    }
}</pre>
After you make a call via the <a href="/soap-api/requestcampaign/">requestCampaign</a> API, you can confirm it by checking to see if the Smart Campaign has run in Marketo.

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/04/campaign.png"><img class="alignnone size-full wp-image-454" src="https://marketohost.wpengine.com/wp-content/uploads/2014/04/campaign.png" alt="campaign" width="744" height="151" /></a>
<p style="font-size: x-small;">* This article contains code used to implement custom integrations. Due to its customized nature, The Marketo Technical Support team is unable to troubleshoot custom work. Please do not attempt to implement the following code sample without appropriate technical experience, or access to an experienced developer.</p><br/><br/>MManzur - 2014-04-03<br/><br/><h2>Capture Anonymous Visitor Activity Based on Business Logic</h2><br/><br/>Imagine you want to track users who visit a specific post on your company blog. Let's say out of the total number of users who visit a post, you would only like to track users who signal their interest by spending at least 5 seconds and scrolling down the page. For anonymous users you would like to create a new lead in Marketo with this event, and for known users you would like to update their lead activity with this event. You can accomplish this by using the <a href="/javascript-api/lead-tracking/">Munchkin tracking code</a> on your website.

When a non-cookied user goes to a page with the Munchkin tracking code, a new cookie will be created and stored on the user's browser, and a new anonymous lead will be created in Marketo. If the user is already cookied and the user is an existing lead in Marketo, the visit to the page will be recorded in the activity log of the user in Marketo.

We’ll show you first how to generate Munchkin tracking code in Marketo, second how to modify your Munchkin sample code to only trigger if certain conditions are met, and third how to verify that a page visit from an anonymous user was recorded in Marketo.

<strong>How to Generate Munchkin Tracking Code</strong>

The Munchkin tracking code allows you to track visits to your web site. There are three types of Munchkin code described below, but in this example we will use the Asynchronous Munchkin tracking code.

A) Simple: has the fewest lines of code, but does not optimize for webpage loading time. This code loads the jQuery library each time a webpage is loaded.

B) Asynchronous: reduces webpage loading time. This code checks if the jQuery library already exists, loads it if it's missing, and uses it for executing tracking code once the rest of the webpage has loaded.

C) Asynchronous jQuery: reduces webpage loading time and also improves system performance. This code assumes that you already have jQuery, and does not check to load it.

1. Click Admin at the top right of the app.

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/04/14.png"><img class="alignnone size-full wp-image-492" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2014/04/14.png" alt="1" width="650" height="350" /></a>

2. Click Munchkin in the tree on the left.

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/04/21.png"><img class="alignnone size-full wp-image-490" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2014/04/21.png" alt="2" width="650" height="394" /></a>

3. Select Asynchronous for Tracking Code Type.

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/04/31.png"><img class="alignnone size-full wp-image-488" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2014/04/31.png" alt="3" width="538" height="392" /></a>

4. Click and copy the Javascript tracking code to put on your website.

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/04/41.png"><img class="alignnone size-full wp-image-486" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2014/04/41.png" alt="4" width="543" height="530" /></a>

<strong>Code Sample to Cookie User and Track Event</strong>

Place the tracking code on your web pages right before the &lt;/body&gt; tag. Landing pages created in Marketo automatically contain tracking code, so you don’t need to put this code on them.

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/04/61.png"><img class="alignnone size-full wp-image-484" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2014/04/61.png" alt="6" width="655" height="369" /></a>

This code sample would call the Munchkin API after the script is loaded:
<pre class="lang:default decode:true prettyprint linenums lang-js">&lt;script type="text/javascript"&gt;
(function() {
  var didInit = false;
  function initMunchkin() {
    if(didInit === false) {
      didInit = true;
      Munchkin.init('XXX-XXX-XXX');
    }
  }
  var s = document.createElement('script');
  s.type = 'text/javascript';
  s.async = true;
  s.src = '//munchkin.marketo.net/munchkin.js';
  s.onreadystatechange = function() {
    if (this.readyState == 'complete' || this.readyState == 'loaded') {
      initMunchkin();
    }
  };
  s.onload = initMunchkin;
  document.getElementsByTagName('head')[0].appendChild(s);
})();
&lt;/script&gt;
</pre>
This code sample would call the Munchkin API after the user has been on the page for 5 seconds and has also scrolled 500 pixels down the page:
<pre class="lang:default decode:true prettyprint linenums lang-js">&lt;script src="https://code.jquery.com/jquery-2.1.0.min.js"&gt;&lt;/script&gt;
&lt;script type="text/javascript"&gt;
$(function(){
	setTimeout(function(){
		$(window).scroll(function() {
    		var y_scroll_position = window.pageYOffset;
    		var scroll_position = 500; //Sets number of pixels user must scroll to be tracked        
		
		if(y_scroll_position &gt; scroll_position) {
		//Munchkin tracking code
			(function() {
  			var didInit = false;
  			function initMunchkin() {
    		if(didInit === false) {
      		didInit = true;
      		Munchkin.init('XXX-XXX-XXX');
    		}
  			}
  			
  			var s = document.createElement('script');
  			s.type = 'text/javascript';
  			s.async = true;
 			s.src = '//munchkin.marketo.net/munchkin.js';
  			s.onreadystatechange = function() {
    		if (this.readyState == 'complete' || this.readyState == 'loaded') {
     	    initMunchkin();
    		}
  			};
  			s.onload = initMunchkin;
  			document.getElementsByTagName('head')[0].appendChild(s);
			})();
	 	}			
	},5000); //Sets time delay before tracking user
});
&lt;/script&gt;
</pre>
<strong>How to Verify Page Visit by Anonymous User Was Recorded in Marketo</strong>

1. Click on Analytics in the top menu, and then click on New Report. Choose Web Page Activity as report type, and then name your report.

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/04/Screenshot-Web-Page-Activity.png"><img class="alignnone size-full wp-image-618" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2014/04/Screenshot-Web-Page-Activity.png" alt="Screenshot - Web Page Activity" width="1424" height="571" /></a>

2. After you create a report, click on Smart List. Then select the Visited Web Page filter from the box on the right. Enter the web page where you put the Munchkin tracking code.

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/04/Screenshot-Smart-List.png"><img class="alignnone size-full wp-image-614" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2014/04/Screenshot-Smart-List.png" alt="Screenshot - Smart List" width="1428" height="420" /></a>

3. Click on Setup. Select Anonymous Visitors from ISPs, and change option to Shown.

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/04/Screenshot-Show-anonymous.png"><img class="alignnone size-full wp-image-616" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2014/04/Screenshot-Show-anonymous.png" alt="Screenshot - Show anonymous" width="1422" height="473" /></a>

4. Click on Report. You will now see activity tracked on the web page you selected.

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/04/Screenshot-Report-1.png"><img class="alignnone size-full wp-image-620" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2014/04/Screenshot-Report-1.png" alt="Screenshot - Report 1" width="1417" height="454" /></a>

5. Double click on the lead record, which will then show the activity log where you can see the specific page the anonymous user visited.

<a href="https://marketohost.wpengine.com/wp-content/uploads/2014/04/Screenshot-Report-2.png"><img class="alignnone size-full wp-image-622" style="border: 1px solid black;" src="https://marketohost.wpengine.com/wp-content/uploads/2014/04/Screenshot-Report-2.png" alt="Screenshot - Report 2" width="1409" height="562" /></a>
<p style="font-size: x-small;">* This article contains code used to implement custom integrations. Due to its customized nature, The Marketo Technical Support team is unable to troubleshoot custom work. Please do not attempt to implement the following code sample without appropriate technical experience, or access to an experienced developer.</p><br/><br/>MManzur - 2014-04-17<br/><br/><h2>Dynamically Change Local Phone Number using RTP</h2><br/><br/>Personalization is everything - we figured this out a long time ago.

With that being said, it’s still surprising to me that every time I need immediate assistance, it is so hard to find the relevant local phone numbers on a website.

Good thing we have <a href="http://www.marketo.com/software/personalization/">Marketo Real-Time Personalization</a> (RTP) installed on www.marketo.com.  We can leverage the <a href="/javascript-api/personalization/get-visitor-data/">RTP Visitor API</a> to dynamically change the phone number that a web visitor sees in different sections of the website.

Wow!  Can you believe this?  How does this magic work?

First, you’ll need to have RTP installed on your web site as described <a href="https://docs.marketo.com/display/public/DOCS/Deploy+the+RTP+JavaScript">here</a>.

Next, follow the instructions below and implement the JavaScript code on your website:
<ol>
 	<li style="font-weight: 400;"><span style="font-weight: 400;">Insert your international phone number in the </span><b>defaultPhone</b><span style="font-weight: 400;"> configuration</span></li>
 	<li style="font-weight: 400;"><span style="font-weight: 400;">Insert the HTML element id(s) in the </span><b>divIds</b><span style="font-weight: 400;"> configuration</span></li>
 	<li style="font-weight: 400;"><span style="font-weight: 400;">If you want to make the phone number a click-to-call link for mobile browsers, then set the </span><b>mobileLink </b>configuration<span style="font-weight: 400;"> to </span><b>true</b><span style="font-weight: 400;">.</span></li>
 	<li style="font-weight: 400;">Map the different locations with their phone numbers in the <strong>cityPhone</strong>, <strong>statePhone</strong>, and <strong>countryPhone</strong> configurations</li>
</ol>
For example, here are sample values for configuration settings:
<pre class="lang:default decode:true prettyprint lang-js">  defaultPhone:"+1.503.608.4679", // Optional
  divIds:["phoneId1","phoneId2"],
  mobileLink: true,
  cityPhone: {
    "&lt;a href="#"&gt;yanir&lt;/a&gt;": ["San Mateo", "San Francisco"],
    "+353.1.242.3000": ["tel-aviv"]
  },
  statePhone: {
    "+1.650.376.2300": ["CA"],
    "+1.650.376.2302": ["OR"]
  },
  countryPhone: {
    "+1.650.376.2300": ["United States"],
    "+353.1.242.3000": ["Israel"]
  }
</pre>
Finally, insert an HTML anchor tag that contains an id matching one of the ids in <strong>divIds</strong> (from step 2 above). For example, if you specified "phoneId1" in <strong>divIds</strong>, then your HTML anchor tag would look like this:
<pre class="lang:default decode:true prettyprint lang-js">  &lt;a href="tel:+1800229933" id="phoneId1"&gt;+1800229933&lt;/a&gt;
</pre>
The script will check if there is a match in this order: cityPhone &gt; statePhone &gt; countryPhone &gt; defaultPhone <span style="font-weight: 400;">You can also replace the phone numbers with text (Example: “Join our San Francisco User Group!”) or HTML code and dynamically change the content based on the geo-location.</span> Enjoy!
<pre class="lang:default decode:true prettyprint lang-js ">&lt;a href="tel:+1800229933" id="phoneId1"&gt;+1800229933&lt;/a&gt;
&lt;script&gt;
(function(a){
    rtp('get','visitor',function(yc){
        var location = yc.results.location;
        var loop = true;
        var phoneChanged = false;
        console.log(yc.results);
        function checkObj(obj){
            return Object.getOwnPropertyNames(obj).length &gt;0;
        }
        function changePhone(p){
            d=a.divIds;
            for(i=0;i&lt;d.length;i++){
                if(document.getElementById(d[i]) !== null){
                    document.getElementById(d[i]).innerHTML = p;
                    if(a.mobileLink){
                        document.getElementById(d[i]).href= "tel:" + p;
                    }
                    console.log(p);
                }                
            }
            loop = false;
            phoneChanged = true;
        }
        function matchLocation(loc,objc){
            for (var key in objc) {
                for(i=0;i&lt;objc[key].length &amp;&amp; loop;i++){
                    if (!loop) { return true;};
                    val = objc[key][i];
                    //console.log(loc + location[loc] + " ? " + val);
                    if(location[loc].toLowerCase() === val.toLowerCase()){
                        changePhone(key);
                    }
                }
            }
        }
        if(checkObj(a.cityPhone)){
            matchLocation("city",a.cityPhone);
        }else if(checkObj(a.statePhone)){
            matchLocation("state",a.statePhone);
        }else if(checkObj(a.countryPhone)){
            matchLocation("country", a.countryPhone);
        }else if(!phoneChanged &amp;&amp; a.defaultPhone.length &gt; 0 ){
            changePhone(a.divId,a.defaultPhone);
        }
    });
})({
    defaultPhone:"",  //  [Optional] the number to show if visitor does not match the mapping below
    divIds:["phoneId1","Floater"],  //the phone HTML element ID, can be &lt;div&gt;, &lt;a&gt;, &lt;span&gt;, &lt;p&gt; etc.
    mobileLink: true,  //if you use click to call link (with href="tel:") you can also change its number

    cityPhone: {
        "&lt;a href='#'&gt;yanir&lt;/a&gt;": ["San Mateo", "San Francisco"],        
        "+353.1.242.3000": ["tel-aviv"]
    },
    statePhone: {
        "+1.650.376.2300": ["CA"],
        "+1.650.376.2302": ["OR"]
    },
    countryPhone: {
        "+1.650.376.2300": ["United States"],
        "+353.1.242.3000": ["Israel"]
    }
});
&lt;/script&gt;

</pre><br/><br/>YCalisar - 2016-02-02<br/><br/><h2>Winter 2016 Updates</h2><br/><br/><h4>REST API</h4>
<ul>
 	<li><a href="/documentation/programs">Asset API - Programs</a>
<ul>
 	<li><strong>Programs</strong> are now being exposed through a new set of endpoints which will allow creating, updating, deleting and cloning of programs.  There are also additional endpoints to get Tags and Channels in order to correctly create and tag new or existing programs remotely.  There are also Approve and Unapprove Program endpoints which will allow the approval of Email programs
<ul>
 	<li><a href="/documentation/programs/create-a-program">Create a Program</a></li>
 	<li><a href="/documentation/programs/get-program-by-id">Get Program By Id</a></li>
 	<li><a href="/documentation/programs/get-program-by-name">Get Program By Name</a></li>
 	<li><a href="/documentation/programs/get-programs-by-tag-type">Get Programs By Tag Name</a></li>
 	<li><a href="/documentation/programs/update-program">Update Program</a></li>
 	<li><a href="/documentation/programs/delete-program-by-id">Delete Program</a></li>
 	<li><a href="/documentation/programs/browse-programs">Browse Programs</a></li>
 	<li><a href="/documentation/programs/clone-program">Clone Program</a></li>
 	<li><a href="/documentation/programs/approve-program">Approve Program</a></li>
 	<li><a href="/documentation/programs/unapprove-program">Unapprove Program</a></li>
</ul>
</li>
 	<li><strong>Tags</strong>
<ul>
 	<li><a href="/documentation/programs/get-tags">Get Tags</a></li>
 	<li><a href="/documentation/programs/get-tag-by-name">Get Tag By Name</a></li>
</ul>
</li>
 	<li><strong>Channels</strong>
<ul>
 	<li><a href="/documentation/programs/get-channels">Get Channels</a></li>
 	<li><a href="/documentation/programs/get-channel-by-name">Get Channel By Name</a></li>
</ul>
</li>
</ul>
</li>
 	<li>Lead API - <a href="/documentation/rest/change-lead-program-status">Change Status in Program</a>
<ul>
 	<li>Along with the exposure of programs, program statuses for leads can now be changed remotely.</li>
 	<li>Leads cannot be added as program members via this API, but their statuses may be changed if they are already members.</li>
</ul>
</li>
 	<li>Lead API - <a href="/documentation/rest/get-lead-activities/">Get Lead Activities</a> by LeadId
<ul>
 	<li>the Get Lead Activities endpoint now supports the 'leadIds' parameter allowing for the submission of a comma-separated list of up to 30 lead IDs.  The endpoint will then return activities for only the given records.</li>
</ul>
</li>
</ul>
<h4>Custom Objects</h4>
<ul>
 	<li><a href="https://docs.marketo.com/display/DOCS/Create+Marketo+Custom+Objects#CreateMarketoCustomObjects-CreateaCustomObjectforaMany-to-ManyStructure">Custom Objects N:N relationships now supported</a>
<ul>
 	<li>Lead or Account records may now have many-to-many relationships through custom objects via the definition of intermediate objects.  After creating a standalone custom object type, and intermediate object type can be created with link fields to both the standalone object and either leads or accounts.</li>
 	<li>There are no new API calls for this capability, but the object definitions must be configured correctly to leverage these relationships through the API.</li>
</ul>
</li>
</ul>
<h4>SOAP API</h4>
<ul>
 	<li>getLeadActivities and getLeadChanges will no longer return activities of anonymous leads.  See the <a href="https://docs.marketo.com/display/DOCS/Next+Generation+Munchkin+Tracking+FAQ">Next Generation Munchkin Tracking FAQ</a> for more information</li>
</ul><br/><br/>kelkington - 2016-02-05<br/><br/><h2>Retrieve Activities for a Single Lead using REST API</h2><br/><br/>Here is a question that we are repeatedly asked by our developer community:
<p style="padding-left: 30px;">"How do I get a list of past activities for an individual lead?"</p>
Up until recently, there was no straightforward way to accomplish this using the REST API.  But now there is!

The Winter 2016 release of our REST API contains a nice little enhancement. <a href="/documentation/rest/get-lead-activities/">Get Lead Activities</a> now accepts the <strong>leadIds</strong> parameter that can be used to specify a lead id.  When the <strong>leadIds</strong> parameter is specified, only activities for that lead id will be returned.  You can think of this as a lead id filter.

Note that the <strong>leadIds</strong> parameter can take a comma separated list of lead ids in case you'd like to filter results on more than one lead (up to 30).  This might come in handy for example when limiting activities to leads for a particular company.

<strong>Example</strong>

Below is a sample request to <a href="/documentation/rest/get-lead-activities/">Get Lead Activities</a> that contains the <strong>leadIds</strong> parameter.  I have specified a value of "50" for the <strong>leadIds</strong> parameter, which corresponds to an arbitrary lead in my Marketo instance.  I have specified a value of "129" for the activityTypeIds parameter, which corresponds to the "Mobile App Session" activity on my Marketo instance.
<pre class="lang:default decode:true prettyprint lang-js ">https://123-abc-456.mktorest.com/rest/v1/activities.json?leadIds=50&amp;activityTypeIds=129&amp;nextPageToken=WQV2VQVPPCKHC6AQYVK7JDSA3J4SMAZRQO4RKIXCEMLFCM2APRSQ====
</pre>
Below is an excerpt of the response from that request above.  As you can see, it contains only result objects with "leadId": 50 and "activityTypeId": 129.
<pre class="lang:default decode:true prettyprint lang-js">{
    "id": 846,
    "leadId": 50,
    "activityDate": "2015-04-06T21:58:59Z",
    "activityTypeId": 129,
    "primaryAttributeValueId": 13,
    "primaryAttributeValue": "Sample App",
    "attributes": [
        {
            "name": "Device Type",
            "value": "iPhone"
        },
        {
            "name": "Mobile App Session Length",
            "value": 7
        },
        {
            "name": "Platform",
            "value": "ios"
        }
    ]
}
{
    "id": 879,
    "leadId": 50,
    "activityDate": "2015-04-07T00:45:11Z",
    "activityTypeId": 129,
    "primaryAttributeValueId": 13,
    "primaryAttributeValue": "Sample App",
    "attributes": [
        {
            "name": "Device Type",
            "value": "iPhone"
        },
        {
            "name": "Mobile App Session Length",
            "value": 5
        },
        {
            "name": "Platform",
            "value": "ios"
        }
    ]
}
{
    "id": 1114,
    "leadId": 50,
    "activityDate": "2015-04-08T00:02:41Z",
    "activityTypeId": 129,
    "primaryAttributeValueId": 13,
    "primaryAttributeValue": "Sample App",
    "attributes": [
        {
            "name": "Device Type",
            "value": "iPhone"
        },
        {
            "name": "Mobile App Session Length",
            "value": 241
        },
        {
            "name": "Platform",
            "value": "ios"
        }
    ]
}
{
    "id": 1551,
    "leadId": 50,
    "activityDate": "2015-04-09T23:31:56Z",
    "activityTypeId": 129,
    "primaryAttributeValueId": 13,
    "primaryAttributeValue": "Sample App",
    "attributes": [
        {
            "name": "Device Type",
            "value": "iPhone"
        },
        {
            "name": "Mobile App Session Length",
            "value": 223
        },
        {
            "name": "Platform",
            "value": "ios"
        }
    ]
}
{
    "id": 1716,
    "leadId": 50,
    "activityDate": "2015-04-15T22:44:19Z",
    "activityTypeId": 129,
    "primaryAttributeValueId": 13,
    "primaryAttributeValue": "Sample App",
    "attributes": [
        {
            "name": "Device Type",
            "value": "iPhone"
        },
        {
            "name": "Mobile App Session Length",
            "value": 223
        },
        {
            "name": "Platform",
            "value": "ios"
        }
    ]
}
</pre>
<strong>Fun With Shell Scripts</strong>

While working on this post, I wrote the following shell script to automate lead activity retrieval.  If I've written it correctly, it should be self explanatory ;)  Feel free to replace the constants at the top of the script with values from your instance and give it a try.

Note that this script makes use of a command line tool "jq".  I've found that <a href="https://stedolan.github.io/jq/">jq</a> and <a href="https://jqplay.org/">jq play</a> are indispensable tools when slicing and dicing JSON response bodies.  Enjoy!
<pre class="lang:default decode:true prettyprint lang-js ">#!/usr/bin/bash
#
#

# Copy these values from Admin &gt; Integration &gt; Web Services &gt; REST API
readonly REST_ENDPOINT='https://123-abc-456.mktorest.com/rest'
readonly REST_IDENTITY='https://123-abc-456.mktorest.com/identity'

# Copy these values from Admin &gt; Integration &gt; LaunchPoint &gt; Edit Service
readonly CLIENT_ID='12345678-1234-1234-1234-123456789012'
readonly CLIENT_SECRET='11122233344455566677788899900011'

# Lead id of interest
readonly LEAD_ID='50'

# Activity name of interest
readonly ACTIVITY_NAME='Mobile App Session'

# Date that determines how far back in time to retrieve activities
readonly SINCE_DATETIME='2015-01-01'

##########################
# Retrieve access token
#
# Globals:
#   REST_IDENTITY
#
# Arguments:
#   1. Client id
#   2. Client secret
#
# Returns:
#   Access token
##########################
function getAccessToken() {
	local client_id=$1
	local client_secret=$2

	# Call Identity API
	local result=`curl "${REST_IDENTITY}/oauth/token?grant_type=client_credentials&amp;client_id=${client_id}&amp;client_secret=${client_secret}"`

	# Extract access token from result
	local access_token=`echo ${result} | jq .access_token`
	access_token=`echo ${access_token} | tr -d '"'`
	echo $access_token
}

##########################
# Retrieve activity id
#
# Globals:
#   REST_ENDPOINT
#
# Arguments:
#   1. Access token
#   2. Activity name
#
# Returns:
#   Activity id
##########################
function getActivityId() {
	local access_token=$1
	local activity_name="$2"

	# Call Get Activity Types API
	local result=`curl "${REST_ENDPOINT}/v1/activities/types.json?access_token=${access_token}"`

	# Extract activity id
	local activity_id=`echo ${result} | jq -c ".result[] | select(.name | contains("${activity_name}"))"`
	activity_id=`echo ${activity_id} | jq .id`
	echo $activity_id
}

##########################
# Retrieve page token
#
# Globals:
#   REST_ENDPOINT
#
# Arguments:
#   1. Access token
#   2. Since datetime
#
# Returns:
#   Page token
##########################
function getPageToken() {
	local access_token=$1
	local since_datetime=$2

	# Call Get Paging Token API
	local result=`curl "${REST_ENDPOINT}/v1/activities/pagingtoken.json?access_token=${access_token}&amp;sinceDatetime=${since_datetime}"`

	# Extract page token
	local page_token=`echo ${result} | jq .nextPageToken`
	page_token=`echo ${page_token} | tr -d '"'`
	echo $page_token
}

##########################
# Retrieve activity dates for given lead(s) for a given activity
#
# Globals:
#   REST_ENDPOINT
#
# Arguments:
#   1. Access token
#   2. Page token
#   3. Activity id
#   4. Lead id(s)
#
# Returns:
#   None
##########################
function getLeadActivities() {
	local access_token=$1
	local page_token=$2
	local activity_id=$3
	local lead_ids=$4

	local more_result="true"
	local lead_activities=""
	local success="true"
	local lead_activities=""

	while [ ${more_result} = "true" ]
	do
		# Call Get Lead Activities API

		local result=`curl "${REST_ENDPOINT}/v1/activities.json?access_token=${access_token}&amp;nextPageToken=${page_token}&amp;activityTypeIds=${activity_id}&amp;leadIds=${lead_ids}"`

		# Extract success, nextPageToken, moreResult
		success=`echo ${result} | jq .success`
		page_token=`echo ${result} | jq .nextPageToken`
		page_token=`echo ${page_token} | tr -d '"'`
		more_result=`echo ${result} | jq .moreResult`

		# Extract activity dates
		lead_activities+=`echo ${result} | jq .result[]`
	done
	echo $lead_activities
}


readonly ACCESS_TOKEN=$(getAccessToken "${CLIENT_ID}" "${CLIENT_SECRET}")
readonly ACTIVITY_ID=$(getActivityId "${ACCESS_TOKEN}" "${ACTIVITY_NAME}")
readonly PAGE_TOKEN=$(getPageToken "${ACCESS_TOKEN}" "${SINCE_DATETIME}")
readonly ALL_LEAD_ACTIVITIES=$(getLeadActivities "${ACCESS_TOKEN}" "${PAGE_TOKEN}" "${ACTIVITY_ID}" "${LEAD_ID}")

echo "ALL_LEAD_ACTIVITIES=${ALL_LEAD_ACTIVITIES}"
</pre>
&nbsp;<br/><br/>deverly - 2016-02-11<br/><br/><h2>Seamless Integration with Marketo and Over 500 Apps Using Zapier</h2><br/><br/>This is a post from Philippe Delle Case, Principal Solutions Consultant, Marketo.
<h2>Objectives</h2>
This article explains in detail how to integrate Marketo with potentially over 500 Cloud Apps, thanks to Zapier.

For that, we’re going to build from scratch a Zapier connector for Marketo and implement two practical integration use cases:

Use Case 1: Unidirectional Leads integration from FullContact Card Reader to Marketo
<ul>
 	<li>Scan any contact’s business card with the FullContact mobile Card Reader app and get a lead automatically created in Marketo.</li>
</ul>
<img class="aligncenter size-full wp-image-5520" src="https://marketohost.wpengine.com/wp-content/uploads/2016/04/use_case_1.png" alt="use_case_1" width="590" height="152" />

Use Case 2: Bidirectional Leads integration between Marketo and Google Sheets
<ul>
 	<li>Add an existing lead to a static list in Marketo and find the lead automatically added to your Google Sheet.</li>
 	<li>Modify any lead in your Google Sheet and find the change echoed back to Marketo.<a href="https://marketohost.wpengine.com/wp-content/uploads/2016/04/use_case_2.png"><img class="aligncenter size-full wp-image-5523" src="https://marketohost.wpengine.com/wp-content/uploads/2016/04/use_case_2.png" alt="use_case_2" width="614" height="160" /></a></li>
</ul>
<h2>Prerequisites</h2>
<strong>Sign-up for a free account with Zapier</strong>

<a href="https://zapier.com/">Zapier</a> is a web app Automation Service that lets you easily automate tasks between other online apps without the need for programmers or any IT resources. A brief introduction can be found <a href="https://zapier.com/help/what-is-zapier/">here</a>.  Today Zapier supports more than 500 apps in many different domains such as Marketing, CRM, CMS, Customer Support, Electronic Signature, Forms, etc.

A single integration between one app and another is called a Zap.  Check Zapier’s <a href="https://zapier.com/zapbook/">zapbook </a>for an exhaustive list of supported web apps.

<a href="https://marketohost.wpengine.com/wp-content/uploads/2016/04/zap_book.png"><img class="aligncenter size-full wp-image-5525" src="https://marketohost.wpengine.com/wp-content/uploads/2016/04/zap_book.png" alt="zap_book" width="376" height="326" /></a>

Sign up for a free account <a href="https://zapier.com/sign-up/">here</a>.  You’ll get access to up to 100 tasks/month, 5 zaps, and zaps running every 15 minutes. You can of course get much more by subscribing to Zapier’s paid plans (basic, business, business plus, etc.)

<strong>Access to a Marketo Instance as Administrator or with a provided API User account</strong>

Our Zapier connector will use the Marketo REST API to push Lead data to Marketo. In order to use this API, you’ll need an API User and a Custom Service that you can create yourself if you are administrator of your Marketo instance. If not, then an administrator will need to provide those to you. There is also a Webhook to create, only accessible to a Marketo Administrator.

A step by step explanation of how to create the Marketo API User and the Custom Service can be found <a href="http://rest-api/custom-services/">here</a>.

Once you’re done, you should have the following credentials in order to invoke the Marketo REST API: Client Id, Client Secret, Munchkin Account Id
<ul>
 	<li>Munchkin Account Id</li>
</ul>
You can get the Munchkin Account Id from the Munchkin or the Web Services Admin screens. Its pattern looks like this: 000-XXX-000.

<a href="https://marketohost.wpengine.com/wp-content/uploads/2016/04/munchkin_webservices.png"><img class="aligncenter size-full wp-image-5527" src="https://marketohost.wpengine.com/wp-content/uploads/2016/04/munchkin_webservices.png" alt="munchkin_webservices" width="244" height="190" /></a>

No need to get an access token as it would be only valid for a single hour.  The Connector will generate tokens for you automatically.

<strong>Sign-up for a free account with Google</strong>

Google Docs, Sheets, and Slides are productivity apps that let you create different kinds of online documents, work on them in real time with other people, and store them in your Google Drive online. Our use case needs a Google Sheet.

Different features of Google Docs and creation of an account with Google can be found <a href="https://www.google.com/docs/about/">here</a>.

<strong>Sign-up for a free account with FullContact</strong>

FullContact keeps you fully connected to the people who matter most by pulling in all your contacts and continuously syncing them with changes to social profiles, photos, email signatures, company information, and more. They offer a mobile business cards reader that can scan cards into 250+ Web Apps, including Zapier.

You can sign-up for a free account <a href="https://app.fullcontact.com/login">here</a>.  You may also subscribe to a premium paid account with more features and capacity.

The mobile app can be downloaded from the <a href="https://itunes.apple.com/us/app/fullcontact-business-card/id576780807?mt=8">Apple AppStore</a>, or from <a href="https://play.google.com/store/apps/details?id=com.fullcontact.cardreader">Google Play</a>.

The FullContact Zaps are documented <a href="https://zapier.com/zapbook/fullcontact/">here</a>.
<h2>Implementation of the Marketo Connector for Zapier</h2>
<strong>Create the Marketo App</strong>

From the Zapier web interface, go to the Developers Portal.<a href="https://marketohost.wpengine.com/wp-content/uploads/2016/04/zapier_developer_portal.png"><img class="aligncenter size-full wp-image-5528" src="https://marketohost.wpengine.com/wp-content/uploads/2016/04/zapier_developer_portal.png" alt="zapier_developer_portal" width="441" height="354" /></a>

Click <strong>Add New App</strong> and fill out at minimum the Title (e.g. ‘Marketo’) and the Description. The logo is optional, but nice to have.<a href="https://marketohost.wpengine.com/wp-content/uploads/2016/04/zapier_add_new_app.png"><img class="aligncenter size-full wp-image-5529" src="https://marketohost.wpengine.com/wp-content/uploads/2016/04/zapier_add_new_app.png" alt="zapier_add_new_app" width="699" height="285" /></a>

<strong>Authentication</strong>

In this section we declare the different fields used for the Marketo REST API authentication and the authentication settings.

Create first the following fields:
<table style="height: 149px;" width="666">
<tbody>
<tr>
<td width="157"><strong>Label</strong></td>
<td width="157"><strong>Munchkin Account Id</strong></td>
<td width="157"><strong>Client Id</strong></td>
<td width="157"><strong>Client Secret</strong></td>
</tr>
<tr>
<td width="157"><strong>Key</strong></td>
<td width="157">munchkin_account_id</td>
<td width="157">client_id</td>
<td width="157">client_secret</td>
</tr>
<tr>
<td width="157"><strong>Type</strong></td>
<td width="157">Unicode</td>
<td width="157">Unicode</td>
<td width="157">Unicode</td>
</tr>
<tr>
<td width="157"><strong>Required</strong></td>
<td width="157">Checked</td>
<td width="157">Checked</td>
<td width="157">Checked</td>
</tr>
</tbody>
</table>
&nbsp;

Edit the ‘Authentication Settings’ as in the following screen:<a href="https://marketohost.wpengine.com/wp-content/uploads/2016/04/zapier_marketo_auth_settings.png"><img class="aligncenter size-full wp-image-5530" src="https://marketohost.wpengine.com/wp-content/uploads/2016/04/zapier_marketo_auth_settings.png" alt="zapier_marketo_auth_settings" width="710" height="462" /></a>
<ul>
 	<li>Auth Type: Session Auth</li>
 	<li>Auth Mapping:</li>
</ul>
<p style="padding-left: 30px;">{</p>
<p style="padding-left: 60px;">“access_token”:”{{access_token}}”</p>
<p style="padding-left: 30px;">}</p>

<ul>
 	<li>Access Token Placement<strong>:</strong> Token in Querystring</li>
</ul>
Once a Marketo custom service has been created, client id and client secret become available. We use the client id and client secret to generate an access token via the REST API <a href="/rest-api/authentication/">Authentication</a> endpoint. We can then use this access token to make subsequent requests to the REST API. The token expires after an hour and must be generated again to proceed calling the REST API.

We chose authentication Type = ‘Session Auth’ as it allows us to execute a custom authentication script every time our session token is expired. We’ll see in the section ‘Scripting API’ how to implement this mechanism that can only work with this type of authentication.

<strong>Triggers</strong>

Zapier Triggers are there to bring data into Zapier. We do not need one for our use cases as we will leverage a Marketo Webhook instead. However, we still need to write a dummy Trigger as a mandatory test for our Marketo connector.

We are going to create a Test Trigger calling the Marketo REST API <a href="/documentation/rest/get-daily-usage">Get Daily Usage</a> endpoint.

Click <strong>Add New Trigger</strong> to start the wizard and fill-up the following fields (fields not mentioned can be left blank):

Name and Description
<ul>
 	<li>Name: Test Trigger</li>
 	<li>Key: test_trigger</li>
 	<li>Description: The Test Trigger of the Marketo App</li>
 	<li>Important? Not checked</li>
 	<li>Hide? Checked</li>
</ul>
Trigger Fields
<ul>
 	<li>None</li>
</ul>
Where Data Comes From
<ul>
 	<li>Data Source: Polling</li>
 	<li>Polling URL: https://{{munchkin_account_id}}.mktorest.com/rest/v1/stats/usage.json</li>
</ul>
Sample Result
<ul>
 	<li>Leave blank</li>
</ul>
Click <strong>Manage Trigger Settings </strong>and set our Test Trigger to be the one we'll use to verify a user's credentials.

<strong>Actions</strong>

Zapier Actions are there to send data out from Zapier.

We are going to implement the Create_Update Lead Action calling the Marketo REST API <a href="/documentation/rest/createupdate-leads/">Create/Update Leads</a> endpoint. This Action will allow us to create a new lead within Marketo, or if the lead already exists, it will update it with the submitted values. We’ll use the field ‘email’ for de-duplication.

Click <strong>Add New Action</strong> to start the wizard and fill-up the following fields (fields not mentioned can be left blank):

Name and Description
<ul>
 	<li>Name: Create_Update Lead</li>
 	<li>Noun: Lead</li>
 	<li>Key: create-update-lead</li>
 	<li>Description: Create a new lead within Marketo, or if the lead already exists update it with the submitted values</li>
 	<li>Important? Checked</li>
 	<li>Hide? Not Checked</li>
</ul>
Action Fields

Action Fields are the fields users will map data into. Choose them carefully according to your own needs as they will represent all the data you will be able to update in Marketo. There is an option in Zapier to offer to the end user all fields available in Marketo, but that would induce more code and complexity, not required for a disposable connector.

As an example, we selected the following fields:
<table>
<tbody>
<tr>
<td width="113"><strong>Label</strong></td>
<td width="106"><strong>Key</strong></td>
<td width="78"><strong>Type</strong></td>
<td width="94"><strong>Required?</strong></td>
<td width="85"><strong>Parent key</strong></td>
<td width="170"><strong>Send in POST by default?</strong></td>
</tr>
<tr>
<td width="113"><strong>Email Address</strong></td>
<td width="106">email</td>
<td width="78">Unicode</td>
<td width="94">Checked</td>
<td width="85">input</td>
<td width="170"></td>
</tr>
<tr>
<td width="113"><strong>Partition Name</strong></td>
<td width="106">partitionName</td>
<td width="78">Unicode</td>
<td width="94">Not Checked</td>
<td width="85"></td>
<td width="170">Checked</td>
</tr>
<tr>
<td width="113"><strong>First Name</strong></td>
<td width="106">firstName</td>
<td width="78">Unicode</td>
<td width="94">Not Checked</td>
<td width="85">input</td>
<td width="170"></td>
</tr>
<tr>
<td width="113"><strong>Last Name</strong></td>
<td width="106">lastName</td>
<td width="78">Unicode</td>
<td width="94">Not Checked</td>
<td width="85">input</td>
<td width="170"></td>
</tr>
<tr>
<td width="113"><strong>Phone Number</strong></td>
<td width="106">phone</td>
<td width="78">Unicode</td>
<td width="94">Not Checked</td>
<td width="85">input</td>
<td width="170"></td>
</tr>
<tr>
<td width="113"><strong>Notes</strong></td>
<td width="106">Lead_Notes__c</td>
<td width="78">Textarea</td>
<td width="94">Not Checked</td>
<td width="85">input</td>
<td width="170"></td>
</tr>
<tr>
<td width="113"><strong>Called</strong></td>
<td width="106">called</td>
<td width="78">Unicode</td>
<td width="94">Not Checked</td>
<td width="85">input</td>
<td width="170"></td>
</tr>
</tbody>
</table>
Partition Name is mandatory in our case since our Marketo instance has Lead Partitions in service. It could be omitted otherwise. We separated it from the ‘input’ group so the end-user understands this is not a field to synch.

The field ‘Notes’ comes from a synch between Marketo and Salesforce, do not use it if you don’t have it in your Marketo instance.

The field ‘Called’ has been created in our Marketo instance, do not use it if you don’t have it in your Marketo instance.

Of course, the goal is to let you pick the fields you need from Marketo. It is recommended to start small and add the extra fields later.

Where to Send Data
<ul>
 	<li>Action Endpoint URL: https://{{munchkin_account_id}}.mktorest.com/rest/v1/leads.json</li>
</ul>
Sample Result
<ul>
 	<li>Leave blank</li>
</ul>
<h2>Zapier Scripting API</h2>
Zapier's scripting feature allows you to manipulate the requests and responses that are exchanged between your app's API and Zapier. You can modify HTTP requests just before they are sent and can parse responses before Zapier does anything with them. We need it in order to complete our custom ‘Session Auth’ authentication so it works with Marketo.  More information <a href="https://zapier.com/developer/documentation/v2/scripting/#intro-to-scripting">here</a>.

Copy the following code and we’ll go through some explanations later on:
<pre class="lang:default decode:true prettyprint lang-js">var Zap = {
     
    get_session_info: function(bundle) {
  
       console.log('Entering get_session_info method ...');
    
         var access_token,
            access_token_request_payload,
            access_token_response;

    
        // Assemble the meta data for our Access Token swap request
         console.log('building Request with client_id=' + bundle.auth_fields.client_id + ', and client_secret=' + bundle.auth_fields.client_secret);
        access_token_request_payload = {
            method: 'POST',
            url: 'https://' + bundle.auth_fields.munchkin_account_id + '.mktorest.com/identity/oauth/token',
            params: {
                'grant_type' : 'client_credentials',
                'client_id' : bundle.auth_fields.client_id,
                'client_secret' : bundle.auth_fields.client_secret
            },
            headers: {
                'Content-Type': 'application/json',  // Could be anything.
                Accept: 'application/json' 
            }
        };

        // Fire off the Access Token request.
        access_token_response = z.request(access_token_request_payload);

        // Extract the Access Token from returned JSON.
        access_token = JSON.parse(access_token_response.content).access_token;
        console.log('New Access_Token=' + access_token);
   
        // This will be mixed into bundle.auth_fields in future calls.
        //bundle.auth_fields.access_token=access_token;
        return {'access_token': access_token};
    },
  
  
    test_trigger_pre_poll: function(bundle) {
     
         console.log('Entering test_trigger_pre_poll method ...');
         
         bundle.request.params = {
         'access_token':bundle.auth_fields.access_token
         };
         
         return bundle.request;
        
    },
  

    test_trigger_post_poll: function(bundle) {
    
        console.log('Entering test_trigger_post_poll method ...');
        
        var data = JSON.parse(bundle.response.content);
        if ((!data.success)&amp;&amp;((data.errors[0].code=="601")||(data.errors[0].code=="600"))){
            console.log('Access Token expired or invalid, requesting new one - data.success=' + data.success + ', data.errors[0].code=' + data.errors[0].code);
            
           throw new InvalidSessionException(); // Calling get_session_info() to regenerate Access Token
        }

        return JSON.parse(bundle.response.content);
    },
     
    create_update_lead_pre_write: function(bundle) {
    
       bundle.request.params = {'access_token':bundle.auth_fields.access_token};  
       return bundle.request;
    },

    create_update_lead_post_write: function(bundle) {
         
         var data = JSON.parse(bundle.response.content);
         if ((!data.success)&amp;&amp;((data.errors[0].code=="601")||(data.errors[0].code=="600"))){
            console.log('Access Token expired or invalid, requesting new one - data.success=' + data.success + ', data.errors[0].code=' + data.errors[0].code);
            throw new InvalidSessionException(); // Calling get_session_info() to regenerate Access Token
        }
        return JSON.parse(bundle.response.content);
    }
    
};

</pre>
<strong>Methods</strong>

<strong>get_session_info</strong>
<ul>
 	<li>This method is responsible for generating or regenerating an access token calling the Marketo REST API <a href="/rest-api/authentication/">Authentication</a> endpoint.</li>
 	<li>It is called every time any ‘post_poll’ method encounters an ‘Access Token Expired’ error. An access token is scheduled to expired every 1 hour so this is expected.</li>
 	<li>Action Endpoint URL: https://{{munchkin_account_id}}.mktorest.com/identity/oauth/token</li>
</ul>
<strong>pre_poll, pre_write</strong>
<ul>
 	<li>We must create a ‘pre-poll’ method on any Trigger we have created, in order to modify the HTTP request just before it is sent, so we can add the Marketo Access Token in its parameters.</li>
 	<li>We must create a ‘pre-write’ method on any Action we have created, for the same reason.</li>
</ul>
<strong>post_poll, post_write</strong>
<ul>
 	<li>We must create a ‘post-poll’ method on any Trigger we have created, in order to parse responses before Zapier does anything with them, and eventually intercept ‘Access Token Expired’ error.</li>
 	<li>We must create a ‘post-write’ method on any Action we have created, for the same reason.</li>
 	<li>If such an error has occurred, we throw an InvalidSessionException that will tell Zapier to replay the authentication and execute again the get_session_info method.</li>
</ul>
<strong> </strong>Note that you can access the Bundle logs from the Scripting API from the ‘Quick links’ menu on the top right corner of the screen. This is really useful to debug the scripts.<a href="https://marketohost.wpengine.com/wp-content/uploads/2016/04/zapier_quick_links.png"><img class="aligncenter size-full wp-image-5531" src="https://marketohost.wpengine.com/wp-content/uploads/2016/04/zapier_quick_links.png" alt="zapier_quick_links" width="246" height="196" /></a>

And now it’s time for the fun part…
<h2>Use Case 1: Integration of Marketo with FullContact Card Reader</h2>
For this integration we’ll create one single Zap from FullContact to Marketo. With this Zap, you’ll be able to scan business cards with the FullContact Mobile Card Reader and push the leads to Marketo.

<a href="https://marketohost.wpengine.com/wp-content/uploads/2016/04/use_case_1.png"><img class="aligncenter size-full wp-image-5520" src="https://marketohost.wpengine.com/wp-content/uploads/2016/04/use_case_1.png" alt="use_case_1" width="590" height="152" /></a>

&nbsp;

<strong>Zap FullContact -&gt; Marketo</strong><a href="https://marketohost.wpengine.com/wp-content/uploads/2016/04/add_new_full_contact_biz_cards.png"><img class="aligncenter size-full wp-image-5532" src="https://marketohost.wpengine.com/wp-content/uploads/2016/04/add_new_full_contact_biz_cards.png" alt="add_new_full_contact_biz_cards" width="688" height="74" /></a>

From the Zapier Dashboard click the button ‘Make a new Zap’.

<strong>Trigger in Zapier</strong>
<ul>
 	<li>Pick the App FullContact</li>
 	<li>Choose FullContact Trigger ‘New Business Card’</li>
 	<li>Connect to your FullContact account</li>
 	<li>Test the FullContact App</li>
</ul>
<strong>Action in Zapier</strong>
<ul>
 	<li>Pick the App Marketo we just created earlier, it should display in Beta</li>
 	<li>Choose Marketo Action ‘Create_Update Lead’</li>
 	<li>Connect to your Marketo account, filling up the authentication parameters (Munchkin Account Id, Client Id, Client Secret)</li>
 	<li>Map the fields from FullContact to Marketo<a href="https://marketohost.wpengine.com/wp-content/uploads/2016/04/setup_marketo_lead.png"><img class="aligncenter size-full wp-image-5533" src="https://marketohost.wpengine.com/wp-content/uploads/2016/04/setup_marketo_lead.png" alt="setup_marketo_lead" width="582" height="581" /></a></li>
 	<li>Fill-up eventually a Partition Name where your new leads should go (only if partitions exist in your Marketo Instance)</li>
 	<li>Test the Marketo App</li>
 	<li>Activate your Zap</li>
</ul>
Note: Make sure you download the business cards Reader from FullContact and activate the Zapier Integration right from your mobile device.
<h2>Use Case 2: Integration of Marketo with Google Sheets</h2>
For this integration we’ll create two Zaps. One from Marketo to Google Sheets and another one from Google Sheets to Marketo. With this Zap, you’ll be able to synch up some of your leads or contacts between Marketo and a Google Sheet.<a href="https://marketohost.wpengine.com/wp-content/uploads/2016/04/use_case_2.png"><img class="aligncenter size-full wp-image-5523" src="https://marketohost.wpengine.com/wp-content/uploads/2016/04/use_case_2.png" alt="use_case_2" width="614" height="160" /></a>

&nbsp;

<strong>Zap Marketo Webhook -&gt; Google Sheets</strong><a href="https://marketohost.wpengine.com/wp-content/uploads/2016/04/push_mql_lead_to_google_sheet.png"><img class="aligncenter size-full wp-image-5534" src="https://marketohost.wpengine.com/wp-content/uploads/2016/04/push_mql_lead_to_google_sheet.png" alt="push_mql_lead_to_google_sheet" width="686" height="73" /></a>

For the first Zap, we don’t rely on a custom connector for Marketo, but we leverage Marketo’s Webhooks and the ‘Webhooks by Zapier’ Trigger.

From the Zapier Dashboard click the button ‘Make a new Zap’.

<strong>Trigger Part 1 in Zapier</strong>
<ul>
 	<li>Pick the ‘Webhooks by Zapier’ Trigger App</li>
 	<li>Check ‘Catch Hook’ that will allow to wait for a POST or GET to a Zapier URL</li>
 	<li>No need to pick off a child key</li>
 	<li>Zapier generated a custom <strong>webhook URL</strong> for you to send requests to, copy it in the clipboard</li>
</ul>
<strong>Webhook in Marketo (steps to be done by an Administrator)</strong>
<ul>
 	<li>Go to Admin -&gt; Webhooks</li>
 	<li>Create a new Webhook called ‘Push Lead to Zapier’ and edit the Webhook form:<a href="https://marketohost.wpengine.com/wp-content/uploads/2016/04/edit_webhook.png"><img class="aligncenter size-full wp-image-5535" src="https://marketohost.wpengine.com/wp-content/uploads/2016/04/edit_webhook.png" alt="edit_webhook" width="428" height="492" /></a></li>
</ul>
<span style="line-height: 1.5;">In the template’s field, declare all the Lead’s fields you would like to transfer to Zapier and leverage the Marketo’s tokens. For our Use Cases, we take the same fields we defined for the custom Zapier connector that push Leads to Marketo:</span>
<pre class="lang:default decode:true prettyprint lang-js ">{
"firstName":"{{lead.First Name}}",
"lastName":"{{lead.Last Name}}",
"email":"{{lead.Email Address}}",
"phone":"{{lead.Phone Number}}",
"leadOwner":"{{lead.Lead Owner First Name}} {{lead.Lead Owner Last Name}}",
"leadOwnerEmail":"{{lead.Lead Owner Email Address}}",
"leadNotes":"{{lead.Lead Notes:default=edit me}}",
"called":"{{lead.Called}}"
}
</pre>
<ul>
 	<li>Save the form</li>
 	<li>No need for a Response Mapping, so you’re done with the Webhook</li>
</ul>
<strong>Test Campaign in Marketo (steps to be done by a Marketer or an Administrator)</strong>
<ul>
 	<li>From the Marketing Activities, create a new Smart Campaign</li>
</ul>
For testing purpose we are going to create a campaign that triggers our Webhook each time a lead status changes to MQL. Of course you can use the Webhook for any other business purpose.<a href="https://marketohost.wpengine.com/wp-content/uploads/2016/04/zapier_push_mql_lead.png"><img class="aligncenter size-full wp-image-5536" src="https://marketohost.wpengine.com/wp-content/uploads/2016/04/zapier_push_mql_lead.png" alt="zapier_push_mql_lead" width="281" height="77" /></a>
<ul>
 	<li>Edit the Smart List<a href="https://marketohost.wpengine.com/wp-content/uploads/2016/04/edit_smart_list.png"><img class="aligncenter size-full wp-image-5537" src="https://marketohost.wpengine.com/wp-content/uploads/2016/04/edit_smart_list.png" alt="edit_smart_list" width="626" height="162" /></a></li>
 	<li>Call the Webhook in the Flow<a href="https://marketohost.wpengine.com/wp-content/uploads/2016/04/call_webhook.png"><img class="aligncenter size-full wp-image-5538" src="https://marketohost.wpengine.com/wp-content/uploads/2016/04/call_webhook.png" alt="call_webhook" width="628" height="148" /></a></li>
 	<li>Schedule the Campaign<a href="https://marketohost.wpengine.com/wp-content/uploads/2016/04/schedule_campaign.png"><img class="aligncenter size-full wp-image-5539" src="https://marketohost.wpengine.com/wp-content/uploads/2016/04/schedule_campaign.png" alt="schedule_campaign" width="423" height="279" /></a></li>
 	<li>Make sure each lead can run through the flow every time</li>
 	<li>Activate the Smart Campaign</li>
</ul>
<strong>Trigger Part 2 in Zapier</strong>
<ul>
 	<li>In order to complete the ‘Webhooks by Zapier’ Trigger App, we need to fire the Marketo Smart Campaign once and catch the Webhook in Zapier</li>
 	<li>In our test case, we just need to go to Marketo Lead Database, open a lead and change its status to ‘MQL’</li>
</ul>
<strong>Create the spreadsheet in Google Sheets</strong>
<ul>
 	<li>Create a new spreadsheet</li>
 	<li>Create a Worksheet or use the default one</li>
 	<li>Add a column for each field you want to synch from Marketo (the ones declared in the Marketo webhook)<a href="https://marketohost.wpengine.com/wp-content/uploads/2016/04/spreadsheet.png"><img class="aligncenter size-full wp-image-5540" src="https://marketohost.wpengine.com/wp-content/uploads/2016/04/spreadsheet.png" alt="spreadsheet" width="1029" height="203" /></a></li>
</ul>
&nbsp;

<strong>Action in Zapier</strong>
<ul>
 	<li>Pick the App Google Sheets</li>
 	<li>Check the option ‘Create Spreadsheet Row’</li>
 	<li>Connect to your Google Sheets account</li>
 	<li>Select your Google Sheets spreadsheet</li>
 	<li>Select the Worksheet</li>
 	<li>Map all the fields between the ‘Webhooks by Zapier’ Trigger App and Google Sheets:<a href="https://marketohost.wpengine.com/wp-content/uploads/2016/04/setup_google_sheets.png"><img class="aligncenter size-full wp-image-5541" src="https://marketohost.wpengine.com/wp-content/uploads/2016/04/setup_google_sheets.png" alt="setup_google_sheets" width="559" height="519" /></a></li>
</ul>
<ul>
 	<li>Test the Google Sheets App</li>
 	<li>Activate your Zap</li>
</ul>
<strong>Zap Google Sheets -&gt; Marketo</strong><a href="https://marketohost.wpengine.com/wp-content/uploads/2016/04/update_leads_from_google_sheets.png"><img class="aligncenter size-full wp-image-5542" src="https://marketohost.wpengine.com/wp-content/uploads/2016/04/update_leads_from_google_sheets.png" alt="update_leads_from_google_sheets" width="686" height="72" /></a>

From the Zapier Dashboard click the button ‘Make a new Zap’.

<strong>Trigger in Zapier</strong>
<ul>
 	<li>Pick the ‘Google Sheets’ Trigger App</li>
 	<li>Tick the ‘Updated Spreadsheet Row’ that triggers when a new row is added or modified in a spreadsheet</li>
 	<li>Connect to your Google account</li>
 	<li>Select the Spreadsheet you want to trigger from (should be the same one used in the previous Zap) and the Worksheet</li>
 	<li>Set Trigger Column to ‘any_column’</li>
 	<li>Test the Google Sheets App</li>
</ul>
<strong>Action in Zapier</strong>
<ul>
 	<li>Pick the App Marketo we just created earlier, it should display in Beta</li>
 	<li>Choose Marketo Action ‘Create_Update Lead’</li>
 	<li>Connect to your Marketo account, filling up the authentication parameters (Munchkin Account Id, Client Id, Client Secret)</li>
 	<li>Map the fields from Google Sheets to Marketo</li>
 	<li>Fill-up eventually a Partition Name where your new leads should go (only if partitions exists in your Marketo Instance)</li>
 	<li>Test the Marketo App</li>
 	<li>Activate your Zap</li>
</ul>
<h3>Conclusion</h3>
Here are some ideas for improvement for our Marketo connector for Zapier:
<ul>
 	<li>Adding other Triggers and Actions related to diverse Marketo objects (Lists, Custom Objects, etc.)</li>
 	<li>Instead of hard coding the fields from Marketo, it’s possible to dynamically pull the fields from Marketo, but that would require some technical translation work between Marketo and Zapier.</li>
 	<li>Sharing the connector with development team and eventually make it generally available.</li>
</ul>
It is possible that Zapier will deploy a Premium Marketo adapter, which would make it  much easier to implement our use cases. In any event, this article could always be leveraged to integrate Marketo with Zapier with a free Zapier plan, and also to build custom use cases that might not be supported by a premium adapter.

We hope you enjoyed this article and that it will help you to be even more successful with Marketo and Zapier. Thank You!<br/><br/>deverly - 2016-04-17<br/><br/><h2>Spring 2016 Updates</h2><br/><br/><p class="p1"><strong>REST API</strong></p>

<ul>
 	<li class="p1"><a href="/documentation/marketo-rest-apis-web-page-objects/">Asset API - Web Pages</a>
<ul>
 	<li class="p1"><strong>Landing Pages</strong> are now exposed via fifteen new endpoints which will allowing creating, updating, deleting, cloning and draft management for landing pages.  Landing Page templates now also have draft management endpoints exposed
<ul>
 	<li class="p1">Get Landing Pages</li>
 	<li class="p1">Get Landing Page by ID</li>
 	<li class="p1">Get Landing Page by Name</li>
 	<li class="p1">Create Landing Page</li>
 	<li class="p1">Update Landing Page Metadata</li>
 	<li class="p1">Get Landing Page Content</li>
 	<li class="p1">Add Landing Page Content Section</li>
 	<li class="p1">Update Landing Page Content Section</li>
 	<li class="p1">Delete Landing Page Content Section</li>
 	<li class="p1">Get Dynamic Content Section</li>
 	<li class="p1">Update Dynamic Content Section</li>
 	<li class="p1">Discard Landing Page Draft</li>
 	<li class="p1">Approve Landing Page</li>
 	<li class="p1">Unnaprove Landing Page Draft</li>
 	<li class="p1">Delete Landing Page</li>
</ul>
</li>
 	<li class="p1"><strong>Landing Page Templates</strong>
<ul>
 	<li class="p1">Discard Landing Page Template Draft</li>
 	<li class="p1">Approve Landing Page Template</li>
 	<li class="p1">Unnaprove Landing Page Template</li>
 	<li class="p1">Delete Landing Page Template</li>
</ul>
</li>
 	<li class="p1"><strong>Forms</strong> will have 21 new endpoints released which provide full creation, editing and management capabilities via the API.  The APIs will not support changes to Forms 1.0 forms.
<ul>
 	<li>Get Forms</li>
 	<li>Get Form by ID</li>
 	<li>Get Form by Name</li>
 	<li>Get Form Fields List</li>
 	<li>Update Form Fields List</li>
 	<li>Create Form</li>
 	<li>Get Form Thank You Page</li>
 	<li>Update Form Thank You Page</li>
 	<li>Update Form</li>
 	<li>Discard Form Draft</li>
 	<li>Approve Form</li>
 	<li>Unapprove Form</li>
 	<li>Clone Form</li>
 	<li>Delete Form</li>
 	<li>Update Form Field</li>
 	<li>Remove Form Field</li>
 	<li>Update Form Field Visibility Rules</li>
 	<li>Add Rich Text Form Field</li>
 	<li>Add Fieldset</li>
 	<li>Remove Field from Fieldset</li>
 	<li>Get Available Form Fields</li>
 	<li>Change Form Field Positions</li>
 	<li>Update Submit Button</li>
</ul>
</li>
 	<li>When using <strong>Get or Browse Programs</strong>, SFDC Campaign ID will be returned for Programs which are linked to an SFDC Campaign</li>
</ul>
</li>
</ul>
<strong>Custom Objects</strong>

Custom Objects will now support Text Area datatypes, allowing for string fields of up to 2000 characters to be stored in custom object fields of this type.

<strong>IP Address Whitelisting</strong>

Admin users will now be able to manage a whitelist of IP addresses to prevent unauthorized access via the APIs.  <a href="https://docs.marketo.com/display/public/DOCS/Create+a+Whitelist+for+IP-Based+API+Access">You can read more about this feature here</a>.

<strong>Custom Activity UI</strong>

Admin users will now be able to define Custom Activity types in their admin menu, and add records to leads via the <a href="/documentation/rest/add-custom-activities/">Add Custom Activities</a> API.  <a href="https://docs.marketo.com/display/public/DOCS/Marketo+Custom+Activities">You can read about defining custom activity types here</a>.
<p class="p1"></p><br/><br/>kelkington - 2016-06-01<br/><br/><h2>Title</h2><br/><br/>[restabs alignment="osc-tabs-left" responsive="true"]
[restab title="PHP" active="active"]
<pre class="lang:default decode:true"><?php> echo "Hello world";</php></pre>
[/restab]
[restab title="Javascript"]
<pre class="lang:default decode:true">alert('Hello, World!')</pre>
[/restab]
[restab title="C++"]
<pre class="lang:default decode:true">#include &lt;iostream&gt;

int main()
{
  std::cout &lt;&lt; "Hello World!";
}</pre>
[/restab][/restabs]

&nbsp;

&nbsp;<br/><br/>nrezinas - 1970-01-01<br/><br/><h2>Welcome to the New Marketo Developer Website</h2><br/><br/>Our engineering team has been busy building out new REST endpoints and creating wonderful ways to extend the Marketo Platform.  To keep pace with this innovation, and help improve the overall developer experience, we have given our site a makeover.  Let's go through a few of the highlights!
<h2>REST API Endpoint Reference</h2>
All new endpoint reference based on Swagger UI.  You can find the new reference underneath the "Endpoint Reference" menu, where there are separate sub-menus for <a href="/rest-api/endpoint-reference/lead-database-endpoint-reference/">Lead Database</a>, <a href="/rest-api/endpoint-reference/asset-endpoint-reference/">Asset</a>, and <a href="/rest-api/endpoint-reference/authentication-endpoint-reference/">Authentication</a>.

Each sub-menu loads a page with a list of endpoint groupings:

<img class="alignnone wp-image-6435 size-full" src="http://beta.developers.marketo.com/wp-content/uploads/2016/09/post-welcome-endpoint-reference-grouping.png" alt="post-welcome-endpoint-reference-grouping" width="888" height="735" />

Click on a grouping to see a list of related endpoints, including the HTTP Method, URL, and friendly name for each:
<img class="alignnone wp-image-6438 size-full" src="http://beta.developers.marketo.com/wp-content/uploads/2016/09/post-welcome-endpoint-reference-grouping-1.png" alt="post-welcome-endpoint-reference-grouping" width="858" height="526" />

Finally, click on any endpoint item and see endpoint detail comprised of four sections:
<ol>
 	<li>Implementation Notes – Short description of endpoint.</li>
 	<li>Response Class – Response body detail in two views (Model and Example Value).</li>
 	<li>Parameters – Request parameter detail in two views (Model and Example Value).</li>
 	<li>Response Messages – HTTP status codes.</li>
</ol>
<img class="alignnone wp-image-6428 size-full" src="http://beta.developers.marketo.com/wp-content/uploads/2016/09/post-welcome-endpoint-reference-detail.png" alt="post-welcome-endpoint-reference-detail" width="850" height="1540" />

As you can see, everything you need to know about a given endpoint is presented in a concise and uniform format. Dig in!
<h2>REST API Conceptual Content</h2>
Added new conceptual content for working with REST APIs.  This provides high level descriptions of entity relationships, and how to invoke the various endpoints.  This holistic approach helps you get up and running quickly.  Find this new content underneath "REST API" menu, where there are separate sub-menus for <a href="/rest-api/lead-database/">Lead Database</a> and <a href="/rest-api/assets/">Assets</a>.
<h2>Navigation Menu</h2>
All new multi-level, collapsible navigation menus.

<img class="alignnone wp-image-6429 size-full" src="http://beta.developers.marketo.com/wp-content/uploads/2016/09/post-welcome-menu.png" alt="post-welcome-menu" width="319" height="880" />

We arranged the topics into a more logical order, and also renamed a few topics for clarity.  For the most part this should be intuitive, so we won't spend much time discussing the changes.  If you cannot find information for a particular topic use the search box.  A perfect segue to our next topic…
<h2>Search</h2>
All new search engine with autosuggest.  Search results now include both documentation pages, and blog posts.  Pro Tip: Looking for reference documentation for a particular endpoint?  Enter the friendly name of the endpoint, select it from the dropdown list, and click it.

<img class="alignnone wp-image-6430 size-full" src="http://beta.developers.marketo.com/wp-content/uploads/2016/09/post-welcome-search-endpoint.png" alt="post-welcome-search-endpoint" width="304" height="269" />
<h2>Syntax Highlighter</h2>
All code samples and API calls/responses are now placed in a syntax-aware container.  The container also contains a toolbar that allows you to toggle line numbers/plain code/line wrap, copy to clipboard, and open in new window.  Pro Tip: Don't like all the fancy formatting?  Double-click the container to switch to plain code.

<img class="alignnone wp-image-6432 size-full" src="http://beta.developers.marketo.com/wp-content/uploads/2016/09/post-welcome-syntax-highlight-1.png" alt="post-welcome-syntax-highlight" width="817" height="405" />
<h2>Conclusion</h2>
We hope you enjoy the new site.  If you are transitioning from the old site and have questions, please see site FAQ <a href="/support/Transitioning_to_New_Marketo_Developer_Site_Sep_2016.pdf">here</a>.  Feel free to let us know what you think, good or otherwise.  You can use the "How can we improve this article?" link at the bottom of any page on the site, or send email to <a href="mailto:developerfeedback@marketo.com?subject=Developer Site Feedback">developerfeedback@marketo.com</a>.<br/><br/>deverly - 2016-09-06<br/><br/><h2>Summer 2016 Updates</h2><br/><br/>For the summer 2016 release on September 23rd, there are three developer-oriented features being released.
<h3>Email 2.0 Support in the REST API</h3>
All <a href="http://developers.marketo.com/rest-api/assets/">pre-existing Asset APIs</a> which were only compatible with v1.0 Emails and Templates are now enabled for use with v2.0 email assets.
<h3><a href="http://developers.marketo.com/rest-api/endpoint-reference/lead-database-endpoint-reference/#/Leads/pushToMarketoUsingPOST">Push Lead to Marketo</a></h3>
<a href="/rest-api/lead-database/leads/#push_lead_to_marketo">Push Lead </a>is an alternate lead synchronization method designed for easier triggering in Smart Campaigns.  You can create a single activity log item, associate a lead, and update the lead record in one call.  This works similarly to a single form fill out by a lead, and can more easily be used as a proxy method for form submission in lieu of using the existing Sync Leads method.
<h3><a href="http://developers.marketo.com/performance/#http_compression">HTTP Compression</a></h3>
The REST API can now compress responses using the standard defined by HTTP 1.1 specification.  This can help reduce the size of the response which will increase transfer speed, and minimize bandwidth utilization.

&nbsp;<br/><br/>kelkington - 2016-09-23<br/><br/><h2>Using swagger-codegen with Marketo</h2><br/><br/><a href="https://github.com/swagger-api/swagger-codegen">Swagger-codegen</a> is a powerful Java library which can generate both server stubs and API clients from swagger definitions.  This can dramatically ease the difficulty and cost of generating clients for any specific language.  To get started and generate your first client, you’ll first want to grab an instance-specific copy of one of Marketo’s Swagger Definitions.  Go <a href="http://developers.marketo.com/rest-api/endpoint-reference/download-swagger-definition/">here</a> and input the Munchkin ID from the instance you want to test with. Start with the identity definition.

Now that you have a definition specific for your instance, you’ll need to download and install swagger-codegen.  The process is specific to your operating system, and you can get the instructions <a href="https://github.com/swagger-api/swagger-codegen#prerequisites">here</a>

With the default settings, codegen will output a client covering all of the provided endpoints and models.  These are typically managed through a class called DefaultApi, containing methods for calling the available endpoints with examples provided in a 'docs' folder (not all languages include templates for this by default).

Now let's build the first client.  Create a folder where you want your code to live, and go there in your terminal session and use the generate command to build a client in the language that you want (we'll assume you've used the homebrew install method):
<pre class="lang:default decode:true">swagger-codegen generate -i $definitionLocation -l $yourLanguage -o $yourLocation</pre>
This will output the client code into your desired location.

Now let's look at using this to call the identity endpoint and get an access token:

[restabs alignment="osc-tabs-left" responsive="true" text="More"]
[restab title="Java" active="active"]
<pre class="lang:java decode:true ">	public static void main(String[] args){
		String client_id = args[0];
		String client_secret = args[1];
		ApiClient client = new ApiClient();
		DefaultApi id = new DefaultApi();
		try {
			String token = id.identityOauthTokenGet(client_id, client_secret, "client_credentials").getAccessToken();
			System.out.println(token);
		} catch (ApiException e) {
			e.printStackTrace();
		}
	}</pre>
&nbsp;

[/restab]
[restab title="PHP"]
<pre class="lang:php decode:true ">&lt;?php
require_once(__DIR__ . '/vendor/autoload.php');

$api_instance = new Swagger\Client\Api\DefaultApi();
$client_id = "client_id_example";
$client_secret = "client_secret_example";
$grant_type = "grant_type_example";

try {
    $result = $api_instance-&gt;identityOauthTokenGet($client_id, $client_secret, $grant_type);
    print_r($result-&gt;getAccessToken);
} catch (Exception $e) {
    echo 'Exception when calling DefaultApi-&gt;identityOauthTokenGet: ', $e-&gt;getMessage(), "\n";
}
?&gt;</pre>
&nbsp;

[/restab]
[restab title="C#"]
<pre class="lang:c# decode:true ">        public static void Main(string[] args)
        {
            string clientId = "CHANGE ME";
            string clientSecret = "CHANGE ME";

            IdentityApi instance = new IdentityApi();
            ResponseOfIdentity response = instance.IdentityUsingGET(clientId, clientSecret, "client_credentials");

            string message = string.Format("Access Token: {0}, Expires In: {1}, Scope: {2}, Token Type: {3}",
                response.AccessToken, response.ExpiresIn, response.Scope, response.TokenType);
            Console.WriteLine(message);
        }</pre>
[/restab][/restabs]

Now that we know how to get authorized, we'll take a look into more advanced use cases of auto-generated clients in the coming weeks.<br/><br/>kelkington - 2016-10-10<br/><br/><h2>Excel Integration Part 1: Extract &amp; Shape Marketo Data Using Power Query</h2><br/><br/>This is the first of a series of articles that explain how to leverage the Power BI technology built into Microsoft Excel to create a true self-service business analytics experience with Marketo.

<img class="alignnone wp-image-6590 size-full" src="http://developers.marketo.com/wp-content/uploads/2016/10/blog-powerquery-intro.png" alt="blog-powerquery-intro" width="754" height="334" />

With the concepts covered in these articles, you’ll be able to:
<ul>
 	<li>Import data from Marketo into Excel</li>
 	<li>Import and combine data from other sources (SaaS applications, databases, flat files, etc.)</li>
 	<li>Shape data for business needs and analysis purpose</li>
 	<li>Refresh on demand the data from Excel</li>
 	<li>Create calculated columns and measures using formulas</li>
 	<li>Create relationships between heterogeneous data</li>
 	<li>Analyze data and build advanced reports with Pivot Tables and Pivot Charts</li>
 	<li>Produce stunning data visualizations</li>
</ul>
<h2>Power Query for Excel</h2>
This first article covers the data import and shaping process using Power Query technology. Power Query is a data connection technology that enables you to discover, connect, combine, and refine data sources to meet your analysis needs. Features in Power Query are available in Excel and Power BI Desktop.

Power Query can connect to many data sources such as databases, Facebook, Salesforce, MS Dynamics CRM, etc. Marketo isn’t supported out of the box, but fortunately we can use Marketo REST APIs for remote execution of many of the system’s capabilities, and Power Query comes with a rich set of formulas (informally known as “M”) allowing you to script a custom data source.
<h2>Custom Connector</h2>
Scripting a single REST API call is trivial with Power Query, but it becomes more challenging to handle the following requirements:
<ul>
 	<li>Access token management including authentication mechanism and periodic token refresh</li>
 	<li>Pagination mechanism for large set of data</li>
 	<li>Error handling</li>
</ul>
This article explains how to build a robust custom connector that can consume the REST APIs of Marketo in order to pull all kinds of data (Leads, Activities, Custom Objects, Programs, etc.). Your only restriction will be down to your Marketo API daily request limit.
The concepts explained here focus on Marketo, but they could also be used to to integrate other SaaS solutions that provide a REST API.
<a name="prerequisites"></a>
<h2>Prerequisites</h2>
<h4>Power Query</h4>
Prior to the release of Excel 2016, Microsoft Power Query for Excel functioned as an Excel add-in that was downloaded and installed on Excel 2010 or Excel 2013. From Excel 2016, this technology is a native feature integrated into the ‘Data’ ribbon under ‘Get &amp; Transform’ section.

All of the scripts produced for this article have been tested on Excel 2016 for Windows. The concepts should be the same for Excel 2013 or Excel 2010 but some adaptations could be required.

<img class="alignnone size-full wp-image-6591" src="http://developers.marketo.com/wp-content/uploads/2016/10/blog-powerquery-data-ribbon.png" alt="blog-powerquery-data-ribbon" width="533" height="152" />

Power Query is currently only available on the Microsoft Windows version of Excel; the Mac version is unfortunately not supported.
<h4>Marketo</h4>
Power Query will use the Marketo REST APIs to access data from Marketo. In order to use these APIs, you’ll need an API User and a Custom Service that you can create yourself if you are administrator of your Marketo instance. If not, then an administrator will need to provide those to you.

A step by step explanation of how to create the Marketo API User and the Custom Service can be found <a href="http://developers.marketo.com/documentation/rest/custom-service/">here</a>.

Once you’re done, you should have the following credentials in order to invoke the Marketo REST APIs: <strong>Client Id</strong> and <strong>Client Secret</strong>.

The <strong>REST API Endpoint</strong> can be found on the REST API section of the Web Services Admin in Marketo and it should have the following pattern:
<blockquote>https://XXX-XXX-XXX.mktorest.com/rest</blockquote>
Marketo has a Daily Request Limit for its API and this limit can be found in the Web Services Admin along with a consumption report. <strong>Make sure to never exceed your daily limit when you design your queries as you may miss some data in your reports</strong>.
<a name="power_query_workbook_creation"></a>
<h2>Power Query Workbook Creation</h2>
Let start with a new Excel workbook. We create a specific configuration worksheet for declaring all the Marketo REST API Settings.

<img class="alignnone size-full wp-image-6592" src="http://developers.marketo.com/wp-content/uploads/2016/10/blog-powerquery-daily-workbook-creation.png" alt="blog-powerquery-daily-workbook-creation" width="832" height="586" />

In this worksheet, we create three tables:

1. Table ‘<strong>REST_API_Authentication</strong>’ with the columns:

<strong>URL</strong>: your Marketo REST API Endpoint.

<strong>Client ID</strong>: from your Marketo REST API OAuth2.0 credential.

<strong>Client Secret</strong>: from your Marketo REST API OAuth2.0 credential.

2. Table ‘<strong>Scoping</strong>’ with the columns:

<strong>Paging Token SinceDatetime</strong>: a date following the ISO 8601 standard date notation (e.g. “2016-10-06T13:22:17-08:00”, “2016-10-06” are valid date/time) that is used to fetch Marketo activities since a given period, thanks to an initial ‘date-based’ paging token. This date is mainly used to limit the amount of data to import into the workbook.

<strong>List ID</strong>: the ID of a static list in Marketo that reference all the leads/contacts we are dealing with. This static list can be managed freely in Marketo (e.g. a smart campaign can feed it periodically or in real time with leads and contacts). In order to get the ID of a static list, open it in Marketo and get its numerical ID from the URL, e.g. https://myorg.marketo.com/#ST3517A1LA1, List ID=3517.

<strong>Max Records Pages</strong>: this is used for our pseudo-recursive algorithms that iterates through the Marketo output data, using ‘position-based’ paging tokens, with a capacity of 300 max records per page. Since this our interest to get as many records per page as possible, we’ll stick to 300. So typically a Max Records Pages set to 33.333 means a capacity of 33.333 X 300 = 9.9999 million records; but it also means 33.333 K on your Marketo API Daily Request Limit. The algorithms will stop anyway as soon as all data from the queries are obtained, so this parameter is just a safety limit for a loop.

3. Table ‘<strong>Leads</strong>’ with the column:

<strong>Lead Fields</strong>: comma separated lead fields to gather from Marketo when querying the leads and contacts.

Declaring a table in Excel is simple. Enter two rows in the spreadsheet with the columns names and values, highlight with the mouse the perimeter of the table, and select the icon Table in the ‘Insert’ menu, and then give it a name.

<img class="alignnone size-full wp-image-6593" src="http://developers.marketo.com/wp-content/uploads/2016/10/blog-powerquery-insert-table.png" alt="blog-powerquery-insert-table" width="275" height="149" />

The names given to the tables and their columns are important as they will be called directly by our scripts.
<h2>Authentication and Access Token</h2>
<h4>About Marketo REST API Authentication</h4>
Marketo’s REST APIs are authenticated with 2-legged OAuth 2.0.  Client IDs and Client Secrets are provided by custom services that you define.  Each custom service is owned by an API-Only user which has a set of roles and permissions which authorize the service to perform specific actions.  An access token is associated with a single custom service.

The full Authentication mechanism is documented <a href="http://developers.marketo.com/rest-api/authentication/">here</a> on the Marketo Developer site.

When an access token is originally created, it’s lifespan is 3600 seconds or 1 hour.  Each consecutive authentication call for the same custom service returns the current access token with its remaining lifespan. Once the token is expired, the authentication returns a brand new access token.

Managing access token expiration is important to ensure that your integration works smoothly and prevents unexpected authentication errors from occurring during normal operation.
<h4>Create Query</h4>
Create a new query by clicking the ‘New Query’ icon from the ‘Get&amp;Transform’ section of the ‘Data’ Menu. Select a blank query to start with and give it a name such as ‘MktoAccessToken’.

<img class="alignnone size-full wp-image-6594" src="http://developers.marketo.com/wp-content/uploads/2016/10/blog-powerquery-new-query.png" alt="blog-powerquery-new-query" width="404" height="149" />

Launch the Advanced Editor from the Query Editor, so you can script manually some Power Query formulas.

<img class="alignnone size-full wp-image-6595" src="http://developers.marketo.com/wp-content/uploads/2016/10/blog-powerquery-advanced-editor.png" alt="blog-powerquery-advanced-editor" width="695" height="375" />

Enter the following code in the advanced editor:
<pre class="lang:default decode:true">let
    // Get url and credentials from config worksheet - Table REST_API_Authentication
    mktoUrlStr = Excel.CurrentWorkbook(){[Name="REST_API_Authentication"]}[Content]{0}[URL],
    clientIdStr = Excel.CurrentWorkbook(){[Name="REST_API_Authentication"]}[Content]{0}[Client ID],
    clientSecretStr = Excel.CurrentWorkbook(){[Name="REST_API_Authentication"]}[Content]{0}[Client Secret],

    // Calling Marketo API Get Access Token
    getAccessTokenUrl = mktoUrlStr &amp; "/identity/oauth/token?grant_type=client_credentials&amp;client_id=" &amp; clientIdStr &amp; "&amp;client_secret=" &amp; clientSecretStr, 
    TokenJson = try Json.Document(Web.Contents(getAccessTokenUrl)) otherwise "Marketo REST API Authentication failed, please check your credentials",

    // Parsing access token
    accessTokenStr = TokenJson [access_token]
       
in
    accessTokenStr
</pre>
The comments embedded in the source code, preceded by “//” make the code self-explanatory. If you need any function reference, please check out the links provided in the Reference section of this article.

Click the button “Done”.

<img class="alignnone size-full wp-image-6596" src="http://developers.marketo.com/wp-content/uploads/2016/10/blog-powerquery-advanced-editor-save.png" alt="blog-powerquery-advanced-editor-save" width="554" height="372" />

Check that the Access token is displayed successfully in output for the final applied step ‘accessTokenStr’.

<img class="alignnone size-full wp-image-6597" src="http://developers.marketo.com/wp-content/uploads/2016/10/blog-powerquery-advanced-editor-check.png" alt="blog-powerquery-advanced-editor-check" width="691" height="448" />

One quick comment about the security in Excel; you may be asked occasionally to enable External Data Connections from the yellow banner. This is required in order to let the Queries work properly.

<img class="alignnone size-full wp-image-6598" src="http://developers.marketo.com/wp-content/uploads/2016/10/blog-powerquery-enable-content.png" alt="blog-powerquery-enable-content" width="597" height="218" />
<h4>Converting Query into a Function</h4>
Return to the advanced Editor and wrap your code with the following function declaration:
<pre class="lang:default decode:true">let
    FnMktoGetAccessToken =()=&gt;

        let
            // Get url and credentials from config worksheet - Table REST_API_Authentication
            mktoUrlStr = Excel.CurrentWorkbook(){[Name="REST_API_Authentication"]}[Content]{0}[URL],
            clientIdStr = Excel.CurrentWorkbook(){[Name="REST_API_Authentication"]}[Content]{0}[Client ID],
            clientSecretStr = Excel.CurrentWorkbook(){[Name="REST_API_Authentication"]}[Content]{0}[Client Secret],

            // Calling Marketo API Get Access Token
           getAccessTokenUrl = mktoUrlStr &amp; "/identity/oauth/token?grant_type=client_credentials&amp;client_id=" &amp; clientIdStr &amp; "&amp;client_secret=" &amp; clientSecretStr, 
           TokenJson = try Json.Document(Web.Contents(getAccessTokenUrl)) otherwise "Marketo REST API Authentication failed, please check your credentials",

            // Parsing access token from Json 
           accessTokenStr = TokenJson [access_token]
       
        in
            accessTokenStr 

in FnMktoGetAccessToken
</pre>
The function does not take any parameters in input but get those from the configuration worksheet. It produces the access token as an output.

Rename your query <strong>FnMktoGetAccessToken</strong> and save it.

Note that you can see all your queries at any time in Excel by clicking the button ‘Show Queries’ in the ‘Get &amp; Transform’ section of the Data menu.

Your function should be now marked with the function icon ‘Fx’, just like in the screenshot below:

<img class="alignnone size-full wp-image-6599" src="http://developers.marketo.com/wp-content/uploads/2016/10/blog-powerquery-show-queries.png" alt="blog-powerquery-show-queries" width="1034" height="296" />
<h2>Load Members of Static List</h2>
<h4>Get Leads</h4>
The Marketo Lead API provides simple CRUD operations against lead records, the ability to modify a lead’s membership in static lists and programs, and initiate Smart Campaign processing for leads. All these capabilities are documented <a href="http://developers.marketo.com/rest-api/lead-database/leads/">here</a>.

A large set of lead records can be retrieved based on membership in a static list or a program.  Using the id of a static list, you can retrieve all lead records which are members of that static list. The id of the list is a path parameter in the call. See the chapter “List and Program Membership” in the Marketo Developers documentation for details.

The maximum number of lead records we can get per API call is 300, so we’ll need to leverage paging tokens in order to gather the records per pages of 300 records. We get the paging token in the Json answer after the first call and we know we're done when the paging token is not in the output anymore.
<h4>Basic Query</h4>
Let’s get started with a fully functioning query aimed at downloading all the leads from a static list.

Create a new blank query called ‘MktoLeads’ and enter the following code in the advanced editor:
<pre class="lang:default decode:true ">let
    
    // Get Url from config worksheet - Table REST_API_Authentication
    mktoUrlStr = Excel.CurrentWorkbook(){[Name="REST_API_Authentication"]}[Content]{0}[URL],
    // Get the number of iterations (pages of 300 records) - Table Scoping
    iterationsNum = Excel.CurrentWorkbook(){[Name="Scoping"]}[Content]{0}[Max Records Pages],
    // Get the List id - Table Scoping
    listIdStr = Number.ToText(Excel.CurrentWorkbook(){[Name="Scoping"]}[Content]{0}[List ID], "D", ""),
    // Get the Lead fields to extract - Table Leads
    LeadFieldsStr = Excel.CurrentWorkbook(){[Name="Leads"]}[Content]{0}[Lead Fields],


    // Build Multiple Leads by List Id URL
    getMultipleLeadsByListIdUrl = mktoUrlStr &amp; "/rest/v1/list/" &amp; listIdStr &amp; "/leads.json?fields=" &amp; LeadFieldsStr,
   
    // Build Marketo Access Token URL parameter
    accessTokenParamStr = "&amp;access_token=" &amp; FnMktoGetAccessToken(),

    pagingTokenParamStr = "",

    // Function iterating though the pages
    FnProcessOnePage =
    (accessTokenParamStr, pagingTokenParamStr) as record =&gt;
        let
        
            // Send REST API Request             
            content = Web.Contents(getMultipleLeadsByListIdUrl &amp; accessTokenParamStr &amp; pagingTokenParamStr),
            
            // Recover Json output and watch if token is expired, in that case, regenerate access token
            newAccessTokenParamStr = if Json.Document(content)[success]=true then accessTokenParamStr else "?access_token=" &amp; FnMktoGetAccessToken(),
            getMultipleLeadsByListIdJson = if Json.Document(content)[success]=true then Json.Document(content) else Json.Document(Web.Contents(getMultipleLeadsByListIdUrl &amp; newAccessTokenParamStr &amp; pagingTokenParamStr)),
            
            // Parse Json outputs: data and next page token     
            data = try getMultipleLeadsByListIdJson[result] otherwise null,          
            next  = try  "&amp;nextPageToken=" &amp; getMultipleLeadsByListIdJson[nextPageToken] otherwise null,
            res = [Data=data, Next=next, Access=newAccessTokenParamStr]
        in
            res,

    // Generates a list of values given four functions that generate the initial value initial, test against a condition, and if successful select the result and generate the next value next. An optional parameter, selector, may also be specified
    GeneratedList =
        List.Generate(
            ()=&gt;[i=0, res = FnProcessOnePage(accessTokenParamStr, pagingTokenParamStr)],
            each [i]&lt;iterationsNum and [res][Data]&lt;&gt;null,
            each [i=[i]+1, res = FnProcessOnePage([res][Access],[res][Next])],
            each [res][Data])
in
    GeneratedList
</pre>
Power Query does not offer traditional looping functions (e.g. For-loop, While-loop) and does not support recursion. A good workaround is to implement a For-loop using List.Generate. This function is documented <a href="https://msdn.microsoft.com/en-us/library/mt260751.aspx">here</a>. With List.Generate it’s possible to iterate over the pages. At each step of the iteration we extract a page of data, keeping the URL that includes the paging token for the next page, and store the results in the next item of the generated list. The blog from <a href="http://datachant.com/2016/06/27/cursor-based-pagination-power-query/">Datachant</a> was a great resource for solving this. Our parameter ‘Max Records Pages’ is here to limit the number of pages and restrict it to a realistic range avoiding an infinite loop.

Another challenge is to ensure that the access token is never expired. Tracking its remaining lifespan would be too complex with Power Query. So all calls to the REST API are backed up with an error check; if an error occurs, we assume the token has expired and we renew it first and replay the call again. If the second call fails, then the second failure will be notified to Excel (in the worst case, you’ll get no data as a result).

Launch the query, after saving it or by clicking the ‘Refresh button’ at any time.

<img class="alignnone size-full wp-image-6600" src="http://developers.marketo.com/wp-content/uploads/2016/10/blog-powerquery-list-generate.png" alt="blog-powerquery-list-generate" width="691" height="469" />

In our case, 1364 lead records were extracted fitting in 5 pages of data within 5 lists.
<h2>Shaping the Data</h2>
We need to shape the data to have all these records in a single flat list of records. There are two ways to do this:
<ul>
 	<li>Using more code</li>
 	<li>Leverage the Power Query UI</li>
</ul>
Right click on the output grid and choose ‘To Table’ in the contextual menu in order to convert it to a table of lists.

<img class="alignnone size-full wp-image-6601" src="http://developers.marketo.com/wp-content/uploads/2016/10/blog-powerquery-to-table.png" alt="blog-powerquery-to-table" width="281" height="269" />

In the ‘To Table’ pop up, leave the default values in the 2 picklists.

<img class="alignnone size-full wp-image-6602" src="http://developers.marketo.com/wp-content/uploads/2016/10/blog-powerquery-to-table-picklists.png" alt="blog-powerquery-to-table-picklists" width="257" height="166" />

Now expand the resulting table of lists.

<img class="alignnone size-full wp-image-6603" src="http://developers.marketo.com/wp-content/uploads/2016/10/blog-powerquery-to-table-expand.png" alt="blog-powerquery-to-table-expand" width="406" height="178" />

Now we have all the records in a single list. The records encoded in Json format contain the fields and their associated values. Expand again.

<img class="alignnone size-full wp-image-6604" src="http://developers.marketo.com/wp-content/uploads/2016/10/blog-powerquery-to-table-expand-again.png" alt="blog-powerquery-to-table-expand-again" width="402" height="207" />

Select in the pop up all the fields you want to keep, uncheck the tick box ‘Use original column name as prefix’.

<img class="alignnone size-full wp-image-6605" src="http://developers.marketo.com/wp-content/uploads/2016/10/blog-powerquery-to-table-select-fields.png" alt="blog-powerquery-to-table-select-fields" width="321" height="255" />

Et voila! All records are displayed nicely in our table.

<img class="alignnone size-full wp-image-6606" src="http://developers.marketo.com/wp-content/uploads/2016/10/blog-powerquery-to-table-display.png" alt="blog-powerquery-to-table-display" width="815" height="427" />

If we re-open the advanced editor, we can see that 3 lines of code have been added to shape our data:
<pre class="lang:default decode:true ">#"Converted to Table" = Table.FromList(GeneratedList, Splitter.SplitByNothing(), null, null, ExtraValues.Error),
#"Expanded Column1" = Table.ExpandListColumn(#"Converted to Table", "Column1"),
#"Expanded Column2" = Table.ExpandRecordColumn(#"Expanded Column1", "Column1", {"id", "updatedAt", "lastName", "email", "createdAt", "firstName"}, {"id", "updatedAt", "lastName", "email", "createdAt", "firstName"})
</pre>
You can do much more with Power Query, like creating extra columns with computed values, we’ll see some more possibilities later on.

Let’s save and close this query. It can now be refreshed manually at any time or automatically via background refreshes.
<h2>Redirecting the Results</h2>
Now the question is, where to send the result data?

Hover over your query with the mouse and select the menu ‘Load To…’ in the contextual menu.

<img class="alignnone size-full wp-image-6607" src="http://developers.marketo.com/wp-content/uploads/2016/10/blog-powerquery-load-to.png" alt="blog-powerquery-load-to" width="854" height="670" />

In the popup, then you can select:
<ul>
 	<li>‘Table’ if you want to send all the shaped data to a worksheet (new or existing one),</li>
 	<li>‘Only Create Connection’ if your goal is to do further analysis in the Power Pivot.</li>
</ul>
The check box ‘Add this to the Data Model allows you to exploit the data in the Power Pivot; this is what we want for the second part of this article.

<img class="alignnone size-full wp-image-6608" src="http://developers.marketo.com/wp-content/uploads/2016/10/blog-powerquery-load-to-load.png" alt="blog-powerquery-load-to-load" width="379" height="359" />
<h2>Managing Pagination</h2>
Since the aim of our project is to build many more queries, let’s do some refactoring and extract a reusable function that would manage the pagination.

Create a new blank query called <strong>FnMktoGetPagedData</strong> and enter the following code in the advanced editor:
<pre class="lang:default decode:true ">let
    FnMktoGetPagedData =(url, accessTokenParamStr, pagingTokenParamStr)=&gt;

    let
    
        // Get the number of iterations (pages of 300 records) - Table Scoping
        iterationsNum = Excel.CurrentWorkbook(){[Name="Scoping"]}[Content]{0}[Max Records Pages],

        // Sub-function iterating though the REST API service result pages
        FnProcessOnePage =
        (accessTokenParamStr, pagingTokenParamStr) as record =&gt;
            let
        
                // Send REST API Request             
                content = Web.Contents(url&amp; accessTokenParamStr &amp; pagingTokenParamStr),
            
                // Recover Json output and watch if token is expired, in that case, regenerate access token
                newAccessTokenParamStr = if Json.Document(content)[success]=true then accessTokenParamStr else "?access_token=" &amp; FnMktoGetAccessToken(),
                contentJson = if Json.Document(content)[success]=true then Json.Document(content) else Json.Document(Web.Contents(url &amp; newAccessTokenParamStr &amp; pagingTokenParamStr)),
            
                // Parse Json outputs: data and next page token     
                data = try contentJson[result] otherwise null,          
                next  = try  "&amp;nextPageToken=" &amp; contentJson[nextPageToken] otherwise null,
                res = [Data=data, Next=next, Access=newAccessTokenParamStr]
            in
                res,

        // Generates a list of values given four functions that generate the initial value initial, test against a condition, and if successful select the result and generate the next value next. An optional parameter, selector, may also be specified
        GeneratedList =
            List.Generate(
                ()=&gt;[i=0, res = FnProcessOnePage(accessTokenParamStr, pagingTokenParamStr)],
                each [i]&lt;iterationsNum and [res][Data]&lt;&gt;null,
                each [i=[i]+1, res = FnProcessOnePage([res][Access],[res][Next])],
                each [res][Data])
    in
        GeneratedList

in FnMktoGetPagedData
</pre>
Save the query. We are going to use it next.
<h2>Simplified Query</h2>
Let’s rewrite again our query ‘MktoLeads’ which will be calling the <strong>FnMktoGetPagedData</strong> function.
<pre class="lang:default decode:true ">let
    
    // Get Url from config worksheet - Table REST_API_Authentication
    mktoUrlStr = Excel.CurrentWorkbook(){[Name="REST_API_Authentication"]}[Content]{0}[URL],
    // Get the List id - Table Scoping
    listIdStr = Number.ToText(Excel.CurrentWorkbook(){[Name="Scoping"]}[Content]{0}[List ID], "D", ""),
    // Get the Lead fields to extract - Table Leads
    LeadFieldsStr = Excel.CurrentWorkbook(){[Name="Leads"]}[Content]{0}[Lead Fields],


    // Build Multiple Leads by List Id URL
    getMultipleLeadsByListIdUrl = mktoUrlStr &amp; "/rest/v1/list/" &amp; listIdStr &amp; "/leads.json?fields=" &amp; LeadFieldsStr,
   
    // Build Marketo Access Token URL parameter
    accessTokenParamStr = "&amp;access_token=" &amp; FnMktoGetAccessToken(),

    // No initial paging token required for this call
    pagingTokenParamStr = "",

    // Invoke the multiple REST API calls through the FnMktoGetPagedData function
    result = FnMktoGetPagedData (getMultipleLeadsByListIdUrl , accessTokenParamStr, pagingTokenParamStr) 
        
in
    result
</pre>
As you can see, our query is now really simple to read and to maintain. We are going to leverage again the <strong>FnMktoGetPagedData</strong> function for the other queries.
<h2>Load Specific Activities from a Defined Period of Time</h2>
<h4>get Activities with pagination</h4>
Marketo permits a huge variety of activity types related to lead records.  Nearly every change, action or flow step is recorded against a lead’s activity log and can be retrieved via the API or leveraged in Smart List and Smart Campaign filters and triggers.  Activities are always related back to the lead record via the leadId, corresponding to the Id of the record, and also have a unique integer id of its own. You’ll find the complete REST API documentation <a href="http://developers.marketo.com/rest-api/lead-database/activities/">here</a>.

There are a very large number of potential activity types, which may vary from subscription to subscription, and have unique definitions for each.  While every activity will have its own unique id, leadId and activityDate, the primaryAttributeValueId and primaryAttributeValue will vary in their meaning.

We are going to focus on the Interesting Moments, one kind of Marketo tracked activities with the ID 46.

The new challenges we are going to resolve are:
<ul>
 	<li>We need to initiate a ‘date-based’ paging token to define the period of time when the activities happened,</li>
 	<li>Shaping the data is a bit trickier as depending on the activity types, a list of activity-specific attributes is provided in Json and need to be parsed and flatted out in order to ease up the analysis.</li>
</ul>
<h4>Date Based Paging Token</h4>
We need to build first this function in order to generate the initial ‘date-based’ paging token, required to scope the period of time for our Activity queries. You’ll find the documentation about the paging token <a href="http://developers.marketo.com/rest-api/paging-tokens/">here</a>.

Create a new blank query called <strong>FnMktoGetPagingToken</strong> and enter the following code in the advanced editor:
<pre class="lang:default decode:true ">let
    FnMktoGetPagingToken =(accessTokenStr)=&gt;

        let
            // Get url from config worksheet - Table REST_API_Authentication
            mktoUrlStr = Excel.CurrentWorkbook(){[Name="REST_API_Authentication"]}[Content]{0}[URL],

            // Get Paging Token SinceDatetime from config worksheet - Table Scoping
            mktoPTSinceDatetimeStr = DateTime.ToText(Excel.CurrentWorkbook(){[Name="Scoping"]}[Content]{0}[Paging Token SinceDatetime], "yyyy-MM-ddThh:mm:ss"),

            // Building URL for API Call
            getPagingTokenUrl = mktoUrlStr &amp; "/rest/v1/activities/pagingtoken.json?access_token=" &amp; accessTokenStr &amp; "&amp;sinceDatetime=" &amp; mktoPTSinceDatetimeStr, 

            // Calling Marketo API Get Paging Token
            content = Web.Contents(getPagingTokenUrl),

            // Recover Json output and watch if access token is expired, in that case, regenerate it
            newAccessTokenStr = if Json.Document(content)[success]=true then accessTokenStr else "?access_token=" &amp; FnMktoGetAccessToken(),
            pagingTokenJson = if Json.Document(content)[success]=true then Json.Document(content) else Json.Document(Web.Contents(mktoUrlStr &amp; "/rest/v1/activities/pagingtoken.json?access_token=" &amp; newAccessTokenStr &amp; "&amp;sinceDatetime=" &amp; mktoPTSinceDatetimeStr)),           

            // Parsing Paging Token
            pagingTokenStr = pagingTokenJson[nextPageToken]
       
        in
            pagingTokenStr 

in FnMktoGetPagingToken
</pre>
Save the function. We are going to use it next.
<h4>Interesting Moments Activities</h4>
Let’s write now the query ‘MktoInterestingMomentsActivities’ which will be calling the <strong>FnMktoGetPagedData</strong> and <strong>FnMktoGetPagingToken</strong> functions.
<pre class="lang:default decode:true ">let
    
    // Get Url from config worksheet - Table REST_API_Authentication
    mktoUrlStr = Excel.CurrentWorkbook(){[Name="REST_API_Authentication"]}[Content]{0}[URL],
    // Get the List id - Table Scoping
    listIdStr = Number.ToText(Excel.CurrentWorkbook(){[Name="Scoping"]}[Content]{0}[List ID], "D", ""),

    // Build Get Activities URL
    getActivitiesUrl = mktoUrlStr &amp; "/rest/v1/activities.json?ListId=" &amp; listIdStr &amp; "&amp;activityTypeIds=46",
   
    // Build Marketo Access Token URL parameter
    accessTokenStr = FnMktoGetAccessToken(),
    accessTokenParamStr = "&amp;access_token=" &amp; accessTokenStr,

    // Obtain date-based paging token used to scope in time the activities
    pagingTokenParamStr = "&amp;nextPageToken=" &amp; FnMktoGetPagingToken(accessTokenStr),

    // Invoke the multiple REST API calls through the FnMktoGetPagedData function
    result = FnMktoGetPagedData (getActivitiesUrl , accessTokenParamStr, pagingTokenParamStr)
   
in
    result
</pre>
The result of this query is again a list of lists, so it needs some further data processing to be usable for analysis.

<img class="alignnone size-full wp-image-6609" src="http://developers.marketo.com/wp-content/uploads/2016/10/blog-powerquery-list-tools.png" alt="blog-powerquery-list-tools" width="682" height="220" />
<h2>Shaping the Data</h2>
Let’s do the same shaping operations we did for the Leads:
<ul>
 	<li>Right click on the output grid and choose ‘To Table’ in the contextual menu in order to convert it to a table of lists,</li>
 	<li>Expand the resulting table of lists,</li>
 	<li>Expand one more time, selecting in the pop up all the fields you want to keep (uncheck the tick box ‘Use original column name as prefix’).</li>
</ul>
You can see the columns with their values, except the column ‘attributes’ that still contain a list of specific attributes associated to the interesting <br/><br/>kelkington - 2016-11-15<br/><br/><h2>Fall 2016 Updates</h2><br/><br/>In the Fall 2016 release, we are adding CRUD support for Email v2 variables and modules, and CRUD support for Named Accounts.  You will now be able to locally read and edit the content using Marketo REST APIs, as well as move, reorder and delete them.  See the full list of updates below:
<h2>Lead Database APIs</h2>
<ul>
 	<li><a href="/rest-api/lead-database/named-accounts/"><strong>Named Accounts</strong></a>
<ul>
 	<li>New endpoints for reading, updating, and deleting Named Accounts</li>
 	<li>Known Issues:
<ul>
 	<li>As of the Fall 2016 release, leads cannot be associated to named accounts via the API</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2>Asset APIs</h2>
<ul>
 	<li><a href="http://developers.marketo.com/rest-api/assets/emails/"><strong>Email</strong></a>
<ul>
 	<li>New endpoints for manipulating Email v2 variables</li>
 	<li>New endpoints for manipulating Email v2 modules</li>
 	<li>Known Issues:
<ul>
 	<li>Queries and updates for sections that contain predictive tokens will return an error</li>
 	<li>Emails with content sections that contain predictive tokens may not be approved using the API</li>
</ul>
</li>
</ul>
</li>
</ul><br/><br/>kelkington - 2016-12-07<br/><br/><h2>Why We Retired @MarketoDev Twitter Handle</h2><br/><br/>We have decided to retire @MarketoDev handle on Twitter.  The account will be deactivated on December 9th, 2016.  Curious why?

<strong>Rewind back to early 2014...</strong>

We had just launched the Marketo Developers Site to help developers build against our APIs.  We wanted to increase awareness of the Marketo platform, and to lower barriers to entry for developers.  In conjunction with that effort we created @MarketoDev to engage with our technology partners and customers that were inclined to build integrated solutions with Marketo.

Like any brave new undertaking, we weren't sure how this would play out.  Initially we tweeted new blog posts and new API releases.  Things were good; traffic to the Developers Site went up!  We also started to receive an assortment of questions, which we dutifully answered.

<strong>Fast forward to late 2016...</strong>

As the <a href="http://launchpoint.marketo.com/">LaunchPoint Partner</a> ecosystem grew, the amount of tweet activity increased.  Responding to the volume of questions posted to @MarketoDev had became a large job for our small team.

We received an increasing amount of general product, and sales related questions, which we redirected to @Marketo or @MarketoCares.

We also had found that 140 characters were simply not enough for development-related questions.  Answering these often led to lengthy and involved threads of conversation, an approach that did not scale.

And finally, we analyzed the traffic sources for visitors to the Developers Site and found that the marjority come from organic search, and the "Subscribe Now" functionality on our blog.

<img class="alignnone size-full wp-image-6709" src="http://developers.marketo.com/wp-content/uploads/2016/12/post-retire-marketodev-subscribe-now.png" alt="post-retire-marketodev-subscribe-now" width="246" height="145" />

For these reasons, we decided to pull the plug on @MarketoDev.

<strong>From here on out...</strong>

If you are a Twitter fan (and who isn't), fear not!  Our corporate Twitter handle @Marketo lives on; as does our customer support handle @MarketoCares.

Have a question about developing against Marketo APIs?  Here is a summary of the resources at your disposal.
<table style="height: 270px; width: 981px;">
<tbody>
<tr>
<td style="width: 301px;"><strong>Resource</strong></td>
<td style="width: 297px;"><strong>I am a Marketo Customer...</strong></td>
<td style="width: 339px;"><strong>I am a Marketo Technology Partner...</strong></td>
</tr>
<tr>
<td style="width: 301px;"><a href="https://www.marketo.com/why-marketo/services-support-and-education/support/">Marketo Customer Support</a></td>
<td style="width: 297px;">✔   (included with subscription)</td>
<td style="width: 339px;"></td>
</tr>
<tr>
<td style="width: 301px;"><a href="https://www.marketo.com/why-marketo/marketing-nation/community/">Marketing Nation Community</a></td>
<td style="width: 297px;">✔   (included with subscription)</td>
<td style="width: 339px;">✔   (included with partner sandbox)</td>
</tr>
<tr>
<td style="width: 301px;"><a href="http://developers.marketo.com/">Marketo Developers Site</a></td>
<td style="width: 297px;">✔</td>
<td style="width: 339px;">✔</td>
</tr>
<tr>
<td style="width: 301px;">Marketo LaunchPoint Developer API Office Hours</td>
<td style="width: 297px;"></td>
<td style="width: 339px;">✔</td>
</tr>
</tbody>
</table>
&nbsp;<br/><br/>marketohost - 2016-12-02<br/><br/><h2>Excel Integration Part 2: Build Advanced Marketo Reports and Data Visualizations Using Power Pivot and Power View</h2><br/><br/>This is the second in a series of two articles that explain how to leverage the Power BI technology built into Microsoft Excel to create a true self-service business analytics experience with Marketo.

<img class="alignnone wp-image-6590 size-full" src="http://developers.marketo.com/wp-content/uploads/2016/10/blog-powerquery-intro.png" alt="blog-powerquery-intro" width="754" height="334" />

With the concepts covered in these articles, you’ll be able to:
<ul>
 	<li>Import data from Marketo into Excel</li>
 	<li>Import and combine data from other sources (SaaS applications, databases, flat files, etc.)</li>
 	<li>Shape data for business needs and analysis purposes</li>
 	<li>Refresh data on demand within Excel</li>
 	<li>Create calculated columns and measures using formulas</li>
 	<li>Create relationships between heterogeneous data</li>
 	<li>Analyze data and build advanced reports with Pivot Tables and Pivot Charts</li>
 	<li>Produce stunning data visualizations</li>
</ul>
<h2>Power Pivot and Power View for Excel</h2>
In this article, we provide examples of how to build the following:
<ul>
 	<li>Advanced Marketo reports that leverage relationships between different collections of Marketo data using Power Pivot</li>
 	<li>Cool static and animated visualizations using Power View</li>
</ul>
<strong>Power Pivot</strong> is an Excel add-in, already included in Excel 2016, you can use to perform powerful data analysis and create sophisticated data models. With Power Pivot, you can mash up large volumes of data from various sources, perform information analysis rapidly, and share insights easily. Data extracted from different data sources with Power Query can be sent to the data model, to the Excel spreadsheet, or to both. In the <a href="/blog/excel-integration-part-1-extract-shape-marketo-data-using-power-query/">first article</a>, we imported and shaped data from Marketo and sent it to the data model in order to perform more sophisticated analysis prior to making it available on the spreadsheet.

<strong>Power View</strong> is an alternative to the Excel visualization layer. It is an interactive data exploration, visualization, and presentation experience that encourages intuitive ad-hoc reporting and dashboarding.
<div class="content-box">

All of the steps explained in this article have been tested on Excel 2016 for Windows. The concepts should be the same for Excel 2013 or Excel 2010 (without Power View) but some adaptations could be required. Power Pivot and Power View are currently only available on the Microsoft Windows version of Excel 2016, the Office 365 version of Excel 2016 does not support fully Power Pivot and Power View.

</div>
<h2>The Marketo Power Workbook</h2>
<h4>Download Workbook</h4>
In the <a href="/blog/excel-integration-part-1-extract-shape-marketo-data-using-power-query/">first article</a>, we covered the data import and shaping process using Power Query technology. We learned how to implement some advanced power queries in order to extract leads and activities from Marketo. Because some of you would want to jump directly to the point where they build reports and visualisations, without coding, we released the Marketo Power Workbook that you can download <a href="/support/Marketo Power Workbook R017.xlsx">here</a>.

This workbook contains all the queries detailed in the first article and a few more. We improved the error handling and added some extra parameters in the configuration worksheet. If you went through the first article, we still recommend you to download the Marketo Power Workbook and check out what has been added.
<div class="content-box">Disclaimer: The Marketo Power Workbook is not official Marketo Product, and therefore is not supported by by Marketo. Feel free to use and expand for your personal business needs, but do so at your own risk.</div>
<h4>Configure Workbook</h4>
Please check out the <a href="http://developers.marketo.com/blog/excel-integration-part-1-extract-shape-marketo-data-using-power-query/#prerequisites">Prerequisites</a> and the <a href="/blog/excel-integration-part-1-extract-shape-marketo-data-using-power-query/#power_query_workbook_creation">Power Query Workbook Creation </a>sections from the first article in order to understand the prerequisites and how to configure the Marketo configuration worksheet.

Fill in all of the required information from the Marketo configuration worksheet:
<ul>
 	<li><strong>Marketo REST API Authentication:</strong> required</li>
 	<li><strong>Scoping:</strong> set the Paging Token SinceDatetime and the Id of your Marketo static list containing all the leads you want to analyze</li>
 	<li><strong>Leads:</strong> for the reports to come, you must at least specify the following Lead fields: id, firstName, lastName, email, createdAt, updatedAt, title, company, industry, inferredCountry, inferredCity
<ul>
 	<li>If the city information is more accurate in one of your custom fields, then you can use your own field instead</li>
</ul>
</li>
 	<li><strong>Activities:</strong> Activity types to fetch from the Marketo database are specified here for each Activity set, no need to change this now.
<ul>
 	<li>Note that we provided a utility query on the workbook that lists, right on the Excel workbook, all the existing Activity types if you want to adjust this information later on</li>
</ul>
</li>
</ul>
<img class="alignnone wp-image-6761 size-full" src="http://developers.marketo.com/wp-content/uploads/2017/01/ExcelIntegration-Blog2-Image1.png" alt="excelintegration-blog2-image1" width="464" height="316" />

Note that you may see some security related pop-ups. Trust external connections and set them to ‘Public’.

If you see the pop-up below, stay with ‘Anonymous’ web access content. The authentication to Marketo is directly managed by our custom queries, so no need to enable any other kind of access.

<img class="alignnone wp-image-6762 size-full" src="http://developers.marketo.com/wp-content/uploads/2017/01/ExcelIntegration-Blog2-Image2.png" alt="excelintegration-blog2-image2" width="320" height="130" />
<h4>Download Marketo Data</h4>
Make sure first that the parameter you define in the Scoping area of the Marketo configuration worksheet will not result in downloading too much data, exceeding your Marketo API daily request limit (see <a href="/blog/excel-integration-part-1-extract-shape-marketo-data-using-power-query/#power_query_workbook_creation">first article</a>).

When ready, click the ‘Refresh All’ button from the ‘Data’ menu and wait that all the data is downloaded into the workbook.

<img class="alignnone wp-image-6763 size-full" src="http://developers.marketo.com/wp-content/uploads/2017/01/ExcelIntegration-Blog2-Image3.png" alt="excelintegration-blog2-image3" width="325" height="108" />

If formatting error messages are displayed when downloading the data, similar to ‘column1 not found’, that means one or more queries are failing to get the data, so the formatting is also failing. Try again later on, if the error persists, then check your version of Excel (do not use Excel 2016 from Office 365).

It is important also to respect the latency from the Marketo platform. If you do any changes in a static list, or in your lead data, then it is preferable to wait before launching the Power Queries.
<h2>Data Modeling in Power Pivot</h2>
Open Power Pivot by clicking the ‘Manage’ button from the Power Pivot menu, available in the top menu bar (if not available check your version of Excel, Power Pivot can be installed as an add-in in some versions of Excel).

<img class="alignnone wp-image-6764 size-full" src="http://developers.marketo.com/wp-content/uploads/2017/01/ExcelIntegration-Blog2-Image4.png" alt="excelintegration-blog2-image4" width="492" height="83" />

All the data downloaded from Marketo and sent to the data model should be accessible from the different tabs at the bottom of the Power Pivot window.

<img class="alignnone wp-image-6765 size-full" src="http://developers.marketo.com/wp-content/uploads/2017/01/ExcelIntegration-Blog2-Image5.png" alt="excelintegration-blog2-image5" width="969" height="291" />
<h4>Data Analysis Expressions (DAX)</h4>
We need to enrich or reformat the data for some reports. Let’s use Power Pivot Data Analysis Expressions (DAX) to define some custom calculations as calculated columns and measures (also known as calculated fields). See the ‘DAX in Power Pivot’ link in the References section to learn more about DAX.

Make sure the Calculation Area is showing in the Power Pivot window; if not, enable it from the Power Pivot Home menu.

<img class="alignnone wp-image-6766 size-full" src="http://developers.marketo.com/wp-content/uploads/2017/01/ExcelIntegration-Blog2-Image7.png" alt="excelintegration-blog2-image7" width="130" height="63" />

Select the <strong>MktoLeads</strong> tab and add the <strong>Leads Count</strong> measure anywhere in the Leads Calculation Area: <strong>Leads Count:=</strong><span style="color: #008000;"><strong>DISTINCTCOUNT</strong></span><strong>([id])</strong>.

This measure is counting the distinct leads available in the list, based on their id. It would also take into account the eventual filters in place in the context of a report.

This measure is not really necessary since the reports are capable of summing up the number of leads but we did it in order to have a lead count with a nicer name than ‘sum of MktoLeads’. It is also a simple example that let you easily imagine some more complex measures doing averages, min, max for a specific type of data entry (e.g. all the leads with a score higher than 50, average score, etc …).

<img class="alignnone wp-image-6767 size-full" src="http://developers.marketo.com/wp-content/uploads/2017/01/ExcelIntegration-Blog2-Image8.png" alt="excelintegration-blog2-image8" width="333" height="341" />

Now let’s select the <strong>MktoWebActivities</strong> tab and create three calculated columns.

Insert the following calculated columns by scrolling to the far right of the table and by clicking the column ‘Add Column’.

<img class="alignnone wp-image-6768 size-full" src="http://developers.marketo.com/wp-content/uploads/2017/01/ExcelIntegration-Blog2-Image9.png" alt="excelintegration-blog2-image9" width="931" height="293" />

<strong>Activity:</strong> Obtain the user-friendly Activity label by looking up the Activity Id in the table MktoActivtyTypes.

<strong>=</strong><span style="color: #008000;"><strong>LOOKUPVALUE</strong></span><strong>(MktoActivityTypes[name],MktoActivityTypes[id],[activityTypeId])</strong>

<strong>Year-Month:</strong> reformat the Activity date with a pattern ‘YYYYmm’ that is more suitable for some reports.

<strong>=</strong><span style="color: #008000;"><strong>LEFT</strong></span><strong>([activityDate],4)&amp;</strong><span style="color: #008000;"><strong>MID</strong></span><strong>([activityDate],6,2)</strong>

<strong>Date:</strong> Activity Date is just a String from our original query, transform it to a proper date.

<strong>=</strong><span style="color: #008000;"><strong>DATE</strong></span><strong>(</strong><span style="color: #008000;"><strong>LEFT</strong></span><strong>([activityDate],4),</strong><span style="color: #008000;"><strong>MID</strong></span><strong>([activityDate],6,2),</strong><span style="color: #008000;"><strong>MID</strong></span><strong>([activityDate],9,2))</strong>

Now let’s create the three same measures for the <strong>MktoEmailActivities</strong> tab, and 2 additional ones:

<img class="alignnone wp-image-6769 size-large" src="http://developers.marketo.com/wp-content/uploads/2017/01/ExcelIntegration-Blog2-Image10-1024x290.png" alt="excelintegration-blog2-image10" width="840" height="238" />

<strong>Campaign:</strong> Obtain the user-friendly Campaign name by looking up the Campaign Id in the table MktoCampaigns.

<strong>=</strong><span style="color: #008000;"><strong>LOOKUPVALUE</strong></span><strong>(MktoCampaigns[name],MktoCampaigns[id],[campaignId])</strong>

<strong>Program:</strong> Obtain the user-friendly Program name by looking up the Campaign Id in the table MktoCampaigns. The table MktoPrograms can provide more details about the Program such as folder, workspace, etc.

<strong>=</strong><span style="color: #008000;"><strong>LOOKUPVALUE</strong></span><strong>(MktoCampaigns[programName],MktoCampaigns[id],[campaignId])</strong>
<h4>Entity-Relationships</h4>
We saw previously a way to lookup information from another table within the model in order to complete some missing information. Power Pivot offers a more powerful option to define the relationships between some tables of the data model, allowing us to leverage those relationships directly from the reports. Let define the key relationships for our reports.

Select the Diagram View from the Power Pivot window.

<img class="alignnone wp-image-6770 size-full" src="http://developers.marketo.com/wp-content/uploads/2017/01/ExcelIntegration-Blog2-Image11.png" alt="excelintegration-blog2-image11" width="128" height="63" />

Trace the following relationships within the Data model diagram:
<ul>
 	<li><strong>MktoInterestingMomentActivities:leadId →</strong><strong> MktoLeads:id</strong></li>
 	<li><strong>MktoScoringActivities:leadId →</strong><strong> MktoLeads:id</strong></li>
 	<li><strong>MktoRevenueStageActivities:leadId →</strong><strong> MktoLeads:id</strong></li>
 	<li><strong>MktoWebActivities:leadId →</strong><strong> MktoLeads:id</strong></li>
 	<li><strong>MktoEmailActivities:leadId →</strong><strong> MktoLeads:id</strong></li>
</ul>
<img class="alignnone wp-image-6771 size-full" src="http://developers.marketo.com/wp-content/uploads/2017/01/ExcelIntegration-Blog2-Image12.png" alt="excelintegration-blog2-image12" width="681" height="608" />

We’ll not use all of these relationships and objects in our reports, only the Leads, Web Activities and Email Activities.

Now it’s time to build some reports.
<h2>Emails Performance Pivot Chart</h2>
This first report is showing email performance KPIs based on a standard Excel Pivot Chart. It allows us to filter data by Industry and/or Campaign.

You can create a Pivot Chart right from the Power Pivot menu by selecting ‘Pivot Chart’ from the ‘Pivot Table’ selector.

<img class="alignnone wp-image-6773 size-full" src="http://developers.marketo.com/wp-content/uploads/2017/01/ExcelIntegration-Blog2-Image13.png" alt="excelintegration-blog2-image13" width="533" height="216" />

An alternative is to create a Pivot Chart directly from the Excel spreadsheet, ticking the option ‘Use this workbook’s Data Model’.

<img class="alignnone wp-image-6774 size-full" src="http://developers.marketo.com/wp-content/uploads/2017/01/ExcelIntegration-Blog2-Image14.png" alt="excelintegration-blog2-image14" width="300" height="246" />

Drag and drop the fields from the <strong>MktoEmailActivities</strong> and the <strong>MktoLeads</strong> tables, like the figure below:

<strong>MktoEmailActivities.Activity →</strong><strong> Legend </strong>(this use the DAX calculated column we implemented on <strong>MktoEmailActivities</strong> earlier)

<strong>MktoEmailActivities.Date →</strong><strong> Axis </strong>(this use the DAX calculated column we implemented on <strong>MktoEmailActivities</strong> earlier)

<strong>MktoEmailActivities.Id →</strong><strong> </strong><strong>∑ Values</strong>

<strong>MktoEmailActivities.Campaign →</strong><strong> Filter</strong>

<strong>MktoLeads.industry →</strong><strong> Filter</strong>

<img class="alignnone wp-image-6775 size-full" src="http://developers.marketo.com/wp-content/uploads/2017/01/ExcelIntegration-Blog2-Image15.png" alt="excelintegration-blog2-image15" width="1065" height="419" />

You can create custom name by selecting ‘Value Field Settings’ on each dropped field. In this case, we dropped the Email Activity id field into the ‘∑ Values’ section and edited its custom name as ‘Number of Activities’.

<img class="alignnone wp-image-6776 size-full" src="http://developers.marketo.com/wp-content/uploads/2017/01/ExcelIntegration-Blog2-Image16.png" alt="excelintegration-blog2-image16" width="397" height="242" />

Now let’s configure the Pivot Chart. Right click directly on the chart and select the ‘Change Chart Type’ option in the contextual menu.

<img class="alignnone wp-image-6777 size-full" src="http://developers.marketo.com/wp-content/uploads/2017/01/ExcelIntegration-Blog2-Image17.png" alt="excelintegration-blog2-image17" width="237" height="245" />

And this is how we selected the different chart type for all data series.

<img class="alignnone wp-image-6778 size-full" src="http://developers.marketo.com/wp-content/uploads/2017/01/ExcelIntegration-Blog2-Image18.png" alt="excelintegration-blog2-image18" width="429" height="431" />
<h2>Leads Map with Power View</h2>
The second report displays your Leads and Contacts by geography on a world map and by Industry.

We’ll need Power View for this report. Please follow the reference link below ‘<a href="https://support.office.com/en-us/article/Turn-on-Power-View-in-Excel-2016-for-Windows-f8fc21a6-08fc-407a-8a91-643fa848729a">Turn-on Power View in Excel 2016</a>’ in order to turn on the menu in Excel. Or you can just type ‘power view’ in the Excel search box.

Select ‘Insert a Power View Report’.

<img class="alignnone wp-image-6779 size-full" src="http://developers.marketo.com/wp-content/uploads/2017/01/ExcelIntegration-Blog2-Image19.png" alt="excelintegration-blog2-image19" width="121" height="72" />

On the blank Power View report, select the <strong>MktoLeads </strong>table on the right panel and drag &amp; drop the lead location field (e.g. <strong>inferredCity</strong>). Now the menu ‘Design’ appear in the main menu.

<img class="alignnone wp-image-6780 size-full" src="http://developers.marketo.com/wp-content/uploads/2017/01/ExcelIntegration-Blog2-Image20.png" alt="excelintegration-blog2-image20" width="796" height="277" />

Switch to the Map visualization by selecting ‘Map’ in the Power View ‘Design’ menu.

Drag and drop the fields from the <strong>MktoLeads</strong> table, like the figure below:

<strong>MktoLeads.industry →</strong><strong> Color</strong>

<strong>MktoLeads.inferredCity →</strong><strong> Locations</strong>

<strong>MktoLeads.Leads Count →</strong><strong> </strong><strong>∑ Size </strong>(this use the DAX measure we implemented on <strong>MktoLeads</strong> earlier)

<img class="alignnone wp-image-6781 size-full" src="http://developers.marketo.com/wp-content/uploads/2017/01/ExcelIntegration-Blog2-Image21.png" alt="excelintegration-blog2-image21" width="756" height="422" />

And your Leads map is ready! You just need to adjust the size of the map, customize the title and legends.

Power View allows you to build advanced dashboards with multiple graphs on one single spreadsheet. Check out the referenced tutorial below ‘<a href="https://support.office.com/en-us/article/Tutorial-Create-Amazing-Power-View-Reports-Part-1-e2842c8f-585f-4a07-bcbd-5bf8ff2243a7">Create Amazing Power View Reports</a>’ to see how to proceed with more dashboard components with Power View.
<h2>Web Activities Animated on a 3D Map</h2>
This third report displays your Lead web activities, by industry, on a 3D world map.

We’ll need a 3D Map for this report. Just type ‘3D’ in the Excel search box and select ‘3D Map’.

<img class="alignnone wp-image-6782 size-full" src="http://developers.marketo.com/wp-content/uploads/2017/01/ExcelIntegration-Blog2-Image22.png" alt="excelintegration-blog2-image22" width="305" height="145" />

Create a new tour from the pop-up window.

<img class="alignnone wp-image-6783 size-full" src="http://developers.marketo.com/wp-content/uploads/2017/01/ExcelIntegration-Blog2-Image23.png" alt="excelintegration-blog2-image23" width="231" height="180" />

Select the Bubble Chart on the right panel.

<img class="alignnone wp-image-6784 size-full" src="http://developers.marketo.com/wp-content/uploads/2017/01/ExcelIntegration-Blog2-Image24.png" alt="excelintegration-blog2-image24" width="220" height="52" />

Drag and drop the fields, from the <strong>MktoLeads</strong> and the <strong>MktoWebActivities</strong> tables, like the figure below:

<strong>MktoLeads.industry →</strong><strong> Category</strong>

<strong>MktoLeads.inferredCity →</strong><strong> Location</strong>

<strong>MktoWebActivities.Activity →</strong><strong> Time </strong>(this use the DAX calculated column we implemented on <strong>MktoWebActivities</strong> earlier. The id field could also be used for counting activities.)

<strong>MktoWebActivities.Date →</strong><strong> Time </strong>(this use the DAX calculated column we implemented on <strong>MktoWebActivities</strong> earlier)

<strong>MktoWebActivities.Activity </strong>can also be used as a filter to filter out the different types of web activities.

<img class="alignnone wp-image-6785 size-full" src="http://developers.marketo.com/wp-content/uploads/2017/01/ExcelIntegration-Blog2-Image25.png" alt="excelintegration-blog2-image25" width="1043" height="497" />

Use the ‘Themes’ button in order to change the color scheme of your 3D Map.

<img class="alignnone wp-image-6786 size-full" src="http://developers.marketo.com/wp-content/uploads/2017/01/ExcelIntegration-Blog2-Image26.png" alt="excelintegration-blog2-image26" width="256" height="168" />

Open the ‘Scene Options’ in order to customize your animations.

<img class="alignnone wp-image-6787 size-full" src="http://developers.marketo.com/wp-content/uploads/2017/01/ExcelIntegration-Blog2-Image27.png" alt="excelintegration-blog2-image27" width="233" height="382" />

And you’re done with the 3D World Map, now you can have fun animating the globe and creating video from it.<strong> </strong>
<h2>Next Steps</h2>
We just scratched the surface of what is possible to do with the Excel Power BI tools. We recommend you to search the web for other great articles and tutorials to expand your Excel skills and design the reports you need to achieve your business goals.

We hope you enjoyed these articles and that they helped you leverage the great benefits of Excel and Marketo combined.
<h2>References</h2>
<h4>Power Pivot</h4>
<ul>
 	<li><a href="https://support.office.com/en-us/article/Power-Pivot-Powerful-data-analysis-and-data-modeling-in-Excel-d7b119ed-1b3b-4f23-b634-445ab141b59b">Power Pivot: Powerful data analysis and data modeling in Excel</a></li>
 	<li><a href="https://support.office.com/en-us/article/Data-Analysis-Expressions-DAX-in-Power-Pivot-bab3fbe3-2385-485a-980b-5f64d3b0f730">Data Analysis Expressions (DAX) in Power Pivot</a></li>
</ul>
<h4>Power View</h4>
<ul>
 	<li><a href="https://support.office.com/en-us/article/Turn-on-Power-View-in-Excel-2016-for-Windows-f8fc21a6-08fc-407a-8a91-643fa848729a">Turn-on Power View in Excel 2016</a></li>
 	<li><a href="https://support.office.com/en-us/article/Tutorial-Create-Amazing-Power-View-Reports-Part-1-e2842c8f-585f-4a07-bcbd-5bf8ff2243a7">Tutorial: Create Amazing Power View Reports</a></li>
</ul><br/><br/>pdellecase - 2017-02-02<br/><br/><h2>Important Change to Activity Records in Marketo APIs</h2><br/><br/><strong>Note: This post will be updated to reflect changes made to activity records returned by the API due to migration to new infrastructure.</strong>

<strong>Last Update: September 13, 2018</strong>

With the rollout of Marketo's next-generation Activity Service beginning in September 2017, we will be unable to enforce the uniqueness or presence of the integer "id" field in activities, data value changes, or lead deletion records returned by Marketo's APIs.

To avoid service disruptions for integrations which retrieve activity records, the id field should be treated as optional.  Cutover of this change will begin to affect subscriptions and upcoming release.

This change will affect the following endpoints:

REST API
<blockquote>
<ul>
 	<li><a href="http://developers.marketo.com/blog/endpoints/get-lead-activities/">Get Lead Activities</a></li>
 	<li><a href="http://developers.marketo.com/blog/endpoints/get-lead-changes/">Get Lead Changes</a></li>
 	<li><a href="http://developers.marketo.com/blog/endpoints/get-deleted-leads/">Get Deleted Leads</a></li>
 	<li><a class="jive-link-external-small" href="http://developers.marketo.com/rest-api/endpoint-reference/lead-database-endpoint-reference/#/Activities/addCustomActivityUsingPOST" target="_blank" rel="nofollow noopener">Add Custom Activities</a></li>
</ul>
</blockquote>
SOAP API
<blockquote>
<ul>
 	<li><a href="http://developers.marketo.com/soap-api/activities/getleadactivity/">getLeadActivity</a></li>
 	<li><a href="http://developers.marketo.com/soap-api/activities/getleadchanges/">getLeadChanges</a></li>
</ul>
The affected SOAP types are ActivityRecord and LeadChangeRecord.</blockquote>
<h2>Examples</h2>
The following examples show record types which will be affected.  In both examples, the effected field is called "id."

<strong>Example REST Field: id</strong>
<pre class="lang:js mark:2 decode:true" title="Response">        {
            "id" : 102988,
            "leadId" : 1,
            "activityDate" : "2015-01-16T23:32:19Z",
            "activityTypeId" : 1,
            "primaryAttributeValueId" : 71,
            "primaryAttributeValue" : "localhost/munchkintest2.html",
            "attributes" : [
                {
                    "name" : "Client IP Address",
                    "value" : "10.0.19.252"
                },
                {
                    "name" : "Query Parameters",
                    "value" : ""
                },
                {
                    "name" : "Referrer URL",
                    "value" : ""
                },
                {
                    "name" : "User Agent",
                    "value" : "Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/39.0.2171.95 Safari/537.36"
                },
                {
                    "name" : "Webpage URL",
                    "value" : "/munchkintest2.html"
                }
            ]
        }</pre>
<strong>Example SOAP Field: id</strong>
<pre class="lang:default mark:2 decode:true " title="Response">          &lt;activityRecord&gt;
            &lt;id&gt;1030680&lt;/id&gt;
            &lt;activityDateTime&gt;2013-07-09T16:44:28-05:00&lt;/activityDateTime&gt;
            &lt;activityType&gt;Visit Webpage&lt;/activityType&gt;
            &lt;mktgAssetName&gt;ClickDemo&lt;/mktgAssetName&gt;
            &lt;activityAttributes&gt;
              &lt;attribute&gt;
                &lt;attrName&gt;Webpage ID&lt;/attrName&gt;
                &lt;attrType xsi:nil="true" /&gt;
                &lt;attrValue&gt;2547&lt;/attrValue&gt;
              &lt;/attribute&gt;
              &lt;attribute&gt;
                &lt;attrName&gt;Webpage URL&lt;/attrName&gt;
                &lt;attrType xsi:nil="true" /&gt;
                &lt;attrValue&gt;/ClickDemo.html&lt;/attrValue&gt;
              &lt;/attribute&gt;
            &lt;/activityAttributes&gt;
            &lt;campaign /&gt;
            &lt;personName xsi:nil="true" /&gt;
            &lt;mktPersonId&gt;1089965&lt;/mktPersonId&gt;
            &lt;foreignSysId xsi:nil="true" /&gt;
            &lt;orgName xsi:nil="true" /&gt;
            &lt;foreignSysOrgId xsi:nil="true" /&gt;
          &lt;/activityRecord&gt;</pre>
<h2>FAQs</h2>
<div id="crayon-58b493aeb8567344994915-15" class="crayon-line">[faqs style="toggle" filter="activity-record-change"]</div><br/><br/>kelkington - 2017-03-01<br/><br/><h2>Winter 2017 Updates</h2><br/><br/>In the Winter 2017 release, we are adding the ability to bulk import custom object data asynchronously, and to manipulate variables in guided landing pages.  See the full list of updates below.
<h2>Lead Database APIs</h2>
<h4>Bulk Import of Custom Objects</h4>
New endpoints to support Bulk Import of Custom Objects.  Details can be found <a href="/rest-api/lead-database/custom-objects/#bulk_import">here</a>.
<a name="activities_upcoming_change"></a>
<h4>Notice of Upcoming Change to Activities</h4>
Please note a significant change that will occur when Marketo releases it's next-generation Activity Service. This change will affect the following endpoints:
<table>
<tbody>
<tr>
<td>REST</td>
<td><a href="/blog/endpoints/get-lead-activities/">Get Lead Activities</a>,  <a href="/blog/endpoints/get-lead-changes/">Get Lead Changes</a>,  <a href="/blog/endpoints/get-deleted-leads/">Get Deleted Leads</a>, <a href="/blog/endpoints/add-custom-activities/">Add Custom Activities</a></td>
</tr>
<tr>
<td>SOAP</td>
<td><a href="/soap-api/activities/getleadactivity/">getLeadActivity</a>,  <a href="/soap-api/activities/getleadchanges/">getLeadChanges</a></td>
</tr>
</tbody>
</table>
The integer "id" field contained in records returned by these endpoints will no longer be guaranteed unique.  This will impact activity, data value change, and lead deletion record types. To avoid service disruptions for integrations that retrieve these record types, the id field should be treated as optional.  Additional details can be found <a href="/blog/important-change-activity-records-marketo-apis/">here</a>.
<h2>Asset APIs</h2>
<h4>Landing Pages Variables</h4>
New endpoints for manipulating Guided Landing Page variables.  Details can be found <a href="/rest-api/assets/landing-pages/#variables">here</a>.
<h2>Mobile SDK</h2>
<h4>Push Token Removal</h4>
Added the ability to remove push tokens via the SDK API.  Details can be found here: <a href="/mobile/push-notifications/#ios_enable_push_notification_in_app_with_marketo_sdk">iOS</a>, <a href="/mobile/push-notifications/#android_setup_push">Android</a>.<br/><br/>marketohost - 2017-03-01<br/><br/><h2>Spring 2017 Updates</h2><br/><br/>In the Spring 2017 release, we are adding the ability to bulk extract lead and activity object data asynchronously, and to manipulate named account lists.  See the full list of updates below.
<h2>Lead Database APIs</h2>
<h4>Bulk Extract of Leads</h4>
New endpoints to support extraction of leads in bulk.  Specify record selection criteria using a variety of options.  Details can be found <a href="/rest-api/bulk-extract/bulk-lead-extract/">here</a>.
<h4>Bulk Extract of Activities</h4>
New endpoints to support extraction of Activities in bulk.  Specify record selection criteria using date range, and activity list.  Details can be found <a href="/rest-api/bulk-extract/bulk-activity-extract/">here</a>.
<h4>Named Account Lists</h4>
New endpoints to support CRUD operations on Named Account Lists.  Details can be found <a href="/rest-api/lead-database/named-account-lists/">here</a>.
<h4>Other Enhancements</h4>
<ul>
 	<li>The <a href="/rest-api/endpoint-reference/lead-database-endpoint-reference/#!/Campaigns/getCampaignsUsingGET">Get Campaigns</a> endpoint now allows you to filter "triggerable" campaigns.  This is achieved by passing "isTriggerable=true" as a query parameter.</li>
 	<li>The <a href="/rest-api/endpoint-reference/asset-endpoint-reference/#/Programs/cloneProgramUsingPOST">Clone Program</a> endpoint now supports programs that contain all asset types except SMS Message.</li>
</ul>
<h2>Mobile SDK</h2>
<h4>Ionic</h4>
You can now use Marketo Mobile MME and with the <a href="https://ionicframework.com/">Ionic</a> application framework.  Details can be found <a href="http://developers.marketo.com/mobile/ionic/">here</a>.
<h4>Unregister Push Notification Token</h4>
A new method was added to the SDK that allows you to unregister the push notification token with Marketo.  This is useful for example when a user logs out of your app.  For usage see "unregisterPushDeviceToken" (iOS) or "uninitializeMarketoPush" (Android) method <a href="/mobile/push-notifications/">here</a>.<br/><br/>marketohost - 2017-06-16<br/><br/><h2>Internet of Things for Marketers with IFTTT and Zapier</h2><br/><br/>The Internet of Things (IoT) is the inter-networking of connected devices, appliances, wearables, vehicles, etc. with embedded electronics, software, sensors, and network connectivity that enable these objects to collect and exchange data with cloud information systems. These technologies are growing and trending so fast that they will impact how we live, how we work and how we do business in no time.

Marketo the leading Marketing Engagement Platform is ready for the IoT with its capabilities to scale and interact with any form of communication channel. Marketo can track already over 70 types of activities related to emails, web, mobile, CRM, etc … and it supports also <a href="http://docs.marketo.com/display/public/DOCS/Create+a+Custom+Activity">custom activities</a> that can be fed by any 3<sup>rd</sup> party system. Marketo <a href="http://docs.marketo.com/display/public/DOCS/Understanding+Marketo+Custom+Objects">custom objects</a> make possible to track all kinds of 3<sup>rd</sup> party metrics related to your business, and allows marketers to leverage those metrics right from Marketo smart campaign filters and triggers.

Implementing IoT for consumers would require a centralized server to interact with consumer devices and this server would exchange data with the Marketo open platform, with capabilities such as REST API, Custom Objects, Custom Activities, etc. - documented <a href="http://developers.marketo.com/">here</a>. Not easy to demonstrate via a blog post.

Instead of that, we are going to integrate the IFTTT Service with Marketo in order to implement some cool IoT use cases for the Marketers like:
<ul>
 	<li>Cheering up your Marketing team each time a lead is registering to a road show by blinking a colored light in the office</li>
 	<li>Cheering up your Sales team each time a deal is won by automatically firing up a bell plugged to a connected power plug</li>
 	<li>Automatically post Marketing success milestones on social networks such as LinkedIn, Facebook, Slack, etc …</li>
 	<li>Automatically launch a Marketing Campaign based on:
<ul style="list-style-type: square">
 	<li>when a weather alert occurs (wind, temperature, rain, etc.)</li>
 	<li>when a new article is published by a newspaper such as the New York Times, matching some specific criteria</li>
 	<li>when the U.S. Senate or House of Representatives votes</li>
 	<li>when the International Space Station passes over a certain location</li>
 	<li>etc …</li>
</ul>
</li>
</ul>
You might find those scenarios fun but useless, but they are here to demonstrate a new conceptual way to do Marketing not only with people, but also with things in our connected world.

Another interesting point covered in this article, is how to leverage an open web integration platform such as Zapier as a "serving hatch" between a 3<sup>rd</sup> party system and Marketo, to manage the authentication for example.
<h2>About IFTTT</h2>
<h4>The IFTTT Service</h4>
IFTTT is an acronym for “IF This Then That”. It is a free web-based service that people use to create chains of simple conditional statements, called applets. An applet is triggered by changes that occur within some partner web services and as a result, actions are sent to other partner web services. IFTTT was launched on 2011 by Linden Tibbets, Jesse Tane, Scott Tong, and Alexander Tibbets in San Francisco.

At first sight, IFTTT looks similar to a service like <a href="https://zapier.com/">Zapier</a> for example, it has a much stronger focus on consumers and IoT devices (remotes, alarms, lights, thermostats, cars, printers, mobile phones, and so much more).

<img class="alignnone size-medium wp-image-6945" src="http://developers.marketo.com/wp-content/uploads/2017/06/IFTTTMedia00-300x86.png" alt="" width="300" height="86" />

First of all, you must create an account for IFTTT from the <a href="https://ifttt.com/search">IFTTT web site</a>. Feel free to discover all the cool applets already available as that will give you some other scenarios ideas for sure!
<h4>The Maker Channel</h4>
A web application that does not have a channel, meaning a partnership with IFTTT, must use the Maker Channel.  With the Maker Channel, you can create Applets that work with any device or app that can make or receive a web request. It offers the following integrations:
<ul>
 	<li>Inbound Triggers to receive web request from a 3<sup>rd</sup> party system in order to trigger an action</li>
 	<li>Outbound Actions to make a web request to a 3<sup>rd</sup> party system publicly accessible on the Internet</li>
</ul>
From IFTTT, search for the “Maker” service and click on it.

<img class="alignnone wp-image-6946 size-full" src="http://developers.marketo.com/wp-content/uploads/2017/06/IFTTTMedia01.png" alt="" width="767" height="387" />

The first time, you will need to activate it by clicking on the “Connect” button.

<img class="alignnone wp-image-6947 size-full" src="http://developers.marketo.com/wp-content/uploads/2017/06/IFTTTMedia02.png" alt="" width="614" height="608" />

Now the Maker Channel is active.

You can obtain your secret key by clicking on the Maker Settings button:

<img class="alignnone wp-image-6948 size-full" src="http://developers.marketo.com/wp-content/uploads/2017/06/IFTTTMedia03.png" alt="" width="471" height="450" />

Copy and paste the provided URL to your browser for more details.
<h2>Triggering Directly an IFTTT Action from Marketo</h2>
First, we are going to focus on triggering all kinds of 3<sup>rd</sup> party web service actions from Marketo.  For that we are going to use a <a href="http://docs.marketo.com/display/public/DOCS/Create+a+Webhook">Marketo Webhook</a>. We’ll start with a push message on your mobile phone or tablet via the IFTTT mobile app, and then we’ll implement a IoT scenario blinking a Philips Hue light.
<h4>Marketo Webhook</h4>
To trigger an event from Marketo, acting as the "if" of IFTTT, is simple. All you need to do is send a POST web request to IFTTT with an event name and your secret key, following this pattern URL:
<blockquote><em>https://maker.ifttt.com/trigger/{event_name}/with/key/{secret_key}</em></blockquote>
The Maker makes it also possible to communicate up to 3 parameters via the web request.  This can be done using query parameters,
<blockquote>https://maker.ifttt.com/trigger/{event_name}/with/key/{secret_key}?value1={value1}&amp;value2={value2}&amp;value3={value3}</blockquote>
or using a JSON body consisting of up to three values:
<blockquote>{

"value1" : "{value1}",

"value2" : "{value2}",

"value3" : "{value3}"

}</blockquote>
In Marketo, create a new Webhook from the Admin interface.

<img class="alignnone wp-image-6949 size-full" src="http://developers.marketo.com/wp-content/uploads/2017/06/IFTTTMedia04.png" alt="" width="572" height="443" />

Provide the following information for your new Webhook:
<p style="padding-left: 30px"><strong>Webhook Name:</strong> IFTTT Program Success</p>
<p style="padding-left: 30px"><strong>Description:</strong> Trigger an event on IFTTT from a Smart Campaign for a Program Success</p>
<p style="padding-left: 30px"><strong>URL: </strong>https://maker.ifttt.com/trigger/{event_name}/with/key/{secret_key}?value1={{program.name}}&amp;value2={{lead.Email Address}}&amp;value3={{lead.Full Name}}</p>
<p style="padding-left: 30px">event_name, use MarketoProgramSuccess for example</p>
<p style="padding-left: 30px">secret_key, use the secret key from your IFTTT Maker Service</p>
<p style="padding-left: 30px">Use static text or Marketo tokens for the three available values. You can push more interactive messages by defining your own tokens at the program level and pass them through these values.</p>
<p style="padding-left: 30px"><strong>Request Type:</strong> POST</p>
<p style="padding-left: 30px"><strong>Template: </strong>Leave blank</p>
<p style="padding-left: 30px"><strong>Request Token Encoding:</strong> Form/Url</p>
<p style="padding-left: 30px"><strong>Response type:</strong> None</p>
<p style="padding-left: 30px">No need to define a response mapping.</p>

<h4>IFTTT Applet</h4>
In IFTTT web portal, select “My Applets” in the main menu.

<img class="alignnone wp-image-6950 size-full" src="http://developers.marketo.com/wp-content/uploads/2017/06/IFTTTMedia05.png" alt="" width="473" height="67" />

Click the button “New Applet” and click on the section <span style="color: #00ccff"><strong>+this</strong>.</span>

<img class="alignnone wp-image-6951 size-full" src="http://developers.marketo.com/wp-content/uploads/2017/06/IFTTTMedia06.png" alt="" width="707" height="439" />

Search for the Maker service.

<img class="alignnone size-medium wp-image-6952" src="http://developers.marketo.com/wp-content/uploads/2017/06/IFTTTMedia07-300x207.png" alt="" width="300" height="207" />

Create the Trigger that will fire every time the Maker service receives a web request to notify it of an event.

Use the same Event Name as the one specified in the URL of your Marketo Webhook, e.g. "MarketoProgramSuccess" and click the "Create trigger" button.

<img class="alignnone wp-image-6953 size-full" src="http://developers.marketo.com/wp-content/uploads/2017/06/IFTTTMedia08.png" alt="" width="389" height="436" />

Now it is time to specify the Action Service by clicking the section <strong>+that</strong>.

<img class="alignnone wp-image-6954 size-full" src="http://developers.marketo.com/wp-content/uploads/2017/06/IFTTTMedia09.png" alt="" width="539" height="90" />

We are going to start with a simple action service that anyone would be able to test without having to invest in any IoT devices, the Notifications Service.

Search for and select the Notifications Service.

<img class="alignnone wp-image-6955 size-full" src="http://developers.marketo.com/wp-content/uploads/2017/06/IFTTTMedia10.png" alt="" width="397" height="292" />

Choose the action “Send a notification” that will send a notification to your devices.

<img class="alignnone wp-image-6956 size-full" src="http://developers.marketo.com/wp-content/uploads/2017/06/IFTTTMedia11.png" alt="" width="374" height="377" />

You can leverage the 3 values you have sent from Marketo by adding them as Ingredients in order to deliver a meaningful notification to the user, just like the example below …

<img class="alignnone wp-image-6957 size-full" src="http://developers.marketo.com/wp-content/uploads/2017/06/IFTTTMedia12.png" alt="" width="377" height="380" />

And then click the button “Create action”.

Review and finish the IFTTT Applet. Make sure it is enabled.

<img class="alignnone wp-image-6958 size-full" src="http://developers.marketo.com/wp-content/uploads/2017/06/IFTTTMedia13.png" alt="" width="259" height="424" />
<h4>Testing the IFTTT Applet</h4>
If you want to get notified on your Mobile, you must first download the IFTTT app for your device.

<img class="alignnone wp-image-6959 size-full" src="http://developers.marketo.com/wp-content/uploads/2017/06/IFTTTMedia14.png" alt="" width="825" height="476" />

You can trigger a Marketo Program Success event by using the Webhook in a Marketo Smart Campaign Flow. Remember that Marketo Webhooks work exclusively with triggered Smart Campaigns (e.g. trigger once a contact filled-out form, was added to a list, etc.).

<img class="alignnone wp-image-6960 size-full" src="http://developers.marketo.com/wp-content/uploads/2017/06/IFTTTMedia15.png" alt="" width="729" height="236" />

And here is an example of an IFTTT notification on your mobile phone.

<img class="alignnone wp-image-6961 size-full" src="http://developers.marketo.com/wp-content/uploads/2017/06/IFTTTMedia16.png" alt="" width="276" height="376" />
<h4>Let’s Get Creative with IFTTT</h4>
IFTTT offers Applet Actions with over 300 partners, so your portfolio of apps and appliances together with your imagination are the limits …

<img class="alignnone wp-image-6962 size-large" src="http://developers.marketo.com/wp-content/uploads/2017/06/IFTTTMedia17-513x1024.png" alt="" width="513" height="1024" />

Let’s take an example with the <a href="http://www2.meethue.com">Hue lights from Philips</a> that you can buy anywhere in electronics shops or online.

The following applets would blink one of your lights with its current assigned color when Marketo triggers a program success, that could boost your marketing team in the office.

We create a new Applet, following the same steps as before, where Marketo is triggering with a webhook, but this time we choose the action from Philips Hue service.

Let’s select the “Blink lights” action.

<img class="alignnone wp-image-6963 size-full" src="http://developers.marketo.com/wp-content/uploads/2017/06/IFTTTMedia18.png" alt="" width="821" height="714" />

The app will request from Philips Hue all your available lights, so you can pick the one to blink. You would need to set up an account with Philips Hue first, the Hue bridge and of course at least one Hue bulb, light strip, projector or lamp.

<img class="alignnone wp-image-6964 size-full" src="http://developers.marketo.com/wp-content/uploads/2017/06/IFTTTMedia19.png" alt="" width="414" height="376" />

We just added a new Applet that will blink a colored light each time a lead is registering to a roadshow or webinar. Your Marketing team will cheer up every day with that setup in the office.
<h2>Executing a Marketo Action from IFTTT, via Zapier</h2>
Now, we are going to trigger a Marketo Smart Campaign from the IFTTT Platform. For that we are going to use the <a href="http://developers.marketo.com/rest-api/">Marketo REST API</a>. Since this API is secured and requires an OAuth2 Authentication prior to invoke anything, we need to handle that authentication via another platform such as Zapier, because IFTTT doesn’t allow to chain two consecutive calls on an API with the Maker Channel.

We picked <a href="https://zapier.com/">Zapier</a> web app Automation Service since we published already <a href="http://developers.marketo.com/blog/seamless-integration-with-marketo-and-over-500-apps-using-zapier/">this blog post</a> introducing Zapier and explaining step by step how to implement a custom Marketo connector for Zapier. Other platforms such as <a href="https://www.workato.com/integrations/marketo">Workato</a> could be a solution too.
<h4>Marketo Campaign</h4>
Create your Marketo Program with a scheduled Smart Campaign.

For test purpose, you could create the following Smart Campaign as an example:

<strong>Smart List</strong>

<img class="alignnone wp-image-6965 size-full" src="http://developers.marketo.com/wp-content/uploads/2017/06/IFTTTMedia21.jpg" alt="" width="667" height="177" />

Use only filters, not triggers. Make sure at least you would qualify.

<strong>Flow</strong>

<img class="alignnone wp-image-6966 size-full" src="http://developers.marketo.com/wp-content/uploads/2017/06/IFTTTMedia22.jpg" alt="" width="666" height="203" />

Send you an email or any another kind of notification.

<strong>Schedule</strong>

<img class="alignnone wp-image-6967 size-full" src="http://developers.marketo.com/wp-content/uploads/2017/06/IFTTTMedia23.jpg" alt="" width="443" height="420" />

Make sure you can run through the flow every time in order to handle your multiple tests.

You can obtain the Smart Campaign Id from the URL. Example: <em>https://{{marketo_url}}/#SC4289A1</em> - the Smart Campaign Id would be 4289.

You can trigger this campaign via the Marketo REST API. You can use for example the <a href="https://www.getpostman.com/">Postman</a> plugin for Chrome and send the 2 following consecutive HTTPS calls:

<strong>Authentication step:</strong>
<blockquote>https://{{Your Munchkin_Account_id}}.mktorest.com/identity/oauth/token?grant_type=client_credentials&amp;client_id={{Your_Client_Id}}&amp;client_secret={{Your_Client_Secret}}</blockquote>
Recover the access token from the JSON response.

<strong>Campaign kick-off step:</strong>
<blockquote>https://{{Your_Munchkin_Account_id}}.mktorest.com/rest/v1/campaigns/{{Campaign_Id}}/schedule.json?access_token={{access_token}}</blockquote>
<h4>Intermediate Zapier Custom Connector to Launch the Marketo Campaign</h4>
We need to build a custom Zapier connector that authenticates with the Marketo REST API and kicks off our Smart Campaign. For that we are re-iterating all the following steps from our previous article ‘<a href="http://developers.marketo.com/blog/seamless-integration-with-marketo-and-over-500-apps-using-zapier/">Seamless Integration with Marketo and over 500 Apps using Zapier</a>’:
<ul>
 	<li>Prerequisites</li>
 	<li>Implementation of the Marketo Connector for Zapier</li>
 	<li>Use a different title such as “Marketo Campaign”
<ul style="list-style-type: square">
 	<li>Do the “Authentication” step</li>
 	<li>Do the “Triggers” step (required for Zapier testing purpose)</li>
 	<li>Do the following specific “Actions” step, responsible to launch a Marketo campaign, explained below:</li>
</ul>
</li>
</ul>
<h5>Action</h5>
Click <strong>Add New Action</strong> to start the wizard and fill-up the following fields (fields not mentioned can be left blank):

Name and Description
<table width="784">
<tbody>
<tr>
<td width="121"><strong>Name</strong></td>
<td width="115"><strong>Noun</strong></td>
<td width="120"><strong>Key</strong></td>
<td width="160"><strong>Description</strong></td>
<td width="84"><strong>Important?</strong></td>
<td width="170"><strong>Hide?</strong></td>
</tr>
<tr>
<td width="121">Launch Campaign</td>
<td width="115">Campaign</td>
<td width="120">launch_campaign</td>
<td width="160">Launch a Smart Campaign in Marketo</td>
<td width="84">Checked</td>
<td width="170">Not Checked</td>
</tr>
</tbody>
</table>
Action Fields
<table width="477">
<tbody>
<tr>
<td width="137"><strong>Label</strong></td>
<td width="130"><strong>Key</strong></td>
<td width="95"><strong>Type</strong></td>
<td width="114"><strong>Required?</strong></td>
</tr>
<tr>
<td width="137"><strong>Campaign Id</strong></td>
<td width="130">CampaignId</td>
<td width="95">Unicode</td>
<td width="114">Checked</td>
</tr>
</tbody>
</table>
Where to Send Data

Action Endpoint URL :
<blockquote>https://{{munchkin_account_id}}.mktorest.com/rest/v1/campaigns/{{CampaignId}}/schedule.json</blockquote>
Leave blank the other optional fields.
<h5>Scripting API</h5>
Zapier’s scripting feature allows you to manipulate the requests and responses that are exchanged between your app’s API and Zapier. You can modify HTTP requests just before they are sent and can parse responses before Zapier does anything with them. We need it in order to complete our custom ‘Session Auth’ authentication.  More information is available on the original article.

Copy the following code very similar to the original, we just changed the action methods:
<pre class="lang:default decode:true">var Zap = {
 
 get_session_info: function(bundle) {
 
 console.log('Entering get_session_info method ...');
 
 var access_token,
 access_token_request_payload,
 access_token_response;

 
 // Assemble the meta data for our Access Token swap request
 console.log('building Request with client_id=' + bundle.auth_fields.client_id + ', and client_secret=' + bundle.auth_fields.client_secret);
 access_token_request_payload = {
 method: 'POST',
 url: 'https://' + bundle.auth_fields.munchkin_account_id + '.mktorest.com/identity/oauth/token',
 params: {
 'grant_type' : 'client_credentials',
 'client_id' : bundle.auth_fields.client_id,
 'client_secret' : bundle.auth_fields.client_secret
 },
 headers: {
 'Content-Type': 'application/json', // Could be anything.
 Accept: 'application/json' 
 }
 };

 // Fire off the Access Token request.
 access_token_response = z.request(access_token_request_payload);

 // Extract the Access Token from returned JSON.
 access_token = JSON.parse(access_token_response.content).access_token;
 console.log('New Access_Token=' + access_token);
 
 // This will be mixed into bundle.auth_fields in future calls.
 //bundle.auth_fields.access_token=access_token;
 return {'access_token': access_token};
 },
 
 test_trigger_pre_poll: function(bundle) {
 
 console.log('Entering test_trigger_pre_poll method ...');
 
 bundle.request.params = {
 'access_token':bundle.auth_fields.access_token
 };
 
 return bundle.request;
 
 },
 
 test_trigger_post_poll: function(bundle) {
 
 console.log('Entering test_trigger_post_poll method ...');
 
 var data = JSON.parse(bundle.response.content);
 if ((!data.success)&amp;&amp;((data.errors[0].code=="601")||(data.errors[0].code=="600"))){
 console.log('Access Token expired or invalid, requesting new one - data.success=' + data.success + ', data.errors[0].code=' + data.errors[0].code);
 
 throw new InvalidSessionException(); // Calling get_session_info() to regenerate Access Token
 }

 return JSON.parse(bundle.response.content);
 },
 
 launch_campaign_pre_write: function(bundle) {
 
 bundle.request.params = {'access_token':bundle.auth_fields.access_token}; 
 return bundle.request;
 },

 launch_campaign_post_write: function(bundle) {
 
 var data = JSON.parse(bundle.response.content);
 if ((!data.success)&amp;&amp;((data.errors[0].code=="601")||(data.errors[0].code=="600"))){
 console.log('Access Token expired or invalid, requesting new one - data.success=' + data.success + ', data.errors[0].code=' + data.errors[0].code);
 throw new InvalidSessionException(); // Calling get_session_info() to regenerate Access Token
 }
 return JSON.parse(bundle.response.content);
 }
 
};
</pre>
<h5>New Zap</h5>
From the Zapier Dashboard click the button "Make a new Zap".

<strong>Trigger</strong>
<ul>
 	<li>Pick the "Webhooks by Zapier" Trigger App</li>
 	<li>Check "Catch Hook"</li>
 	<li>No need to pick off a child key</li>
 	<li>Zapier generated a custom webhook URL for you to send requests to, keep it safe somewhere</li>
 	<li>Test the webhook URL, by starting the “IFTTT Applet that calls the Zapier Webhook” scenario below. That will allow Zapier to learn about the webhook payload and to let you assign the campaign Id to the Action</li>
</ul>
<strong>Action</strong>
<ul>
 	<li>Select the Marketo Campaign connector previously created</li>
 	<li>Choose the only action available: <strong>Launch Campaign</strong></li>
 	<li>Connect to your Marketo account, filling up the authentication parameters (Munchkin Account Id, Client Id, Client Secret)</li>
 	<li>Edit the Template and associate the Campaign ID from the Trigger to the "Launch Campaign" Campaign Id parameter</li>
</ul>
<img class="alignnone wp-image-6968 size-full" src="http://developers.marketo.com/wp-content/uploads/2017/06/IFTTTMedia24.jpg" alt="" width="677" height="340" />
<ul>
 	<li>Test the step and check that the Marketo Campaign get launched</li>
</ul>
<h4>IFTTT Applet that Calls the Zapier Webhook</h4>
We start with a simple scenario that is easy to test. We pick in IFTTT a Date &amp; Time trigger that will kick off the Marketo Campaign every hour.

<img class="alignnone wp-image-6969 size-full" src="http://developers.marketo.com/wp-content/uploads/2017/06/IFTTTMedia25.jpg" alt="" width="441" height="384" />

The Action is a web request posting to the Zapier Webhook URL and passing over the Smart Campaign Id.

<img class="alignnone wp-image-6970 size-full" src="http://developers.marketo.com/wp-content/uploads/2017/06/IFTTTMedia26.jpg" alt="" width="323" height="1455" />

Make sure the Zapier Zap and the IFTTT Applet are both active and test everything is working as expected.
<h4>Let’s get Creative with IFTTT</h4>
IFTTT offers Applet Triggers with over 300 partners, so again your portfolio of apps and appliances together with your imagination are the limits …

Let’s take an example with the <a href="https://www.wunderground.com/">Weather Underground</a> service that we are going to use to launch our Marketo campaign on weather alert.

<img class="alignnone wp-image-6971 size-full" src="http://developers.marketo.com/wp-content/uploads/2017/06/IFTTTMedia27.jpg" alt="" width="363" height="252" />

The following trigger would kick-off when a Rain condition is announced.

<img class="alignnone wp-image-6972 size-full" src="http://developers.marketo.com/wp-content/uploads/2017/06/IFTTTMedia28.jpg" alt="" width="322" height="338" />

And then associate the Trigger with the Maker Webhook Action, and just like previously fill in the Zapier webhook parameters.

<img class="alignnone wp-image-6973 size-full" src="http://developers.marketo.com/wp-content/uploads/2017/06/IFTTTMedia29.jpg" alt="" width="318" height="1421" />

Et voila, you just need now a good rain to come to double check this is actually working.
<h2>Conclusion</h2>
We hope you’ll have a lot of fun applying the concepts provided in this article. But most important, we think it will help anybody wanting to integrate Marketo with other 3<sup>rd</sup> party systems, thanks to the key concepts from this article:
<ul>
 	<li>Marketo REST API</li>
 	<li>Marketo Webhooks</li>
 	<li>How to leverage an open web integration platform such as Zapier as a "serving hatch" between a 3<sup>rd</sup> party system and Marketo, to manage the authentication for example</li>
</ul><br/><br/>pdellecase - 2017-06-20<br/><br/><h2>Summer 2017 Updates</h2><br/><br/>In the Summer 2017 release, we are releasing some minor enhancements to our Program APIs.
<h2>Asset APIs</h2>
<h3>Browse Programs</h3>
We are adding the ability to get programs by date range to our <a href="https://developers.marketo.com/rest-api/endpoint-reference/asset-endpoint-reference/#!/Programs/browseProgramsUsingGET">Get Programs</a> endpoint, via the addition of the optional earliestUpdatedAt and latestUpdatedAt parameters.  You can set either or both parameters with the datetime of your choice to return only programs which have been created or updated between the two datetimes. This is useful for retrieving new and updated sets of marketing collateral, most importantly for translation and business intelligence use cases.<br/><br/>kelkington - 1970-01-01<br/><br/><h2>Extend Marketo Business Logic with Google Cloud Functions</h2><br/><br/>This article proposes a solution to extend Marketo with some business logic capabilities with Google Cloud Platform (GCP), based on the following simple example:

3 custom fields on the Marketo Lead record:
<ul>
 	<li><strong>OnLinePreference</strong>: an incremental score that indicates a prospect/customer appetence for online communications.</li>
 	<li><strong>OfflinePreference</strong>: an incremental score that indicates a prospect/customer appetence for offline communications.</li>
 	<li><strong>Preference</strong>: a field computed by GCP that displays “offline’ if the offline score is higher than the online one, and “online” the other way around</li>
</ul>
<img class="alignnone wp-image-7052 size-full" src="http://developers.marketo.com/wp-content/uploads/2017/11/GCPFunctions8.png" alt="" width="474" height="78" />

This technology opens the way for more advanced business logic and eventually for calling out external web services, transforming and consolidating the results in Marketo.

&nbsp;
<h1>About Google Cloud Platform and Functions</h1>
<img class="alignnone size-full wp-image-7044" src="http://developers.marketo.com/wp-content/uploads/2017/11/GCPFunctions0.png" alt="" width="274" height="45" />

<a href="https://cloud.google.com/">Google Cloud Platform</a> (GCP) is a suite of cloud computing services that runs on the same infrastructure that Google uses internally for its end-user products, such as Google Search and YouTube. Alongside a set of management tools, it provides a series of modular cloud services including computing, data storage, data analytics, machine learning, big data and much more.

We could have used many different GCP services for our need, such as Compute Engine, App Engine or Kubernetes Engine, but we opted for the <a href="https://cloud.google.com/functions/">Cloud Functions</a> (still in Beta) for the following main advantages:
<ul>
 	<li>Serverless cloud computing where logic can be spun up on-demand in response to events such as HTTP calls.</li>
 	<li>Relieves most of the pain caused by server maintenance and deployments.</li>
 	<li>Cost effective, as you pay GCP only for each function call and not for keeping a server up and running.</li>
 	<li>Simple and fast to implement as you focus only on your application logic.</li>
 	<li>Automatic scaling, ready for very high workloads.</li>
</ul>
Please check <a href="https://cloud.google.com/">GCP web site</a> for more information about this technology and its pricing. Typically, this tutorial should not induce any important cost and will fit perfectly within the free credit of a GCP trial.

&nbsp;
<h1><span lang="EN-US">Preparation of your Google Cloud environment</span></h1>
You need a Google Cloud account. You can try GCP for free with a credit that is more than enough to run this tutorial, just click “Try it free” button on the <a href="https://cloud.google.com/">GCP web site</a>.

Follow all the steps from the section ‘Before you begin’ in the <a href="https://cloud.google.com/functions/docs/tutorials/http">HTTP Tutorial</a> from Google:
<ol>
 	<li>Create a Cloud Platform project: <a href="https://console.cloud.google.com/cloud-resource-manager">GO TO THE MANAGE RESOURCES PAGE</a><img class="alignnone size-medium wp-image-7045" src="http://developers.marketo.com/wp-content/uploads/2017/11/GCPFunctions1-300x182.png" alt="" width="300" height="182" /></li>
 	<li>Enable billing for your project: <a href="https://support.google.com/cloud/answer/6293499#enable-billing">ENABLE BILLING</a></li>
 	<li>Enable the Cloud Functions API: <a href="https://console.cloud.google.com/flows/enableapi?apiid=cloudfunctions&amp;redirect=https://cloud.google.com/functions/docs/tutorials/http">ENABLE THE API</a></li>
 	<li><a href="https://cloud.google.com/sdk/docs/">Install and initialize the Cloud SDK</a></li>
 	<li>Update and install gcloud components
<table>
<tbody>
<tr>
<td><span style="color: #008000"><strong>gcloud components update &amp;&amp;</strong></span>

<span style="color: #008000"><strong>gcloud components install beta</strong></span></td>
</tr>
</tbody>
</table>
</li>
 	<li>Prepare your environment for Node.js development: <a href="https://cloud.google.com/nodejs/docs/setup">GO TO THE SETUP GUIDE</a></li>
</ol>
&nbsp;
<h1><span lang="EN-US">Implementation of the scoreCompare Cloud Function</span></h1>
<ol>
 	<li>Create a Cloud Storage bucket to stage your Cloud Functions files. You can do it with the command line:
<table style="width: 536px">
<tbody>
<tr>
<td style="width: 521px"><strong><span style="color: #008000">gsutil mb gs://[YOUR_STAGING_BUCKET_NAME]</span></strong></td>
</tr>
</tbody>
</table>
or from the Google Cloud web interface, by selecting your project and clicking the Storage menu:
<ul>
 	<li>Give your Storage bucket a unique name</li>
 	<li>Select the default storage class</li>
 	<li>Select the best suited regional location<img class="alignnone wp-image-7048 size-full" src="http://developers.marketo.com/wp-content/uploads/2017/11/GCPFunctions4.png" alt="" width="499" height="411" /></li>
</ul>
</li>
 	<li>Create a directory on your local system for the application code.</li>
 	<li>Create an ‘index.js’ file in this directory with the following JavaScript code: the code is really simple to understand. It parses the two input parameters from the HTTP request body in JSON, does the processing and encodes in JSON the HTTP response.</li>
 	<li>
<pre class="lang:default decode:true">/**
 * HTTP scoreCompare Cloud Function.
 *
 * @param {Object} req Cloud Function request context.
 * @param {Object} res Cloud Function response context.
 */
exports.scoreCompare = function scoreCompare (req, res) {
 var onlineScore=parseInt(req.body.onlineScore);
 var offlineScore=parseInt(req.body.offlineScore); 
 console.log('/scoreCompare: got values onlineScore =' + onlineScore + ', offlineScore =' + offlineScore);
 var result;
 if (onlineScore&gt;offlineScore) {result = 'online';} else {result = 'offline';}
 console.log('/scoreCompare: and result is ' + result);
 res.status(200).json({output: result}).end();
};
</pre>
Deploy the function scoreCompare with an HTTP trigger. Run the following command from your directory:
<table style="width: 516px">
<tbody>
<tr>
<td style="width: 501px"><span style="color: #008000"><strong>gcloud beta functions deploy [FUNCTION] --stage-bucket [YOUR_STAGING_BUCKET_NAME] --trigger-http</strong></span></td>
</tr>
</tbody>
</table>
where [YOUR_STAGING_BUCKET_NAME] is the name of your staging Cloud Storage bucket.

In our example:
<table>
<tbody>
<tr>
<td><strong><span style="color: #008000">gcloud beta functions deploy scoreCompare --stage-bucket mktostorage --trigger-http</span></strong></td>
</tr>
</tbody>
</table>
</li>
 	<li>Note the Cloud Function URL (httpsTrigger URL) from the console output, that looks like this: <strong>https://[YOUR_REGION]-[YOUR_PROJECT_ID].cloudfunctions.net/[FUNCTION] </strong>where
<ul>
 	<li>[YOUR_REGION] is the region where your function is deployed. This is visible in your terminal when your function finishes deploying.</li>
 	<li>[YOUR_PROJECT_ID] is your Cloud project ID. This is visible in your terminal when your function finishes deploying.</li>
 	<li>[FUNCTION] is your function name.</li>
</ul>
In our example:

<a href="https://us-central1-marketo-cloud-logic.cloudfunctions.net/scoreCompare"><strong>https://us-central1-marketo-cloud-logic.cloudfunctions.net/scoreCompare</strong></a></li>
 	<li>Test your function with a tool like <a href="https://www.getpostman.com/">Postman</a>:
<ul>
 	<li>HTTP Verb: POST</li>
 	<li>URL: <a href="https://us-central1-marketo-cloud-logic.cloudfunctions.net/scoreCompare">https://us-central1-marketo-cloud-logic.cloudfunctions.net/scoreCompare</a></li>
 	<li>Headers: content-type = application/json</li>
 	<li>Body: {“onlineScore”:110, “offlineScore”:200}Output should give: {“output”: “offline”}.</li>
</ul>
</li>
</ol>
<h1><span lang="EN-US">Call the Cloud Function from a Marketo’s Webhook</span></h1>
The three following custom fields must be created on the Lead record in Marketo:
<ul>
 	<li><strong>OnlinePreference</strong>: Integer</li>
 	<li><strong>OfflinePreference</strong>: Integer</li>
 	<li><strong>Preference</strong>: String</li>
</ul>
Create the following webhook from the Marketo admin interface by using your ‘scoreCompare’ cloud function URL and the custom field’s tokens:

<img class="alignnone wp-image-7049 size-full" src="http://developers.marketo.com/wp-content/uploads/2017/11/GCPFunctions5.png" alt="" width="589" height="556" />

Test the webhook with a Marketo triggered smart campaign. A smart list and flow are showed here after, as an example:

<img class="alignnone wp-image-7050 size-full" src="http://developers.marketo.com/wp-content/uploads/2017/11/GCPFunctions6.png" alt="" width="568" height="255" />

<img class="alignnone wp-image-7051 size-full" src="http://developers.marketo.com/wp-content/uploads/2017/11/GCPFunctions7.png" alt="" width="575" height="186" />
<ul>
 	<li><strong>Marketo webhooks can only be invoked from triggered smart campaigns, not batch smart campaigns.</strong></li>
 	<li><strong>If you do not use your cloud function, delete it or delete the whole project, in order to avoid incurring charges to your Google Cloud Platform account.</strong></li>
</ul>
&nbsp;
<h1><span lang="EN-US">Conclusion</span></h1>
We hope this tutorial was worth your time and that it will make you think about more advanced scenarios involving complex processing and 3<sup>rd</sup> party services.

A good example would be to leverage Google Cloud AI, the machine learning services from Google. You could, for example, parse some free text from a Marketo form and ask Google Natural Language API to reveal the structure and meaning of the text and then save back this analysis in Marketo; just opening the floodgates for ideas.<br/><br/>pdellecase - 2017-11-21<br/><br/><h2>Fall 2017 Updates</h2><br/><br/>In the Fall 2017 release, we are releasing several enhancements to our Asset APIs.  See the full list of updates below.
<h2>Asset APIs</h2>
<h4>Browse Programs by Date Range</h4>
We have added the ability to get programs by date range to our <a href="https://developers.marketo.com/rest-api/endpoint-reference/asset-endpoint-reference/#!/Programs/browseProgramsUsingGET">Get Programs</a> endpoint.  This is done using the <strong>earliestUpdatedAt</strong> and <strong>latestUpdatedAt</strong> parameters.  You can set either or both parameters with the datetime of your choice to return only programs which have been created or updated between the two datetimes.
<h4>Preview Email</h4>
You many now preview an email using the <a href="/rest-api/endpoint-reference/asset-endpoint-reference/#!/Emails/getEmailFullContentUsingGET">Get Email Full Content</a> endpoint, which returns the serialized HTML version of an email.  All tokens, snippets, dynamic content, and embedded components are fully rendered.  An optional <strong>leadId</strong> parameter may be passed to impersonate a given lead.
<h4>Replace HTML of Email 2.0</h4>
We have added the <a href="/rest-api/endpoint-reference/asset-endpoint-reference/#!/Emails/createEmailFullContentUsingPOST">Update Email Full Content</a> endpoint to allow you to replace blocks of HTML email content.  If you edit the HTML code of a Marketo email using the Marketo Email 2.0 Editor, then the relationship between the email and its template is broken, more about that <a href="https://docs.marketo.com/display/DOCS/Edit+an+Email%27s+HTML">here</a>.  Using this endpoint, you can programmatically update the HTML contents of an email whose relationship has been broken.

In addition, we have modified all other email lifecycle-related endpoints to be compatible with emails where the relationship has been broken:
<ul>
 	<li>Approve Email Draft</li>
 	<li>Unapprove Email</li>
 	<li>Delete Email</li>
 	<li>Discard Email Draft</li>
 	<li>Clone Email</li>
 	<li>Update Email Metadata</li>
</ul>
<h2>Other Enhancements</h2>
<h4>Bulk Extract</h4>
<ul>
 	<li>The maximum time span for date range filters has been increased to 31 days.  This pertains to <a href="http://developers.marketo.com/rest-api/bulk-extract/bulk-lead-extract/#filters">Bulk Lead Extract filters</a> (createdAd or updatedAt), and <a href="http://developers.marketo.com/rest-api/bulk-extract/bulk-activity-extract/#filters">Bulk Activity Extract filter</a> (createdAt).</li>
</ul>
<h4>Developer Site - Download Swagger Definition</h4>
<ul>
 	<li>Fixed several "semantic errors" that were generated by  <a href="https://editor.swagger.io/">Swagger Editor</a> when using definitions <a href="/rest-api/endpoint-reference/download-swagger-definition/">downloaded</a> from Marketo Developers.</li>
</ul><br/><br/>marketohost - 2017-12-15<br/><br/><h2>TEST - External video link on Community</h2><br/><br/><a href="https://nation.marketo.com/videos/2215-email-deliverability-power-pack-tutorial-video">Email Deliverability Power Pack Tutorial Video</a>

&nbsp;<br/><br/>marketohost - 1970-01-01<br/><br/><h2>Winter 2018 Updates</h2><br/><br/>In the Winter 2018 release, we are releasing a few enhancements to our APIs.  See the full list of updates below.
<h2>Asset APIs</h2>
<h4>Activate/Deactivate Trigger Campaigns</h4>
We have added the ability to activate and deactivate trigger campaigns, which can simplify the process of automating your program templates. This is achieved by calling two newly added endpoints: <a href="http://developers.marketo.com/rest-api/endpoint-reference/asset-endpoint-reference/#!/Smart_Campaigns/activateSmartCampaignUsingPOST">Activate Smart Campaign</a>, <a href="http://developers.marketo.com/rest-api/endpoint-reference/asset-endpoint-reference/#!/Smart_Campaigns/deactivateSmartCampaignUsingPOST">Deactivate Smart Campaign</a>.  See Trigger section in <a href="/rest-api/assets/campaigns">Campaigns</a> documentation for details.
<h4>Get Program by Name</h4>
Added two parameters to <a href="/rest-api/endpoint-reference/asset-endpoint-reference/#/Programs/getProgramByNameUsingGET">Get Program by Name</a> endpoint to facilitate retrieval of program costs and program tags.  See <strong>includeCosts</strong> and <strong>includeTags</strong> parameters in <a href="/rest-api/assets/programs/#by_name">Programs</a> documentation for details.
<h2>Other Enhancements</h2>
<h4>Bulk Extract</h4>
The Bulk Extract API is now "workspace aware".  When you create an API-Only User for a <a href="/rest-api/custom-services/">Custom Service</a>, you must select a User Role with API Access for one or more workspaces.  Previously, the Custom Service was granted access to all workspaces.  Now, the Custom Service is granted access to only the workspace(s) that were selected during API-Only User creation.<br/><br/>marketohost - 2018-03-02<br/><br/><h2>Spring 2018 Updates</h2><br/><br/>In the Spring 2018 release we are releasing new REST APIs, and web tracking privacy enhancements.  See the full list of updates below.
<h2>REST API</h2>
<h4>Static List CRUD</h4>
Allows users to remotely Create, Read, Update, and Delete Static List Records.  Enables management of the entire lifecycle of a static list through REST APIs, including populating and maintaining membership.  Details can be found <a href="/rest-api/assets/static-lists/">here</a>.
<h4>Custom Activity Metadata</h4>
Allows users to remotely create Custom Activity Records.  Enables management of the entire lifecycle of custom activities through REST APIs, including manipulation of types and type attributes .  Details can be found <a href="/rest-api/lead-database/activities/">here</a>.
<h4>Smart List Metadata</h4>
Allows users to remotely Read, Clone, and Delete Smart List Records.  Enables management of smart lists through REST APIs.  Details can be found <a href="/rest-api/assets/smart-lists/">here</a>.
<h2>Web Tracking Privacy</h2>
The Munchkin JavaScript web tracking code has been enhanced to include the following privacy-related enhancements:
<ul>
 	<li>Opt-Out - Ability to allow visitors to permantly opt-out of web tracking.  Details can be found <a href="/javascript-api/lead-tracking/#opt_out">here</a>.</li>
 	<li>IP Address Anonymization - Comply with local and international privacy regulations by providing ability to anonymize the IP addresses of web visitors.  See <strong>anonymizeIP</strong> configuration parameter <a href="/javascript-api/lead-tracking/configuration/">here</a>.</li>
</ul>
<h2>Other Enhancements</h2>
<h4>REST API</h4>
<ul>
 	<li>The <a href="/rest-api/endpoint-reference/asset-endpoint-reference/#!/Folders/getFolderUsingGET">Get Folders</a> endpoint now returns all folders when a non-root parent and maxDepth=1 are specified.</li>
 	<li>The <a href="http://developers.marketo.com/rest-api/endpoint-reference/asset-endpoint-reference/#!/Landing_Pages/getLandingPageByIdUsingGET">Get Landing Page by Id</a> endpoint now returns URL attributes with the protocol in all cases (http:// or https://).</li>
</ul><br/><br/>marketohost - 2018-06-29<br/><br/><h2>Summer 2018 Updates</h2><br/><br/>The Summer 2018 release is primarily a maintenance release comprised of minor enhancements, and defect resolutions.  See the full list of updates below.
<h2>REST API</h2>
<h4>Enhancements</h4>
<ul>
 	<li>Added support for Email Disposition fields that were unnecessarily omitted originally.  These fields will now be available for reading and writing over REST, as appropriate.
<ul>
 	<li>Black Listed</li>
 	<li>Marketing Suspended</li>
 	<li>Email Suspended</li>
 	<li>Relative Urgency</li>
</ul>
</li>
 	<li>The <a href="/rest-api/endpoint-reference/lead-database-endpoint-reference/#/Leads/getLeadsByFilterUsingGET">Get Leads by Filter Type</a> endpoint now supports leadPartionId as a filterType.</li>
</ul>
<h4>Defect Resolutions</h4>
<table style="width: 852px;">
<tbody>
<tr>
<td style="width: 254px;"><strong>REST Endpoint</strong></td>
<td style="width: 571px;"><strong>Description</strong></td>
</tr>
<tr>
<td style="width: 254px;"><a href="/rest-api/endpoint-reference/asset-endpoint-reference/#/Programs/approveProgramUsingPOST">Approve Program</a></td>
<td style="width: 571px;">If you had set Block Non-Operational Emails to false when creating the program, a call to Approve Program would reset to true.</td>
</tr>
<tr>
<td style="width: 254px;"><a href="/rest-api/bulk-extract/">Bulk Extract</a></td>
<td style="width: 571px;">Certain Unicode characters were corrupted in extract output file.</td>
</tr>
<tr>
<td style="width: 254px;"><a href="/rest-api/endpoint-reference/asset-endpoint-reference/#!/Programs/cloneProgramUsingPOST">Clone Program</a></td>
<td style="width: 571px;">
<ul>
 	<li>If you cloned Email Program, then the SmartList filter logic was reset to "All" in the resulting program regardless of initial setting.</li>
 	<li>If you tried to clone a program that had contained a static list (that was deleted), then you received a 709, "The following assets are unsupported:List" error.</li>
 	<li>If you tried to clone a program across workspaces, then you received a 611, "Unable to clone program" error.</li>
</ul>
</td>
</tr>
<tr>
<td style="width: 254px;"><a href="/rest-api/endpoint-reference/asset-endpoint-reference/#!/Static_Lists/getStaticListByIdUsingGET">Get Static List by Id</a></td>
<td style="width: 571px;">If your Custom Service had Read-Only Asset role permission, then you would received a 603, "Access denied" error.</td>
</tr>
<tr>
<td style="width: 254px;"><a href="/rest-api/endpoint-reference/lead-database-endpoint-reference/#/Leads/pushToMarketoUsingPOST">Push Lead to Marketo</a></td>
<td style="width: 571px;">If <strong>cookies</strong> attribute was specified in <strong>input</strong> array lead object, prior anonymous activity was not associated with newly created Lead.</td>
</tr>
<tr>
<td style="width: 254px;"><a href="/rest-api/endpoint-reference/lead-database-endpoint-reference/#/Campaigns/scheduleCampaignUsingPOST">Schedule Campaign</a></td>
<td style="width: 571px;">If you specified a <strong>runAt</strong> date far into the future, then the campaign was never run and <strong>success=true</strong> was returned.  Now if the <strong>runAt</strong> date is farther than 2 years into the future, an error is returned (<a href="/rest-api/error-codes/#1042">1042</a>).</td>
</tr>
<tr>
<td style="width: 254px;"><a href="/rest-api/endpoint-reference/lead-database-endpoint-reference/#!/Leads/syncLeadUsingPOST">Sync Leads</a></td>
<td style="width: 571px;">If you specified <strong>action=createDuplicate</strong> and an <strong>externalCompanyId</strong> parameter (to associate the new Lead with an existing Company), then the Lead was associated with an empty Company (instead of the specified Company).</td>
</tr>
</tbody>
</table>
<h4>Miscellaneous</h4>
<ul>
 	<li>Removed the following Data Change Value from all endpoint responses: mktoClientReqId.  This was for internal use only.</li>
</ul>
<h2>Developer Site</h2>
<ul>
 	<li>Added error lookup functionality.  Enter a REST API error code into the search box and select from autocomplete list underneath to jump to error description.</li>
</ul>
<img class="alignnone wp-image-7316 size-full" src="http://developers.marketo.com/wp-content/uploads/2018/10/post-error-autocomplete-1.png" alt="" width="679" height="354" />

<img class="alignnone wp-image-7317 size-full" src="http://developers.marketo.com/wp-content/uploads/2018/10/post-error-autocomplete-2.png" alt="" width="1143" height="284" />
<ul>
 	<li>Added <a href="/rest-api/endpoint-reference/endpoint-index/">Endpoint Index</a> page.  This is a sortable list of all REST API endpoints in one place.  You can also use this page to generate the minimal set of permissions needed by your application.  This comes in handy when creating a Custom Service.<img class="alignnone wp-image-7333 size-full" src="http://developers.marketo.com/wp-content/uploads/2018/10/post-endpoint-index-permissions.png" alt="" width="830" height="259" /></li>
</ul><br/><br/>deverly - 2018-10-12<br/><br/><h2>Fall 2018 Updates</h2><br/><br/>The Fall 2019 release is primarily a maintenance release comprised of minor enhancements, and defect resolutions.  See the full list of updates below.
<h2>REST API</h2>
<h4>Enhancements</h4>
<ul>
 	<li>Added <a href="https://docs.marketo.com/display/DOCS/Email+CC">Email CC Fields</a> support for <a href="/rest-api/assets/">Asset API</a>.  CC Field settings are propagated as expected during approval/clone operations (Email or Email Template draft approval,  Email or Program clone).  All Email-related endpoints now  return CC Fields values in the <strong>ccFields</strong> property.  Scroll down in the response below to see an example.  This change affects the following endpoints: <a href="/rest-api/endpoint-reference/asset-endpoint-reference/#!/Emails/getEmailByIdUsingGET">Get Email by ID</a>, <a href="/rest-api/endpoint-reference/asset-endpoint-reference/#/Emails/getEmailByNameUsingGET">Get Email by Name</a>, <a href="/rest-api/endpoint-reference/asset-endpoint-reference/#!/Emails/getEmailUsingGET">Get Emails</a>, <a href="/rest-api/endpoint-reference/asset-endpoint-reference/#!/Emails/approveDraftUsingPOST">Approve Email Draft</a>, <a href="/rest-api/endpoint-reference/asset-endpoint-reference/#!/Email_Templates/approveDraftUsingPOST_1">Approve Email Template Draft</a>, <a href="/rest-api/endpoint-reference/asset-endpoint-reference/#!/Emails/cloneEmailUsingPOST">Clone Email</a>, <a href="/rest-api/endpoint-reference/asset-endpoint-reference/#!/Programs/cloneProgramUsingPOST">Clone Program.</a></li>
</ul>
<pre class="lang:default mark:44-63 decode:true " title="Response">{
    "success": true,
    "errors": [],
    "requestId": "cc96#166e836348b",
    "warnings": [],
    "result": [
        {
            "id": 2061,
            "name": "Test Email",
            "description": "This is a test",
            "createdAt": "2018-11-06T05:27:10Z+0000",
            "updatedAt": "2018-11-06T08:33:16Z+0000",
            "url": "https://app-sjqe.marketo.com/#EM2061A1LA1",
            "subject": {
                "type": "Text",
                "value": "This is a test with CC Fields"
            },
            "fromName": {
                "type": "Text",
                "value": "Tommy Tester"
            },
            "fromEmail": {
                "type": "Text",
                "value": "tommy.tester@marketo.com"
            },
            "replyEmail": {
                "type": "Text",
                "value": "tommy.tester@marketo.com"
            },
            "folder": {
                "type": "Program",
                "value": 7494,
                "folderName": "Initiative"
            },
            "operational": false,
            "textOnly": false,
            "publishToMSI": false,
            "webView": false,
            "status": "approved",
            "template": 1218,
            "workspace": "Default",
            "version": 2,
            "autoCopyToText": true,
            "ccFields": [
                {
                    "attributeId": "855",
                    "objectName": "lead",
                    "displayName": "emailcc",
                    "apiName": "emailcc"
                },
                {
                    "attributeId": "857",
                    "objectName": "lead",
                    "displayName": "leadDetails",
                    "apiName": "leadDetails"
                },
                {
                    "attributeId": "859",
                    "objectName": "company",
                    "displayName": "headquarters",
                    "apiName": "headquarters"
                }
            ]
        }
    ]
}</pre>
<ul>
 	<li>Added the <a href="/rest-api/endpoint-reference/lead-database-endpoint-reference/#!/Leads/describeUsingGET_6">Describe2</a> endpoint to provide a comprehensive list of fields that are searchable when using <a href="/rest-api/endpoint-reference/lead-database-endpoint-reference/#!/Leads/getLeadsByFilterUsingGET">Get Leads by Filter Type</a> endpoint.</li>
</ul>
<h4>Defect Resolutions</h4>
<ul>
 	<li>Adjusted <a href="https://docs.marketo.com/display/DOCS/Add+Multiple+Branding+Domains">Multiple Branding Domains</a> support for <a href="/rest-api/assets/">Asset API</a>.  Previously, Multiple Branding Domains settings were not propagated when approving an Email draft, cloning an Email, or cloning a Program. This has been corrected.  This change affects the following endpoints: <a href="/rest-api/endpoint-reference/asset-endpoint-reference/#/Emails/approveDraftUsingPOST">Approve Email Draft</a>, <a href="/rest-api/endpoint-reference/asset-endpoint-reference/#/Emails/cloneEmailUsingPOST">Clone Email</a>, <a href="/rest-api/endpoint-reference/asset-endpoint-reference/#/Programs/cloneProgramUsingPOST">Clone Program.</a></li>
</ul>
<h2>Lead Tracking (Munchkin v155 Beta)</h2>
<h4>Enhancements</h4>
<ul>
 	<li>Added <a href="/javascript-api/lead-tracking/configuration/#apionly">apiOnly</a> configuration setting.  By default, web pages that contain the Munchkin tag fire a “Visits Web Page” event when the web page is loaded in the browser. In some cases, this is undesirable.  For example, single page web applications that need full control of when this event is fired.  To support this use case, we added a new <strong>apiOnly</strong> configuration setting.  When set to true, the Munchkin tag does not generate a “Visits Web Page” activity during page load.</li>
 	<li>Added <a href="/javascript-api/lead-tracking/configuration/#domainselectorv2">domainSelectorV2</a> configuration setting.  By default, the Munchkin tag doesn't correctly handle web pages that are hosted on sites with two-letter <a href="https://en.wikipedia.org/wiki/Country_code_top-level_domain">country code top-level domains</a> (examples: .io, .co, .ly).  This causes the Munchkin cookie domain attribute to be set incorrectly.  To achieve a better out of box experience, we added a new <strong>domainSelectorV2</strong> configuration setting.  When set to true, an improved algorithm is used to automatically set the Munchkin cookie domain attribute.</li>
</ul>
<h4>Defect Resolutions</h4>
<ul>
 	<li>Adjusted <a href="/javascript-api/lead-tracking/#opt_out">Opt-Out</a> cookie domain.  In certain cases, the domain attribute of the Munchkin Opt-Out cookie (mkto_opt_out) was set incorrectly.  The Munchkin Opt-Out cookie now uses the same logic as the Munchkin cookie (_mkto_trk) to determine the domain cookie attribute, including honoring the <strong>domainLevel</strong> configuration setting.</li>
</ul>
<h2>Mobile SDK</h2>
<h4>Firebase Cloud Messaging Support</h4>
<ul>
 	<li>Android application developers can now directly use Google’s <a href="http://firebase.google.com/docs/cloud-messaging/">Firebase Cloud Messaging</a> (FCM) with this SDK.  Details can be found <a href="/mobile/installation/#android_firebase_cloud_messaging_support">here</a>.</li>
</ul><br/><br/>deverly - 2018-12-07<br/><br/><h2>Spring 2019 Updates</h2><br/><br/>The Spring 2019 release is primarily a maintenance release comprised of minor enhancements, and defect resolutions.  See the full list of updates below.
<h2>REST API</h2>
<h4>Enhancements</h4>
<ul>
 	<li>Added two new Smart Campaign endpoints: <a href="/rest-api/assets/campaigns/#by_id">Get Smart Campaign by Id</a> , <a href="/rest-api/assets/campaigns/#browse">Get Smart Campaigns</a>.  Use these endpoints to lookup Smart Campaign records.  Note that these two new Asset API endpoints supersede these two Lead API legacy endpoints: <a href="/rest-api/endpoint-reference/lead-database-endpoint-reference/#/Campaigns/getCampaignByIdUsingGET">Get Campaign by Id</a>, <a href="/rest-api/endpoint-reference/lead-database-endpoint-reference/#!/Campaigns/getCampaignsUsingGET">Get Campaigns</a>.   The new endpoints provide richer information, the ability to filter results using time range, and the ability to lookup  system background  campaigns (such as those created by Email Programs).  Using the legacy endpoints on background campaigns would return 1013, "Campaign not found" error.</li>
 	<li>Added new Email endpoint: <a href="/rest-api/endpoint-reference/asset-endpoint-reference/#!/Emails/getEmailCCFieldsUsingGET">Get Email CC Fields</a>.  Use this endpoint to retrieve the set of fields enabled for Email CC in the target instance.</li>
</ul>
<h4>Defect Resolutions</h4>
<ul>
 	<li style="list-style-type: none;">
<ul>
 	<li>Fixed issue with <a href="/rest-api/endpoint-reference/asset-endpoint-reference/#/Emails/cloneEmailUsingPOST">Clone Email</a> and <a href="/rest-api/endpoint-reference/asset-endpoint-reference/#!/Emails/updateEmailContentUsingPOST">Update Email Content</a> endpoints where they would return 611, "System error" if the email template contained mktoDefaultSnippetId attribute.</li>
 	<li>Fixed issue with <a href="/rest-api/endpoint-reference/asset-endpoint-reference/#!/Emails/approveDraftUsingPOST">Approve Email Draft</a> endpoint where it would return 611. "System error" when email template contained no components.</li>
 	<li>Fixed issue with <a href="/rest-api/endpoint-reference/lead-database-endpoint-reference/#!/Opportunities/syncOpportunitiesUsingPOST">Sync Opportunities</a> endpoint where it would return a 611, "Failed to sync opportunity" when specifying a non-existent ExternalSalesPersonID.  The endpoint now returns 718, "ExternalSalesPersonID not found" in this case.</li>
 	<li>Fixed issue with <a href="/rest-api/endpoint-reference/asset-endpoint-reference/#!/Programs/cloneProgramUsingPOST">Clone Program</a> endpoint when the source program contained smart campaign with a local static list.  After being cloned, the newly created destination program would contain static list references to the source program rather than the destination program.</li>
</ul>
</li>
</ul><br/><br/>deverly - 2019-03-19<br/><br/><h2>August 2019 Updates</h2><br/><br/>In August 2019 we are releasing new REST APIs, enhancing existing APIs, and resolving defects.  See the full list of updates below.
<h2>REST API</h2>
<h4>Enhancements</h4>
<ol>
 	<li>Enhanced Smart Campaign lifecycle capabilities.  Added new endpoints to allow you to perform the following operations on Smart Campaigns: get by name, create, update, clone, and delete.  Complete information can be found <a href="/rest-api/assets/smart-campaigns/">here</a>.</li>
 	<li>Enhanced Smart List endpoints to improve query capabilities.
<ol>
 	<li><a href="/rest-api/endpoint-reference/asset-endpoint-reference/#/Smart_Lists/getSmartListByIdUsingGET">Get Smart List by Id</a> endpoint now returns Smart List rule descriptions (triggers and filters) when you pass the <strong>includeRules</strong> boolean parameter.</li>
 	<li><a href="/rest-api/endpoint-reference/asset-endpoint-reference/#/Smart_Lists/getSmartListsUsingGET">Get Smart Lists</a> endpoint now allows you to filter the results by date range when you pass the <strong>earliestUpdatedAt</strong> and <strong>latestUpdatedAt </strong>datetime parameters.   Additionally, this endpoint now returns Smart Lists that are members of campaigns and email programs.</li>
</ol>
</li>
 	<li>Added endpoints for extracting Smart List definitions.
<ol>
 	<li>Get <a href="/rest-api/endpoint-reference/asset-endpoint-reference/#/Smart_Campaigns/getSmartListBySmartCampaignIdUsingGET">Smart List by Smart Campaign Id</a> endpoint returns the smart list record for a given smart campaign id.</li>
 	<li>Get <a href="/rest-api/endpoint-reference/asset-endpoint-reference/#/Programs/getSmartListByProgramIdUsingGET">Smart List by Program Id</a> endpoint returns the smart list record for a given program id.</li>
</ol>
</li>
 	<li>Enhanced the <a href="/rest-api/endpoint-reference/asset-endpoint-reference/#!/Emails/updateEmailContentUsingPOST">Update Email Content</a> endpoint to allow updates to email header fields for emails that have been broken from their template (subject, from name, from email, reply to).  Broken from template is described <a href="https://docs.marketo.com/display/public/DOCS/Edit+an+Email%27s+HTML#EditanEmail'sHTML-BreakinganEmailFromitsTemplate">here</a>.</li>
</ol>
<h4>Defect Resolutions</h4>
<ol>
 	<li>Fixed issue where calling <a href="https://developers.marketo.com/rest-api/endpoint-reference/asset-endpoint-reference/#!/Landing_Pages/deleteLandingPageByIdUsingPOST">Delete Landing Page</a> on an approved landing page would delete the landing page.  It now correctly returns a "709, Approved landing page cannot be deleted" error. [LM-127271]</li>
 	<li>Fixed issue with <a href="/rest-api/endpoint-reference/asset-endpoint-reference/#!/Emails/sendSampleEmailUsingPOST">Send Sample Email</a> endpoint where it would return 611. “System error” when email had been broken from it's template.  [LM-127288]</li>
 	<li>Fixed issue with <a href="/rest-api/endpoint-reference/asset-endpoint-reference/#!/Programs/deleteProgramUsingPOST">Delete Program</a> endpoint where in some cases it would delete an in-use program instead of issuing a "709, Cannot delete program. The assets are in use elsewhere or not deletable" error. [LM-125431]</li>
</ol>
<h2>Deprecations</h2>
<ol>
 	<li>API support for Email Editor 1.0 is scheduled to be deprecated January 2020. Please remember to convert your assets to 2.0 before then.  Attempts to write to or clone Email 1.0 assets after January will result in errors instead of warnings. Learn more about Email APIs <a href="https://nation.marketo.com/docs/DOC-3628-email-20-and-email-api-faqs">here</a>.</li>
 	<li>To align with Adobe’s world-class standard for security, we will be deprecating support for Transport Layer Security (TLS) 1.0 and 1.1 starting December 13, 2019. Systems integrating with Marketo that are not compliant with 1.2 protocol could potentially lose access to Marketo Engage services. To maintain your Marketo Engage access, please ensure that all client systems are TLS 1.2 compliant before December 13, 2019. More detailed information can be found <a href="https://nation.marketo.com/docs/DOC-7059-tls-10-11-deprecation-faq">here</a>.</li>
</ol>
<h2>Developer Site</h2>
<ol>
 	<li>All Smart Campaign related content now resides in the <a href="/rest-api/assets/smart-campaigns/">Smart Campaigns</a> menu item (underneath REST API &gt; Assets).</li>
</ol><br/><br/>deverly - 2019-08-16<br/><br/><h2>January 2020 Updates</h2><br/><br/>In January 2020 we are releasing new REST APIs, enhancing existing APIs, and resolving defects.  See the full list of updates below.
<h2>Lead Database APIs</h2>
<h4>Custom Object Schema Definition</h4>
<ul>
 	<li>Added the ability to programmatically create of Custom Object schema definitions. This allows you to define a custom object once and provision it to as many instances as needed.  This allows you to enable users to effectively leverage sandbox and center-of-excellence models.  Also allows ISVs to simplify the customer onboarding process.  You will need an appropriate subscription type to access Custom Object Metadata API.  For more information see <a href="/rest-api/lead-database/custom-objects/#custom_object_types">Custom Object Types</a>.</li>
</ul>
<h4>Bulk Import/Extract Program Members</h4>
<ul>
 	<li>Added the ability to import and export of Program Members in bulk.  This new set of endpoints follow the existing Marketo REST API pattern for creating asynchronous bulk processing jobs.  Program Member records can contain Program Member custom fields, and/or Lead fields.  For more information see <a href="/rest-api/bulk-import/bulk-program-member-import/">Bulk Program Member Import</a> and <a href="/rest-api/bulk-extract/bulk-program-member-extract/">Bulk Program Member Extract</a>.</li>
</ul>
<h2>Asset APIs</h2>
<h4>Program Member Fields as Form Fields</h4>
<ul>
 	<li>Added <a href="https://developers.marketo.com/rest-api/endpoint-reference/asset-endpoint-reference/#/Form_Fields/getAllProgramMemberFieldsUsingGET">Get Available Form Program Member Fields</a> endpoint to support use of Program Member Custom Fields as Form Fields.  This returns a list of all program member custom fields that can be used in a Marketo Form.</li>
</ul>
<h4>Email Template Dependencies</h4>
<ul>
 	<li>Added <a href="/rest-api/assets/email-templates/#query_email_dependencies">Get Email Template Used By</a> endpoint that returns a  list of email assets that depend on a given email template.  This allows you to quickly understand the impact of a potential email template change, and more easily address these dependencies.</li>
</ul>
<h2>Defect Resolutions</h2>
<ul>
 	<li>Fixed issue where <a href="https://developers.marketo.com/rest-api/endpoint-reference/lead-database-endpoint-reference/#!/Bulk_Import_Custom_Objects/importCustomObjectUsingPOST">Import Custom Objects</a> endpoint would return error "1003, Partition is not part of the given workspace" when using single partition with multiple workspaces and API user had sufficient permissions to perform operation  [LM-130159]</li>
 	<li>When you update and approve an email template, a draft is created for all of its dependent email assets.  If you used <a href="/rest-api/endpoint-reference/asset-endpoint-reference/#!/Emails/approveDraftUsingPOST">Approve Email Draft</a> endpoint to approve said drafts, then the email template updates were not reflected in  subsequent "email preview" or "email send sample" operations.   [LM-130243]</li>
 	<li>Fixed issue where <a href="/rest-api/endpoint-reference/asset-endpoint-reference/#!/Smart_Campaigns/getAllSmartCampaignsGET">Get Smart Campaigns</a> endpoint would return isRequestable = false for Smart Campaigns that were requestable.  [LM-131266]</li>
 	<li>Fixed issue where <a href="https://developers.marketo.com/rest-api/endpoint-reference/asset-endpoint-reference/#!/Tokens/addTokenTOFolderUsingPOST">Create Token</a> endpoint would return error "611, Number token value limited to only numbers" when creating tokens with type = number.  [LM-131189]</li>
 	<li>Fixed issue where <a href="/rest-api/endpoint-reference/asset-endpoint-reference/#/Smart_Lists/cloneSmartListUsingPOST">Clone Smart List</a> endpoint would return error "611, System error" when passed an invalid folder id.  Smart List parent folders must be either a Program or Smart List folder.  [LM-130867]</li>
 	<li>  Fixed issue where <a href="https://developers.marketo.com/rest-api/endpoint-reference/asset-endpoint-reference/#!/Form_Fields/addFieldToAFormUsingPOST">Add Field to Form</a> endpoint to add a single checkbox field would not render in the Marketo Engage UI.  [LM-130124]</li>
 	<li>Fixed issue where <a href="https://developers.marketo.com/rest-api/endpoint-reference/asset-endpoint-reference/#/EmailTemplates/approveDraftUsingPOST_1">Approve Template Draft</a> endpoint would return error "702, {id } There is a problem with the email template content." when mktEditable IDs contained spaces, special characters, or japanese characters.  [LM-130028]</li>
 	<li>Fixed issue where <a href="/rest-api/endpoint-reference/asset-endpoint-reference/#/FormFields/updateFormFieldUsingPOST">Update Form Field</a> endpoint would return error "709, equal operator should have only one value." when updating a multi-value "Select" field type.  [LM-111678]</li>
</ul><br/><br/>deverly - 2020-01-17<br/><br/><h2>How to Retrieve Every Custom Object</h2><br/><br/>We are often asked how to use Marketo's API to get a list of all <a href="https://docs.marketo.com/display/public/DOCS/Marketo+Custom+Objects">custom objects</a> (COs). Querying for COs requires more than its name: some <em>a priori</em> knowledge about each CO is also required. The methods to get that knowledge may not be obvious since the API provides no method for querying it directly. As with many goals in Marketo Engage, Smart Lists provide an answer for COs linked to Persons (Leads). Smart Lists work differently with Companies and you'll end up with a list of all Persons whose Companies are linked to the type of object for the filter so you may find it necessary to deduplicate companies depending on your goals.

Anytime a new Custom Object is approved, an associated filter is created. It will be named in the format "<strong>Has CO NAME</strong>". In the example below, the custom object name is "<strong>Conference Track Subscription"</strong> and its filter is named "<strong>Has Conference Track Subscription</strong>".

<img class="alignnone size-full wp-image-7591" src="http://developers.marketo.com/wp-content/uploads/2020/01/Smart-List-Filter-1.png" alt="" width="1312" height="378" />

Once you have created the Smart List, you can retrieve the information necessary to query for associated COs using the <a href="https://developers.marketo.com/rest-api/lead-database/custom-objects/#query">custom objects endpoint</a>. Export the list ensuring the linked field is included (either ID or email address). You can export using the <a href="https://developers.marketo.com/rest-api/bulk-extract/bulk-lead-extract/">Bulk Lead Extract API</a> filtering by the <strong>smartListName</strong> or <strong>smartListId </strong><a href="#footnote1">(1)</a> filter or <a href="https://docs.marketo.com/display/public/DOCS/Export+People+to+Excel+from+a+List+or+Smart+List">export from the UI</a>. You'll use each linked field value to query associated custom objects individually in the next step.

The custom object's name is <strong>"Conference Track Subscription"</strong> in this example, and its API name is <strong>conferenceTrackSubscription_c</strong>. You'll find the API name both in the UI as "<strong>API Name</strong>" and via the API as "<strong>name</strong>".

Here it is in the UI:

[caption id="attachment_7592" align="alignnone" width="634"]<a href="https://docs.marketo.com/display/public/DOCS/Understanding+Marketo+Custom+Objects"><img class="wp-image-7592 size-full" src="http://developers.marketo.com/wp-content/uploads/2020/01/Conference-Track-Subscription-UI.png" alt="Screen capture of custom object details in Marketo Engage UI" width="634" height="573" /></a> Admin | Marketo Custom Objects[/caption]

And here's a fragment returned by the <a href="https://developers.marketo.com/rest-api/endpoint-reference/lead-database-endpoint-reference/#!/Custom_Objects/listCustomObjectsUsingGET">List Custom Objects API</a> endpoint:
<div>
<pre class="lang:js decode:true" title="custom object list">        {
            "name": "conferenceTrackSubscription_c",
            "displayName": "Conference Track Subscription",
            "description": "Track subscription for conference attendees",
            "createdAt": "2020-01-13T19:50:06Z",
            "updatedAt": "2020-01-13T19:50:06Z",
            "idField": "marketoGUID",
            "dedupeFields": [
                "subscriptionID"
            ],
            "searchableFields": [
                [
                    "subscriptionID"
                ],
                [
                    "marketoGUID"
                ],
                [
                    "leadID"
                ]
            ],
            "relationships": [
                {
                    "field": "leadID",
                    "type": "child",
                    "relatedTo": {
                        "name": "Lead",
                        "field": "Id"
                    }
                }
            ]
        }</pre>
To retrieve the custom objects associated one to one (1:1) or one to many (1:N) with the Persons in your Smart List, make a request like this:

</div>
<div class="crayon-pre">
<div id="crayon-5e1cee1e8ab54038447362-1" class="crayon-line">
<pre class="lang:default decode:true">GET /rest/v1/customobjects/conferenceTrackSubscription_c.json?filterType=leadID&amp;filterValues=1000302,1000303,1000304,1000306,1000307</pre>
In this example, this custom object is linked to Persons by the <strong>leadID</strong> field so the filter type is "<strong>leadID</strong>". The filter values parameter is a comma-separated list of of the IDs taken from the Smart List export. The request may include as many filter values as you can fit in a single request URI: up to 8K characters. Requests exceeding this length will return a 414 HTTP-level error code. The response may be returned in more than one chunk. If so, <strong>moreResult</strong> will be <strong>true</strong> and a <strong>nextPageToken</strong> will be included. You will then need to <a href="https://developers.marketo.com/rest-api/paging-tokens/">page through</a> the results until <strong>moreResult</strong> is <strong>false</strong>.

Here's part of the result for the above API request:
<div>
<pre class="lang:js decode:true">    "result": [
        {
            "seq": 0,
            "marketoGUID": "d6b3ed3d-4eb8-4066-a9cd-184c8d385cfe",
            "leadID": "1000302",
            "subscriptionID": "4ad59184-6bf1-4eeb-a583-d82aeee68210",
            "createdAt": "2020-01-13T21:24:04Z",
            "updatedAt": "2020-01-13T21:24:04Z"
        },
        {
            "seq": 1,
            "marketoGUID": "e5e0aba4-f27f-494d-93ed-9cb580989bf3",
            "leadID": "1000303",
            "subscriptionID": "fc5596d5-6fa2-4848-b4a2-89d96e245c59",
            "createdAt": "2020-01-13T21:24:04Z",
            "updatedAt": "2020-01-13T21:24:04Z"
        },
        {
            "seq": 2,
            "marketoGUID": "e65007cd-86b1-4c17-8d55-057c96e1788a",
            "leadID": "1000304",
            "subscriptionID": "7e54b8a0-2170-4d81-a809-4eac349508d0",
            "createdAt": "2020-01-13T21:24:04Z",
            "updatedAt": "2020-01-13T21:24:04Z"
        },
        {
            "seq": 3,
            "marketoGUID": "39d956b2-85e2-4c24-94e7-e9fa5a09d3d0",
            "leadID": "1000306",
            "subscriptionID": "644c8e5b-fc0c-4d4a-80f8-358a65ce0a68",
            "createdAt": "2020-01-13T21:24:04Z",
            "updatedAt": "2020-01-13T21:24:04Z"
        },
        {
            "seq": 4,
            "marketoGUID": "a2151350-50c8-437f-bc71-7a054bb601f0",
            "leadID": "1000307",
            "subscriptionID": "bf14218c-ae6a-42b3-a14e-f7182903cbcd",
            "createdAt": "2020-01-13T21:24:04Z",
            "updatedAt": "2020-01-13T21:24:04Z"
        }</pre>
</div>
You now have the values for each custom object directly associated with the Persons in your Smart List and beyond retrieving the values, you can use the <strong>marketoGUID</strong> to <a href="https://developers.marketo.com/rest-api/lead-database/custom-objects/#create_and_update">Update</a> or <a href="https://developers.marketo.com/rest-api/lead-database/custom-objects/#delete">Delete</a> these objects.

For custom objects associated with Persons in a many to many relationship (N:N), the above technique will return the first level object which is the intermediary object connecting each Person to multiple second level COs. To retrieve those 2nd level COs, start a new set of queries for the 2nd level CO type by filtering on the link field and the values extracted from the 1st level intermediary object. For example, the above "<strong>Conference Track Subscription"</strong> object could have another level of objects representing sessions called <strong>"Session"</strong> which would probably be linked by the <strong>subscriptionID</strong>. The request to retrieve Sessions linked to the above Conference Track Subscriptions would then look like this:
<pre class="lang:default decode:true">GET /rest/v1/customobjects/session_c.json?filterType=subscriptionID&amp;filterValues=4ad59184-6bf1-4eeb-a583-d82aeee68210,e5e0aba4-f27f-494d-93ed-9cb580989bf3,e65007cd-86b1-4c17-8d55-057c96e1788a,39d956b2-85e2-4c24-94e7-e9fa5a09d3d0,bf14218c-ae6a-42b3-a14e-f7182903cbcd
</pre>
&nbsp;

<hr />

<em>Footnote</em>

<em>1) <strong>smartListName</strong> and <strong>smartListId</strong> filter types are unavailable for some subscriptions. If unavailable for your subscription, you will receive an error when calling the Create Export Lead Job endpoint (<strong>“1035, Unsupported filter type for target subscription”</strong>). Customers may contact Marketo Support to have this functionality enabled in their subscription.</em>

</div>
</div><br/><br/>tmayse - 2020-01-14<br/><br/><h2>How to Retrieve Every Person (Lead)</h2><br/><br/>This is a follow-up to <a href="http://developers.marketo.com/blog/how-to-retrieve-every-custom-object/">How to Retrieve Every Custom Object</a>. We get many inquiries about the processes required to retrieve every person (lead) from a Marketo Engage instance. We have provided many useful answers, but none has been as complete as this one. I have identified a few key concepts needed to extract every lead using Marketo's Bulk Extract API. All the other details can be learned from the demonstration code I created to go with it. After reading this post and exploring the demo code, you will have all the information you need to know to retrieve every lead from a Marketo Engage instance.
<h1>Technique</h1>
<h3>Overview</h3>
The core technique uses the <a href="https://developers.marketo.com/rest-api/bulk-extract/bulk-lead-extract/">Bulk Lead Extract API</a>. You might expect to be able to create a bulk lead export job with no filter, but you can't:<strong> the API requires a filter</strong>. The available filters are <strong>createdAt</strong>, <strong>staticListName</strong>, <strong>staticListId,</strong> <strong>updatedAt</strong>, <strong>smartListName</strong>, and <strong>smartListId</strong>. Filtering by a Smart List with no filters also seems attractive. Try that and you'll find that the system is smart enough to treat a Smart List with no filter the same: the API requires a filter here too. Since we need a filter, the trustworthy and canonical filter to use is <strong>createdAt</strong>. This filter type permits datetime ranges up to 31 days, so we will need to run multiple jobs and combine the results.

We start by finding the oldest possible create date for a lead in the target instance. Starting at that oldest possible date, we'll create jobs spanning 31 days minus one second (more on that later). After creating each job, we will enqueue it and wait for it to complete. Then we'll download the resulting file, and check its integrity using a checksum. And finally, deduplicate leads by ID then write unique leads to an output CSV file.
<h3>Find Your Oldest Lead</h3>
I'm using a little "trick" to get the oldest possible date for a lead in the target instance. There's no API endpoint dedicated to that task, so we need a little creativity. What I do is <a href="https://developers.marketo.com/rest-api/assets/folders/#browse">query all folders</a> with a <strong>maxDepth = 1</strong> which will give us a list of all the top-level folders in the instance. Then I collect the <strong>createdAt</strong> dates, parse them, and find the oldest date. This method works because some default, top-level folders are created with the instance and no leads could be created before then.
<h3>Select Required Fields</h3>
You need to decide which fields you need to extract. Find the available fields for your target instance using the <a href="https://developers.marketo.com/rest-api/endpoint-reference/lead-database-endpoint-reference/#!/Leads/describeUsingGET_6">Describe Lead 2 endpoint</a>. The response to that request will include a list named "fields". Here's an excerpt from an example response:
<div>
<pre class="lang:js decode:true">            "fields": [
                {
                    "name": "AccountSource",
                    "displayName": "Account Source",
                    "dataType": "string",
                    "length": 40,
                    "updateable": true,
                    "crmManaged": false
                },
                {
                    "name": "acquisitionProgramId",
                    "displayName": "Acquisition Program",
                    "dataType": "reference",
                    "updateable": true,
                    "crmManaged": false
                },
                {
                    "name": "Active__c",
                    "displayName": "Active",
                    "dataType": "string",
                    "length": 255,
                    "updateable": true,
                    "crmManaged": false
                },
                {
                    "name": "address",
                    "displayName": "Address",
                    "dataType": "text",
                    "updateable": true,
                    "crmManaged": false
                },
                {
                    "name": "Address_lead",
                    "displayName": "Address (L)",
                    "dataType": "string",
                    "length": 255,
                    "updateable": true,
                    "crmManaged": false
                },
                {
                    "name": "annualRevenue",
                    "displayName": "Annual Revenue",
                    "dataType": "currency",
                    "updateable": true,
                    "crmManaged": false
                },
                {
                    "name": "anonymousIP",
                    "displayName": "Anonymous IP",
                    "dataType": "string",
                    "length": 255,
                    "updateable": true,
                    "crmManaged": false
                }, ...</pre>
This endpoint returns an exhaustive list including both standard and custom fields. The more fields you request, the longer your export job will take to complete and the larger the resulting file will be. You should typically choose just the fields you need. Nothing prevents you from requesting every available field, so that's what I'm demoing. The field identifier required when creating an export job is the <strong>name</strong> value. I will extract the name values to a list of all field names. Then I'll use it to request every available field when I create each export job.
<h3>Export Job Date Ranges: 31 Days Each</h3>
Each export job can span up to 31 days. The demo instance I'm using was created in August of 2016, so I'll need to create a little over 40 jobs today. That's the number of days since the first create date divided by 31 rounded up. The API permits two export jobs to be processing at once so you could extract with two jobs running in parallel. Bulk extract jobs are a resource shared with every other integration, so I'm going to be nice. I leave the other available job for other integrations and will demonstrate running single jobs one after the other.

The dates used for the <strong>createdAt</strong> filter are formatted using the <a href="https://www.w3.org/TR/NOTE-datetime">ISO 8601 specification</a>. They are always in GMT (Z+0000) so the timezone will be simply be represented as "Z" or "+00:00". August 1st, 2016 is <strong><span class="crayon-s">2016-08-01T00:00:00+00:00</span></strong><span class="crayon-s"> and 31 days later is September 1st, 2016 which is <strong>2016-09-01T00:00:00+00:00. </strong>Both start and end times are inclusive, so I'm going to subtract 1 second from that ending time: <strong>2016-09-01T00:00:00+00:00</strong> becomes <strong>2016-08-31T23:59:59+00:00</strong>. Subtracting a second avoids overlapping times. Since GMT is the default, you can also leave the <strong>Z</strong> or <strong>+00:00</strong> off.
</span>
<h3>Deduplication</h3>
</div>
<span class="crayon-s">Even though I've gone to the trouble of avoiding overlapping times, I also implemented de-duplication. I did that since there are some edge cases when times change (<a href="https://en.wikipedia.org/wiki/Daylight_saving_time">Daylight Saving Time</a>) resulting in ambiguous values, and, as a result, Marketo's Bulk Extract API can return otherwise unexpected duplicate leads. It's rare that this happens, but needs to be accounted for in any integration using datetime filter ranges. I removed one second to make clear that times are inclusive. I wouldn't want you to think that creating a job with <strong>createdAt</strong> and <strong>endAt</strong> times of  <strong>2016-08-01T00:00:00Z</strong> and <strong>2016-09-01T00:00:00Z</strong> respectively won't include leads created on <strong>2016-09-01T00:00:00Z</strong>; it will.
</span>
<h1>Execution</h1>
<div>
<h3>Create a Job</h3>
The first step is to create a job using the <a href="https://developers.marketo.com/rest-api/endpoint-reference/lead-database-endpoint-reference/#!/Bulk_Export_Leads/createExportLeadsUsingPOST">Create Export Lead Job endpoint</a>. In this demo, the request to create our first export job looks like this:
<pre class="lang:js decode:true">POST /bulk/v1/leads/export/create.json

{ "filter": {"createdAt": {"startAt": "2016-08-01T00:00:00",
                           "endAt": "2016-09-01T00:00:00"}},
"fields":["AccountSource","acquisitionProgramId","Active__c","address","Address_lead","annualRevenue","anonymousIP","BillingAddress","billingCity","billingCountry","BillingGeocodeAccuracy","BillingLatitude","BillingLongitude","billingPostalCode","billingState","billingStreet","blackListed","blackListedCause","city","CleanStatus","CleanStatus_account","company","CompanyDunsNumber","contactCompany","cookies","country","createdAt","customfield","DandbCompanyId","DandbCompanyId_account","dateOfBirth","dddS","department","doNotCall","doNotCallReason","dS","dueDate","DunsNumber","email","EmailBouncedDate","EmailBouncedReason","emailInvalid","emailInvalidCause","emailSuspended","emailSuspendedAt","emailSuspendedCause","externalCompanyId","externalSalesPersonId","facebookDisplayName","facebookId","facebookPhotoURL","facebookProfileURL","facebookReach","facebookReferredEnrollments","facebookReferredVisits","fax","firstName","gender","GeocodeAccuracy","holll","id","industry","inferredCity","inferredCompany","inferredCountry","inferredMetropolitanArea","inferredPhoneAreaCode","inferredPostalCode","inferredStateRegion","interested","interestedIn","isAnonymous","IsEmailBounced","isLead","iSTRUE","Jigsaw","JigsawCompanyId_account","JigsawContactId_lead","Jigsaw_account","Languages__c","lastName","LastReferencedDate","LastReferencedDate_account","lastReferredEnrollment","lastReferredVisit","LastViewedDate","LastViewedDate_account","Latitude","leadPartitionId","leadPerson","leadRevenueCycleModelId","leadRevenueStageId","leadRole","leadScore","leadSource","leadStatus","linkedInDisplayName","linkedInId","linkedInPhotoURL","linkedInProfileURL","linkedInReach","linkedInReferredEnrollments","linkedInReferredVisits","links","Longitude","MailingAddress","MailingGeocodeAccuracy","MailingLatitude","MailingLongitude","mainPhone","marketingSuspended","marketingSuspendedCause","middleName","mktoAcquisitionDate","mktocomment1","mktocomments2","mktoCompanyNotes","mktoDoNotCallCause","mktoIsCustomer","mktoIsPartner","mktoName","mktoPersonNotes","mktosync","mktotest1","mobile","mobilePhone","NaicsCode","NaicsDesc","newcustom","numberOfEmployees","originalReferrer","originalSearchEngine","originalSearchPhrase","originalSourceInfo","originalSourceType","OtherAddress","OtherGeocodeAccuracy","OtherLatitude","OtherLongitude","personPrimaryLeadInterest","personTimeZone","personType","phone","PhotoUrl","PhotoUrl_account","postalCode","priority","ProductInterest__c","rating","referal","registrationSourceInfo","registrationSourceType","relativeScore","relativeUrgency","requiredNumberofCylinder","salutation","sfdcAccountId","sfdcContactId","sfdcId","sfdcLeadId","sfdcLeadOwnerId","sfdcType","ShippingAddress","ShippingGeocodeAccuracy","ShippingLatitude","ShippingLongitude","sicCode","SicDesc","site","state","surveyAnswers","syndicationId","testBooleanField","testscore","title","totalReferredEnrollments","totalReferredVisits","Tradestyle","twitterDisplayName","twitterId","twitterPhotoURL","twitterProfileURL","twitterReach","twitterReferredEnrollments","twitterReferredVisits","uNSUBSCIBE","unsubscribed","unsubscribedReason","updatedAt","urgency","url","website","YearStarted"]}</pre>
The response will look like this:
<pre class="lang:js decode:true">{
    "requestId": "6902#16fb52118bf",
    "result": [
        {
            "exportId": "4f2b9115-c3f2-4e40-a87c-bf803bbfed99",
            "format": "CSV",
            "status": "Created",
            "createdAt": "2020-01-17T20:10:43Z"
        }
    ],
    "success": true
}</pre>
<h3>Enqueue the Job</h3>
The job is now created but just sitting there doing nothing. To run the job, we'll need to call the <a href="https://developers.marketo.com/rest-api/endpoint-reference/lead-database-endpoint-reference/#!/Bulk_Export_Leads/enqueueExportLeadsUsingPOST">enqueue endpoint</a> using the <strong>exportId</strong> value to build the URI for the request. That will look like this:
<pre class="lang:js decode:true">POST /bulk/v1/leads/export/4f2b9115-c3f2-4e40-a87c-bf803bbfed99/enqueue.json</pre>
There's no body for this POST, we are simply using the POST HTTP verb here. That request will generate a response like this:
<pre class="lang:js decode:true">{
    "requestId": "1836a#16fb5238a48",
    "result": [
        {
            "exportId": "4f2b9115-c3f2-4e40-a87c-bf803bbfed99",
            "format": "CSV",
            "status": "Queued",
            "createdAt": "2020-01-17T20:10:43Z",
            "queuedAt": "2020-01-17T20:13:23Z"
        }
    ],
    "success": true
}</pre>
As I mentioned earlier, you are limited in the number of jobs that can be run at a time. There is also a limit to the number of jobs queued at one time: 10. We need more than 40 so that limit prevents us from creating all the jobs at once. Other integrations can run jobs too, so we need to account for the possibility that all slots are full. Trying to enqueue a new job when there are already 10 queued jobs will generate a <a href="https://developers.marketo.com/rest-api/error-codes/#1029">1029</a> error. When you get a <strong>1029</strong>, use an exponential backoff until the job can be enqueued. I wait 1 minute and double that value each time I get a <strong>1029</strong> error code up to 4 minutes between requests, but never longer than that. This technique is known as <a href="https://devopedia.org/binary-exponential-backoff">Truncated Binary Exponential Backoff</a> and is best practice for recoverable errors and status checks.
<h3>Wait for Job to Complete</h3>
Each job will take some time to run so we will call the <a href="https://developers.marketo.com/rest-api/endpoint-reference/lead-database-endpoint-reference/#!/Bulk_Export_Leads/getExportLeadsStatusUsingGET">status endpoint</a> to monitor its progress. Again, we'll include the <strong>exportId</strong> in the request URI like this:
<pre class="lang:js decode:true">GET /bulk/v1/leads/export/4f2b9115-c3f2-4e40-a87c-bf803bbfed99/status.json</pre>
Before the job is complete, you'll get a response that looks like this:
<pre class="lang:js decode:true ">{
    "requestId": "153cb#16fb525435d",
    "result": [
        {
            "exportId": "4f2b9115-c3f2-4e40-a87c-bf803bbfed99",
            "format": "CSV",
            "status": "Processing",
            "createdAt": "2020-01-17T20:10:43Z",
            "queuedAt": "2020-01-17T20:13:23Z",
            "startedAt": "2020-01-17T20:13:49Z"
        }
    ],
    "success": true
}</pre>
I execute the same exponential backoff (1 minute up to 4 minutes) while the job status is "Queued". The status isn't real-time; it's updated once per minute and there's very little benefit to polling faster. I reset the backoff when the job status changes to "Processing". We are waiting for a status "Completed", which looks like this:
<div>
<pre class="lang:js decode:true">{
    "requestId": "10ad9#16fb5268f9b",
    "result": [
        {
            "exportId": "4f2b9115-c3f2-4e40-a87c-bf803bbfed99",
            "format": "CSV",
            "status": "Completed",
            "createdAt": "2020-01-17T20:10:43Z",
            "queuedAt": "2020-01-17T20:13:23Z",
            "startedAt": "2020-01-17T20:13:49Z",
            "finishedAt": "2020-01-17T20:15:28Z",
            "numberOfRecords": 59,
            "fileSize": 74436,
            "fileChecksum": "sha256:de553362e7ffad6556ae9ea749655c35010c7f0e944fc5a85782183130dca18d"
        }
    ],
    "success": true
}</pre>
The <strong>numberOfRecords</strong> value will be zero when the request returns no leads. I check this value and skip the next steps when that makes sense. When leads are returned, I extract the <strong>fileChecksum</strong> value. We will use it to check the integrity of the file when it's downloaded.
<h3>Get Your Leads</h3>
If the <strong>numberOfRecords</strong> is larger than zero, download the exported file using <a href="https://developers.marketo.com/rest-api/endpoint-reference/lead-database-endpoint-reference/#!/Bulk_Export_Leads/getExportLeadsFileUsingGET">Get Export Lead File</a> with a request like this:
<pre class="lang:js decode:true ">GET /bulk/v1/leads/export/4f2b9115-c3f2-4e40-a87c-bf803bbfed99/file.json</pre>
Check that the file transferred without error: calculate the checksum of the file and compare to the <strong>fileChecksum</strong> we saved earlier. Calculate the checksum using <a href="https://en.wikipedia.org/wiki/SHA-2">SHA-2</a> and specifically the SHA256 hash function. If the calculated checksums don't match, there was an error in file transfer and you can either try the transfer again or abort and recover manually.
<h3>Aggregate the Data</h3>
After cycling through every 31-day range from the first lead until today, you'll have a complete set. You'll also have one file for each range. The simplest way to build a single aggregated file with every lead would be to concatenate these files after removing the header row for all but the first file. If you do that, don't forget to expect and plan for potential duplication later in your data processing pipeline. In my demonstration, I process the files as I download them. Before adding each row of data to the output file, I deduplicate by checking to see if the row's lead ID has already been written.
<h1>Conclusion</h1>
I've developed some demonstration code hosted <a href="https://github.com/Marketo/REST-Sample-Code/tree/master/python/LeadDatabase/Leads">here</a> which hopefully fills in the details of this process and can serve as a template for your own development. The demo code is intended to be a learning tool so there are improvements to robustness that would be required for a production system. <strong>The code is provided AS-IS</strong> under the MIT license, but it's probably good enough for one-off usage with human supervision.

Nothing is stopping you now! When you follow this process, you will extract every lead using Marketo's Bulk Extract API and potentially every field for the target Marketo Engage instance. To extend your data further, get each lead's activities using the techniques in: <a href="https://developers.marketo.com/blog/retrieve-activities-for-a-single-lead-using-rest-api/">How-To Retrieve Activities for a Single Lead using REST API</a> and keep lead data updated using the techniques you'll learn in: <a href="https://developers.marketo.com/blog/synchronizing-lead-data-changes-using-rest-api/">How-To Synchronizing Lead Data Changes using REST API</a>.

</div>
</div><br/><br/>tmayse - 2020-03-05<br/><br/><h2>February 2020 Updates</h2><br/><br/>In February 2020 we are releasing new REST APIs.  See the full list of updates below.
<h2>Lead Database APIs</h2>
<h4>User Management</h4>
<ul>
 	<li>Added User Management APIs.  These allow you to automate the creation and managment of users, enabling automatic role management.  You can now invite new users, update or delete existing users, query users and roles, and assign roles to user.  For more information see <a href="/rest-api/user-management/">User Management</a>.</li>
</ul>
<h4>Lead Membership</h4>
<ul>
 	<li>Added Lead Membership APIs: <a href="https://developers.marketo.com/rest-api/endpoint-reference/lead-database-endpoint-reference/#!/Leads/getListMembershipUsingGET">Get Lists by Lead Id</a>, <a href="https://developers.marketo.com/rest-api/endpoint-reference/lead-database-endpoint-reference/#!/Leads/getProgramMembershipUsingGET">Get Programs by Lead Id</a>, <a href="https://developers.marketo.com/rest-api/endpoint-reference/lead-database-endpoint-reference/#!/Leads/getSmartCampaignMembershipUsingGET">Get Smart Campaigns by Lead Id</a> .  These allow you to retrieve static list, program, and smart campaign membership records for a given lead.  For more information see <a href="/rest-api/lead-database/leads/#list_and_program_membership">Leads &gt; Membership</a>.</li>
</ul>
<h2>Asset APIs</h2>
<h4>Landing Page Redirect Rules</h4>
<ul>
 	<li>Added Landing Page Redirect Rules APIs.  These allow you to automate creation and management of landing page redirect rules.  For more information see <a href="/rest-api/assets/landing-page-redirect-rules/">Landing Page Redirect Rules</a>.</li>
</ul>
<h2>Announcements</h2>
<h4>Asset API "_method" Parameter</h4>
<ul>
 	<li>After September 2020, <a href="/rest-api/assets/">Asset API</a> Endpoints will no longer accept <strong>_method</strong> query parameter.  This was used to pass query parameters in a POST body to bypass URI length limitations.  To accommodate requests which required this parameter, the URI limit for Asset APIs will be increased from 6KiB to 65KiB.</li>
</ul>
<h4>Intelligent Tracking Protection (ITP)</h4>
<ul>
 	<li>With regard to our position on ITP, please see thisMarketo Community post: <a href="https://nation.marketo.com/t5/Knowledgebase/Browser-Cookie-Updates-How-Marketo-Munchkin-Is-Affected/ta-p/251524">Browser Cookie Updates: How Marketo/Munchkin Is Affected</a></li>
</ul>
<h4>"Change Status in Progression" Activity</h4>
<ul>
 	<li>A change was made to the "Change Status in Progression" activity.  The "Program Member ID" attribute was added to in support of upcoming feature "Program Member Custom Fields".</li>
</ul><br/><br/>deverly - 2020-02-26<br/><br/><h2>Deprecation of Munchkin Associate Lead Method</h2><br/><br/>With the  next release of the Munchkin JavaScript Client, version 159, we will begin deprecation of the Munchkin <a href="https://developers.marketo.com/javascript-api/lead-tracking/api-reference/#munchkin_associatelead">Associate Lead method</a>.  Beginning with this version, when the method is invoked, a warning will be issued in the browser console indicating that the method will be removed in a future release.  Once the method has been removed, attempts to use the method will result in failure.  Marketo customers which we have identified as having used this method recently will be notified individually of their use.

For more information on the Munchkin 159 release, <a href="https://nation.marketo.com/t5/Product-Documents/Munchkin-JavaScript-version-159-amp-Associate-Lead-Deprecation/ta-p/299687">see this Marketing Nation Post</a>.
<h1>FAQs</h1>
<h2>How do I know if I'm affected?</h2>
Adobe will notify customers where we have observed usage of this method on their subscription, and will do so several times over the deprecation period.
<h2>When will the method be removed?</h2>
This method will be removed in Munchkin JS v161, scheduled for General Availability alongside the October 2021 Marketo release.
<h2>Why is this method being removed?</h2>
More performant ways of fulfilling the same use cases have been implemented and released since the introduction of this method.  In order to improve the performance and health of our services, it is sometimes necessary to remove features which do not perform to acceptable standards.
<h2>What should I use instead of this method?</h2>
Munchkin Associate Lead has two primary use cases, submission of person data, and association of a browser web-tracking cookie to the corresponding person record in Marketo.  Since Munchkin Associate Lead was introduced, more robust ways of performing data submission and cookie association have been implemented.
<h3>Browser-Side Submission</h3>
If your use case requires submission of person data from the browser, you should use <a href="http://developers.marketo.com/blog/make-a-marketo-form-submission-in-the-background/">background form submission.</a>
<h3>Server-Side Submission</h3>
If you do not need browser-side submission, the REST API offers many methods for <a href="https://developers.marketo.com/rest-api/lead-database/leads/#create_and_update">person data submission</a>, and a<a href="https://developers.marketo.com/rest-api/lead-database/leads/#associate_web_activity"> purpose-built method for associating cookies to person records</a>.
<h2>When is Version 159 of Munchkin Rolling Out?</h2>
Version 159 has been in General Availability since the October 2020 Marketo release.<br/><br/>kelkington - 2020-05-06<br/><br/><h2>Make a Marketo Form Submission in the Background</h2><br/><br/>When your organization has many different platforms for hosting web content and customer data it becomes fairly common to need parallel submissions from a form so that the resulting data can be gathered in separate platforms. There are several strategies to do this, but the best one is often the simplest: Using the Forms 2 API to submit a hidden Marketo form. This will work with any new Marketo Form, but ideally you should create an empty form for this, which has no fields:

<img class="alignnone size-full wp-image-4973" src="https://marketohost.wpengine.com/wp-content/uploads/2015/09/Capture.png" alt="Empty Form" width="1201" height="801" />

This will ensure that the form doesn't load any more data than necessary, since we don't need to render anything. Now just grab the <a href="https://docs.marketo.com/display/public/DOCS/Embed+a+Form+on+your+Website">embed code</a> from your form and add it to the body of your desired page, making a small modification. Your embed code includes a form element like this:
<pre class="lang:default decode:true prettyprint html">&lt;form id="mktoForm_1068"&gt;&lt;/form&gt;
</pre>
You'll want to add 'style="display:none"' to the element so it is not visible, like this:
<pre class="lang:default decode:true prettyprint html">&lt;form id="mktoForm_1068" style="display:none"&gt;&lt;/form&gt;
</pre>
Once the form is embedded and hidden, the code to submit the form is really quite simple:
<pre class="lang:default decode:true prettyprint html">var myForm = MktoForms2.allForms()[0];
myForm.addHiddenFields({
	//These are the values which will be submitted to Marketo
	"Email":"test@example.com",
	"FirstName":"John",
	"LastName":"Doe"
	});
myForm.submit();
</pre>
Forms submitted this way will behave exactly like if the lead had filled out and submitted a visible form. Triggering the submission will vary between implementations since each one will have a different action to prompt it, but you can make it occur on basically any action. The important part is setting your fields and values correctly. Be sure to use the SOAP API name of your fields which you can find with <a href="/documentation/rest/field-names/">Export Field Names</a> to ensure correct submission of values.
<h2>Migrating from Munchkin Associate Lead</h2>
Background form submission is one of the recommended replacement methods for Munchkin Associate Lead.  The sample HTML page below demonstrates migration at a high level, by reusing the same values which are submitted to Associate Lead.
<pre class="lang:default decode:true">&lt;html&gt;

&lt;head&gt;
    &lt;!--
      Munchkin Code
      Replace with your own instance code
    --&gt;
    &lt;script type="text/javascript"&gt;
        (function() {
          var didInit = false;
          function initMunchkin() {
            if(didInit === false) {
              didInit = true;
              Munchkin.init('CHANGE ME');
            }
          }
          var s = document.createElement('script');
          s.type = 'text/javascript';
          s.async = true;
          s.src = '//munchkin.marketo.net/munchkin-beta.js';
          s.onreadystatechange = function() {
            if (this.readyState == 'complete' || this.readyState == 'loaded') {
              initMunchkin();
            }
          };
          s.onload = initMunchkin;
          document.getElementsByTagName('head')[0].appendChild(s);
        })();
        &lt;/script&gt;
&lt;/head&gt;

&lt;body&gt;
  &lt;!--
    Start Embed code.  
    Pasted from Form Actions -&gt; Embed Code except for addition of 'style="display:none"' to the form tag in order to hide it, and instance-specific codes redacted
    Replace with your own code for testing
  --&gt;
  &lt;script src="CHANGE ME"&gt;&lt;/script&gt;
  &lt;form id="CHANGE ME" style="display:none"&gt;&lt;/form&gt;
  &lt;script&gt;MktoForms2.loadForm("CHANGE ME", "CHANGE ME", "CHANGE ME TO AN INTEGER ID");&lt;/script&gt;
  &lt;!--End Embed Code--&gt;

  &lt;!--Demo code--&gt;
    &lt;script&gt;
        //The same map which is assembled for the Munchkin submission can be reused for the form submission
        let values = {
            "Email": "email@example.com",
            "FirstName": "Test",
            "LastName": "Record"
        }
        //whenReady lets us apply a callback to all mkto forms on the page
        //the callback function fires whenever a form is completely loaded
        //for most use cases this will just be used to capture a reference to the form for later usage
        //submission is done in line here for demonstration only
        MktoForms2.whenReady(function(form){

            //the addHiddenFields methods lets us add arbitrary fields to the form as well as their values
            form.addHiddenFields(values);

            //pass the same set of values to associateLead
            //hashString: secret + email
            Munchkin.munchkinFunction('associateLead', values, "CHANGE ME");
            
            //submit the form
            form.submit();
            
            
        })
    &lt;/script&gt;
&lt;/body&gt;

&lt;/html&gt;</pre>
&nbsp;

&nbsp;<br/><br/>kelkington - 2020-05-26<br/><br/><h2>Removal of _method Parameter from Asset Endpoints</h2><br/><br/>TODO Content<br/><br/>kelkington - 1970-01-01<br/><br/><h2>June 2020 Updates</h2><br/><br/>In June 2020 we are releasing new REST APIs, enhancing existing APIs, and resolving defects.  See the full list of updates below.
<h2>Lead Database APIs</h2>
<h4>Describe Program Member</h4>
<ul>
 	<li>Added <a href="/rest-api/endpoint-reference/lead-database-endpoint-reference/#!/Leads/describeProgramMemberUsingGET">Describe Program Member</a> endpoint.  This allows you to retrieve the REST API names for Program Member Fields.  The REST API names can be used in conjunction with Bulk Program Member APIs.  For Bulk Import, these are the column header names placed in first row of <a href="/rest-api/bulk-import/bulk-program-member-import/#import_file">import file</a>.  For Bulk Export, these are placed in fields parameter of <a href="/rest-api/bulk-extract/bulk-program-member-extract/#options">formatting options</a>.</li>
</ul>
<h4>Programs by Lead ID Filter</h4>
<ul>
 	<li style="list-style-type: none;">
<ul>
 	<li>Added <strong>filterType/filterValues</strong> parameters to <a href="/rest-api/endpoint-reference/lead-database-endpoint-reference/#!/Leads/getProgramMembershipUsingGET">Get Programs by Lead Id</a> endpoint.  This can be used to filter the set of programs returned by supplying a list of program Ids.</li>
</ul>
</li>
</ul>
<h2>Asset APIs</h2>
<h4>Form Dependencies</h4>
<ul>
 	<li>Added <a href="/rest-api/endpoint-reference/asset-endpoint-reference/#!/Forms/getFormUsedByUsingGET">Get Form Used By</a> endpoint that returns a  list of assets that depend on a given form.  This allows you to quickly understand the impact of a potential form change, and more easily address these dependencies.</li>
</ul>
<h4>Email Preheader</h4>
<ul>
 	<li>Added <strong>preHeader</strong> parameter <a href="/rest-api/endpoint-reference/asset-endpoint-reference/#!/Emails/updateEmailUsingPOST">Update Email Metadata</a> endpoint.  This can be used to specify preheader text.</li>
</ul>
<h4>Smart Campaigns Filter</h4>
<ul>
 	<li>Added <strong>isActive</strong> parameter to <a href="/rest-api/endpoint-reference/asset-endpoint-reference/#!/Smart_Campaigns/getAllSmartCampaignsGET">Get Smart Campaigns</a> endpoint.  This can be used to filter active trigger campaigns.</li>
</ul>
<h2>Defect Resolutions</h2>
<ul>
 	<li>Fixed issue where <a href="/rest-api/endpoint-reference/asset-endpoint-reference/#/Programs/deleteProgramUsingPOST">Delete Program</a> endpoint would not allow you to delete a program containing a static list. [LM-113044]</li>
 	<li>Fixed issue where <a href="/rest-api/endpoint-reference/asset-endpoint-reference/#!/Landing_Pages/updateLandingPageUsingPOST">Update Landing Page Metadata</a> endpoint when you specified <strong>urlPageName</strong> to update the page URL, the page was left in an inconsistent state by creating a draft.  The page URL is now applied to the live page (rather than creating a draft).  [LM-128458]</li>
 	<li>Fixed issue where <a href="/rest-api/endpoint-reference/asset-endpoint-reference/#/Programs/cloneProgramUsingPOST">Clone Program</a> endpoint would return an error "611, Unable to clone program" when you had a program with a smart campaign with a flow step that contained a Datetime field.  [LM-135226]</li>
 	<li>Fixed issue in <a href="/rest-api/endpoint-reference/lead-database-endpoint-reference/#/Sales_Persons/syncSalesPersonsUsingPOST">Sync Sales Persons</a> endpoint.  When you specified action=updateOnly this would generate a Change Data Value activity for all leads associated with sales person, which was incorrect since there was no actual data change that occurred.  [LM-135659]</li>
 	<li>Fixed issue where Custom Object names specified as part of a path in REST API call was case-sensitive.  [LM-136316] For example if CO name is "aWSSaaSUsage_c", this call now succeeds: /bulk/v1/customobjects/awssaasusage_c/import/{id}/status.json</li>
</ul>
<h2>Announcements</h2>
<ul>
 	<li><a href="/blog/deprecation-of-munchkin-associate-lead-method/">Deprecation of Munchkin Associate Lead Method</a></li>
 	<li><a href="/blog/important-change-activity-records-marketo-apis/">Important Change to Activity Records in Marketo APIs</a></li>
</ul><br/><br/>deverly - 2020-06-05<br/><br/><h2>July 2020 Updates</h2><br/><br/>In July 2020 we are releasing new REST APIs, enhancing existing APIs, and resolving defects.  See the full list of updates below.
<h2>User Management APIs</h2>
<ul>
 	<li>Added two endpoints that allow you to query and delete users that have not yet accepted their invitation (i.e. are "pending" users).  The <a href="/rest-api/user-management/#invited_user_by_id">Get Invited User by Id</a> endpoint allows you to query a pending user.  The <a href="/rest-api/user-management/#delete_invited_user">Delete Invited User</a> endpoint allows you to delete a pending user.</li>
 	<li>The <a href="/rest-api/user-management/#invite_user">Invite User</a> endpoint has been updated to accept ISO 8601 compliant datetime strings for the <strong>expiresAt</strong> parameter.</li>
 	<li>Both the <a href="/rest-api/user-management/#user_by_id">Get User by Id</a> and <a href="/rest-api/user-management/#update_user_attributes">Update User Attribute</a> endpoints have been updated to return the last user login time in the <strong>lastLoginAt</strong> attribute.</li>
</ul>
<h2>Defect Resolutions</h2>
<ul>
 	<li>Fixed issue where <a href="/rest-api/endpoint-reference/asset-endpoint-reference/#!/Static_Lists/createStaticListUsingPOST">Create Static List</a> endpoint would return an error "611, System error" when you tried to create a static list that already existed.  Changed to return error "709, Static List with the same name already exists".  [LM-135934]</li>
 	<li>Fixed issue where <a href="/rest-api/endpoint-reference/asset-endpoint-reference/#!/Emails/createEmailUsingPOST">Create Email</a> endpoint would return an error "611, System error" when you tried to create an email that already existed.  Changed to return error "709, Email with the same name already exists".  [LM-138648]</li>
 	<li>Fixed issue where Landing Page query endpoints were returning  incorrect <strong>createdAt </strong>values.  The endpoints were returning the time when a landing page was last approved.  They now return the time when a landing page was created.  [LM-138648]</li>
 	<li>Fixed issue where <a href="/rest-api/endpoint-reference/lead-database-endpoint-reference/#!/Leads/mergeLeadsUsingPOST">Merge Leads</a> endpoint would return an error "611, System error" for invalid merge operation.  Occurred when the merge resulted in a duplicate lead and <strong>mergeinCRM</strong> was set to true.  Changed to return error "712, You're creating a duplicate record. We recommend you use an existing record instead".  [LM-137463]</li>
</ul><br/><br/>deverly - 2020-08-01<br/><br/><h2>Guest Post - Deep Dive: Custom Object vs Custom Activities vs Custom fields</h2><br/><br/><strong>This is a guest post from Amit Jain, Marketo Champion 2020, MarTech IT Specialist</strong>

As the Enterprise level Marketing automation platform, Marketo manages your user/customer/prospects information acquired from several sources and maintain that in Marketo for better personalization, segmentation and reporting. These sources can range from your website forms to list build to your CRM data to your e-commerce data.

Marketo offers standard objects i.e. Lead, Company, Opportunity and Activity etc. These standard objects sometimes are not sufficient to fulfil the emerging marketing needs of extended datasets to be available in Marketo. For example, items added to the cart, students applied for different courses, products owned by specific person, and consents for different subscriptions etc. This information can be critical for Marketers to keep the customer/prospect engaged by providing more personalized content and unified user experience across platforms.

To accommodate these business needs, Marketo provides custom ways to store this type of data in Custom Fields, Custom Activities and Custom Objects.

I have observed people having issues understanding when to use which of the options. In this blog post, <strong>we will understand in detail what these three things actually are and when to use which one with some examples.</strong>
<h1><strong>Custom Fields</strong></h1>
The “Lead“ object in Marketo is the master object and everything else is connected with this one, directly or indirectly. Marketo allow you to create custom fields on the “Lead“ object, “Company” object and recently they announced the support of “Program member” custom fields. These custom fields fulfil your need to store certain type of data. For example, you might need to store the Job Function or different consents from the user. There are two types of custom fields in Marketo:
<ol>
 	<li><strong>Synced From CRM Fields: </strong>As part of the auto Marketo ↔︎ SFDC sync, Marketo syncs all the custom fields visible to Marketo user in SFDC on Lead, Contact, Account and Opportunity Object.</li>
 	<li><strong>Marketo Only Fields: </strong>You can directly create a field in Marketo. The data of these fields will not be synced with SFDC.</li>
</ol>
<table style="border-collapse: collapse; width: 100%;">
<tbody>
<tr>
<td style="width: 50%; text-align: left;"><strong>Quick Tips</strong></td>
</tr>
<tr>
<td style="width: 50%;">
<ul>
 	<li>Do you have a Marketo only field and now want to sync the data in SFDC? Check out <a href="https://themarketingautomationblog.com/2019/12/06/field-management-merging-remapping-hiding-marketo-fields/">this blog</a> to learn how you can do that.</li>
 	<li>Learn more about custom fields <a href="https://themarketingautomationblog.com/2019/11/15/knowing-your-marketo-fields/">here</a>.</li>
 	<li>Marketo APIs do not support updating/creation of custom fields as of now.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<h1><strong>Custom Objects</strong></h1>
Apart from standard objects, Marketo allows you to create your own custom objects. <em>You can create custom objects and relate to either Company or Lead object or another custom object.</em>

A custom object is a set of custom records that supplement standard Lead and Company records. Custom objects allow you to store additional data in a scalable manner and link that data to a Lead or Company record.

You can build a custom object with any combination of standard (Link Fields) and custom fields, populate those fields to create custom object <em>records</em>, and then link those records to a Lead or a Company record. Powerful and flexible, linked records enrich your Segments, Smart Lists, and Campaigns by letting you build those assets with information not found in Lead fields and Company fields.

A custom object can have one of the following types of relationships:
<ul>
 	<li><strong>One-to-One Relationship</strong>: where each custom object has a single Lead/Company object record.</li>
 	<li><strong>One-to-Many Relationship</strong>: where each custom object contains multiple custom object records related to a Lead/Company.</li>
 	<li><strong>Many-to-Many Relationship: </strong>where multiple custom object records can link with multiple lead/company objects. For example, multiple students are enrolled in multiple courses from a course catalog.</li>
</ul>
<table width="100%">
<tbody>
<tr>
<td><strong>Quick Tips</strong></td>
</tr>
<tr>
<td>
<ul>
 	<li>Learn more to setup custom objects <a href="https://docs.marketo.com/display/public/DOCS/Marketo+Custom+Objects">here</a>.</li>
 	<li>You can use the Marketo custom object as intermediary object as well meaning custom object of custom object.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<h3><strong>Why Custom Objects?</strong></h3>
Custom objects allow you to compile and use unique data that is relevant to a company or lead but is not necessarily static information about the company or lead themselves. While lead fields relate to an individual’s lead information (<em>Email Address</em>, <em>Zip Code</em>, and so on), business information (<em>Job Title</em>, <em>Industry</em>, and so on), or system-driven information (<em>Marketo ID</em>, a SFDC ID, or Create Date etc.), custom object fields are fully customizable. For example, use custom objects to store information such as the following:
<ul>
 	<li>A user’s purchase history.</li>
 	<li>Cart information.</li>
 	<li>Whether or not a customer has used one of your limited-time, promotional discount codes.</li>
 	<li>Supplementary information acquired from  survey results, interviews, and event attendance.</li>
 	<li>A user’s trial information including trial instance URL, Start Date, End Date, Number of user’s etc.</li>
</ul>
<h3><strong>Marketo Custom Object Limitations</strong></h3>
<ol>
 	<li>By default, Marketo allows you to create 10 custom objects. You can increase the limit with additional subscription fee.</li>
 	<li>The Default number of fields per object is 50 but you can request Marketo support for additional fields if required.  Thank you <a href="https://www.linkedin.com/in/michaelflorin/">Michael Florin</a> for additional input here.</li>
 	<li>There is a limit on the number of records you can have across all the custom objects. It depends on your subscription with Marketo. This limit can be increased with additional subscription fee.</li>
 	<li>If a custom object was created using API, Marketo does not allow to edit the CO schema from Marketo UI.</li>
</ol>
<table width="100%">
<tbody>
<tr>
<td><strong>Quick Tips</strong></td>
</tr>
<tr>
<td>
<ul>
 	<li>Marketo API’s support CRUD (Create, Read, Update, and Delete) operation on custom objects.</li>
 	<li>You can use this custom object data for email personalization using Velocity Script.</li>
 	<li>You can find all Custom object related endpoints <a href="/rest-api/endpoint-reference/lead-database-endpoint-reference/#/Custom_Objects">here</a>.</li>
 	<li>Bulk APIs only support bulk import of custom object records, it doesn’t support bulk extract. More details <a href="https://developers.marketo.com/rest-api/endpoint-reference/lead-database-endpoint-reference/#/Bulk_Import_Custom_Objects">here</a>.</li>
 	<li>You can import data into a custom object using Lead Database import functionality. More details <a href="https://docs.marketo.com/display/public/DOCS/Import+Custom+Object+Data">here</a>.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<h3><strong>Custom Object Terminology</strong></h3>
<strong>Custom Object</strong>: A container that holds a grouping of all the custom object records. Formally known as a data card set or custom table.

<strong>Custom Object Record</strong>: Data record holding additional field information that can be tied to a lead or company. A record can be made up of standard lead or company fields, and custom object record fields. Formally known as a data card or data table row.

<strong>Custom Object Record Field</strong>: Completely customizable fields to collect unique or temporary information. These fields are created and housed inside the custom object itself. Formally known as a data card field or database table field/column.

<strong>Link Field</strong>: Special type of custom object record field to define the relationship between custom object record and linked Lead/Company object record. When you create custom objects, you must provide link fields to connect the custom object record to the correct parent record.
<ul>
 	<li>For a one-to-many or one-to-one custom structure, use the link field in the custom object to connect it to a person or a company.</li>
 	<li>For a many-to-many structure, you use two link fields, connected from a separately created intermediary object (which is a type of custom object, too). One link connects to people or companies in your database and the other connects to the custom object. In this case, the link field is not located in the custom object itself.</li>
</ul>
<h1>Custom Activities</h1>
<strong>There are several ways someone can interact with our organization. They may visit your company’s website, attend one of your tradeshows, or perhaps click a link in an email sent by you. These actions are activities</strong>, and whatever action they take, Marketo captures it so your Marketing and Sales Teams can better understand user’s behavior for personalized and unified engagement.

<strong><em>Custom Activities </em></strong><em>can help you track an activity that isn’t related to a Marketo form, email, or landing page</em>. For example, if you want to track when someone viewed a video on website or took a survey, use custom activity.

Custom activities differ from custom objects. Use custom objects when the value can change (i.e. “car color” changes from blue to red). Use custom activities when tracking moments that occurred, and their details cannot change (i.e. “purchased car”).

By default, the limit of max number of custom activities can be defined is 10. This can be increased with additional subscription fee.

As per the <a href="https://nation.marketo.com/t5/Knowledgebase/Marketo-Activities-Data-Retention-Policy-Under-the-Hood/ta-p/251191">Marketo data retention policy</a>, custom activities will be deleted automatically after 25 months.
<h2><strong>Custom Activities Terminology</strong></h2>
<strong>Custom Activity:</strong> Non-Marketo events that you would want to track inside Marketo.

<strong>Custom Activity ID:</strong> Marketo assign a numeric ID to the custom activity that can be used while trying to push/pull the activity data using Marketo API.

<strong>Custom Activity Fields:</strong> Activity meta data can be stored in activity field. For example, if you are tracking the views on video, the fields could be the Page URL, Video Title etc.

<strong>Custom Activity Primary Field:</strong> Custom activity fields that can be used as the smart list filer criteria.
<table width="100%">
<tbody>
<tr>
<td><strong>Quick Tips</strong></td>
</tr>
<tr>
<td>
<ul>
 	<li>The API endpoints for custom activities are available <a href="/rest-api/endpoint-reference/lead-database-endpoint-reference/#!/Activities/addCustomActivityUsingPOST">here.</a></li>
</ul>
</td>
</tr>
</tbody>
</table>
<h1>Custom Object vs Custom Activity</h1>
<table width="704">
<tbody>
<tr>
<td></td>
<td><strong>Custom Object</strong></td>
<td><strong>Custom Activity</strong></td>
</tr>
<tr>
<td>1</td>
<td>Max 10 Custom objects by default per instance.</td>
<td>Max 10 custom activities by default.</td>
</tr>
<tr>
<td>2</td>
<td>Max 50 custom object fields per custom object.</td>
<td>Each custom activity type can have up to 20 secondary attributes.</td>
</tr>
<tr>
<td>3</td>
<td>Max 1MM custom object records; May very based on your subscription.</td>
<td>After 25 months custom activities will be deleted as per the Marketo data retention policy.</td>
</tr>
<tr>
<td>4</td>
<td>Can be used as Filter and Trigger in Smart Lists and Smart Campaigns.</td>
<td>Can be used as Filter and Trigger in Smart Lists and Smart Campaigns.</td>
</tr>
<tr>
<td>5</td>
<td>Can be used to personalize the email content.</td>
<td>Cannot be used to personalize the email content.</td>
</tr>
<tr>
<td>6</td>
<td>Can perform CRUD operation on a custom object record.</td>
<td>Only Create and Read is allowed on custom activities.</td>
</tr>
<tr>
<td>7</td>
<td>Use custom objects when the value can change (i.e. “car color” changes from blue to red).</td>
<td>Use custom activities when tracking moments that occurred, and their details cannot change (i.e. “purchased car”).</td>
</tr>
<tr>
<td>8</td>
<td>Custom objects tell you the fact. i.e. present value.</td>
<td>Custom Activities tell you the events that have happened in the past.</td>
</tr>
</tbody>
</table>
&nbsp;<br/><br/>AJain - 2020-10-18<br/><br/><h2>January 2021 Updates</h2><br/><br/>In January 2021 we are releasing new REST APIs and resolving several defects.  See the full list of updates below.
<h2>Lead Database APIs</h2>
<h4>Submit Form</h4>
<ul>
 	<li>Added <a href="/rest-api/lead-database/leads/#submit_form">Submit Form</a> endpoint which allows you to perform programmatic form submissions.  Third party forms can now integrate with Marketo forms to take advantage of existing marketing workflows.</li>
</ul>
<h2>Asset APIs</h2>
<h4>Landing Page Preview</h4>
<ul>
 	<li>Added <a href="/rest-api/assets/landing-pages/#preview_landing_page">Get Landing Page Full Content</a> endpoint which returns the serialized HTML version of a landing page.  Allows you to render fully personalized previews of landing pages without having to login to Marketo Engage.  This can help streamline editing and translation workflows within integrated applications.</li>
</ul>
<h2>Velocity Script</h2>
<h4>Custom Object Retrieval Limit</h4>
<ul>
 	<li>You can now configure the number custom objects available for access via Velocity script.  Configuration instructions can be found <a href="https://docs.marketo.com/display/public/DOCS/Change+Custom+Object+Retrieval+Limits+in+Velocity+Scripting">here</a>.</li>
</ul>
<h2>Defect Resolutions</h2>
<ul>
 	<li>Fixed issue where <a href="/rest-api/user-management/#delete_user">Delete User</a> endpoint would allow you to delete an API-Only User that was in-use by a Custom Service.  Now it returns an error "611,  You cannot delete an API user that is being used in API service".  [LM-141893]</li>
 	<li>Fixed issue where <a href="/rest-api/user-management/#browse_users">Get Users</a> endpoint would return deleted users in some cases.  [LM-141542]</li>
 	<li>Fixed issue where <a href="https://developers.marketo.com/rest-api/endpoint-reference/asset-endpoint-reference/#!/Programs/cloneProgramUsingPOST">Clone Program</a> endpoint.  If you specified a program name that exceeded 255 characters, it would return "611, Unable to clone program error".  Now it returns "701, name cannot exceed more than 255 characters".  [LM-143436]</li>
 	<li>Fixed issue with <a href="https://developers.marketo.com/rest-api/endpoint-reference/asset-endpoint-reference/#!/Landing_Pages/approveLandingPageUsingPOST">Approve Landing Page Draft</a> endpoint.  When you approved a landing page with mobile version activated, you would see content from mobile version in desktop version in certain cases.  [LM-146867]</li>
 	<li>Fixed issue with <a href="https://developers.marketo.com/rest-api/endpoint-reference/asset-endpoint-reference/#!/Landing_Pages/unapproveLandingPageByIdUsingPOST">Unapprove Landing Page</a> endpoint which allowed you to unapprove a landing page that was in use as a follow up page by one or more forms.  It now returns an error "709, Unapprove landing page failed. Landing page is in use by one or more forms as a followup page with form IDs:[<em>formId1,formId2,...</em>]".  [LM-143326]</li>
</ul>
<h2>Announcements</h2>
<ul>
 	<li style="list-style-type: none;">
<ul>
 	<li>Happy new year!</li>
</ul>
</li>
</ul><br/><br/>deverly - 2021-01-15<br/><br/><h2>Munchkin 160 Beta and Beacon API</h2><br/><br/><strong>Jan 27th 2021:</strong> Some Marketo users who will be affected by Associate Lead deprecation received an email notification in error indicating that they have the Munchkin Beta setting enabled on one or more of their instances.  This release will be held until the correct audience can be notified.

<span data-contrast="auto">Beginning with version 160 of the Munchkin JavaScript, the </span><a href="https://developer.mozilla.org/en-US/docs/Web/API/Beacon_API"><span data-contrast="none">Beacon API</span></a><span data-contrast="auto"> will become the default way that Munchkin communicates with the </span><span data-contrast="auto">Marketo</span><span data-contrast="auto"> backend.  This became a</span><span data-contrast="auto">vailable as an option in Summer 2020 with the release of version 159 via the </span><b><span data-contrast="auto">useBeaconAPI</span></b><span data-contrast="auto"> configuration parameter.  The Beacon API has several advantages over using the old </span><span data-contrast="auto">XMLHttpRequest</span><span data-contrast="auto"> method, but the p</span><span data-contrast="auto">rincipal improvement is that it is a non-blocking asynchronous API for HTTP communication which is available for use in all modern internet browsers.  </span><span data-contrast="auto">While most users of Munchkin will not notice a change in website behavior, this update will prevent Munchkin from blocking navigation while waiting to submit a </span><span data-contrast="auto">click event to the backend, or more simply, this all but eliminates the possibility of </span><span data-contrast="auto">Munchkin causing a browser to “hang”</span><span data-contrast="auto"> </span><span data-contrast="auto">after clicking a link to a new page.</span><span data-contrast="auto">  This has been a rare but frustrating occurrence for some </span><span data-contrast="auto">Marketo</span><span data-contrast="auto"> customers.</span><span data-ccp-props="{&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:259}"> </span>

<span data-contrast="auto">As of Jan 27th 2021, the rollout of this version is on hold pending rescheduling.</span>

<span data-contrast="auto">While no problems related to this change are anticipated, and none have been identified while testing</span><span data-contrast="auto">, it is impossible for </span><span data-contrast="auto">Marketo</span><span data-contrast="auto"> to test all possible deployment configurations of Munchkin and you may wish to test these changes </span><span data-contrast="auto">beforehand or forego this change until general availability of this version.  Instructions for various scenarios are presented below.</span><span data-ccp-props="{&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:259}"> </span>
<h1 aria-level="1"><span data-contrast="none">Test Beacon API</span><span data-ccp-props="{&quot;201341983&quot;:0,&quot;335559738&quot;:240,&quot;335559739&quot;:0,&quot;335559740&quot;:259}"> </span></h1>
<span data-contrast="auto">If you wish to test the updated Beacon API in anticipation of the upcoming </span><span data-contrast="auto">version, you can do so, by adding the </span><b><span data-contrast="auto">useBeaconAPI</span></b><span data-contrast="auto"> parameter to your Munchkin configuration on an external test page</span><span data-contrast="auto">.  This test will work with either the generally available or beta version of Munchkin.</span><span data-contrast="auto"> </span><span data-contrast="auto">The configuration </span><span data-contrast="auto">paraemeter</span><span data-contrast="auto"> is shown</span><span data-contrast="auto"> below</span><span data-contrast="auto"> in the second argument of the invocation of the </span><span data-contrast="auto">Munchkin.init</span><span data-contrast="auto">() method on line 7: </span><span data-ccp-props="{&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:259}"> </span>

{ 'useBeaconAPI’: true}
<pre class="lang:default mark:7 decode:true" title="Munchkin JavaScript">&lt;script type="text/javascript"&gt;
(function() {
  var didInit = false;
  function initMunchkin() {
    if(didInit === false) {
      didInit = true;
      Munchkin.init('299-BYM-827', {"useBeaconAPI":true});
    }
  }
  var s = document.createElement('script');
  s.type = 'text/javascript';
  s.async = true;
  s.src = '//munchkin.marketo.net/munchkin.js';
  s.onreadystatechange = function() {
    if (this.readyState == 'complete' || this.readyState == 'loaded') {
      initMunchkin();
    }
  };
  s.onload = initMunchkin;
  document.getElementsByTagName('head')[0].appendChild(s);
})();
&lt;/script&gt;</pre>
<span data-ccp-props="{&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:259}"> </span>
<h1 aria-level="1"><span data-contrast="none">Disable Munchkin Beta on Marketo Landing Pages</span><span data-ccp-props="{&quot;201341983&quot;:0,&quot;335559738&quot;:240,&quot;335559739&quot;:0,&quot;335559740&quot;:259}"> </span></h1>
<span data-contrast="auto">To disable Munchkin Beta on </span><span data-contrast="auto">Marketo</span><span data-contrast="auto"> landing pages, you will need to access your<a href="https://docs.marketo.com/display/public/DOCS/Enable+or+Disable+Treasure+Chest+Features"> Treasure Chest</a> menu in the Admin section of your subscription</span><span data-contrast="auto"> and change the Munchkin Beta on Landing Pages setting to disabled.</span><span data-ccp-props="{&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:259}"> </span>
<h1 aria-level="1"><span data-contrast="none">Disable Munchkin Beta on External Pages</span><span data-ccp-props="{&quot;201341983&quot;:0,&quot;335559738&quot;:240,&quot;335559739&quot;:0,&quot;335559740&quot;:259}"> </span></h1>
<span data-contrast="auto">If you have deployed the Beta version of Munchkin JavaScript to external web pages, and wish to forego this change until it is generally available, you will need to alt</span><span data-contrast="auto">er your Munchkin JS snippet to target the </span><b><span data-contrast="auto">munchkin.</span></b><b><span data-contrast="auto">js</span></b><span data-contrast="auto"> file instead of the </span><b><span data-contrast="auto">munchkin-beta.</span></b><b><span data-contrast="auto">js</span></b><span data-contrast="auto"> file</span><span data-contrast="auto">.  In the example below, this is the value of the </span><b><span data-contrast="auto">s.src</span></b><span data-contrast="auto"> variable on line 13.</span><span data-contrast="auto">  Your </span><span data-contrast="auto">snippet may not closely resemble the example, or may be deployed by a tag manager on your external pages and you may need to reach out to your IT resources or whomever manages your websites with Munch</span><span data-contrast="auto">kin tracking enabled.</span><span data-ccp-props="{&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:259}"> </span>
<pre class="lang:default mark:13 decode:true " title="Munchkin JavaScript">&lt;script type="text/javascript"&gt;
(function() {
  var didInit = false;
  function initMunchkin() {
    if(didInit === false) {
      didInit = true;
      Munchkin.init('299-BYM-827');
    }
  }
  var s = document.createElement('script');
  s.type = 'text/javascript';
  s.async = true;
  s.src = '//munchkin.marketo.net/munchkin.js';//This line should have the munchkin.js file, not munchkin-beta.js
  s.onreadystatechange = function() {
    if (this.readyState == 'complete' || this.readyState == 'loaded') {
      initMunchkin();
    }
  };
  s.onload = initMunchkin;
  document.getElementsByTagName('head')[0].appendChild(s);
})();
&lt;/script&gt;</pre><br/><br/>kelkington - 2021-01-08<br/><br/><h2>Final API Deprecation of Email V1</h2><br/><br/><a href="https://nation.marketo.com/t5/Knowledgebase/Email-Editor-1-0-is-Being-Deprecated-June-18th/ta-p/250666"><span data-contrast="none">Deprecation of Email V1 began </span><span data-contrast="none">almost </span><span data-contrast="none">two years ago</span></a><span data-contrast="auto"> and beginning with the </span><span data-contrast="auto">March </span><span data-contrast="auto">maintenance</span><span data-contrast="auto"> </span><span data-contrast="auto">release to London &amp; Netherlands subscriptions on </span><span data-contrast="auto">March 17</span><span data-contrast="auto">th</span><span data-contrast="auto">, 2021</span><span data-contrast="auto"> and all other subscriptions on March 19</span><span data-contrast="auto">th</span><span data-contrast="auto">, 2021</span><span data-contrast="auto">, all API support for V1 </span><span data-contrast="auto">e</span><span data-contrast="auto">mails will b</span><span data-contrast="auto">e ended.  A</span><span data-contrast="auto">fter this release, </span><span data-contrast="auto">any attempts to interact with V1 emails via the Asset APIs will result in errors and no actions taken</span><span data-contrast="auto">.  All known remaining users since</span><span data-contrast="auto"> February 24</span><span data-contrast="auto">th</span><span data-contrast="auto">, 2021</span><span data-contrast="auto"> have been notified</span><span data-contrast="auto">,</span><span data-contrast="auto"> but</span><span data-contrast="auto"> it is possible</span><span data-contrast="auto"> that there are still integrations which may attempt to interact with these assets.  The most common types of affected integrations are services </span><span data-contrast="auto">which</span><span data-contrast="auto"> offer digital</span><span data-contrast="auto"> asset management, translation, and localization</span><span data-contrast="auto">.</span><span data-ccp-props="{&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:259}"> </span>

<span data-contrast="auto">If you do observe integration failures as a result of this change, </span><a href="https://docs.marketo.com/display/public/DOCS/Transitioning+to+Email+Editor+2.0"><span data-contrast="none">you will still be able to upgrade problematic assets</span><span data-contrast="none"> by editing and approving them</span></a><span data-contrast="auto">.  Once an email asset is upgraded to V2, you should be able to resume using it with integrated services.</span><span data-ccp-props="{&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:259}"> </span><br/><br/>kelkington - 2021-03-17<br/><br/><h2>May 2021 Updates</h2><br/><br/>In May 2021 we are releasing new REST APIs, enhancing existing REST APIs, and resolving several defects.  See the full list of updates below.
<h2>Lead Database APIs</h2>
<h4>Program Members</h4>
<ul>
 	<li>Added Program Member APIs that allow you to retrieve, update, and delete program membership records.  For more information see <a href="/rest-api/lead-database/program-members/">REST API &gt; Lead Database &gt; Program Members</a>.</li>
</ul>
<h4>Bulk Custom Object Extract</h4>
<ul>
 	<li>Added Bulk Custom Object Extract APIs that allow you to export first-level Marketo Custom Object records which are associated with leads in a one-to-many relationship.  For more information see <a href="/rest-api/bulk-extract/bulk-custom-object-extract/">REST API &gt; Bulk Extract &gt; Bulk Custom Object Extract</a>.</li>
</ul>
<h4>Custom Fields Metadata</h4>
<ul>
 	<li>Added Custom Field Metadata APIs that allow you to create, update, and retrieve metadata for lead fields.  For more information see <a href="https://developers.marketo.com/rest-api/lead-database/leads/#fields">REST API &gt; Lead Database &gt; Leads</a>.</li>
</ul>
<h4>Experience Cloud Id Support (ECID)</h4>
<ul>
 	<li><span class="EOP SCXW254972766 BCX0">We have enhanced both the <a href="/rest-api/lead-database/leads/#adobe_ecid">Lead API</a> and the <a href="/rest-api/bulk-extract/bulk-lead-extract/#options">Bulk Lead Extract API</a> to permit users to retrieve the Adobe Experience Cloud Id (ECID).   This allows users who  <a href="https://docs.marketo.com/display/public/DOCS/Sync+an+Audience+From+Adobe+Experience+Cloud">Sync Audiences from Adobe Experience Cloud</a> to identify leads that have associated ECIDs.  This opens up <a href="https://adobeexchangeec.zendesk.com/hc/en-us/articles/360024277392-Adobe-Experience-Cloud-Using-the-ECID-for-integration">integration possibilities</a> with other Adobe Experience Cloud products.</span></li>
</ul>
<h4>Bulk Lead Import &amp; Company Association</h4>
<ul>
 	<li>We have enhanced the <a href="/rest-api/bulk-import/bulk-lead-import/">Bulk Lead Import API</a> to support adding leads to company records during the import process.  This is done by including the <strong>externalCompanyId</strong> field to the import file.</li>
</ul>
<h2>Asset APIs</h2>
<h4>Programs</h4>
<ul>
 	<li class="Paragraph SCXW254972766 BCX0"><span class="EOP SCXW254972766 BCX0">We have enhanced several Program endpoints to provide parity with functionality found in the Marketo Engage UI.  W</span><span class="EOP SCXW254972766 BCX0">e have enhanced the <a href="/rest-api/assets/programs/#create">Create Programs</a> and <a href="https://developers.marketo.com/rest-api/assets/programs/#clone">Clone Programs</a> endpoints to permit create, clone, or move operations on event programs.  This is for users that organize event programs by "nesting" them underneath other program types.  </span>We have also enhanced the <a href="/rest-api/assets/programs/#delete-program">Delete Program</a> endpoint to permit deletion of programs that contain the following assets: Push Notifications, In-App Messages, Reports, Landing Pages with Embedded Social Assets.</li>
</ul>
<h4>Sensitive Field Support</h4>
<ul>
 	<li>As a Marketo Admin, you can <a href="https://docs.marketo.com/display/public/DOCS/Mark+a+Field+as+Sensitive">mark a specific field as "sensitive"</a> so its values <a href="https://docs.marketo.com/display/public/DOCS/Disable+Pre-fill+for+a+Form+Field">never get pre-filled in forms</a>, thereby protecting users' sensitive data.  <span class="EOP SCXW254972766 BCX0">We have enhanced several Form Field endpoints to provide parity with this functionality found in the Marketo Engage UI.  The following endpoints now permit you to set or retrieve the <b>isSensitive </b>boolean field attribute : </span><a href="/rest-api/endpoint-reference/asset-endpoint-reference/#!/Form_Fields/addFieldToAFormUsingPOST">Add Field to Form</a>, <a href="/rest-api/endpoint-reference/asset-endpoint-reference/#!/Form_Fields/updateFormFieldUsingPOST">Update Form Field</a>, <a href="/rest-api/endpoint-reference/asset-endpoint-reference/#!/Form_Fields/getFormFieldByFormVidUsingGET">Get Fields for Form</a>, <a href="/rest-api/endpoint-reference/asset-endpoint-reference/#!/Form_Fields/getAllFieldsUsingGET">Get Available Form Fields</a>.</li>
</ul>
<h4>Channel Status Type</h4>
<ul>
 	<li>We have enhanced <a href="https://developers.marketo.com/rest-api/endpoint-reference/asset-endpoint-reference/#!/Channels/getChannelByNameUsingGET">Get Channel by Name</a> and <a href="http://marketohost.staging.wpengine.com/rest-api/endpoint-reference/asset-endpoint-reference/#!/Channels/getAllChannelsUsingGET">Get Channels</a> endpoints to return status type in the <strong>type</strong> attribute.</li>
</ul>
<h2>Defect Resolutions</h2>
<ul>
 	<li>Fixed issue with <a href="/rest-api/endpoint-reference/asset-endpoint-reference/#!/Programs/deleteProgramUsingPOST">Delete Program</a> endpoint.  If you tried to delete a program in a shared folder, it would return "611, System Error".  Now it returns " "Target program is in a shared folder and cannot be deleted.  The folder must be unshared before attempting deletion."  [LM-149405]</li>
 	<li>Fixed issue with <a href="https://developers.marketo.com/rest-api/endpoint-reference/asset-endpoint-reference/#!/Programs/cloneProgramUsingPOST">Clone Program</a> endpoint.  If you tried to clone a program that contained a DateTime in a flow step, it would return "611, System Error".  Now it successfully clones the program.  [LM-135226]</li>
 	<li>Fixed issue with <a href="https://developers.marketo.com/rest-api/endpoint-reference/asset-endpoint-reference/#!/Programs/createProgramUsingPOST">Create Programs</a> endpoint that inadvertently allowed you to create a program underneath an email program (which is not allowed).  [LM-150648]</li>
 	<li>Fixed issue with <a href="https://developers.marketo.com/rest-api/endpoint-reference/asset-endpoint-reference/#!/Programs/cloneProgramUsingPOST">Clone Program</a> endpoint.  If you cloned a program that contained a landing page, the name of the landing page in the target program was missing an underscore between program name and landing page name.  e.g. http://&lt;<em>pod</em>&gt;.marketo.com/lp/&lt;<em>munchkin</em>&gt;/&lt;<em>program name</em>&gt;<strong>_</strong>&lt;<em>LP name</em>&gt;.html  [LM-149488]</li>
</ul>
<h2>Announcements</h2>
<ul>
 	<li>The previously released Describe Program Member endpoint (/rest/v1/program/members/describe.json) has been superceded by a new version of <a href="/rest-api/endpoint-reference/lead-database-endpoint-reference/#!/Program_Members/describeProgramMemberUsingGET2">Describe Program Member</a> (/rest/v1/programs/members/describe.json).  This is to standardize on a common set of API names for program member fields across all program member related endpoints.  For example, the old API name for "Acquired By" was "Acquired By" and the new API name is "acquiredBy".  We encourage you to migrate to the new endpoint and use the new API names.  The old endpoint will continue to function but will no longer be maintained.</li>
 	<li>The <a href="/rest-api/endpoint-reference/lead-database-endpoint-reference/#!/Leads/changeLeadProgramStatusUsingPOST">Change Lead Program Status</a> endpoint has been superceded by <a href="/rest-api/endpoint-reference/lead-database-endpoint-reference/#!/Program_Members/syncProgramMemberStatusUsingPOST">Sync Program Member Status</a>.  Currently the two endpoints are functionally equivalent.  We encourage you to migrate to Sync Program Member Status.  Change Lead Program Status will continue to function but will no longer be maintained.</li>
 	<li>In January 2021 there was a minor change in behavior in our Bulk Extract Activity API due to a backend infrastructure component upgrade. Before the upgrade, when the database entry associated with primaryAttributeValueId field contained a null value, the API exported a 0 for that field.  After the change, a null value is exported as null.  If you have an integration that is impacted by this change, please adjust how you consume the primaryAttributeValueId field.  Assume that the field can now contain an integer or null as a value.</li>
</ul><br/><br/>deverly - 2021-05-07<br/><br/><h2>Limited Time Offer to Join Adobe Exchange</h2><br/><br/>Marketo Engage partner community support is one of the pillars of our customers’ success. We want to ensure the Marketo Engage Integration ecosystem is well represented in the <a href="https://nam04.safelinks.protection.outlook.com/?url=http%3A%2F%2Fexchangepartners-engage.adobe.com%2FNjA4LURIVi05MTUAAAF-P5lIeRNWofMyd90ysx0ba_s-F6G-mNDTR2xfUXzXV4X0wDK_Bx6ETjLT0Owj0o3MDbR1IUE%3D&amp;data=04%7C01%7Cweihl%40adobe.com%7Cdd1aeed93405468825ff08d946187940%7Cfa7b1b5a7b34438794aed2c178decee1%7C0%7C0%7C637617893186752936%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C1000&amp;sdata=4H7Lx6JIrNhaZX6E0TO9QFYO0Bqxs2RQqcEu48Cwntw%3D&amp;reserved=0">Exchange Marketplace</a>, and have a special offer for LaunchPoint partners.

For a very limited time, that will not be extended, we are offering our LaunchPoint partners free Innovate partnership in the Exchange program through the end of 2022 (approximately $15k value). We designed this offer to encourage LaunchPoint partners to create their integration listings in the Exchange Partner Portal, which will then be publicly searchable in the Adobe Exchange Marketplace. To see a full list of the Innovate partnership benefits that you will receive for no charge through December 2022, please visit <a href="https://nam04.safelinks.protection.outlook.com/?url=http%3A%2F%2Fexchangepartners-engage.adobe.com%2FNjA4LURIVi05MTUAAAF-P5lIeXKQsVs6__aHlzjZJdXjcf_rXMyQLLEp3_7ZtdhbsQWRB14QGHTorfdOS7J0ODaNBLk%3D&amp;data=04%7C01%7Cweihl%40adobe.com%7Cdd1aeed93405468825ff08d946187940%7Cfa7b1b5a7b34438794aed2c178decee1%7C0%7C0%7C637617893186762932%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C1000&amp;sdata=1rSa29%2B8oKr41li0NrKg5kua%2FM3DpiAXptL8C%2BS573g%3D&amp;reserved=0">this page</a>. A few of the most popular benefits are access to sandboxes, as well as a public listing on our <a href="https://nam04.safelinks.protection.outlook.com/?url=http%3A%2F%2Fexchangepartners-engage.adobe.com%2FNjA4LURIVi05MTUAAAF-P5lIeRNWofMyd90ysx0ba_s-F6G-mNDTR2xfUXzXV4X0wDK_Bx6ETjLT0Owj0o3MDbR1IUE%3D&amp;data=04%7C01%7Cweihl%40adobe.com%7Cdd1aeed93405468825ff08d946187940%7Cfa7b1b5a7b34438794aed2c178decee1%7C0%7C0%7C637617893186772925%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C1000&amp;sdata=Hy5K6dCFybGBe77b3LiH0azECWqlfSZnMjqFBx%2FBfws%3D&amp;reserved=0">Adobe Exchange Marketplace</a>.

<strong>How to Take Advantage of This Offer</strong>
<ol>
 	<li>Go to <a href="https://adobeexchangeec.zendesk.com/hc/en-us?mkt_tok=NjA4LURIVi05MTUAAAF-P5lIeVWOuBmKMS_uE_NpgFKtC0ukt7z_ksnq_Sbzb6mzXUuXpqpqQeujtPdZ24WcjMdptygQSR9XrYt_Cw">Adobe Exchange Partner Support Center</a></li>
 	<li>Click on “Submit a request” in the top right corner<img class="alignnone size-large wp-image-7875" src="http://developers.marketo.com/wp-content/uploads/2021/07/adobe_exchange_submit_a_request-1024x600.png" alt="" width="840" height="492" /></li>
 	<li>In <strong>Please choose your issue below</strong> dropdown choose "Adobe Exchange Support"<img class="alignnone size-full wp-image-7876" src="http://developers.marketo.com/wp-content/uploads/2021/07/adobe_exchange_submit_a_request2.png" alt="" width="709" height="251" /></li>
 	<li>In <strong>Your email address</strong> enter your email address</li>
 	<li>In <strong>Subject</strong> box enter "LaunchPoint Offer"</li>
 	<li>In the <strong>Description</strong> box enter "LaunchPoint Offer"</li>
 	<li>In the <strong>Support Type</strong> dropdown select "Program Support"<img class="alignnone size-full wp-image-7877" src="http://developers.marketo.com/wp-content/uploads/2021/07/adobe_exchange_submit_a_request3.png" alt="" width="678" height="172" /></li>
 	<li>In the <strong>Adobe Exchange Product</strong> dropdown select "Adobe Exchange Program"<img class="alignnone size-full wp-image-7878" src="http://developers.marketo.com/wp-content/uploads/2021/07/adobe_exchange_submit_a_request4.png" alt="" width="670" height="193" /></li>
 	<li>Submit the Form. Our team will be in contact with you shortly!</li>
</ol>
<strong>If you would like to take advantage of this offer you must let us know by submitting a request <a href="https://nam04.safelinks.protection.outlook.com/?url=http%3A%2F%2Fexchangepartners-engage.adobe.com%2FNjA4LURIVi05MTUAAAF-P5lIeTwCa0rEpYTOvZQStRFsQ-CZVh9VyFTryyaRUqy2BWDg80rtUQLe2z9_3BHHycT8_0I%3D&amp;data=04%7C01%7Cweihl%40adobe.com%7Cdd1aeed93405468825ff08d946187940%7Cfa7b1b5a7b34438794aed2c178decee1%7C0%7C0%7C637617893186772925%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C1000&amp;sdata=ZSCzmPqopCoQx4%2BOPiH%2FhfIZKH7fdInq%2BWH9X4vc2ik%3D&amp;reserved=0">here</a> by August 31st. Please note that we will not be able to honor any requests that come in after that date. </strong>

Please contact our <a href="https://nam04.safelinks.protection.outlook.com/?url=http%3A%2F%2Fexchangepartners-engage.adobe.com%2FNjA4LURIVi05MTUAAAF-P5lIebDIJMSrcEMyIrupWPvzlCHjycoXbmbRMbAB9JQyxU5NVi3K1Ki5eImB2F7qN-4ylic%3D&amp;data=04%7C01%7Cweihl%40adobe.com%7Cdd1aeed93405468825ff08d946187940%7Cfa7b1b5a7b34438794aed2c178decee1%7C0%7C0%7C637617893186782920%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C1000&amp;sdata=ZyQ%2FC1jnfK826Bl9aiKJOUqn2co0Z9%2Fr%2FU0eE8yYAzA%3D&amp;reserved=0">support team</a> if you have questions.

Sincerely,
Adobe Exchange Team<br/><br/>deverly - 2021-07-22<br/><br/><h2>August 2021 Updates</h2><br/><br/>In August 2021 we are enhancing existing REST APIs, and resolving several defects.  See the full list of updates below.
<h2>Lead Database APIs</h2>
<h4>Bulk Activity Extract</h4>
<ul>
 	<li>We have enhanced the Bulk Activity Extract API to permit users to filter using primary attributes for 6 different activity types.  For more information see <a href="https://developers.marketo.com/rest-api/bulk-extract/bulk-activity-extract/#filters">Bulk Activity Extract</a>.</li>
</ul>
<h4>Sales Activities</h4>
<ul>
 	<li>In order to give Marketo Sales Connect users more access to their sales activity data we enabled additional sales activity attributes. We added the following attributes to Send Sales Email, Open Sales Email, and Click Sales Email activities:</li>
</ul>
<table style="border-collapse: collapse; width: 100%;">
<tbody>
<tr>
<td style="width: 50%;"><strong>Activity Attribute</strong></td>
<td style="width: 50%;"><strong>Description</strong></td>
</tr>
<tr>
<td style="width: 50%;">Marketo Sales Person ID</td>
<td class="xl43" style="width: 50%; height: 18.75pt;" width="416" height="25">Unique ID for person record in Sales Connect</td>
</tr>
<tr>
<td style="width: 50%;">Sales Campaign Name</td>
<td class="xl43" style="width: 50%; height: 18.75pt;" width="416" height="25">Name of sales campaign, if email was part of a sales campaign</td>
</tr>
<tr>
<td style="width: 50%;">Sales Campaign URL</td>
<td class="xl43" style="width: 50%; height: 18.75pt;" width="416" height="25">Sales Connect URL for sales campaign if email was part of a sales campaign</td>
</tr>
<tr>
<td style="width: 50%;">Sales Template Name</td>
<td class="xl43" style="width: 50%; height: 18.75pt;" width="416" height="25">Name of email template in Sales Connect, if a template was used</td>
</tr>
<tr>
<td style="width: 50%;">Sales Template URL</td>
<td class="xl43" style="width: 50%; height: 18.75pt;" width="416" height="25">Sales Connect URL for email template, if a template was used</td>
</tr>
</tbody>
</table>
<h2>Asset APIs</h2>
<h4>Emails</h4>
<ul>
 	<li class="Paragraph SCXW254972766 BCX0"><span class="EOP SCXW254972766 BCX0">We have enhanced the <a href="https://developers.marketo.com/rest-api/endpoint-reference/asset-endpoint-reference/#!/Emails/getEmailUsingGET">Get Emails</a> endpoint by adding earliestUpdatedAt/latestUpdatedAt filter.  This allows you to use the updatedAt field to search only for a subset of emails, allowing incremental synchronization.</span></li>
 	<li>We have enhanced the <a href="https://developers.marketo.com/rest-api/endpoint-reference/asset-endpoint-reference/#!/Emails/getEmailUsingGET">Get Emails</a>, <a href="https://developers.marketo.com/rest-api/endpoint-reference/asset-endpoint-reference/#!/Emails/getEmailByNameUsingGET">Get Email by Name</a>, <a href="https://developers.marketo.com/rest-api/endpoint-reference/asset-endpoint-reference/#!/Emails/getEmailByIdUsingGET">Get Email by Id</a> endpoints to support retrieval of <a href="https://experienceleague.adobe.com/docs/marketo/using/product-docs/email-marketing/general/functions-in-the-editor/email-tests-champion-challenger/add-an-email-champion-challenger.html?lang=en">Champion and Challenger</a> type email records.</li>
</ul>
<h2>Defect Resolutions</h2>
<ul>
 	<li>Fixed issue with the <a href="https://developers.marketo.com/rest-api/endpoint-reference/user-management-endpoint-reference/#!/User_Management/getUsersUsingGET">Get Users</a> endpoint.  Users that had been issued a <a href="https://experienceleague.adobe.com/docs/marketo/using/product-docs/core-marketo-concepts/marketing-calendar/understanding-the-calendar/issue-revoke-a-marketing-calendar-license.html?lang=en">Marketing Calendar</a> license were not being returned.   Marketing Calendar users are now correctly returned.  [LM-152424]</li>
 	<li>Fixed issue with <a href="https://developers.marketo.com/rest-api/endpoint-reference/lead-database-endpoint-reference/#!/Leads/SubmitFormUsingPOST">Submit Form</a> endpoint.  In the event of duplicate lead records, Submit Form used to issue a "1007, Multiple lead match lookup criteria" error.  Submit Form now updates the most recently updated record in the same way that the <a href="https://developers.marketo.com/javascript-api/forms/">Forms 2.0 API</a> does.  [LM-151990]</li>
 	<li>Improved several misleading error messages returned by <a href="https://developers.marketo.com/rest-api/endpoint-reference/lead-database-endpoint-reference/#!/Leads/updateLeadFieldUsingPOST">Update Lead Field</a> and <a href="https://developers.marketo.com/rest-api/endpoint-reference/lead-database-endpoint-reference/#!/Leads/createLeadFieldUsingPOST">Create Lead Fields</a> endpoints. [LM-151890, LM-151888, LM-151889]</li>
 	<li>Fixed issue with <a href="https://developers.marketo.com/rest-api/endpoint-reference/lead-database-endpoint-reference/#!/Leads/getLeadFieldByNameUsingGET">Get Lead Field by Name</a> and <a href="https://developers.marketo.com/rest-api/endpoint-reference/lead-database-endpoint-reference/#!/Leads/getLeadFieldsUsingGET">Get Lead Fields</a> endpoints.  Both endpoints could potentially return slightly out of date information.  They now always return current information.  [LM-151202]</li>
 	<li>Fixed issue with <a href="https://developers.marketo.com/rest-api/bulk-extract/">Bulk Extract API</a> when using the "range" HTTP header for partial retrieval where the last byte in the range was not returned.  [LM-155141]</li>
 	<li>Fixed issue with <a href="https://developers.marketo.com/rest-api/endpoint-reference/asset-endpoint-reference/#!/Snippets/updateSnippetUsingPOST">Update Snippet Metadata</a> endpoint.  When updating the snippet name or description, the snippet status was changed to "approved with draft".  Now the snipped status remains unchanged after updating snippet name or description.  [LM-155005]</li>
 	<li>Fixed issue with <a href="https://developers.marketo.com/rest-api/endpoint-reference/asset-endpoint-reference/#!/Emails/addModuleUsingPOST">Add Email Module</a> endpoint.  When adding a module that contained a snippet, it returned a "611, System Error".  It now correctly adds the module to the email.  [LM-154423]</li>
 	<li>Fixed issue with <a href="https://developers.marketo.com/rest-api/endpoint-reference/asset-endpoint-reference/#!/Programs/deleteProgramUsingPOST">Delete Program</a> endpoint.  When deleting a program that contained an In-App Message local asset, it returned a "611, System Error".  It now correctly deletes the program [LM-152876]</li>
</ul>
<h2>Announcements</h2>
<ul>
 	<li>The <a href="/rest-api/endpoint-reference/lead-database-endpoint-reference/#!/Program_Members/describeProgramMemberUsingGET2">Describe Program Member</a> endpoint exposes the updatedAt as a searchable field.  The ability to search using updatedAt is not yet implemented, but will become available in a future release.</li>
</ul><br/><br/>deverly - 2021-08-22<br/><br/><h2>Munchkin Version 161 Rollout</h2><br/><br/><span data-contrast="auto">On September 7th</span><span data-contrast="auto"> 2021, version 161 of Munchkin will begin rolling out to 10% of subscriptions with Munchkin Beta enabled, followed by 50% on September 16th, and 100% on September 30th. This change will affect Marketo landing pages and the version of the file munchkin-beta.js served to external landing pages which are loaded from subscriptions that the new version has been rolled out to. This version fully deprecates the Munchkin Associate Lead method, which is a feature that allowed submission of person data to a Marketo subscription and associated web browsing history with a known person record.  Associate Lead is being removed in favor of more modern and secure alternatives, like the </span><a href="https://developers.marketo.com/javascript-api/forms/"><span data-contrast="none">Forms JS API</span></a><span data-contrast="auto">, the </span><a href="https://developers.marketo.com/rest-api/endpoint-reference/lead-database-endpoint-reference/#!/Leads/SubmitFormUsingPOST"><span data-contrast="none">Form Submit API</span></a><span data-contrast="auto"> and the </span><a href="https://developers.marketo.com/rest-api/lead-database/leads/#associate_web_activity"><span data-contrast="none">Associate Lead REST API</span></a><span data-contrast="auto">.  If you or your organization uses this method, you should migrate away from usage by October 12</span><span data-contrast="auto">th</span><span data-contrast="auto"> 2021 when the October release rollout is scheduled to begin.  You can find more info about this deprecation </span><a href="https://developers.marketo.com/blog/deprecation-of-munchkin-associate-lead-method/"><span data-contrast="none">here</span></a><span data-contrast="auto">.</span><span data-ccp-props="{&quot;201341983&quot;:0,&quot;335551550&quot;:1,&quot;335551620&quot;:1,&quot;335559739&quot;:160,&quot;335559740&quot;:259}"> </span>

<span data-contrast="auto">If you no longer wish to opt into the Munchkin beta, you can disable usage on Marketo landing pages by toggling the “Munchkin Beta on Landing Pages” feature to disabled in the </span><a href="https://experienceleague.adobe.com/docs/marketo/using/product-docs/administration/settings/enable-or-disable-treasure-chest-features.html"><span data-contrast="none">Treasure Chest menu</span></a><span data-contrast="auto">. If you have deployed the Munchkin Beta JavaScript to external web pages and wish to switch to the default Munchkin release channel, you will need to update your code snippet to load Munchkin JavaScript from munchkin.js instead of munchkin-beta.js. More detailed guidance may be found </span><a href="https://developers.marketo.com/blog/deprecation-of-munchkin-associate-lead-method/"><span data-contrast="none">here</span></a><span data-contrast="auto">.</span><span data-ccp-props="{&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:259}"> </span>
<h2>Schedule</h2>
Below is the rollout schedule as of 8/24/21
<table class="confluenceTable">
<tbody>
<tr>
<th class="confluenceTh">Phase</th>
<th class="confluenceTh">Date</th>
</tr>
<tr>
<td class="confluenceTd">Beta 10%</td>
<td class="confluenceTd">9/7/21</td>
</tr>
<tr>
<td class="confluenceTd">Beta 50%</td>
<td class="confluenceTd">9/16/21</td>
</tr>
<tr>
<td class="confluenceTd">Beta 100%</td>
<td class="confluenceTd">9/30/21</td>
</tr>
<tr>
<td class="confluenceTd">GA 10%</td>
<td class="confluenceTd">10/14/21</td>
</tr>
<tr>
<td class="confluenceTd">GA 50%</td>
<td class="confluenceTd">10/21/21</td>
</tr>
<tr>
<td class="confluenceTd">GA 100%</td>
<td class="confluenceTd">10/28/21</td>
</tr>
</tbody>
</table><br/><br/>kelkington - 2021-08-24<br/><br/><h2>TLS 1.0 and TLS 1.1 End-of-Life for Munchkin Services</h2><br/><br/>Beginning on October 21st 2021, munchkin.marketo.net, which is used to serve Munchkin JavaScript to visitors, will no longer accept connections using <a href="https://en.wikipedia.org/wiki/Transport_Layer_Security">TLS 1.0 or TLS 1.1.</a>  These encryption standards are no longer accepted as part of web security best practices and are no longer supported by modern browser versions.  There are no anticipated negative impacts as a result of this change.<br/><br/>kelkington - 2021-10-04<br/><br/><h2>October 2021 Updates</h2><br/><br/>In October 2021 we are enhancing existing REST APIs, and resolving several defects.  See the full list of updates below.
<h2>Lead Database APIs</h2>
<h4>Submit Form</h4>
<ul>
 	<li>We have enhanced the <a href="https://developers.marketo.com/rest-api/endpoint-reference/lead-database-endpoint-reference/#!/Leads/SubmitFormUsingPOST">Submit Form</a> endpoint to support program member custom fields as part of the form submission.  Optionally, a program can be specified as program to add form to, and/or the program to add program member custom fields to as described <a href="https://developers.marketo.com/rest-api/lead-database/leads/#submit_form">here</a>.</li>
</ul>
<h4>Program Membership</h4>
<ul>
 	<li>We have enhanced the <a href="https://developers.marketo.com/rest-api/endpoint-reference/lead-database-endpoint-reference/#!/Program_Members/getProgramMembersUsingGET">Get Program Members</a> endpoint to support date range based queries based on updatedAt attribute.  This is done by passing starting and ending datetime parameters as described <a href="https://developers.marketo.com/rest-api/lead-database/program-members/#query">here</a>.</li>
</ul>
<h4>Lead Fields</h4>
<ul>
 	<li>We have enhanced the <a href="https://developers.marketo.com/rest-api/lead-database/leads/#fields">Leads Fields</a> APIs to support <a href="https://experienceleague.adobe.com/docs/marketo/using/product-docs/administration/field-management/mark-a-field-as-sensitive.html?lang=en">Sensitive Fields</a>.  The <a href="https://developers.marketo.com/rest-api/endpoint-reference/lead-database-endpoint-reference/#!/Leads/getLeadFieldByNameUsingGET">Get Lead Field by Name</a>, <a href="https://developers.marketo.com/rest-api/endpoint-reference/lead-database-endpoint-reference/#!/Leads/getLeadFieldsUsingGET">Get Lead Fields</a>,  <a href="https://developers.marketo.com/rest-api/endpoint-reference/lead-database-endpoint-reference/#!/Leads/createLeadFieldUsingPOST">Create Lead Fields</a>, and <a href="https://developers.marketo.com/rest-api/endpoint-reference/lead-database-endpoint-reference/#!/Leads/updateLeadFieldUsingPOST">Update Lead Field</a> endpoints now support the isSensitive attribute.</li>
</ul>
<h2>Defect Resolutions</h2>
<ul>
 	<li>Fixed issue with <a href="https://developers.marketo.com/rest-api/user-management/">User Management</a> API.  Pertains to Marketo users that are configured for use with <a href="https://www.marketo.com/software/sales-insight/">Sales Insight</a>.  These users are now returned by <a href="https://developers.marketo.com/rest-api/endpoint-reference/user-management-endpoint-reference/#!/User_Management/getUsersUsingGET">Get Users</a> endpoint, and these users may now be deleted using <a href="https://developers.marketo.com/rest-api/endpoint-reference/user-management-endpoint-reference/#!/User_Management/deleteUserUsingPOST">Delete User</a> endpoint.  [LM-155864]</li>
 	<li>Fixed issue with Add <a href="https://developers.marketo.com/rest-api/endpoint-reference/asset-endpoint-reference/#!/Form_Fields/addRichTextFieldUsingPOST">Rich Text Field</a> endpoint.  When adding a rich text field that is longer than 65k characters to email, landing page, snippet, or form, it returned a "611, System Error".  It now returns error "701, Operation cannot be completed.  'content' exceeds maximum length of 65,535 bytes".  [LM-156706]</li>
</ul><br/><br/>deverly - 2021-10-25<br/><br/><h2>January 2022 Updates</h2><br/><br/>In January 2022 we are enhancing existing REST APIs, and resolving several defects.  See the full list of updates below.
<h2>Lead Database APIs</h2>
<h4>Bulk Custom Object Extract</h4>
<ul>
 	<li>We have enhanced the <a href="https://developers.marketo.com/rest-api/bulk-extract/bulk-custom-object-extract/#filters">Bulk Custom Object Extract</a> API to permit users to filter using an <strong>updatedAt</strong> date range.</li>
</ul>
<h4>Field Metadata</h4>
<ul>
 	<li>Added Program Member field metadata APIs that allow you to create, update, and retrieve metadata for Program Member fields.  For more information see <a href="https://developers.marketo.com/rest-api/lead-database/program-members/#fields">Program Members &gt; Fields</a>.</li>
 	<li>Added Company field metadata APIs that allow you to retrieve metadata for Company fields.  For more information see <a href="https://developers.marketo.com/rest-api/lead-database/companies/#fields">Companies &gt; Fields</a>.</li>
 	<li>Added Opportunity field metadata APIs that allow you to retrieve metadata for Opportunity fields.  For more information see <a href="https://developers.marketo.com/rest-api/lead-database/opportunities/#fields">Opportunities &gt; Fields</a>.</li>
 	<li>Added Named Account field metadata APIs that allow you to retrieve metadata for Named Account fields.  For more information see <a href="https://developers.marketo.com/rest-api/lead-database/named-accounts/#fields">Named Accounts &gt; Fields</a>.</li>
 	<li>Updated field metadata endpoints to return a new boolean property <strong>isApiCreated</strong> to indicate whether or not a field was created by the REST API.</li>
</ul>
<h2>Defect Resolutions</h2>
<ul>
 	<li>Fixed latency issue between time of call to <a href="https://developers.marketo.com/rest-api/endpoint-reference/lead-database-endpoint-reference/#!/Leads/createLeadFieldUsingPOST">Create Lead Fields</a> endpoint and time when newly created lead field was available in smart list.  [LM-152838]</li>
 	<li>Fixed issue with <a href="https://developers.marketo.com/rest-api/endpoint-reference/lead-database-endpoint-reference/#!/Leads/createLeadFieldUsingPOST">Create Lead Fields</a> endpoint where created fields were not available in form fields dropdown list used to <a href="https://experienceleague.adobe.com/docs/marketo/using/product-docs/demand-generation/forms/creating-a-form/add-a-field-to-a-form.html?lang=en">add fields to form</a> in Marketo Engage UI.  [LM-158243]</li>
 	<li>Fixed issue with <a href="https://developers.marketo.com/rest-api/endpoint-reference/lead-database-endpoint-reference/#/Campaigns/getCampaignsUsingGET">Get Campaigns</a> endpoint where triggerable campaigns were not returned when isTriggerable=true parameter was specified.  [LM-158283]</li>
 	<li>Fixed issue where <a href="https://developers.marketo.com/rest-api/endpoint-reference/lead-database-endpoint-reference/#!/Static_Lists/getLeadsByListIdUsingGET">Get Leads by List Id</a> endpoint would return an error “611, System error” in certain cases.  [LM-157214]</li>
 	<li>Cleaned up several error messages returned by <a href="https://developers.marketo.com/rest-api/lead-database/leads/#update_field">Update Lead Field</a> endpoint.  [LM-151886, LM-151888, LM-151889]</li>
</ul><br/><br/>deverly - 2022-01-27<br/><br/><h2>March 2022 Updates</h2><br/><br/>In March 2022 we are enhancing existing REST APIs, and resolving several defects.  See the full list of updates below.
<h2>Lead APIs</h2>
<h4>Bulk Activity Extract</h4>
<ul>
 	<li>We have added the <strong>actionResult</strong> field to the export file produced by the <a href="https://developers.marketo.com/rest-api/bulk-extract/bulk-activity-extract/">Bulk Activity Extract API</a>.  This field can be used to distinguish between successful, skipped, and failed activities.</li>
</ul>
<h2>Asset APIs</h2>
<h4>Emails</h4>
<ul>
 	<li>We have added the <b>isOpenTrackingDisabled </b>field to responses from <a href="https://developers.marketo.com/rest-api/assets/emails/">Emails API</a>.  This field can be used to determine whether <a href="https://experienceleague.adobe.com/docs/marketo/using/product-docs/email-marketing/general/email-editor-2/email-editor-v2-0-overview.html?lang=en">Disable Open Tracking</a> feature is enabled.</li>
</ul>
<h4>Programs</h4>
<ul>
 	<li>We have added two endpoints that allow you to selectively manage program tags.  The <a href="https://developers.marketo.com/rest-api/assets/programs/tags/#update">Update Program Tags</a> endpoint allows you to selectively update a program tag.  The <a href="https://developers.marketo.com/rest-api/assets/programs/tags/#delete">Delete Program Tags</a> endpoint allows you to selectively delete a program tag.</li>
 	<li>We have added the <strong>isExecutable</strong> parameter to the <a href="https://developers.marketo.com/rest-api/assets/smart-campaigns/#clone">Clone Smart Campaign</a> endpoint.  This parameter allows you to clone a program as an executable program.</li>
 	<li>We have added the <strong>headStart</strong> field to <a href="https://developers.marketo.com/rest-api/assets/programs/">Programs API</a>.  This allows you to create, update, and retrieve the <a href="https://experienceleague.adobe.com/docs/marketo/using/product-docs/email-marketing/email-programs/email-program-actions/head-start-for-email-programs.html?lang=en">Head Start</a> setting for Email Programs.</li>
</ul>
<h2>Defect Resolutions</h2>
<ul>
 	<li>Fixed issue with <a href="https://developers.marketo.com/rest-api/endpoint-reference/asset-endpoint-reference/#!/Emails/getEmailDynamicContentUsingGET">Get Email Dynamic Content</a> endpoint.  When trying to retrieve subject lines with dynamic content from emails that had broken template relationships, an error was returned, 709 ,""API only allows operations on emails with a template".  The endpoint now returns the dynamic content.  [LM-152331]</li>
 	<li>Fixed issue with <a href="https://developers.marketo.com/rest-api/endpoint-reference/lead-database-endpoint-reference/#!/Leads/syncLeadUsingPOST">Sync Leads</a> endpoint.  When using externalSalesPersonId to associate Sales Person with lead using externalSalesPersonId and using action = createDuplicate, then the Sales Person association would not occur.  [LM-158990]</li>
</ul>
<h2>Announcements</h2>
<h4>Adobe IMS Integration</h4>
<ul>
 	<li>Those who’ve been onboarded to <a href="https://experienceleague.adobe.com/docs/marketo/using/product-docs/administration/marketo-with-adobe-identity/overview.html?lang=en">Adobe IMS</a> cannot utilize all of the <a href="https://developers.marketo.com/rest-api/user-management/">Marketo User Management APIs</a>.  The following endpoints will return an error on when called on Marketo Instances that have been integrated with Adobe IMS : <a href="https://developers.marketo.com/rest-api/endpoint-reference/user-management-endpoint-reference/#!/User_Management/inviteUserUsingPOST">Invite User</a>, <a href="https://developers.marketo.com/rest-api/endpoint-reference/user-management-endpoint-reference/#!/User_Management/getInvitedUserUsingGET">Get Invited User by Id</a>, <a href="https://developers.marketo.com/rest-api/endpoint-reference/user-management-endpoint-reference/#!/User_Management/updateUserAttributeUsingPOST">Update User Attributes</a>, <a href="https://developers.marketo.com/rest-api/endpoint-reference/user-management-endpoint-reference/#!/User_Management/deleteUserUsingPOST">Delete User</a>, and <a href="https://developers.marketo.com/rest-api/endpoint-reference/user-management-endpoint-reference/#!/User_Management/deleteInvitedUserUsingPOST">Delete Invited User</a>.  As a replacement, the <a href="https://www.adobe.io/apis/experienceplatform/umapi-new.html">Adobe User Management APIs</a> should be used.</li>
</ul><br/><br/>deverly - 2022-03-14<br/><br/><h2>May 2022 Updates</h2><br/><br/>In May 2022 we are enhancing existing REST APIs, and resolving several defects.  See the full list of updates below.
<h2>Lead APIs</h2>
<h4>Companies, Opportunities, and Sales Persons</h4>
<ul>
 	<li>We have added the ability to retrieve <a href="https://developers.marketo.com/rest-api/lead-database/companies/#query">Company</a>, <a href="https://developers.marketo.com/rest-api/lead-database/opportunities/#query">Opportunity</a>, and <a href="https://developers.marketo.com/rest-api/lead-database/sales-persons/#query">Sales Persons</a> records when either <a href="https://experienceleague.adobe.com/docs/marketo/using/product-docs/crm-sync/salesforce-sync/sfdc-sync-details/sfdc-sync-field-sync.html?lang=en">SFDC Sync</a> or <a href="https://experienceleague.adobe.com/docs/marketo/using/product-docs/crm-sync/microsoft-dynamics/microsoft-dynamics-sync-details/microsoft-dynamics-sync-user-sync.html?lang=en">Microsoft Dynamics Sync</a> are enabled in your Marketo Engage instance.</li>
</ul>
<h2>Asset APIs</h2>
<h4>Emails</h4>
<ul>
 	<li>We have updated the <a href="https://developers.marketo.com/rest-api/endpoint-reference/asset-endpoint-reference/#!/Emails/getEmailDynamicContentUsingGET">Get Email Dynamic Content</a> endpoint to allow you to retrieve <a href="https://experienceleague.adobe.com/docs/marketo/using/product-docs/email-marketing/general/functions-in-the-editor/using-dynamic-content-in-an-email.html?lang=en">Dynamic Content</a> from an email  subject line.  This works regardless of whether the given email is linked to an email template.</li>
</ul>
<h4>Forms</h4>
<ul>
 	<li>We have updated the <a href="https://developers.marketo.com/rest-api/endpoint-reference/asset-endpoint-reference/#!/Form_Fields/addFieldToAFormUsingPOST">Add Field to Form</a> and <a href="https://developers.marketo.com/rest-api/endpoint-reference/asset-endpoint-reference/#!/Form_Fields/updateFormFieldUsingPOST">Update Form Field</a> endpoints to allow you to add and update hidden form fields.  Do this by specifying "hidden" as the <strong>fieldType</strong> parameter.</li>
 	<li>We have updated the <a href="https://developers.marketo.com/rest-api/endpoint-reference/asset-endpoint-reference/#!/Form_Fields/addFieldToAFormUsingPOST">Add Field to Form</a> and <a href="https://developers.marketo.com/rest-api/endpoint-reference/asset-endpoint-reference/#!/Form_Fields/updateFormFieldUsingPOST">Update Form Field</a> endpoints to allow you to add and update display values for <strong>select-type</strong> form fields.  Here is an example:</li>
</ul>
<pre class="lang:default decode:true" title="Request">POST /rest/asset/v1/form/{id}/field/State.json?values=[{"label":"Alaska"},{"value":"AK"},{"label":"West Virginia","value":"WV"},{"label":"Wyoming","value":"WY"}]</pre>
<ul>
 	<li>We have updated the <a href="https://developers.marketo.com/rest-api/endpoint-reference/asset-endpoint-reference/#!/Form_Fields/addFormFieldVisibilityRuleUsingPOST">Add Form Field Visibility Rules</a> endpoint to allow you to add multiple comparison values for <strong>isNot</strong> type <a href="https://developers.marketo.com/rest-api/assets/forms/#visibility_rule">Invisibility Rules</a>.   Here is an example:</li>
</ul>
<pre class="lang:default decode:true code-java" title="Request">POST /rest/asset/v1/form/{id}/field/LastName/visibility.json?
visibilityRule={"ruleType":"show","rules":[{"subjectField":"LastName","operator":"isNot","values":["A","B","C"]}</pre>
<h2>Defect Resolutions</h2>
<ul>
 	<li>Fixed issue with <a href="https://developers.marketo.com/rest-api/lead-database/leads/#submit_form">Submit Form</a> endpoint that occurred when passing "null" for an attribute in <a href="https://developers.marketo.com/rest-api/lead-database/leads/#submit_form">leadFormFields</a> parameter, an error was returned, "611, System Error".  It now correctly returns, "1003, Form validation failed" error.  [LM-162213]</li>
</ul><br/><br/>deverly - 2022-05-09<br/><br/><h2>August 2022 Updates</h2><br/><br/>In August 2022 we are enhancing existing REST APIs.  See the full list of updates below.
<h2>Lead APIs</h2>
<h4>Bulk Program Member Extract</h4>
We have added several new filters that can be used when calling <a href="https://developers.marketo.com/rest-api/endpoint-reference/lead-database-endpoint-reference/#!/Bulk_Export_Program_Members/createExportProgramMembersUsingPOST">Create Export Program Member Job</a> endpoint.  Note that many of the filters can be used in combination with each other to refine the extracted data set.
<ul>
 	<li>The <strong>programIds</strong> filter can be used to specify up to 10 program identifiers which can help improve throughput.</li>
 	<li>The <strong>isExhausted</strong> filter can be used to filter records for <a href="https://experienceleague.adobe.com/docs/marketo/using/product-docs/email-marketing/drip-nurturing/using-engagement-programs/people-who-have-exhausted-content.html?lang=en">people who have exhausted content</a>.</li>
 	<li>The <strong>nurtureCadence</strong> filter can be used to filter records based on <a href="https://experienceleague.adobe.com/docs/marketo/using/product-docs/core-marketo-concepts/smart-campaigns/program-flow-actions/change-engagement-program-cadence.html?lang=en">engagement program cadence</a>.</li>
 	<li>The <strong>statusNames</strong> filter can be used to filter records for one or more <a href="https://experienceleague.adobe.com/docs/marketo/using/product-docs/core-marketo-concepts/programs/creating-programs/understanding-program-membership.html?lang=en">program statuses</a>.</li>
 	<li>The <strong>updatedAt</strong> filter can be used to filter records based on a date range.</li>
</ul>
<h2>Announcements</h2>
<ul>
 	<li>The behavior of the <a href="https://developers.marketo.com/rest-api/endpoint-reference/authentication-endpoint-reference/#!/Identity/identityUsingGET">Identity</a> endpoint has changed.  When you call the endpoint and do not include an <strong>access_token</strong> parameter, the "603, Access denied" error is returned.  Previously, the "600, Empty access token" error was returned.  Note that the "600, Empty access token" error has been deprecated.</li>
</ul><br/><br/>deverly - 2022-09-03<br/><br/><h2>October 2022 Updates</h2><br/><br/>In October 2022 we are enhancing existing REST APIs.  See the full list of updates below.
<h2>Lead APIs</h2>
<h4>Bulk Lead Import</h4>
<ul>
 	<li>We have enhanced the <a href="https://developers.marketo.com/rest-api/bulk-import/bulk-lead-import/">Bulk Lead Import API</a> to support adding Leads to Sales Persons records during the import process.  This is done by including the <strong>externalSalesPersonId</strong> field in the import file.</li>
</ul>
<h2>Defect Resolutions</h2>
<ul>
 	<li>Fixed issue with <a href="https://developers.marketo.com/rest-api/lead-database/leads/#create_fields">Create Lead Fields</a> endpoint that occurred when creating Score type fields.  These fields were not available for use in the <a href="https://experienceleague.adobe.com/docs/marketo/using/product-docs/core-marketo-concepts/smart-campaigns/flow-actions/change-score.html?lang=en">Change Score</a> flow action in the Marketo Engage UI.  [LM-166815]</li>
</ul>
<h2>Announcements</h2>
<ul>
 	<li>The Program Membership attribute <strong>acquiredBy</strong> has been changed to be updateable.</li>
</ul><br/><br/>deverly - 2022-10-18<br/><br/><h2>Upcoming change to Marketo Forms REST API</h2><br/><br/><span data-contrast="auto">Beginning with the 2022.R2 release, currently scheduled for the week of March 24</span><span data-contrast="auto">th</span><span data-contrast="auto"> 2023, the Adobe Marketo Engage Forms Asset APIs will consistently return only the name of the form without a prefixed program name, regardless of whether the form is a child of a program or not.  This change will make the Forms API’s behaviors with regard to asset names consistent with the rest of the Adobe Marketo Engage Asset APIs.</span><span data-ccp-props="{&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:259}"> </span>

<span data-contrast="auto">To avoid service disruptions, you should review any integrations which use MArketo Engage Forms APIs and work with your integrators to see if any changes are needed to accommodate this this</span><span data-ccp-props="{&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:259}"> </span>

<span data-contrast="auto">Prior to this upcoming change, names returned by the Forms APIs inconsistently prefixed a program name for forms which are children of programs in Marketing Activities.  For example, a form named “Form 1,” that was a child of “Program 1,” may have its name returned by the API as:</span><span data-ccp-props="{&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:259}"> </span>

<span data-contrast="auto">Program 1.Form 1</span><span data-ccp-props="{&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:259}"> </span>

<span data-contrast="auto">Or</span><span data-ccp-props="{&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:259}"> </span>

<span data-contrast="auto">Form 1</span><span data-ccp-props="{&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:259}"> </span>

<span data-contrast="auto">Beginning with the 2022.R2 release, the name of a form will always be returned without a prefixed program name.  Using the same example, the name would always be:</span><span data-ccp-props="{&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:259}"> </span>

<span data-contrast="auto">Form 1</span><span data-ccp-props="{&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:259}"> </span><br/><br/>kelkington - 2022-11-04<br/><br/><h2>January 2023 Updates</h2><br/><br/>In January 2023 we made an API-related enhancement to the Admin UI and  are making two announcements.  See the full list of updates below.
<h2>Admin UI</h2>
<h4>Bulk Lead Extract</h4>
<ul>
 	<li>We have enhanced the Marketo Engage Admin UI to allow you to view the Bulk Extract API daily capacity allocation for your subscription.  In addition, you can view capacity use by API-User over the past 7 days.  More information can be found <a href="https://experienceleague.adobe.com/docs/marketo/using/product-docs/administration/settings/bulk-export-api-information.html">here</a>.</li>
</ul>
<h2>Defect Resolutions</h2>
<ul>
 	<li>Fixed issue with <a href="https://developers.marketo.com/rest-api/endpoint-reference/lead-database-endpoint-reference/#!/Opportunities/deleteOpportunitiesUsingPOST">Delete Opportunities</a> endpoint.  In certain cases, a "Remove from Opportunity" activity was not being generated.  [LM-172208]</li>
</ul>
<h2>Announcements</h2>
<ul>
 	<li>Please see <a href="https://nation.marketo.com/t5/product-documents/upcoming-change-to-marketo-rest-api/ta-p/331698">this article</a> on Marketo Community regarding REST API and a change to the HTTP response message <a href="https://www.rfc-editor.org/rfc/rfc7230#section-3.1.2">reason phrase</a>.</li>
 	<li>The Program Membership attribute <b>statusReason </b>has been changed to be updateable.</li>
</ul><br/><br/>deverly - 2023-01-21<br/><br/>
</body>
</html>